// ==UserScript==
// @name         Facebook Phones.Trade Bot
// @namespace    http://tampermonkey.net/
// @version      24.1113.15
// @description  try to take over the world!
// @author       You
// @match        https://www.facebook.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=facebook.com
// @grant        GM.getValue
// @grant        GM.setValue


// @grant        GM_addElement
// @grant        GM_addStyle
// @run-at document-end
// @sandbox DOM
// @require https://code.getmdl.io/1.3.0/material.min.js
// @require https://cdnjs.cloudflare.com/ajax/libs/getmdl-select/2.0.1/getmdl-select.min.js
// @require https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js
// @require https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.5.6/dialog-polyfill.min.js
// @require https://cdn.trackjs.com/agent/v3/latest/t.js
// @require https://login.hopla.to/js/hopla-login.js
// ==/UserScript==

(function() {
  'use strict';
// https://raw.githubusercontent.com/HOPLAtools/snatchbots-facebook-marketplace/main/index.js ;


/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={2373:(e,t,n)=>{"use strict";n.r(t),n.d(t,{checkStoredSubscriptionId:()=>i});var a=n(1334),s=n(1221);async function i(){const e=await(0,a.chromeStorageGet)("subscription_id");if(e)return(0,s.ln)(e)}},4087:(e,t,n)=>{"use strict";n.r(t),n.d(t,{api_search:()=>m,api_sendMessage:()=>u});var a=n(4484),s=n(1203),i=n(3539),o=n(5703),r=n(8544),l=n(2287),c=n(4246),d=n(7367);async function u(e,t){const n=(0,o.W)(),m=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded",pragma:"no-cache","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceMessageSellerMutation","x-fb-lsd":"eGdwssYEVXB7hv3L3hNExb"},referrer:`https://www.facebook.com/marketplace/item/${e}/?ref=browse_tab&referral_code=marketplace_top_picks&referral_story_type=top_picks`,referrerPolicy:"strict-origin-when-cross-origin",body:`av=${n}&__user=${n}&__a=1&__req=w&__hs=19538.HYP%3Acomet_pkg.2.1..2.1&dpr=2&__ccg=GOOD&__rev=1007773680&__s=pz5dko%3Au0mc7e%3Aeov58w&__hsi=7250295222789373259&__dyn=7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2CE4ibyQdwSAxacyUco5S3O2Saw8i2S1DwUx60GE3Qwb-q7oc81xoswIK1Rwwwg8a8465o-cw5Mx62G5Usw9m1YwBgK7o884y0Mo4G4UcUC7Udo5qfK0zEkxe2GewyDwkUtxGm2SUbElxm3y3aexfxmu3W3y261eBx_y88E3qxWm2Sq2-azo7u3C223908O321LwTwNxe6Uak1xwJwxyo6O1Fw&__csr=gL15aAxKBbb6JOO9iH4nR6Rbth1cOT9czcPOvjXldQQTTbF9OPn4qhfsHVuHiOr8AVqHCCG-FsC8CaVdfZVq8FaHhFe-aBZ4-O7ighK5FF-QEqm8y9EgVoKtoSVUJ4gR7Az4icAjghzaBxa9xi6o--u4UsWAyoOfKfwACxR1e9z8WbK1dAxqUG5UOcy8GUipGDCG2bxdem6S3e5EqxGdzElUy5VpFoKexO3SqfwWCz89qwg82gwyGu4k5ofUcoarwtUW7VoWawspEWVojxa6ofotw0Jnw0D8w0gO401VrDwea02WK0qO0xE2Ww1Mqu0yo8FEuBgnwbfway1Nw-wJw0Nkw0FsggwBw1360eIoS0RU2Qw7EwKDg0bDA06EqwSw6AhFd0FQi0q92oqA84IM5S0pa0tuu0ii0ehUfo&__comet_req=15&fb_dtsg=${(0,r.getFb_dtsg)()}&jazoest=25701&lsd=eGdwssYEVXB7hv3L3hNExb&__spin_r=1007773680&__spin_b=trunk&__spin_t=1688090903&fb_api_caller_class=RelayModern&fb_api_req_friendly_name=CometMarketplaceMessageSellerMutation&variables=%7B%22input%22%3A%7B%22attribution_id_v2%22%3A%22CometMarketplaceHoistedPermalinkContentContainer.react%2Ccomet.marketplace.item%2Cvia_cold_start%2C1688090903780%2C951%2C1606854132932955%2C%22%2C%22listing_id%22%3A%22${e}%22%2C%22message%22%3A%22${t}%22%2C%22referral_surface%22%3A%22browse_tab%22%2C%22surface%22%3A%22product_details%22%2C%22tracking%22%3Anull%2C%22ui_component%22%3A%22contact_seller_button%22%2C%22actor_id%22%3A%22100023618722690%22%2C%22client_mutation_id%22%3A%222%22%7D%7D&server_timestamps=true&doc_id=4861194384003324`,method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,l.handleFetchErrors)(e))).then((e=>e.text()));if(m&&m.match(/api_error_code":368/i)){console.log("Send message blocked.");const n=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,a=moment(n).calendar();return(0,i.CONSOLE_MESSAGE)("halted_soft",{schedule:a}),(await(0,d.stats)()).addKo(),window.isKO=!0,await(0,c.sleep)(60*s.waitIfSpamDetected*1e3),window.isKO=!1,await u(e,t)}if(m&&m.match(/User Verification Needed/i))return console.log("Verification needed."),(0,i.CONSOLE_MESSAGE)("custom","Account verification required.."),await(0,c.sleep)(864e5),"STOP";if(m&&m.match(/1378009/i))return console.log("Failed to send message. Not all buyers can message this seller.",e),{error:m};if(m&&m.match(/error/i))return await(0,a._apiSendBug)({error:"Failed to send message",response:m,listing_id:e,message:t}),{error:m};let p;try{p=m.match(/thread_id":"(\d+)"/i)[1]}catch(e){console.error("Failed to get thread_id",m)}const g={success:!0};return p&&(g.thread_id=p),g}async function m({keyword:e,lat:t=7.79716,long:n=122.763,radius:a=65,count:s=24}){const r={buyLocation:{latitude:t,longitude:n},contextual_data:null,count:24,cursor:null,flashSaleEventID:"",hasFlashSaleEventID:!1,marketplaceSearchMetadataCardEnabled:!1,params:{bqf:{callsite:"COMMERCE_MKTPLACE_WWW",query:e},browse_request_params:{commerce_enable_local_pickup:!0,commerce_enable_shipping:!0,commerce_search_and_rp_available:!0,commerce_search_and_rp_category_id:[],commerce_search_and_rp_condition:null,commerce_search_and_rp_ctime_days:null,filter_location_latitude:t,filter_location_longitude:n,filter_price_lower_bound:0,filter_price_upper_bound:214748364700,filter_radius_km:a},custom_request_params:{browse_context:null,contextual_filters:[],referral_code:null,saved_search_strid:null,search_vertical:"C2C",seo_url:null,surface:"SEARCH",virtual_contextual_filters:[]}},savedSearchID:null,savedSearchQuery:e,scale:2,shouldIncludePopularSearches:!1},d=(0,o.W)(),u={av:d,__user:d,__a:"1",__req:"1y",__hs:"19538.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:"1007776100",__s:"5quzjd:u0mc7e:7xf1x9",__hsi:"7250391670970196399",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K361twYwJyE24wJwpUe8hwaG0Z82_CxS320om78bbwto88422y11xmfz81s8hwGxu782lwv89kbxS2218wc61axe3S7Udo5qfK0zEkxe2GewyDwkUtxGm2SUbElxm3y3aexfxmu3W3y261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1Iwqo",__csr:"ghjgDdsIl5h7REr69Wj4hcA8JlGgAZ8yGOAIBsiZKy8IGchYhc-h4AQ-SKCWjQHiFb9Di-D9GQqiWOfQA-DqAFpV8PoG-4rVAaUFKuQmXKiWho-5qxamqi4EF2fDDjAzUKpoKvxa8VoOcBzUhwWheaS7oS2uay9onAwRwwxuuewOxq5GyovAxe9yUD-58qxacxe2ieK9wNz98jy9oqzohDKE7y5E4W3u2R0UxO3a3PxidwSwZwIwGwh9Ehxq2O3a5UmwpEKewVw09yt00Tig04iO02WS0o-0G82Lw1LC5U2hwhFA0pS1xwnE5a01Gww3NO072w7cgmU0bvFU0rNzo1C9Z0PWQi0qy4lA9mEK1Fw73w4mQ0Nk0To0ZF0",__comet_req:"15",fb_dtsg:"NAcO1KsFTdHd-D4iLqt4IgugVzA01qlAIoSoHyEaLGNXjQzvYYThG9A:29:1688000622",jazoest:"25437",lsd:"IudQ3V8x_C_Vv_XEg-5tyu",__spin_r:"1007776100",__spin_b:"trunk",__spin_t:"1688113359",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:"CometMarketplaceSearchContentContainerQuery",variables:JSON.stringify(r),server_timestamps:"true",doc_id:"6555223147833946"};let g=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:p(u),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,l.handleFetchErrors)(e))).then((e=>e.json()));const _=JSON.stringify(g);return _&&_.match(/api_error_code":368/i)?(console.log("search api rate limit exceeded"),(0,i.CONSOLE_MESSAGE)("custom","Rate limit exceeded. Waiting for 1 hour."),await(0,c.sleep)(36e5),m({keyword:e,lat:t,long:n,radius:a,count:s})):_&&_.match(/User Verification Needed/i)?(console.log("Verification needed."),(0,i.CONSOLE_MESSAGE)("custom","Account verification required.."),await(0,c.sleep)(864e5),m({keyword:e,lat:t,long:n,radius:a,count:s})):g.data.marketplace_search.feed_units.edges.map((e=>{const t=e.node.listing;return{title:t.marketplace_listing_title,price:t.listing_price.formatted_amount,id:t.id,seller:t.marketplace_listing_seller}}))}function p(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}},4484:(e,t,n)=>{"use strict";n.r(t),n.d(t,{_apiSendBug:()=>i});var a=n(2617),s=n(4246);function i(e){const t=(new Date).getTime();e.log_id=t;try{e.email||(e.email=(0,a.g)())}catch(e){console.error("failed to add email to log.")}return window.tabId&&(e.tabId=window.tabId),window.taEmail&&(e.partner_email=window.taEmail),unsafeWindow.taPartnerId&&(e.taPartnerId=unsafeWindow.taPartnerId),e.extension_version=window.extension_version,async function t(n){return fetch("https://cloudlogging.hopla.workers.dev/log?function=facebookbot",{method:"POST",body:JSON.stringify(e),mode:"no-cors"}).then((e=>e.text())).catch((async e=>(console.error("Fetch Failed (_apiSendBug)",e,n),n&&n>6?"":(await(0,s.sleep)(1e4),n||(n=0),t(n+=1)))))}().catch((e=>(console.error("Fetch Failed (_apiSendBug)",e),"")))}},9088:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addAllUserListingsToSkipList:()=>i});var a=n(3539),s=n(8521);async function i(e,t,n,i,o){if(n){const r=n.filter((e=>e.id)).map((e=>e.id));if(o){const e=r.indexOf(o);e>-1&&r.splice(e,1)}return(0,a.CONSOLE_MESSAGE)("custom",`Adding ${r.length} listings of ${t} (${e}) to skip list.`),(0,s.skips)().saveToSkipListingBatch(r,i)}}},8048:(e,t,n)=>{"use strict";n.r(t),n.d(t,{promptarchive:()=>w});var a=n(3539),s=n(175),i=n(3177),o=n(4246),r=n(1203),l=n(5703),c=n(8544),d=n(2287),u=n(7367),m=n(5078),p=n(6728);async function g(e){window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const t={};let n=e&&e.cursor;const w=e&&e.previousThreads;n&&(t.cursor=n,t.count=12);let h=e&&e.page;h||(h=1),console.log("Fetching inbox threads. Page: ",h);const f=(0,c.getFb_dtsg)(),y=(0,m.getFrom)(document.body.outerHTML,'revision":',",");for(var b="2",x=0;x<f.length;x++)b+=f.charCodeAt(x);const S=(0,m.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}'),v=n?"CometMarketplaceInboxBuyerTabViewPaginationQuery":"CometMarketplaceInboxBuyerTabViewContainerQuery",E=n?"6063301870422274":"9150907031651351",k=(0,l.W)(),L={av:k,__user:k,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${y}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:f,jazoest:b,lsd:S,__spin_r:y,__spin_b:"trunk",__spin_t:"1688385023",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:v,variables:JSON.stringify(t),server_timestamps:"true",doc_id:E};let C=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:_(L),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,d.handleFetchErrors)(e))).then((e=>e.json()));const I=JSON.stringify(C);if(I&&I.match(/api_error_code":368/i)){console.log("Fetch inbox thread rate limited.");const t=(new Date).getTime()+60*r.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,a.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,u.stats)()).addKo(),window.isKO=!0,await(0,o.sleep)(60*r.waitIfSpamDetected*1e3),window.isKO=!1,g(e)}let A=[];const O=C&&C.data&&C.data.viewer&&C.data.viewer.marketplaceInboxBuyerMessageThreads&&C.data.viewer.marketplaceInboxBuyerMessageThreads.edges;if(O){const e=document.getElementById("archiveolderthan").value;for(let t=0;t<O.length;t++){const n=O[t],a=n&&n.node;if(a&&a.updated_time_precise)if((0,p.hasDaysPassed)(e,a.updated_time_precise))A.push(a);else{let t;try{t=a.marketplace_thread_data.messageable_item.marketplace_listing_title}catch(e){}console.log(`Thread ${t} last update is less than <`,e,"will not archive")}}}const q=document.querySelector("#switch-skipunread").checked;let M=await async function(e,t=!0){const n=document.getElementById("amount_to_archive").value||0;let a=0;for(const r of e){const l=r&&r.thread_key&&r.thread_key.thread_fbid;if(l){if(t&&r.unread_count>0){console.log("threadid",l,"has unread messages",r.unread_count);continue}if(!t&&r.unread_count>0&&console.log("Did not skip unread because skipunread is false"),await(0,s.changeArchivedStatus)(l,!0),window.iArchived||(window.iArchived=0),window.iArchived+=1,a+=1,window.iArchived>=n){window.iArchived=0;const t=`Archived ${a} threads of ${e.length} threads in Page.`;return console.log(t),console.log(`Reached max archive of ${n}`),"max archive reached"}const c=(0,i.l)(1,5);console.log("Archived",l,"Timeout for",c,"s"),await(0,o.sleep)(1e3*c)}}const r=`Archived ${a} threads of ${e.length} threads in Page.`;console.log(r)}(A,q);if("max archive reached"===M)return A;w&&(A=w.concat(A));const U=C&&C.data&&C.data.viewer&&C.data.viewer.marketplaceInboxBuyerMessageThreads&&C.data.viewer.marketplaceInboxBuyerMessageThreads.page_info;if(U&&U.has_next_page){n=U.end_cursor;const e=(0,i.l)(5,10);return await(0,o.sleep)(1e3*e),console.log("Timeout for",e,"s"),g({cursor:n,previousThreads:A,page:h+1})}return A}function _(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}async function w(){"ARCHIVE"===prompt("Are you sure you want to archive all read threads in your marketplace inbox? Type ARCHIVE to confirm:")&&((0,a.CONSOLE_MESSAGE)("custom","Archiving read threads..."),async function(){console.log("Starting to archive threads with no unread messages..."),await g();const e="Finished archiving read threads.";console.log(e),(0,a.CONSOLE_MESSAGE)("custom",e)}())}},1424:(e,t,n)=>{"use strict";n.r(t),n.d(t,{attachEvents:()=>R});var a=n(8048),s=n(1203),i=n(8785),o=n(1023),r=n(4246),l=n(6183);async function c(){(0,o.showLoading)(!0);const e=await(0,l.getListingDetails)();let t=e.photos;const n=parseInt(document.getElementById("num_images").value,10);n&&t&&t.length>n&&(t=t.slice(0,n));try{navigator.clipboard.writeText(e.text+"\nPhotos: "+JSON.stringify(t))}catch(e){console.log("Error copying to clipboard",e)}(0,o.showLoading)(!1),await(0,r.sleep)(1e3),alert("Details has beed copied to clipboard")}var d=n(4711);function u(e){const t=e.target.textContent;if(window.lastInputId){const e=document.getElementById(window.lastInputId[0]);let n=e.value;n=[n.slice(0,window.lastInputId[1]),t,n.slice(window.lastInputId[1])].join(""),e.value=n,e.parentNode.classList.add("is-focused"),e.focus();const a=window.lastInputId[1]+t.length;e.setSelectionRange(a,a)}}function m(e){let t=e.target.value;t=t.split("\n").map((e=>e.replace(/[^0-9,.-]/g,""))).filter((e=>e.length)),t=t.join("\n"),e.target.value=t}function p(e){let t=e.target.value;t=t.replace(/[^0-9.-]/g,""),e.target.value=t}function g(e){let t=e.target.value;t=t.replace(/[^0-9.\-%]/g,""),e.target.value=t}var _=n(9485),w=n(9309),h=n(3539),f=(n(7164),n(8521));async function y(){(0,o.showLoading)("Getting listing details..."),(0,h.CONSOLE_MESSAGE)("custom","Getting listing details...");const e=await(0,l.getListingDetails)();if(!e)return void(0,o.showLoading)(!1);(0,o.showLoading)("Generating message..."),(0,h.CONSOLE_MESSAGE)("custom","Generating message...");const t=await(0,w.generateMessage)(e.text,e.photos);if((0,o.showLoading)(!1),(0,h.CONSOLE_MESSAGE)("custom","Message generated."),"skip"!==t.status){if("message"===t.status){let e=t.message;return Array.isArray(e)&&(e=e.join("\n")),void alert(e)}return"error"===t.status?((0,o.showLoading)(!1),void alert(t.message)):void 0}alert(t.message)}var b=n(1334);async function x(){"LISTINGS"===prompt("Are you sure you want to purge your listings skip list? Type LISTINGS to confirm:")&&((0,h.CONSOLE_MESSAGE)("custom","Purging listings..."),async function(){const e=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?purge=1&listname=listings&partnerid=${window.taPartnerId}`).then((e=>e.json()));if(e.success){const e="skip_listings";await(0,b.chromeStorageRemove)(e),(0,h.CONSOLE_MESSAGE)("custom","Listings has been successfully purged.")}else console.error("Failed to purge listings.",e),(0,h.CONSOLE_MESSAGE)("custom","Failed to purge listings.")}())}async function S(){"OWNERS"===prompt("Are you sure you want to purge your owners skip list? Type OWNERS to confirm:")&&((0,h.CONSOLE_MESSAGE)("custom","Purging owners..."),async function(){const e=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?purge=1&listname=usersskip&partnerid=${window.taPartnerId}`).then((e=>e.json()));if(e.success){const e="skip_usersskip";await(0,b.chromeStorageRemove)(e),(0,h.CONSOLE_MESSAGE)("custom","Owners has been successfully purged.")}else console.error("Failed to purge owners.",e),(0,h.CONSOLE_MESSAGE)("custom","Failed to purge owners.")}())}n(9971);var v=n(4423);async function E(e){const t=e.target.id;if(t)if("radio"===e.target.type){const n=e.target.name;(0,b.chromeStorageSet)(`radio_${n}`,t)}else"checkbox"===e.target.type?((0,b.chromeStorageSet)(`input_${t}`,e.target.checked),"switch-rununtil"===t&&(e.target.checked?(await k("Bot is starting in ",5),window.location.reload()):(unsafeWindow.isRun=0,delete unsafeWindow.runningInstanceId,(0,v.o)(!0),await k("Bot is stopping in ",5),window.location.reload()))):(0,b.chromeStorageSet)(`input_${t}`,e.target.value)}async function k(e,t){for(let n=t;n>0;n--)console.log(e,n),(0,h.CONSOLE_MESSAGE)("custom",e+n),await new Promise((e=>setTimeout(e,1e3)))}var L=n(1221),C=n(13),I=n(8365),A=n(1060),O=n(7480),q=n(1773),M=n(9237),U=n(6564),N=n(313),D=n(5639);async function G(){(0,o.showLoading)(!0);let e=window.location.href;if(!e)return(0,o.showLoading)(!1),void alert("Please enter a valid listing URL.");let t="";if(isNaN(e)){let n=e.match(/marketplace\/item\/(\d+)\/?/);n&&(t=n[1])}else t=e;if(!t)return(0,o.showLoading)(!1),void alert("Current page is not a listing page.");const n=await(0,C.fetchListingDetails)({id:t});if(console.log("listingDetails",n),0===Object.keys(n).length)return(0,o.showLoading)(!1),void alert("Faild to get listing details. Listing not found.");let a=await(0,I.x)(n);const i=await(0,A.$)(n.title),l=function(e){let t=Number(document.querySelector("#listing_min_price").value)||0,n=Number(document.querySelector("#listing_max_price").value)||214748364700,a=e.price;return"string"==typeof a&&(a=Number(a.replace(/[^0-9\.]+/g,""))),isNaN(a)&&(a=0),a>=t&&a<=n}(n),c=await(0,f.skips)().isSkipListing(t),d=await(0,f.skips)().isSkipMessagedListing(t),u=await(0,f.skips)().isSkipMessagedUser(n.seller.id);console.log("isMessagedSeller",u),u&&console.log(`User ${n.seller.id} was already messaged ${moment(u).fromNow()}`);const m=await(0,f.skips)().isSkipUser(n.seller.id),p=await async function(e){const t=await(0,O.readCoordinates)();if(e.location&&t){let n=parseInt(document.getElementById("radius").value||"65");const a=(0,q.c)(e.location.latitude,e.location.longitude,t.lat,t.lon);return console.log("distance",e.location.latitude,e.location.longitude,t.lat,t.lon,a),console.log("radius",n),a<=n}}(n),g=await(0,A.P)(n.description),_=await async function(e){const t=document.getElementById("listing_max_age").value;if(Number(t)<1){const n=100*t;return(0,M.h)(e.creationTime)<=n}return(0,M.f)(e.creationTime)<=t}(n),w=await async function(e){const t=e&&e.seller&&e.seller.id;let n=document.getElementById("skip_profiles_created_after_year");n&&(n=Number(n.value)),n||(n=s.DEFAULT_SKIP_OWNERCREATION_YEAR);const a=await(0,U.getUserJoined)(t);return a&&a>=n}(n),h=n.seller.id,y=n.seller.name,b=n.title,x=await(0,D.getUserListings)(h,!0),S=await(0,N.R)(t,h,y,b,"",x,!0);console.log("isListingsCountInRange",S),(0,o.showLoading)(!1),await(0,r.sleep)(1e3);let v=`Keyword in title ${a?"✅":"❌"}\n`;v+=`No skipword in title ${i?"❌":"✅"}\n`,v+=`Price in range: ${l?"✅":"❌"}\n`,v+=`Listing not in SkipList ${c?"❌":"✅"}\n`,v+=`Listing not in MessagedList ${d?"❌":"✅"}\n`,v+=`Seller not in SkipList ${m?"❌":"✅"}\n`,v+=`Seller not in MessagedList ${u?"❌":"✅"}\n`,v+=`Listing distance in range ${p?"✅":"❌"}\n`,v+=`No skipword in description: ${g?"❌":"✅"}\n`,v+=`Listing age not maxed ${_?"✅":"❌"}\n`;let E=document.getElementById("skip_profiles_created_after_year");E&&(E=Number(E.value)),E||(E=s.DEFAULT_SKIP_OWNERCREATION_YEAR),v+=`Seller profile creation date is < ${E} ${w?"❌":"✅"}\n`,v+=`Owner listings count in range ${S?"✅":"❌"}\n`,alert(v)}var F=n(3142);function T(){(0,F.testCategorySearch)()}var j=n(7121);function $(e,t){e.target.value<t&&(e.target.value=t)}function B(e,t){e.target.value>t&&(e.target.value=t)}function K(e,t,n){let a=t.value;a=Number(a);let s=e.value;s=Number(s),a-s<n&&(t.value=s+n)}function P(e,t){let n=e.target.value,a=t.value;Number(n)>Number(a)&&(t.value=n)}function W(e,t){let n=e.target.value,a=t.value;Number(n)<Number(a)&&(e.target.value=a)}function R(){document.querySelector("#roundupdown").addEventListener("change",window.prefix),document.querySelector("#roundupdown").addEventListener("change",E),document.querySelector("#streak").addEventListener("change",E),document.querySelector("#streaktimeout").addEventListener("change",E),document.querySelector("#followup_after").addEventListener("change",E),document.querySelector("#followup_after").addEventListener("change",(e=>{$(e,s.followAfterMinutes[0]),B(e,s.followAfterMinutes[1])})),document.querySelector("#keywords").addEventListener("change",E),document.querySelector("#keywords").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#searchwithfilters").addEventListener("change",E),document.querySelector("#searchwithfilters").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#title_must_include").addEventListener("change",E),document.querySelector("#title_must_include").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#skipwords_title").addEventListener("change",E),document.querySelector("#skipwords_title").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#skipwords_description").addEventListener("change",E),document.querySelector("#skipwords_description").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#ownerlisting_kw_match").addEventListener("change",E),document.querySelector("#ownerlisting_kw_match").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#coordinates").addEventListener("change",m),document.querySelector("#coordinates").addEventListener("change",E),document.querySelector("#coordinates").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#radius").addEventListener("change",p),document.querySelector("#radius").addEventListener("change",E),document.querySelector("#radius").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#message_1").addEventListener("change",E),document.querySelector("#message_1").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#message_2").addEventListener("change",E),document.querySelector("#message_2").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#message_3").addEventListener("change",E),document.querySelector("#message_3").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#followup_1").addEventListener("change",E),document.querySelector("#followup_1").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#followup_2").addEventListener("change",E),document.querySelector("#followup_2").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#followup_3").addEventListener("change",E),document.querySelector("#followup_3").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#messageonreply_1").addEventListener("change",E),document.querySelector("#messageonreply_1").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_min_price").addEventListener("change",E),document.querySelector("#listing_min_price").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_min_price").addEventListener("change",(e=>{P(e,document.querySelector("#listing_max_price"))})),document.querySelector("#listing_max_price").addEventListener("change",E),document.querySelector("#listing_max_price").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_max_price").addEventListener("change",(e=>{W(e,document.querySelector("#listing_min_price"))})),document.querySelector("#owner_min_lists").addEventListener("change",E),document.querySelector("#owner_min_lists").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#owner_min_lists").addEventListener("change",(e=>{P(e,document.querySelector("#owner_max_lists"))})),document.querySelector("#owner_max_lists").addEventListener("change",E),document.querySelector("#owner_max_lists").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#owner_max_lists").addEventListener("change",(e=>{W(e,document.querySelector("#owner_min_lists"))})),document.querySelector("#listing_price_delta").addEventListener("change",g),document.querySelector("#listing_price_delta").addEventListener("change",E),document.querySelector("#listing_price_delta").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_max_age").addEventListener("change",p),document.querySelector("#listing_max_age").addEventListener("change",E),document.querySelector("#listing_max_age").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_max_age").addEventListener("change",(e=>{W(e,document.querySelector("#listing_min_age"))})),document.querySelector("#listing_min_age").addEventListener("change",p),document.querySelector("#listing_min_age").addEventListener("change",E),document.querySelector("#listing_min_age").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_min_age").addEventListener("change",(e=>{P(e,document.querySelector("#listing_max_age"))})),document.querySelector("#skip_profiles_created_after_year").addEventListener("change",p),document.querySelector("#skip_profiles_created_after_year").addEventListener("change",E),document.querySelector("#skip_profiles_created_after_year").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#runfrom").addEventListener("change",E),document.querySelector("#rununtil").addEventListener("change",E),document.querySelector("#switch-deleteaftersend").addEventListener("change",E),document.querySelector("#switch-rununtil").addEventListener("change",E),document.querySelector("#switch-rununtil").addEventListener("change",(()=>{(0,j.X)(!document.querySelector("#switch-rununtil").checked)})),document.querySelectorAll("#ta .variables .variable").forEach((e=>e.addEventListener("click",u))),document.querySelectorAll("#ta #login_with_subscription_id").forEach((e=>e.addEventListener("click",L.ln))),document.querySelector("#ta #test_template").addEventListener("click",window.testTemplates),document.querySelector("#copy_search_filters").addEventListener("click",i.copySearchFilters),document.querySelector("#test_search_filters").addEventListener("click",T),document.querySelector("#ta #restore_defaults").addEventListener("click",unsafeWindow.restoreDefaults),document.querySelector("#purge_listings").addEventListener("click",x),document.querySelector("#purge_owners").addEventListener("click",S),document.querySelector("#archive_all_threads").addEventListener("click",a.promptarchive),document.querySelector("#ta_maximize").addEventListener("click",_.E),document.querySelector("#owner_message_expiry").addEventListener("change",V),document.querySelector("#btn_test_url").addEventListener("click",G),document.querySelector("#download_listings").addEventListener("click",d.downloadListingSkipList),document.querySelector("#download_owners").addEventListener("click",d.downloadOwnerSkipList),document.querySelector("#switch-loopsearch").addEventListener("change",E),document.querySelector("#timeout_api_calls_min").addEventListener("change",E),document.querySelector("#timeout_api_calls_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_api_calls_min").addEventListener("change",(e=>{$(e,s.apiCallDelay[0]),K(e.target,document.querySelector("#timeout_api_calls_max"),5)})),document.querySelector("#timeout_api_calls_max").addEventListener("change",E),document.querySelector("#timeout_api_calls_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_api_calls_max").addEventListener("change",(e=>{B(e,s.apiCallDelay[1]),K(document.querySelector("#timeout_api_calls_min"),e.target,5)})),document.querySelector("#timeout_listings_messaged_min").addEventListener("change",E),document.querySelector("#timeout_listings_messaged_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_listings_messaged_min").addEventListener("change",(e=>{$(e,s.userDelay[0]),K(e.target,document.querySelector("#timeout_listings_messaged_max"),10)})),document.querySelector("#timeout_listings_messaged_max").addEventListener("change",E),document.querySelector("#timeout_listings_messaged_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_listings_messaged_max").addEventListener("change",(e=>{B(e,s.userDelay[1]),K(document.querySelector("#timeout_listings_messaged_min"),e.target,10)})),document.querySelector("#timeout_streak_min").addEventListener("change",E),document.querySelector("#timeout_streak_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_streak_min").addEventListener("change",(e=>{$(e,s.timeout_streak[0]),K(e.target,document.querySelector("#timeout_streak_max"),10)})),document.querySelector("#timeout_streak_max").addEventListener("change",E),document.querySelector("#timeout_streak_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_streak_max").addEventListener("change",(e=>{B(e,s.timeout_streak[1]),K(document.querySelector("#timeout_streak_min"),e.target,10)})),document.querySelector("#timeout_end_of_run_min").addEventListener("change",E),document.querySelector("#timeout_end_of_run_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_end_of_run_min").addEventListener("change",(e=>{$(e,s.timeout_perpage[0]),K(e.target,document.querySelector("#timeout_end_of_run_max"),10)})),document.querySelector("#timeout_end_of_run_max").addEventListener("change",E),document.querySelector("#timeout_end_of_run_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_end_of_run_max").addEventListener("change",(e=>{B(e,s.timeout_perpage[1]),K(document.querySelector("#timeout_end_of_run_min"),e.target,10)})),document.querySelector("#stop_messaging_after").addEventListener("change",E),document.querySelector("#stop_messaging_after").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_between_messages_min").addEventListener("change",E),document.querySelector("#timeout_between_messages_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_between_messages_min").addEventListener("change",(e=>{$(e,s.timeout_permessage[0]),K(e.target,document.querySelector("#timeout_between_messages_max"),5)})),document.querySelector("#timeout_between_messages_max").addEventListener("change",E),document.querySelector("#timeout_between_messages_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_between_messages_max").addEventListener("change",(e=>{B(e,s.timeout_permessage[1]),K(document.querySelector("#timeout_between_messages_min"),e.target,5)})),document.querySelector("#archiveolderthan").addEventListener("change",E),document.querySelector("#archiveolderthan").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#amount_to_archive").addEventListener("change",E),document.querySelector("#amount_to_archive").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#switch-skipunread").addEventListener("change",E),document.querySelector("#btn_set_openai_apikey").addEventListener("click",w.setOpenAIApiKey),document.querySelector("#btn_eject_openai_apikey").addEventListener("click",w.ejectOpenAIApikey),document.querySelector("#num_images").addEventListener("change",E),document.querySelector("#num_images").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#high").addEventListener("change",E),document.querySelector("#low").addEventListener("change",E),document.querySelector("#switch-enablegpt").addEventListener("change",E),document.querySelector("#btn_openai_test").addEventListener("click",y),document.querySelector("#btn_copylisting_details").addEventListener("click",c),document.querySelector("#buy_license_key").addEventListener("click",(()=>{window.open("https://snatchbots.com","_blank")})),document.getElementById("login_iframe").onload=function(){console.log("Iframe has loaded successfully!"),(0,o.showLoading)(!1)}}function V(e){e.target.value>14&&(e.target.value=14)}},1773:(e,t,n)=>{"use strict";function a(e,t,n,a){const i=s(n-e),o=s(a-t),r=Math.sin(i/2)*Math.sin(i/2)+Math.cos(s(e))*Math.cos(s(n))*Math.sin(o/2)*Math.sin(o/2);return 2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r))*6371*.621371}function s(e){return e*(Math.PI/180)}n.d(t,{c:()=>a})},175:(e,t,n)=>{"use strict";n.r(t),n.d(t,{changeArchivedStatus:()=>o});var a=n(5703),s=n(8544),i=n(5078);async function o(e,t){if(!e)return{error:"threadId is required"};void 0===t&&(t=!0),window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const n=(0,s.getFb_dtsg)(),o=(0,i.getFrom)(document.body.outerHTML,'revision":',",");for(var l="2",c=0;c<n.length;c++)l+=n.charCodeAt(c);const d=(0,i.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}'),u="ids["+e+"]",m=(0,a.W)(),p={av:m,__user:m,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${o}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:n,jazoest:l,lsd:d,server_timestamps:"true",[u]:t};let g=await fetch("https://www.facebook.com/ajax/mercury/change_archived_status.php",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:r(p),method:"POST",mode:"cors",credentials:"include",connection:"keep-alive"}).then((e=>e.text()));return g.match(/server_change_archived_status/i)?{success:!0}:(console.log("results",g),{error:"Failed to archive thread",response:g})}function r(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}},1334:(e,t,n)=>{"use strict";async function a(e){return GM.getValue(e)}async function s(e,t){return GM.setValue(e,t)}async function i(e){return GM.deleteValue(e)}async function o(){return await GM.listValues()}n.r(t),n.d(t,{chromeStorageGet:()=>a,chromeStorageListKeys:()=>o,chromeStorageRemove:()=>i,chromeStorageSet:()=>s})},1203:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DEFAULT_SKIP_OWNERCREATION_YEAR:()=>b,aNoReasonNeeded:()=>x,apiCallDelay:()=>g,botRetryDelay:()=>p,debug_disableMessages:()=>l,delayPerXMessages:()=>u,disableLogs:()=>c,followAfterMinutes:()=>f,intervalConversationsCheck:()=>i,listingsPerKeyword:()=>s,losenolead_locationid:()=>S,maxItemsToOfferPartner:()=>o,messageDelay:()=>d,sheet_id:()=>y,showAlerts:()=>r,timeout_permessage:()=>h,timeout_perpage:()=>w,timeout_streak:()=>_,userDelay:()=>m,waitIfSpamDetected:()=>a});const a=1440,s=120,i=300,o=3,r=!1,l=!1,c=!1,d=[3,10],u=10,m=[20,180],p=[50,70],g=[5,15],_=[20,180],w=[20,180],h=[5,15],f=[15,180],y="1a6324ea456c27346230df0a70458cc9",b=2023,x=["listings_messaged","partnermessage","users"],S="b6gmn59GxMqRwJSxl2DU"},8785:(e,t,n)=>{"use strict";n.r(t),n.d(t,{copySearchFilters:()=>d,getCategoryParameters:()=>c,urlSearchToApiParameters:()=>u});var a=n(4484);const s=[{graphqlName:"bathrooms",maxDefault:120,maxParam:"maxBathrooms",minDefault:0,minParam:"minBathrooms"},{graphqlName:"area_size",maxParam:"maxAreaSize",minParam:"minAreaSize"},{graphqlName:"bedrooms",maxDefault:120,maxParam:"maxBedrooms",minDefault:0,minParam:"minBedrooms"},{graphqlName:"rooms",maxDefault:120,maxParam:"maxRooms",minDefault:0,minParam:"minRooms"},{graphqlName:"odometer",maxParam:"maxMileage",minParam:"minMileage"},{graphqlName:"year",maxParam:"maxYear",minParam:"minYear"}],i={catFriendly:{graphqlName:"cat_friendly"},dogFriendly:{graphqlName:"dog_friendly"},isC2CListingOnly:{graphqlName:"is_c2c_listing_only"},isFurnished:{graphqlName:"is_furnished"},minMPG:{graphqlName:"min_mpg"},minSafetyRating:{graphqlName:"min_safety_rating"},minSeatingCapacity:{graphqlName:"min_seating_capacity"},sellerType:{graphqlName:"is_dealership_owned",transform:function(e){return"dealership"===e?1:0}},transmissionType:{graphqlName:"is_manual_transmission",transform:function(e){return"manual"===e?1:0}}},o={carfaxHistory:{graphqlName:"carfax_history"},carType:{graphqlName:"vehicle_type"},conditions:{graphqlName:"condition"},constructionStatus:{graphqlName:"construction_status"},dealerBranch:{graphqlName:"dealer_branch"},make:{graphqlName:"canonical_make_id"},model:{graphqlName:"canonical_model_id"},pivots:{graphqlName:"commerce_search_and_rp_fb_product_category_id"},privateRoomBathroomType:{graphqlName:"private_room_bathroom_type"},propertyType:{graphqlName:"property_type"},rentalRoomType:{graphqlName:"rental_room_type"},saleType:{graphqlName:"sale_type"},topLevelVehicleType:{graphqlName:"vehicle_type"},vehicleExteriorColors:{graphqlName:"exterior_colors"},vehicleInteriorColors:{graphqlName:"interior_colors"}},r={BEST_MATCH:null,CREATION_TIME_ASCEND:{sort_by_filter:"CREATION_TIME",sort_order:"ASCEND"},CREATION_TIME_DESCEND:{sort_by_filter:"CREATION_TIME",sort_order:"DESCEND"},DISTANCE_ASCEND:{sort_by_filter:"DISTANCE",sort_order:"ASCEND"},DISTANCE_DESCEND:{sort_by_filter:"DISTANCE",sort_order:"DESCEND"},PRICE_ASCEND:{sort_by_filter:"PRICE_AMOUNT",sort_order:"ASCEND"},PRICE_DESCEND:{sort_by_filter:"PRICE_AMOUNT",sort_order:"DESCEND"},VEHICLE_YEAR_ASCEND:{sort_by_filter:"VEHICLE_YEAR",sort_order:"ASCEND"},VEHICLE_YEAR_DESCEND:{sort_by_filter:"VEHICLE_YEAR",sort_order:"DESCEND"},VEHICLE_MILEAGE_ASCEND:{sort_by_filter:"VEHICLE_MILEAGE",sort_order:"ASCEND"},VEHICLE_MILEAGE_DESCEND:{sort_by_filter:"VEHICLE_MILEAGE",sort_order:"DESCEND"}};var l=n(8252);function c(e){if(!e)return void console.error("Failed to get category parameters. Missing category input");let t=document.getElementById("searchwithfilters").value,n="";t=String(t).split("\n");for(const a of t){const t=String(a).split("?")[0];if(String(t).toLowerCase()===String(e).toLowerCase()){n=a;break}}return n?u(String(n).split("?")[1]):void 0}function d(){const{validParameters:e,unhandledParams:t,priceRange:n}=u(window.location.search);console.log("validParameters",e);const s=function(){let e=window.location.href;e=e.replace(/marketplace\/\d+/,"marketplace/category");let t=e.match(/(category\/.+)\?/);return t&&t.length>1?t[1]:(t=e.match(/(category\/.+)\??/),t&&t.length>1?t[1]:"")}();if(!s)return console.error("Failed to get category.",s),void alert("Failed to get category name. make sure you are in a category page. i.e., facbook.com/marketplace/category/<name>");const i=document.getElementById("searchwithfilters");let o=i.value,r=s+"?"+e.join("&");var c,d;"?"===r&&(r=""),o&&(o+="\n"),r&&(o+=r),console.log("valueToAdd",r),console.log("filterValues",o),i.value=o.trim(),(0,l.b)(i),c=document.getElementById("searchwithfilters"),d=new Event("change",{bubbles:!0,cancelable:!0}),c.dispatchEvent(d),t.length&&((0,a._apiSendBug)({message:"Unhandled url parameters were found",unhandledParams:t.join(",")}),console.log(`Parameters ${t.join(", ")} are not supported, we have been notified`))}function u(e){const t=function(e){const t=new URLSearchParams(e||window.location.search),n={};for(const[e,a]of t.entries())n[e]=a;return n}(e),n=[],a={},l=[],c=[],d=[],u=[];let m="";const p=["exact"];for(const e in t){const g=s.find((t=>t.minParam===e||t.maxParam===e));if(g){a[g.graphqlName]||(a[g.graphqlName]={});let s=e.startsWith("min")?"min":"";s||(s=e.startsWith("max")?"max":"");let i=t[e];isNaN(i)||(i=Number(i)),s&&(n.push(`${e}=${t[e]}`),a[g.graphqlName][s]=i);continue}const _=o[e];if(_){n.push(`${e}=${t[e]}`),l.push({name:_.graphqlName,value:t[e]});continue}const w=i[e];if(w)n.push(`${e}=${t[e]}`),c.push({name:w.graphqlName,value:w.transform?w.transform(t[e]):t[e]});else if("minPrice"!==e)if("maxPrice"!==e)if("sortBy"!==e)p.includes(e)||u.push(e);else{let a=String(t[e]).toUpperCase(),s=r[a];s&&(m=s),n.push(`${e}=${t[e]}`)}else n.push(`${e}=${t[e]}`),d[1]=t[e];else n.push(`${e}=${t[e]}`),d[0]=t[e]}const g=[];for(const e in a){let t=a[e].min,n=a[e].max;t&&!n&&(a[e].max=2147483647),n&&!t&&(a[e].min=0),g.push({name:e,min:t||0,max:n||2147483647})}return{validParameters:n,numericVerticalFields:c,numericVerticalFieldsBetween:g,stringVerticalFields:l,filterSortingParams:m,priceRange:d,unhandledParams:u}}},4904:(e,t,n)=>{"use strict";n.d(t,{TI:()=>l,VB:()=>c,Xh:()=>d});var a=n(1203),s=n(3539),i=n(3177),o=n(4246);async function r(e,t,n){e=Number(e),t=Number(t);const a=1e3*(0,i.l)(e,t),r=(new Date).getTime()+a;n&&(n+=". ");const l=`${n}Timeout for ${a/1e3} seconds.`;(0,s.CONSOLE_MESSAGE)("timeout",{message:l,hh:moment(r).format("HH"),mm:moment(r).format("mm"),ss:moment(r).format("ss")}),await(0,o.sleep)(a)}async function l(e){let t=document.getElementById("timeout_api_calls_min").value;t||(t=a.apiCallDelay[0]);let n=document.getElementById("timeout_api_calls_max").value;n||(n=a.apiCallDelay[1]),await r(t,n,e)}async function c(e){let t=document.getElementById("timeout_end_of_run_min").value;t||(t=a.timeout_perpage[0]);let n=document.getElementById("timeout_end_of_run_max").value;n||(n=a.timeout_perpage[1]),await r(t,n,e)}async function d(e){let t=document.getElementById("timeout_between_messages_min").value;t||(t=a.timeout_permessage[0]);let n=document.getElementById("timeout_between_messages_max").value;n||(n=a.timeout_permessage[1]),await r(t,n,e)}},6183:(e,t,n)=>{"use strict";n.r(t),n.d(t,{fetchListingImages:()=>p,fetchListingImagesOLD:()=>g,getListingDetails:()=>m,injectFloatingButton:()=>d});var a=n(13),s=n(4139),i=n(5703),o=n(8544),r=n(5639),l=(n(313),n(5078));function c(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}async function d(){const e=document.createElement("button");e.id="floating-button",e.innerHTML="Copy Listing Details",e.onclick=u,document.body.appendChild(e);const t=document.createElement("style");return t.innerHTML="\n    #floating-button {\n      position: fixed;\n      bottom: 10px;\n      left: 10px;\n      background-color: #343ca3;\n      color: white;\n      border: none;\n      padding: 10px 20px;\n      border-radius: 5px;\n      cursor: pointer;\n    }\n  ",document.head.appendChild(t),e.style.transform="rotate(5deg)",setTimeout((()=>{e.style.transform="rotate(-5deg)"}),100),setTimeout((()=>{e.style.transform="rotate(5deg)"}),200),setTimeout((()=>{e.style.transform="rotate(-5deg)"}),300),setTimeout((()=>{e.style.transform="rotate(5deg)"}),400),setTimeout((()=>{e.style.transform="rotate(-5deg)"}),500),setTimeout((()=>{e.style.transform="rotate(0deg)"}),600),{button:e}}async function u(){const e=await m();navigator.clipboard.writeText(e),alert("Details got copied to clipboard")}async function m(){if(!window.location.href.includes("marketplace/item/"))return void alert("This is not a listing page. Make sure you are in listing page such as facebook.com/marketplace/item/1329223407934470/");let e;try{e=window.location.href.match(/\/item\/(\d+)/)[1]}catch(e){return void alert("Error getting listing id from url")}const t=await(0,a.fetchListingDetails)({id:e,includeAllDetails:!0}).catch((e=>{alert("Error fetching listing details")}));let n=[];const i=t&&t.seller&&t.seller.id;if(console.log("ownerid",i),i){const e=await(0,r.getUserListings)(i,!0);console.log("ownerListings",e),n=e}return(0,s.r)(t,n)}async function p(e){const t=(0,i.W)();let n={imageContext:null,targetId:e};n=JSON.stringify(n),window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const a=(0,o.getFb_dtsg)(),s=(0,l.getFrom)(document.body.outerHTML,'revision":',",");for(var r="2",d=0;d<a.length;d++)r+=a.charCodeAt(d);const u={av:t,__aaid:"0",__user:t,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19924.HYP:comet_pkg.2.1..2.1",dpr:"1",__ccg:"GOOD",__rev:`${s}`,__s:"28mg8f:3to5f4:xo50q3",__hsi:"7393580665476759467",__dyn:"7xeXxaU5a5Q1ryaxG4Vp41twpUnwgUb852bzEdF8vyUco2qwJyE2OwpUe8hwaG0Z82_CwjE1xoswMwto2awgo9oO0n24oaEnxO0Bo7O2l0Fw4HwiE567Udo5qfK0zEkxe2GewvEe9obrwh8lwUwgojxuu3W3y261kx-0ium2CVEbUGdw45g2cwMwrUK2K364UrwFg2fwxyo6J0qo35wjHDzUiwRK6E4-mEbUaU",__csr:"h4a8W4hLOiTdnqkIRtZlTaysnWjFYyRZ9niIZsAhjKCDiEg-iKlppKVqiQGRFqhktqszWSAA-hiaE_jXKFCSTCBqzt4F19a8ByqUOuZ5BBGqdAhWJGaiVogxaEuG4Q7qxuEiCwk8kxmaxa1dx22W5H848ybwOw_xO3G1GxK3S1LwGyUixG4EbEcEvy81CV85m0jC6UdEkwCw5fxu1Vw2JE1cEeU0RpwWwq81_U060K06gVU03jlg0H907sw1c202zq015ow0GKw11a0om02cG0T80Ki6o3rw",__comet_req:"15",fb_dtsg:a,jazoest:r,lsd:"mEjJWIooswD_HeAKuNcDHg",__spin_r:s,__spin_b:"trunk",__spin_t:"1721452145",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:"MarketplacePDPC2CMediaViewerWithImagesQuery",variables:n,server_timestamps:"true",doc_id:"7820841627934041"},m=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded",priority:"u=1, i","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not/A)Brand";v="8", "Chromium";v="126", "Google Chrome";v="126"',"sec-ch-ua-full-version-list":'"Not/A)Brand";v="8.0.0.0", "Chromium";v="126.0.6478.127", "Google Chrome";v="126.0.6478.127"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"Windows"',"sec-ch-ua-platform-version":'"10.0.0"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-asbd-id":"129477","x-fb-friendly-name":"MarketplacePDPC2CMediaViewerWithImagesQuery","x-fb-lsd":"mEjJWIooswD_HeAKuNcDHg"},referrer:"https://www.facebook.com/marketplace/item/1093962355023900/?ref=search&referral_code=null&referral_story_type=post&tracking=browse_serp%3Ad19e73b8-f9ec-4982-a8ff-c53d84ecfd3f",referrerPolicy:"strict-origin-when-cross-origin",body:c(u),method:"POST",mode:"cors",credentials:"include"}).then((e=>e.json())),p=[];return m&&m.data&&m.data.viewer&&m.data.viewer.marketplace_product_details_page&&m.data.viewer.marketplace_product_details_page.target&&m.data.viewer.marketplace_product_details_page.target.listing_photos&&m.data.viewer.marketplace_product_details_page.target.listing_photos.forEach((e=>{p.push(e.image.uri)})),p}async function g(e){const t=(0,i.W)(),n=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded",pragma:"no-cache",priority:"u=1, i","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not/A)Brand";v="8", "Chromium";v="126", "Google Chrome";v="126"',"sec-ch-ua-full-version-list":'"Not/A)Brand";v="8.0.0.0", "Chromium";v="126.0.6478.128", "Google Chrome";v="126.0.6478.128"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"14.2.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-asbd-id":"129477","x-fb-friendly-name":"MarketplacePDPC2CMediaViewerWithImagesQuery","x-fb-lsd":"3PNeZdXaMv9h7-qYhIPWzb"},referrer:`https://www.facebook.com/marketplace/item/${e}/?ref=browse_tab&referral_code=marketplace_top_picks&referral_story_type=top_picks`,referrerPolicy:"strict-origin-when-cross-origin",body:`av=${t}&__aaid=0&__user=${t}&__a=1&__req=48&__hs=19923.HYP%3Acomet_pkg.2.1..2.1&dpr=2&__ccg=EXCELLENT&__rev=1015002717&__s=idxs84%3A9p9isw%3Ahe28j9&__hsi=7393218427461493051&__dyn=7AzHK4HwBgDx-5Q1hyoyEqxd4Ag5S3G2O5U4e2CEf8jyUW3qi7UK360CEboG4E762S1DwUx60xU8k1sw9u0LVEtwMw65xO321Rwwwg8a8462mcw8a1TwgEcEhwGxu782lwj8bU9kbxS2617wc61awkovwRwlE-U2exi4UaEW4UmwkUtxGm2SU4i5oe8cEW4-5pUfEe88o4qum7-2K0-poarCwLyES0Io88cA0z8c84p1e4UK2K364UrwFgbU5-269wkopg6C13whEeE4WVU-4EdrxG1fBG2-2K&__csr=gaQInslNsQTNcIb4LaOsO5_v4kD5PHO8KysjmDbGGYHiZEOQiIymISTaF5ZplXcQSPP8qAgzm8SFkXiHyHnAXmAnmhbF9HihEB7BACV5h9G-_BDpoK6F5ujKEKKqV5qGVevQAmidW-9yaGtpoRpbyaJoSLF3p4Q9CDUJ6AG4p9pqXx53bDXQnGWiyVeZdaEJUim210ziAUCi7GDXKEK3m7FEO7e8xaqiqESqfz_y9AeyEmKaBXzUmK-UR1h3EMCdzoxrDwHAyV8jyUqgNGUpUKcxG788UaoWq4VeeKKi4oqK4EOiewwCK9y8pBxefxy10VEOF8S68K5oCfx2UGaBQbwi9o7iEc9rUcFayEaUeUceE9EaUoVU8E98C265U2MK489E6K2W1pwrE9U650aq0Pofo5Ci16xG0xU9osx51m2m1iwn41TG0gC0rS0G80dfUqdhAP4K58-2e0p26o08pU16E1r-5k2h7gcU1q87a1rzXw19W08fG4o08eE05yiE6q03W10kqzU9Q0Jo0xp04Kw2Ro0E20cKyoGlw2KC0aEwNweu0cmwr8fEHio0OC1f-7Uf80Gqdw1O209aw1Wyqu051AmKA0y82RwuE0lU80S8kAHw6cw7sg3fhEx04Rw-xy3608AUW1yws4BwJw1sYzyE2sw7ew-Cgx096&__comet_req=15&fb_dtsg=NAcO7gCvbTTrjLyVwKw3V6OzpS894ta-JL9MqLQ6kNvCM1hfYpfncVw%3A27%3A1716992112&jazoest=25523&lsd=3PNeZdXaMv9h7-qYhIPWzb&__spin_r=1015002717&__spin_b=trunk&__spin_t=1721367805&fb_api_caller_class=RelayModern&fb_api_req_friendly_name=MarketplacePDPC2CMediaViewerWithImagesQuery&variables=%7B%22imageContext%22%3Anull%2C%22targetId%22%3A%22${e}%22%7D&server_timestamps=true&doc_id=7820841627934041`,method:"POST",mode:"cors",credentials:"include"}).then((e=>e.json())),a=[];return n&&n.data&&n.data.viewer&&n.data.viewer.marketplace_product_details_page&&n.data.viewer.marketplace_product_details_page.target&&n.data.viewer.marketplace_product_details_page.target.listing_photos&&n.data.viewer.marketplace_product_details_page.target.listing_photos.forEach((e=>{a.push(e.image.uri)})),a}},4711:(e,t,n)=>{"use strict";n.r(t),n.d(t,{downloadListingSkipList:()=>i,downloadOwnerSkipList:()=>s});var a=n(8792);async function s(){const e=await(0,a.gp)("usersskip");return o(e,"Owner Skip List.json"),e}async function i(){const e=await(0,a.gp)("listings");return o(e,"Listings Skip List.json"),e}function o(e,t){const n=JSON.stringify(e,null,2),a=new Blob([n],{type:"text/plain"}),s=URL.createObjectURL(a),i=document.createElement("a");i.setAttribute("href",s),i.setAttribute("download",t),document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(s)}},13:(e,t,n)=>{"use strict";n.r(t),n.d(t,{fetchListingDetails:()=>u});var a=n(1203),s=n(3539),i=n(5703),o=n(8544),r=n(2287),l=n(4246),c=n(7367),d=n(5078);async function u({id:e,includeAllDetails:t=!1}){window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const n={UFI2CommentsProvider_commentsKey:"MarketplacePDP",feedbackSource:56,feedLocation:"MARKETPLACE_MEGAMALL",referralCode:"null",scale:2,should_show_new_pdp:!1,targetId:String(e),useDefaultActor:!1},u=(0,o.getFb_dtsg)(),p=(0,d.getFrom)(document.body.outerHTML,'revision":',",");for(var g="2",_=0;_<u.length;_++)g+=u.charCodeAt(_);const w=(0,i.W)(),h={av:w,__user:w,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${p}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:u,jazoest:g,lsd:"VSZVwWRyifaM82K_F8cOFc",__spin_r:"1007782503",__spin_b:"trunk",__spin_t:"1688385023",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:"CometMarketplaceSearchContentContainerQuery",variables:JSON.stringify(n),server_timestamps:"true",doc_id:"6019983858113356"};let f=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:m(h),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,r.handleFetchErrors)(e))).then((e=>e.json()));const y=JSON.stringify(f);if(y&&y.match(/api_error_code":368/i)){const e=(new Date).getTime()+60*a.waitIfSpamDetected*1e3,t=moment(e).calendar();return(0,s.CONSOLE_MESSAGE)("halted_soft",{schedule:t}),(await(0,c.stats)()).addKo(),window.isKO=!0,await(0,l.sleep)(60*a.waitIfSpamDetected*1e3),window.isKO=!1,{error:"Rate limit exceeded",error_code:"rate_limit_exceeded"}}const b={};if(f&&f.data&&f.data.viewer&&f.data.viewer.marketplace_product_details_page){const e=f.data.viewer.marketplace_product_details_page.target.id,n=f.data.viewer.marketplace_product_details_page.target.marketplace_listing_title,a=f.data.viewer.marketplace_product_details_page.target.redacted_description.text,s=f.data.viewer.marketplace_product_details_page.target.listing_price.amount,i=f.data.viewer.marketplace_product_details_page.target.marketplace_listing_seller,o=f.data.viewer.marketplace_product_details_page.target.creation_time,r=f.data.viewer.marketplace_product_details_page.target.attribute_data;if(r){const e=r.find((e=>"Condition"===e.attribute_name));e&&(b.condition=e.value)}const l=f.data.viewer.marketplace_product_details_page.target.location;if(l&&(b.location={latitude:l.latitude,longitude:l.longitude}),e&&(b.id=e),n&&(b.title=n),a&&(b.description=a),s&&(b.price=s),i){let e=f.data.viewer.marketplace_product_details_page.target.marketplace_listing_seller.join_time;e&&(e*=1e3,i.join_year=new Date(e).getFullYear()),b.seller=i}o&&(b.creationTime=1e3*o,b.age=Date.now()-b.creationTime);let c=f.data.viewer.marketplace_product_details_page.target.listing_photos;c&&(b.photos=c.map((e=>e.image.uri))),t&&(b.allDetails=f.data.viewer.marketplace_product_details_page.target)}if(0===Object.keys(b).length){if(f.errors&&Array.isArray(f.errors))if(f.errors.length>0){if(console.log("Error",f.errors[0]),368===f.errors[0].api_error_code)return console.log("Fetch listing detail rate limited."),(await(0,c.stats)()).addKo(),console.log("Rate limit exceeded"),{error:"Rate limit exceeded",error_code:"rate_limit_exceeded"}}else console.log("No errors",e,f);console.log("No results",e,f)}return b}function m(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}},8365:(e,t,n)=>{"use strict";n.d(t,{R:()=>o,x:()=>r});var a=n(3539),s=n(8521),i=n(7367);async function o(e){const t=e.length,n=[...e];e=e.filter(r);const o=n.filter((t=>!e.includes(t))),l=[];o.forEach((async e=>{const t=(0,s.skips)().saveToSkipListing(e.id,`Title does not contain match. Title = ${e.title}`);l.push(t)})),(await(0,i.stats)()).addSkipped(o.length),await Promise.all(l);const c=e.length;return c!==t&&(0,a.CONSOLE_MESSAGE)("skip_no_keyword",{num_listings:t-c}),e}function r(e){let t=document.querySelector("#ta #title_must_include").value;const n=e.title;if(!n)return!1;t=t.trim().replace(/,+$/,"");let a=t.split(",").map((e=>e.trim())).join("|");a.startsWith("|")&&(a=a.substring(1)),a.endsWith("|")&&(a=a.substring(0,a.length-1));const s=new RegExp(a,"i");return!!n.match(s)}},6901:(e,t,n)=>{"use strict";n.r(t),n.d(t,{filterOutListingsNotInPriceRange:()=>r,isPriceInRange:()=>l});var a=n(4484),s=n(3539),i=n(8521),o=n(7367);async function r(e){let t=Number(document.querySelector("#listing_min_price").value)||0,n=Number(document.querySelector("#listing_max_price").value)||214748364700;if(0===t&&0===n)return e;const r=e.length,l=[];let c=0;e=e.filter((e=>{let s=e.price;"string"==typeof s&&(s=Number(s.replace(/[^0-9\.]+/g,""))),isNaN(s)&&(l.push((0,a._apiSendBug)({error:"Price is NaN",listing_id:e.id,price:e.price,listing:e})),s=0);const o=s>=t&&s<=n;if(!o){let a=`Price [${s}] not in range [${t}-${n}].`;s<t&&(a=`Price [${s}] < [${t}]`),s>n&&(a=`Price [${s}] > [${n}]`);const o=(0,i.skips)().saveToSkipListing(e.id,a);c+=1,l.push(o)}return o})),c>0&&(await(0,o.stats)()).addSkipped(c),await Promise.all(l);const d=e.length;return d!==r&&(0,s.CONSOLE_MESSAGE)("price_not_inrange",{num_listings:r-d}),e}function l(e){let t=Number(document.querySelector("#listing_min_price").value)||0,n=Number(document.querySelector("#listing_max_price").value)||0;return 0===t&&0===n||("string"==typeof e&&(e=Number(e.replace(/[^0-9\.]+/g,""))),isNaN(e)&&(e=0),e>=t&&e<=n)}},4898:(e,t,n)=>{"use strict";n.r(t),n.d(t,{addFollowupEntry:()=>v,addMOREntry:()=>E,followup:()=>x});var a=n(1334),s=n(4904),i=n(3542),o=n(9355),r=n(4087),l=n(175),c=n(1203),d=n(3539),u=n(533),m=n(9107),p=n(3177),g=n(4246),_=n(8329);async function w(e){let t,n="",a="",s=await(0,_.templates)().followup_1,i=await(0,_.templates)().followup_2,o=await(0,_.templates)().followup_3,w=s,h="1";if(e.last_template_sent&&("1"===e.last_template_sent?i?(w=i,h="2"):o&&(w=o,h="3"):"2"===e.last_template_sent&&o&&(w=o,h="3")),w){const s=await async function(e,t){const n=e.id,a=e.title,s=e.seller.name,i=(0,u.getKeywordMatched)(a),o=e.price;let l;if(t){t=(0,m.parseVariables)(t,s,o,i,a);const e=await(0,r.api_sendMessage)(n,t);if("STOP"===e)return void console.log("Stopped sending messages to user because other user is blocked.");if(e.error)return void console.log(e.error);l||(l=e),(0,d.CONSOLE_MESSAGE)("message_sent",{message_sent:t,listing_price:o,listing_id:n,listing_name:a});const u=1e3*(0,p.l)(c.messageDelay[0],c.messageDelay[1]),_=(new Date).getTime()+u;return(0,d.CONSOLE_MESSAGE)("timeout",{message:"Message Sent",hh:moment(_).format("HH"),mm:moment(_).format("mm"),ss:moment(_).format("ss")}),await(0,g.sleep)(u),{message:t,postMsgId:l}}}(e.listingData,w);s&&(w=s.message,!t&&s.postMsgId&&(t=s.postMsgId)),n&&(n+="\n"),n+=w,a&&(a+=", "),a+=`followup${h}`;const _={last_template_sent:h};let f=!1;return"1"===h?i||o||(f=!0):"2"===h?o||(f=!0):"3"===h&&(f=!0),f&&(await async function(){if(t&&(t.thread_id&&(t=t.thread_id),document.querySelector("#switch-deleteaftersend").checked)){const e=await(0,l.changeArchivedStatus)(t,!0);e&&e.success?console.log("Conversation has been archived:",t):console.error("Failed to archive conversation",t)}}(),_.isLastMessageSent=!0),_}return{isLastMessageSent:!0}}async function h(e){let t,n="",a="",s=await(0,_.templates)().messageonreply_1;if(s){const i=await async function(e,t){const n=e.id,a=e.title,s=e.seller.name,i=(0,u.getKeywordMatched)(a),o=e.price;let l;if(t){t=(0,m.parseVariables)(t,s,o,i,a);const e=await(0,r.api_sendMessage)(n,t);if("STOP"===e)return void console.log("Stopped sending messages to user because other user is blocked.");if(e.error)return void console.log(e.error);l||(l=e),(0,d.CONSOLE_MESSAGE)("message_sent",{message_sent:t,listing_price:o,listing_id:n,listing_name:a});const u=1e3*(0,p.l)(c.messageDelay[0],c.messageDelay[1]),_=(new Date).getTime()+u;return(0,d.CONSOLE_MESSAGE)("timeout",{message:"Message Sent",hh:moment(_).format("HH"),mm:moment(_).format("mm"),ss:moment(_).format("ss")}),await(0,g.sleep)(u),{message:t,postMsgId:l}}}(e.listingData,s);return i&&(s=i.message,!t&&i.postMsgId&&(t=i.postMsgId)),n&&(n+="\n"),n+=s,a&&(a+=", "),a+="messageonreply1",{last_template_sent:"1"}}return{isLastMessageSent:!0}}function f(e,t){const n=new Date(t);return(new Date-n)/1e3/60>=e}const y="toFollowUp",b="toMOR";async function x(){if((0,o.z)())try{const e=await(0,i.fetchInboxThreads)({limitDays:!0}),t=S({threads:e,hasUnRead:!0}),n=S({threads:e,hasUnRead:!1});await async function(e){let t=await(0,a.chromeStorageGet)(b);if(t&&(t=JSON.parse(t)),!t)return;console.log("toMOR",t&&t.length);for(let n=t.length-1;n>=0;n--){const i=t[n],o=i.tsLastMsg||i.tsAdded,r=i.listingid,l=i.listingData.title,c=i.listingData.seller.name,d=e.find((e=>e.listingId===r)),u=d&&new Date(Number(d.updated_time_precise))>=new Date(o);if(console.log("sellerReplied",u,l),u)console.log(`Sending Message-On-Reply to seller [${c}] [${l}]`),await h(i),t.splice(n,1),console.log(`Message-On-Reply has been sent to listing [${c}] [${l}]`),await(0,a.chromeStorageSet)(b,JSON.stringify(t)),await(0,s.Xh)("Message-On-Reply sent.");else if(f(10080,o)){t.splice(n,1),await(0,a.chromeStorageSet)(b,JSON.stringify(t));continue}}}(t),await async function(e){let t=await(0,a.chromeStorageGet)(y);t&&(t=JSON.parse(t)),console.log("toFollowUp",t&&t.length);let n=!1;for(let i=t.length-1;i>=0;i--){const o=t[i],r=o.tsLastMsg||o.tsAdded,l=o.listingid,c=o.listingData.title,d=o.listingData.seller.name,u=e.find((e=>e.listingId===l));if(f(document.getElementById("followup_after").value,r))if(u&&new Date(Number(u.updated_time_precise))<=new Date(r)){console.log(`Entry is due for followup [${d}] [${c}]`);const e=await w(o);e.isLastMessageSent?(console.log("last followup message was sent. Will remove followup entry."),t.splice(i,1)):(e.last_template_sent&&(o.last_template_sent=e.last_template_sent),o.tsLastMsg=(new Date).toISOString()),n=!0,console.log(`Followup message has been sent to listing [${d}] [${c}]`),await(0,a.chromeStorageSet)(y,JSON.stringify(t)),await(0,s.Xh)(`FollowUp #${e.last_template_sent||"3"} sent.`)}else console.log(`Has unread message. Will not follow up [${d}] [${c}]}`),t.splice(i,1),await(0,a.chromeStorageSet)(y,JSON.stringify(t))}n&&console.log("Done sending followups")}(n)}catch(e){if("fetchInboxThreads already ran less than 15 minutes ago. Skipping."!==e.message)throw console.error("Error in followup",e),e;console.log("fetchInboxThreads already ran less than 15 minutes ago. Skipping.")}}function S({threads:e,hasUnRead:t}){const n=[];return e.forEach((e=>{const a=e.unread_count,s=e.updated_time_precise;if(t&&0===a)return;if(!t&&a>0)return;const i=e.messages.edges;if(i&&i.length){const t=i[0].node.__typename,a=e.marketplace_thread_data&&e.marketplace_thread_data.messageable_item&&e.marketplace_thread_data.messageable_item.id,o=e.marketplace_thread_data&&e.marketplace_thread_data.messageable_item&&e.marketplace_thread_data.messageable_item.marketplace_listing_title;"UserMessage"===t&&n.push({listingId:a,updated_time_precise:s,title:o,info:e})}})),n}async function v(e,t){if(!e)return void console.error("Failed to add followup entry. Missing listingid");let n=await(0,a.chromeStorageGet)(y);n||(n="[]"),n=JSON.parse(n);const s=(new Date).toISOString(),i={listingid:e,tsAdded:s,listingData:t},o=n.find((t=>t.listingid===e));if(o&&n.indexOf(o)>-1){const e=n.indexOf(o);n[e]=i}else n.push(i);await E(e,t),await(0,a.chromeStorageSet)(y,JSON.stringify(n))}async function E(e,t){const n=b;if(!e)return void console.error("Failed to add MOR entry. Missing listingid");let s=await(0,a.chromeStorageGet)(n);s||(s="[]"),s=JSON.parse(s);const i=(new Date).toISOString(),o={listingid:e,tsAdded:i,listingData:t},r=s.find((t=>t.listingid===e));if(r&&s.indexOf(r)>-1){const e=s.indexOf(r);s[e]=o}else s.push(o);await(0,a.chromeStorageSet)(n,JSON.stringify(s))}},4139:(e,t,n)=>{"use strict";function a(e,t){const n={};for(const t in e.allDetails)"title"!==t&&"price"!==t&&"description"!==t&&"location"!==t&&"photos"!==t&&"seller"!==t&&(n[t]=e.allDetails[t]);delete n.listing_photos,delete n.commerce_badges_info;for(const e in n)if((e.startsWith("__")||null===n[e])&&delete n[e],"object"==typeof n[e])for(const t in n[e])(t.startsWith("__")||null===n[e][t])&&delete n[e][t];let a="";a+=`Title: ${e.title}\n`,a+=`Price: ${e.price}\n`,n.condition&&(a+=`Condition: ${n.condition}\n`),a+=`Description: ${e.description}\n`,a+="# Seller Details\n",a+=`Name: ${e.seller.name}\n`,n.location_text&&n.location_text.text&&(a+=`Location: ${n.location_text.text}\n`),e.location&&e.location.latitude&&(a+=`Latitude: ${e.location.latitude}\n`),e.location&&e.location.longitude&&(a+=`Longitude: ${e.location.longitude}\n`),a+="Stats:\n",a+=` - five_star_ratings_average: ${e.seller.marketplace_ratings_stats_by_role.seller_stats.five_star_ratings_average}\n`,a+=` - five_star_total_rating_count_by_role: ${e.seller.marketplace_ratings_stats_by_role.seller_stats.five_star_total_rating_count_by_role}\n`,a+=`Join Date: ${new Date(1e3*e.seller.join_time).toLocaleString("default",{month:"long",year:"numeric"})}\n`,a+="# Additional Listing Details\n",n.vehicle_exterior_color&&(a+=`vehicle_exterior_color: ${n.vehicle_exterior_color}\n`),n.vehicle_features&&(a+=`vehicle_features: ${n.vehicle_features.join(", ")}\n`),n.vehicle_fuel_type&&(a+=`vehicle_fuel_type: ${n.vehicle_fuel_type}\n`),n.vehicle_interior_color&&(a+=`vehicle_interior_color: ${n.vehicle_interior_color}\n`),n.vehicle_is_paid_off&&(a+=`vehicle_is_paid_off: ${n.vehicle_is_paid_off}\n`),n.vehicle_make_display_name&&(a+=`vehicle_make_display_name: ${n.vehicle_make_display_name}\n`),n.vehicle_model_display_name&&(a+=`vehicle_model_display_name: ${n.vehicle_model_display_name}\n`),n.vehicle_number_of_owners&&(a+=`vehicle_number_of_owners: ${n.vehicle_number_of_owners}\n`),n.vehicle_odometer_data&&(a+=`vehicle_odometer_data: ${JSON.stringify(n.vehicle_odometer_data)}\n`),n.vehicle_title_status&&(a+=`vehicle_title_status: ${n.vehicle_title_status}\n`),n.vehicle_transmission_type&&(a+=`vehicle_transmission_type: ${n.vehicle_transmission_type}\n`),n.vehicle_trim_display_name&&(a+=`vehicle_trim_display_name: ${n.vehicle_trim_display_name}\n`),a+="# Other Seller Listings:\n",a+=t.map((e=>`- Title: ${e.title}, Price: ${e.price}`)).join("\n");const s={text:a};return s.photos=e.photos,s.listingDetails=e,s}n.d(t,{r:()=>a})},3372:(e,t,n)=>{"use strict";function a(){return Math.round(1e3*Math.random())}n.r(t),n.d(t,{generateId:()=>a})},9237:(e,t,n)=>{"use strict";function a(e){const t=new Date,n=new Date(e);return Math.floor((t-n)/864e5)}function s(e){return(new Date-new Date(e))/36e5}n.d(t,{f:()=>a,h:()=>s})},8528:(e,t,n)=>{"use strict";n.d(t,{L:()=>o});var a=n(5703),s=n(8544),i=n(5078);async function o(e){const t=e||new URL(window.location.href).pathname,n=(0,a.W)();window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const o=(0,i.getFrom)(document.body.outerHTML,'revision":',",");var r="2";const l=(0,s.getFb_dtsg)();for(var c=0;c<l.length;c++)r+=l.charCodeAt(c);const d=(0,i.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}');let u=await fetch("https://www.facebook.com/ajax/bulk-route-definitions/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded",pragma:"no-cache",priority:"u=1, i","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not/A)Brand";v="8", "Chromium";v="126", "Google Chrome";v="126"',"sec-ch-ua-full-version-list":'"Not/A)Brand";v="8.0.0.0", "Chromium";v="126.0.6478.116", "Google Chrome";v="126.0.6478.116"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"14.2.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-asbd-id":"129477","x-fb-lsd":"HJHbStuhz9hBrOnKneloOI"},referrer:"https://www.facebook.com/marketplace/category/apparel",referrerPolicy:"strict-origin-when-cross-origin",body:`route_urls[\n      0\n    ]=${encodeURIComponent(t)}&routing_namespace=fb_comet&__aaid=0&__user=${n}&__a=1&__req=${(window.global.reqCounter++).toString(36)}&__hs=19912.HYP%3Acomet_pkg.2.1..2.1&dpr=2&__ccg=GOOD&__rev=${o}&__s=jryowq%3Abq7uyb%3A604en2&__hsi=7389116395254251180&__dyn=7xeu4HwkEng5K8G6EjBAg5S1Dxu13wvoKewSwAyUco38yE2OwpUe8hwaG0Z82_CwjE1xoswMwto2awgo9oO0n24oaEd82lwv89k2C0iK0D8vwRwpHw8W58jwGzE2ZwJK2W5olwuEjxu16wUwxwl8vw4DBwFKq2-azo11E2cwMwrUK2K364UrwFg2Xwr86C0No4WVU-4EdrxG1fy8bUaU&__csr=gEYl4uQN4AAHORPV2bSzkBlTLOuhF9aRWiRRBHXLhvhAA8AWVifUFi4DC_WHpqjjzVoCUF9eUKGIHUC4pVWCjDU88rzaKq5EyuiQUvxO6UigC3W5UgwDwsXgx1-68S0O8mwbW0Du3a08uw6lw9C0uq07dE01lYUG0bLg1F80lDw0Bqw0hS806ui0cPw&__comet_req=15&fb_dtsg=${l}&jazoest=${r}&lsd=${d}&__spin_r=${o}&__spin_b=trunk&__spin_t=1720412726`,method:"POST",mode:"cors",credentials:"include"}).then((e=>e.text()));u=u.replace("for (;;);","");try{u=JSON.parse(u)}catch(e){return console.error("Faild to get category ids for",t),[]}try{return u.payload.payloads[t].result.exports.rootView.props.categoryIDs}catch(e){return console.error(e),alert("Failed to get category IDs"),[]}}},3539:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CONSOLE_MESSAGE:()=>c,getConsoleMessages:()=>l});var a=n(4484),s=n(1203),i=n(2287),o=n(6849),r=n(7091);async function l(){if(window.consoleMessages)return window.consoleMessages;let e;try{e=await fetch(`https://sheets.hopla.tools/?HT=${s.sheet_id}&format=json&sheet_name=ConsoleLogFbBot`).then((async e=>(0,i.handleFetchErrors)(e))).then((e=>e.text())).then((async e=>{try{return JSON.parse(e)}catch(t){return await(0,o.default)({error:"Failed to parse getConsoleMessages api response.",x:e}),{}}}))}catch(e){return await(0,a._apiSendBug)({error:"Failed to get console messages.",e:e.toString()}),console.error("Failed to get console message"),{}}if(e&&e.result){window.consoleMessages={};for(const t of e.result)t.variable&&(window.consoleMessages[t.variable]=t.message||"");return window.consoleMessages}return await(0,o.default)({error:"Failed to get console messages."}),console.error("Failed to get console message"),{}}function c(e,t,n){if(function(e){return e="object"==typeof e?JSON.stringify(e):e,window.lastLog?window.lastLog===e||void(window.lastLog=e):(window.lastLog=e,!1)}(t||e))return;if("custom"===e)return window.lastLog=t,void(0,r.showLastConsoleLog)(t);if(!window.consoleMessages)return console.error("Called consoleMessage without initiating."),"";let s=window.consoleMessages[e];if(!s)return(0,a._apiSendBug)({error:"No message found for template.",template_name:e,variables:t}),console.error(`No message found for template: ${e}`),"";if(t)for(const e in t){const n=new RegExp(`{${e}}`,"gi");s=s.replace(n,t[e]||"")}(0,r.showLastConsoleLog)(s)}},5703:(e,t,n)=>{"use strict";function a(){const e=document.cookie.split(";");let t="";for(let n=0;n<e.length;n++){const a=e[n];if(a.includes("c_user")){t=a.split("=")[1];break}}if(!t){const e=document.body.outerHTML.match(/"USER_ID":"(\d+)"/i);e&&(t=e[1])}return t}n.d(t,{W:()=>a})},8544:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getFb_dtsg:()=>s});var a=n(5078);function s(){const e=document.body.outerHTML.match(/"fb_dtsg","value":"(.+?)"/);return e&&e.length>1?e[1]:(0,a.getFrom)(document.body.outerHTML,'["DTSGInitData",[],{"token":"','"')||"NAcNhhWzHFUzP5lxJVGtei4dqFjAdspi-QTjezuJHG6hmYpsNW__W3w:2:1712977252"}},3542:(e,t,n)=>{"use strict";n.r(t),n.d(t,{fetchInboxThreads:()=>p});var a=n(1334),s=n(1203),i=n(3539),o=n(5703),r=n(8544),l=n(2287),c=n(3177),d=n(4246),u=n(7367),m=n(5078);async function p(e){if(!e.DisablelastFetchInboxThreads){let e=await(0,a.chromeStorageGet)("lastFetchInboxThreads")||0;if(e&&(new Date).getTime()-e<9e5)throw console.log("fetchInboxThreads already ran less than 15 minutes ago. Skipping."),new Error("fetchInboxThreads already ran less than 15 minutes ago. Skipping.");await(0,a.chromeStorageSet)("lastFetchInboxThreads",(new Date).getTime())}window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const t={};let n=e&&e.cursor;const _=e&&e.previousThreads;n&&(t.cursor=n,t.count=12);let w=e&&e.page;w||(w=1),console.log("Fetching inbox threads.. Page:",w);const h=function(){const e=new Date;return e.setDate(e.getDate()-1),e.getTime()}(),f=(0,r.getFb_dtsg)(),y=(0,m.getFrom)(document.body.outerHTML,'revision":',",");for(var b="2",x=0;x<f.length;x++)b+=f.charCodeAt(x);const S=(0,m.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}'),v=n?"CometMarketplaceInboxBuyerTabViewPaginationQuery":"CometMarketplaceInboxBuyerTabViewContainerQuery",E=n?"6063301870422274":"9150907031651351",k=(0,o.W)(),L={av:k,__user:k,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${y}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:f,jazoest:b,lsd:S,__spin_r:y,__spin_b:"trunk",__spin_t:"1688385023",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:v,variables:JSON.stringify(t),server_timestamps:"true",doc_id:E};let C=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:g(L),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,l.handleFetchErrors)(e))).then((e=>e.json()));const I=JSON.stringify(C);if(I&&I.match(/api_error_code":368/i)){console.log("Fetch inbox thread rate limited.");const t=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,i.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,u.stats)()).addKo(),window.isKO=!0,await(0,d.sleep)(60*s.waitIfSpamDetected*1e3),window.isKO=!1,e.DisablelastFetchInboxThreads=!0,p(e)}let A=[];if(!unsafeWindow.isRun&&!e.testrun)return A;const O=C&&C.data&&C.data.viewer&&C.data.viewer.marketplaceInboxBuyerMessageThreads&&C.data.viewer.marketplaceInboxBuyerMessageThreads.edges;if(O)for(let t=0;t<O.length;t++){const n=O[t],a=n&&n.node;if(e&&e.limitDays&&a&&a.updated_time_precise<=h)return _&&(A=_.concat(A)),console.log("Found a thread that is more than a day old. Paging has been stopped.",a.marketplace_thread_data.messageable_item.marketplace_listing_title,new Date(Number(a.updated_time_precise)),h),A;A.push(a)}_&&(A=_.concat(A));const q=C&&C.data&&C.data.viewer&&C.data.viewer.marketplaceInboxBuyerMessageThreads&&C.data.viewer.marketplaceInboxBuyerMessageThreads.page_info;return q&&q.has_next_page?(n=q.end_cursor,await(0,d.sleep)((0,c.l)(5e3,1e4)),p({...e,cursor:n,previousThreads:A,page:w+1,DisablelastFetchInboxThreads:!0})):A}function g(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}},5836:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getAllOwnerListingKwMatches:()=>o,getKeyword:()=>i,removeParameters:()=>r});var a=n(1334),s=n(7480);async function i(){let e=await(0,a.chromeStorageGet)("lastKwIdx");e=e||0===e?parseInt(e,10)+1:0;let t,n=document.querySelector("#ta #keywords").value,o=document.querySelector("#ta #searchwithfilters").value;return n?(n=n.split(/[\n,]+/).map((e=>e.trim())),o&&(o=o.split("\n").map((e=>e.trim())),n=n.concat(o)),e>=n.length&&(e=0,t=await(0,s.readCoordinates)({getNext:!0})),t=await(0,s.readCoordinates)({getNext:!1}),await(0,a.chromeStorageSet)("lastKwIdx",e),String(n[e]).trim().length?{keyword:n[e],coordinates:t}:i()):(console.error("No keywords found."),alert("No keywords found."),{error:"no keyword found"})}async function o(){let e=document.querySelector("#ta #ownerlisting_kw_match").value;return e?(e=e.trim().replace(/,+$/,""),e=e.split(",").map((e=>e.trim())),e):(console.error("No keywords found."),{error:"no keyword found"})}function r(e){return e?String(e).split("?")[0].trim():e}},533:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getKeywordMatched:()=>s});var a=n(4484);function s(e){try{let t=document.querySelector("#ta #keywords").value.split("\n").map((e=>e.trim())).join("|");t.startsWith("|")&&(t=t.substring(1)),t.endsWith("|")&&(t=t.substring(0,t.length-1));const n=new RegExp(t,"i");if(e.match(n))return e.match(n)[0]}catch(t){(0,a._apiSendBug)({location:"getKeywordMatched",err:t,extra:{title:e}})}}},9132:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getDeductionMatches:()=>c,getModelMatches:()=>o,getNetworkMatches:()=>l,getStorageMatches:()=>r});var a=n(1203),s=n(2287),i=n(4484);async function o(){let e;console.log("Fetching model matches1.");try{e=await fetch(`https://sheets.hopla.tools/?HT=${a.sheet_id}&format=json&sheet_name=model`).then((async e=>(0,s.handleFetchErrors)(e))).then((e=>e.text())).catch((e=>{(0,i._apiSendBug)({error:"Failed to get model matches.",e:e.toString()}),alert("Failed to get model matches.")}))}catch(e){return(0,i._apiSendBug)({error:"Failed to get model matches.",e:e.toString()}),alert("Failed to get model matches."),{}}if(e&&!e.includes("13promax"))return o();e=JSON.parse(e),console.log("Model matches has been fetched2.",e);const t={};return e.result&&Array.isArray(e.result)&&e.result.length?(e.result.forEach((e=>{for(const n in e)t[n]||(t[n]=[]),e[n]&&t[n].push(e[n])})),t):((0,i._apiSendBug)({error:"Failed to get model matches.",x:e}),alert("Failed to get model matches."),t)}async function r(){let e;console.log("Fetching storage matches.");try{e=await fetch(`https://sheets.hopla.tools/?HT=${a.sheet_id}&format=json&sheet_name=storage`).then((async e=>(0,s.handleFetchErrors)(e))).then((e=>e.text())).catch((e=>{(0,i._apiSendBug)({error:"Failed to get storage matches.",e:e.toString()}),alert("Failed to get model matches.")}))}catch(e){return(0,i._apiSendBug)({error:"Failed to get storage matches.",e:e.toString()}),alert("Failed to get storage matches."),{}}if(e&&!e.includes("256gb"))return r();e=JSON.parse(e),console.log("Storage matches has been fetched.");const t={};return e.result&&Array.isArray(e.result)&&e.result.length?(e.result.forEach((e=>{for(const n in e)t[n]||(t[n]=[]),e[n]&&t[n].push(e[n])})),t):((0,i._apiSendBug)({error:"Failed to get storage matches.",x:e}),alert("Failed to get storage matches."),t)}async function l(){let e;console.log("Fetching network matches.");try{e=await fetch(`https://sheets.hopla.tools/?HT=${a.sheet_id}&format=json&sheet_name=network`).then((async e=>(0,s.handleFetchErrors)(e))).then((e=>e.text())).catch((e=>{(0,i._apiSendBug)({error:"Failed to get network matches.",x:e}),alert("Failed to get network matches.")}))}catch(e){return(0,i._apiSendBug)({error:"Failed to get network matches.",e:e.toString()}),alert("Failed to get network matches."),{}}if(e&&!e.includes("unlocked"))return l();e=JSON.parse(e),console.log("Network matches has been fetched.");const t={};return e.result&&Array.isArray(e.result)&&e.result.length?(e.result.forEach((e=>{for(const n in e)t[n]||(t[n]=[]),e[n]&&t[n].push(e[n])})),t):((0,i._apiSendBug)({error:"Failed to get network matches.",x:e}),alert("Failed to get network matches."),t)}async function c(){let e;console.log("Fetching deduction matches.");try{e=await fetch(`https://sheets.hopla.tools/?HT=${a.sheet_id}&format=json&sheet_name=deductions`).then((async e=>(0,s.handleFetchErrors)(e))).then((e=>e.text())).catch((e=>{(0,i._apiSendBug)({error:"Failed to get deduction matches.",e:e.toString()}),alert("Failed to get deduction matches.")}))}catch(e){return(0,i._apiSendBug)({error:"Failed to get deduction matches.",e:e.toString()}),alert("Failed to get deduction matches."),{}}if(e&&!e.includes("icloud"))return c();e=JSON.parse(e),console.log("Deduction matches has been fetched.");const t={};return e.result&&Array.isArray(e.result)&&e.result.length?(e.result.forEach((e=>{for(const n in e)t[n]||(t[n]=[]),e[n]&&t[n].push(e[n])})),t):((0,i._apiSendBug)({error:"Failed to get deduction matches.",x:e}),alert("Failed to get deduction matches."),t)}},9105:(e,t,n)=>{const{sheet_id:a}=n(1203)},8414:(e,t,n)=>{"use strict";async function a(e){return fetch(`https://us-central1-trade-apples.cloudfunctions.net/partners?getpartnerdetails=1&uid=${e}`).then((e=>e.json()))}n.r(t),n.d(t,{getPartnerDetails:()=>a})},2646:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getQuote:()=>c});const a=e=>e?e=(e=e.replace(/\[.+?\]/,"")).trim():"";var s=n(3539),i=n(6849);async function o(){try{if(window.kvJson)return window.kvJson;const e=await fetch("https://prices.phones.trade/?kvread=key_values").then((e=>e.json()));return window.kvJson=e,e}catch(e){return console.log("error",e),await(0,i.default)({error:"Failed to get key values from prices endpoint"}),""}}function r(e){if(e&&e.match(/internal/i))return"internal";let t=e;const n=e.match(/\[(.+)\]/);let a="";return n&&(a=n[1].trim(),t=t.replace(`[${a}]`,"").trim(),t=t.split("-"),t=t.length>1?t[1].trim():t[0].trim()),t}async function l(e){const t=await o();if(!t)return"";const n=t.bykey;return n&&n[e]||""}async function c(e,t){console.log("Getting quote.."),(0,s.CONSOLE_MESSAGE)("custom",`Getting quote of listing (${t})`);const n=e.model||"14promax",i=e.storage,c=e.network,d=e.condition||"likenew",u=e.deductions||"";let m,p;e.model&&e.storage&&e.network&&e.condition&&e.deductions||console.log("Found case with missing variant details.",e,t);const g=await async function(e){const t=(await o()).bykey;let n=[];if(!t)return"";const a=Object.keys(t).filter((e=>e.startsWith("M")));for(const e of a)n.push({key:e,value:t[e]});e&&!e.startsWith("iphone")&&(e="iphone"+e);for(const t of n){let n=t.value;if(n=n.toLowerCase().replace(/\s+/g,""),"iphonese2020"===n&&(n="iphonese2"),"iphonese2022"===n&&(n="iphonese3"),n===e)return t.key}}(n);i&&(m=await async function(e){const t=await o();return e=e.toUpperCase(),t.byvalue[e]}(i)),c&&(p=await async function(e){const t=await o(),n=Object.keys(t.bykey).filter((e=>e.startsWith("N")));for(const s of n){const n=a(t.bykey[s]);if(e.toLowerCase()===n.toLowerCase())return s}}(c));const _=await async function(e){const t=(await o()).bykey,n=[];if(!t)return"";const a=Object.keys(t).filter((e=>e.startsWith("C")));for(const e of a)n.push({key:e,value:t[e]});e&&(e=e.toLowerCase().replace(/\s+/g,""));for(const t of n){let n=t.value;if(n=r(n),n=n.toLowerCase().replace(/\s+/g,""),n===e)return t.key}return""}(d),w=await function(e){const t=[];e&&e.forEach((e=>{let n;switch(e){case"touchid issue":case"faceid issue":n="D3";break;case"crackedback":case"crackediphone":n="D1";break;case"simcard reading issue":n="D5";break;case"wifiissues":case"wifiproblems":n="D4";break;case"camera issues":case"cameraproblems":case"brokencamera":n="D2";break;case"crackedcameralens":n="D13"}n&&t.push(n)}))}(u);console.log("deductionKeys",w);const h={model:a(await l(g)),condition:a(await l(_))};if(m&&(h.storage=a(await l(m))),p&&(h.network=a(await l(p))),w&&Array.isArray(w)){const e=w.map((e=>{console.log("key",e);let t=l(e);return a(t)}));h.deductions=e}u&&u.includes("icloud")&&(m="S5",p="N6"),console.log("modelKey",g),console.log("storageKey",m),console.log("networkKey",p),console.log("conditionKey",_),console.log("deductionKeys",w);const f=await async function(e,t,n,a,s){let i=s?s.join("-"):"";return i&&(i=`&deductions=${i}`),await fetch(`https://prices.phones.trade/?getvariantprice=1&model=${e}&storage=${t||""}&network=${n||""}&condition=${a||""}${i}`).then((e=>e.text())).then((e=>{try{return JSON.parse(e)}catch(e){return{}}}))}(g,m,p,_,w);return console.log("price",f.price),!m&&f.storageKey&&(h.storage=a(await l(f.storageKey))),!p&&f.networkKey&&(h.network=a(await l(f.networkKey))),h.price=f.price,h}},2617:(e,t,n)=>{"use strict";function a(){if(window.userEmail)return window.userEmail;const e=document.body.outerHTML.match(/"username":"(.+?)"/);return e&&e.length>1?(window.userEmail=e[1],window.userEmail):void 0}n.d(t,{g:()=>a})},6564:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getUserJoined:()=>r});var a=n(4484),s=n(5703),i=n(8544),o=n(5078);async function r(e){if(!e)return console.error("getUserJoined: Missing userid."),await(0,a._apiSendBug)({error:"Failed to get user joined date",userid:e||"missing uid"}),!1;const t=(0,s.W)(),n=(0,i.getFb_dtsg)(),r=(0,o.getFrom)(document.body.outerHTML,'revision":',",");for(var l=0;l<n.length;l++)n.charCodeAt(l);const c=(0,o.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}'),d=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded",dpr:"0.75","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',"sec-ch-ua-full-version-list":'"Not_A Brand";v="8.0.0.0", "Chromium";v="120.0.6099.109", "Google Chrome";v="120.0.6099.109"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"14.2.0"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1394","x-asbd-id":"129477","x-fb-friendly-name":"MarketplaceSellerProfileDialogQuery","x-fb-lsd":"ZeZ9a75KiNNAXAW98DvOh7"},referrer:"https://www.facebook.com/marketplace/item/440485838707747?referral_code=null&referral_story_type=post&tracking=browse_serp%3Ade2d0f81-0cc3-4442-9f0c-aea8a4ee2388",referrerPolicy:"strict-origin-when-cross-origin",body:`av=${t}&__user=${t}&__a=1&__req=30&__hs=19711.HYP%3Acomet_pkg.2.1..2.1&dpr=1&__ccg=EXCELLENT&__rev=1010509199&__s=43vc1w%3Atx9r56%3Aw3n2se&__hsi=7314513933974460203&__dyn=7AzHK4HwkEng5K8G6EjBAo2nDwAxu13wFG1gyUW3qi7UK360CEboG0IE6u3y4o2Gwn82nwb-q7oc81xoswIK1Rwwwqo465o-cwfG1Rx62G5Usw9m1YwBgK7o884y0Mo4G17yovwRwlE-U2exi4UaEW2G1jxS6FobrwKxm5o7G4-5pUfEe88o4Wm7-2K0-poarCwLyESE6C14wkQ0z8c86-3u364UrwFg662S269wqQ1FwgU4q3G1eKufxa&__csr=ghTqFY8laAGfH5lqllslsATsQj49RtXczaJqvbkGb8BYBaFbA9O4VZbLWQniK-V6UF29K8jLhayuiKi8g-aUBdetXAqyVk9h4l344DCJ3Ukm2t4UGlK8gtx-23x7xO5UG362S39a585lxKi48nwUVo8Ecolx-0FE6C5FoowwwhUd8768wkFU8o2Ywr85K3a1wwCwCxu0dpw1PW0acw0oHe00TGYM0Qmfw5bw2lo0HW0tG9g0QS0buU0ek80m5w77w2mu025i03vG08Cw1nG&__comet_req=15&fb_dtsg=${n}&jazoest=25599&lsd=${c}&__aaid=0&__spin_r=${r}&__spin_b=trunk&__spin_t=1703042987&fb_api_caller_class=RelayModern&fb_api_req_friendly_name=MarketplaceSellerProfileDialogQuery&variables=%7B%22isCOBMOB%22%3Afalse%2C%22isSelfProfile%22%3Afalse%2C%22productID%22%3A%22440485838707747%22%2C%22scale%22%3A1%2C%22sellerId%22%3A%22${e}%22%2C%22show_reviews%22%3Atrue%2C%22useContextualViewHeader%22%3Afalse%7D&server_timestamps=true&doc_id=25261541876769985`,method:"POST",mode:"cors",credentials:"include"}).then((e=>e.json())).catch((e=>(console.error(e),{})));if(d.data?.user?.items?.nodes?.length>0){const e=d.data.user.items.nodes.find((e=>e.title?.text.match(/joined/i)))?.title?.text;let t=String(e).match(/\d{4}/)?.[0];if(t)return Number(t)}return console.error("Failed to get user joined year",e,d),!1}},5639:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getUserListings:()=>m});var a=n(1203),s=n(13),i=n(3539),o=n(5703),r=n(8544),l=n(2287),c=n(4246),d=n(7367),u=n(5078);async function m(e,t,n,p){let g={scale:2,sellerID:e},_="5916012751817013";n&&(g={availabilities:["IN_STOCK"],count:8,cursor:n,order:"CREATION_TIMESTAMP_DESC",scale:2,search:null,id:e},_="5793095287435129");let w="MarketplaceSellerProfileInventoryQuery";n&&(w="MarketplaceSellerProfileInventoryListPaginationQuery");const h=(0,r.getFb_dtsg)(),f=(0,u.getFrom)(document.body.outerHTML,'revision":',",");for(var y=0;y<h.length;y++)h.charCodeAt(y);const b=(0,u.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}'),x=(0,o.W)(),S=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":w,"x-fb-lsd":b},referrer:"https://www.facebook.com/marketplace/item/2620405768097653/?ref=search&referral_code=null&referral_story_type=post&tracking=browse_serp%3Aa3117bdc-6ff8-4cc8-be80-d19683441210",referrerPolicy:"strict-origin-when-cross-origin",body:`av=${x}&__user=${x}&__a=1&__req=4l&__hs=19542.HYP%3Acomet_pkg.2.1..2.1&dpr=2&__ccg=GOOD&__rev=${f}&__s=12vy3m%3A0e0321%3A5dnfrh&__hsi=7251815563541642227&__dyn=7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2CE4ibyQdwSAxacyUco5S3O2Saw8i2S1DwUx60GE3Qwb-q7oc81xoswIK1Rwwwg8a8465o-cw5Mx62G5Usw9m1YwBgK7o884y0Mo4G4UcUC7Udo5qfK0zEkxe2GewyDwkUtxGm2SUbElxm3y3aexfxmu3W3y261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1Iwqo&__csr=gggP5FNdOTdEQRq5YyQy8vEIAGb94EJdOirtjGB98YyPQDYJ9XCYyKLvtidmW9h2dX8QFyrTjHmnGaVCHbKRyl--GhtVd7JbGnG55VXxibypbCgVatmA8GcHKlBGdQ8HBy49CqCKjyV9V6eULG4t7-dx2cgrBgm-dGu4HK6FBxB1ameyFoS7UG5XCwKxvggBUiAAjKdDGcCGdDgPwWgWdxW6F4u2G4-7ojDwHAxO7bwAxG9yQ-E4C4Uy6e4EW3ycxe264EK3yiu5ocUcVUK2e1kjwEwGxeu7EcUmwby4osw0AOw0LjUco041C1kw0r1Uy0eyw0N2w6xwcy0y80_60b-xq0FpFU94bg3Tg2Cwoo7a3O02FQEkw0Li80So3AU0I60du80MU3bw7eDu4E0bEo-06e82Ozo1Fqx52e8yLw6oBtV8yaxx38a8bU7-0im0u10dC0f7x50&__comet_req=15&fb_dtsg=${h}&jazoest=25236&lsd=${b}&__spin_r=${f}&__spin_b=trunk&__spin_t=1688444885&fb_api_caller_class=RelayModern&fb_api_req_friendly_name=${w}&variables=${JSON.stringify(g)}&server_timestamps=true&doc_id=${_}`,method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,l.handleFetchErrors)(e))).then((e=>e.text()));if(S.match(/api_error_code":368/i)){console.log("Get user listings rate limited.");const t=(new Date).getTime()+60*a.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,i.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,d.stats)()).addKo(),window.isKO=!0,await(0,c.sleep)(60*a.waitIfSpamDetected*1e3),window.isKO=!1,await m(e)}const v=S.split("\r\n");let E=[];if(p&&(E=[...p]),v.forEach(((e,t)=>{try{const t=JSON.parse(e);if(t.data&&t.data.profile&&t.data.profile.marketplace_listing_sets&&t.data.profile.marketplace_listing_sets.edges)t.data.profile.marketplace_listing_sets.edges.forEach((e=>{const t={},n=e.node.canonical_listing.marketplace_listing_title,a=e.node.canonical_listing.listing_price.amount,s=e.node.canonical_listing.id;n&&(t.title=n),a&&(t.price=a),s&&(t.id=s),E.push(t)}));else if(t.data&&t.data.node&&t.data.node.canonical_listing){const e={},n=t.data.node.canonical_listing.marketplace_listing_title,a=t.data.node.canonical_listing.listing_price.amount,s=t.data.node.canonical_listing.id;n&&(e.title=n),a&&(e.price=a),s&&(e.id=s),E.push(e)}}catch(e){console.log(e)}})),!t){const t=[];let n=!1;for(let e=0;e<E.length;e++){const a=E[e].id,i=(0,s.fetchListingDetails)({id:a}).then((t=>{t.error?(console.error("Failed to get listing details.",t.error),"rate_limit_exceeded"===t.error_code&&(n=!0)):E[e]={...E[e],...t}}));e%10==0&&(await(0,c.sleep)(2e3),await Promise.all(t),t.length=0),t.push(i)}if(await Promise.all(t),n){const t=(new Date).getTime()+60*a.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,i.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,d.stats)()).addKo(),window.isKO=!0,await(0,c.sleep)(60*a.waitIfSpamDetected*1e3),window.isKO=!1,await m(e)}}return E}},821:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getVariant:()=>o});var a=n(9132),s=n(13);function i(e,t){if(!e)return"";for(const n of e)if(n.attributeName===t&&Array.isArray(n.attributeValue)&&n.attributeValue.length)return n.attributeValue[0].toLowerCase();return""}async function o(e,t){window.textMatchIndex={},window.textMatchIndex[e]={};const n={};return n.model=await async function(){const n=t.title&&t.title.toLowerCase(),s=t.description&&t.description.toLowerCase(),i=["11promax","11pro","11","xsmax","xs","xr","x","8plus","8","7plus","7","se2","12promax","12pro","12mini","12","13promax","13pro","13mini","13","6plus","6splus","6s","6"];if(!unsafeWindow.modelMatches){const e=await(0,a.getModelMatches)();unsafeWindow.modelMatches=[];const t=[];for(const n in e)i.includes(n)||t.push(n);const n=t.filter((e=>e.endsWith("promax"))),s=t.filter((e=>e.endsWith("pro"))),o=t.filter((e=>e.endsWith("plus"))),r=t.filter((e=>!e.endsWith("promax")&&!e.endsWith("pro")&&!e.endsWith("plus")));t.length=0,t.push(...n),t.push(...s),t.push(...o),t.push(...r),i.push(...t),i.forEach((t=>{unsafeWindow.modelMatches.push([t,e[t]])}))}const o=unsafeWindow.modelMatches;for(const t of o){const a=t[0],i=t[1];if(Array.isArray(i))for(const t of i){const i=new RegExp(t,"i");let o="";if(o)return window.textMatchIndex[e].modelFromAttribute||(window.textMatchIndex[e].modelFromAttribute={}),window.textMatchIndex[e].modelFromAttribute.model={rgx:i},a;if(o=n&&n.match(i),o)return window.textMatchIndex[e].title||(window.textMatchIndex[e].title={}),window.textMatchIndex[e].title.model={rgx:i},a;if(o=s&&s.match(i),o)return window.textMatchIndex[e].description||(window.textMatchIndex[e].description={}),window.textMatchIndex[e].description.model={rgx:i},window.textMatchIndex[e].model={via:"description",index:o.index,length:i.source.length},a}}for(const e of o){const t=e[0],n=e[1];if(console.log("keyMatches",n),n)for(const e of n){const n=new RegExp(e,"i");if(s&&s.match(n))return t}}}(),n.storage=await async function(){const s=t.title&&t.title.toLowerCase(),i=t.description&&t.description.toLowerCase();window.storageMatches||(window.storageMatches=await(0,a.getStorageMatches)());const o=window.storageMatches,r={"16gb":["16\\s?gb"]};for(const t in o){const n=o[t];for(const a of n){const n=new RegExp(a,"i");if(s&&s.match(n))return window.textMatchIndex[e].title||(window.textMatchIndex[e].title={}),window.textMatchIndex[e].title.storage={rgx:n},t;if(i&&i.match(n))return window.textMatchIndex[e].description||(window.textMatchIndex[e].description={}),window.textMatchIndex[e].description.storage={rgx:n},t}}for(const e in r){const t=r[e];for(const a of t){const t=new RegExp(a,"i");if(s&&s.match(t))return n.skip=!0,e;if(i&&i.match(t))return n.skip=!0,e}}}(),n.network=await async function(){const n=t.title&&t.title.toLowerCase(),s=t.description&&t.description.toLowerCase(),i=["unlocked","locked"];if(!window.networkMatches){const e=await(0,a.getNetworkMatches)();window.networkMatches=[],i.forEach((t=>{window.networkMatches.push([t,e[t]])}))}const o=window.networkMatches;for(const t of o){const a=t[0],i=t[1];for(const t of i){const i=new RegExp(t,"i");if(n&&n.match(i))return window.textMatchIndex[e].title||(window.textMatchIndex[e].title={}),window.textMatchIndex[e].title.network={rgx:i},a;if(s&&s.match(i))return window.textMatchIndex[e].description||(window.textMatchIndex[e].description={}),window.textMatchIndex[e].description.network={rgx:i},a}}}(),n.condition=await function(){if(t&&t.condition){if("new"===t.condition)return"newinbox";if("used_like_new"===t.condition)return"new";if("used_good"===t.condition)return"likenew";if("used_fair"===t.condition)return"used"}}(),n.deductions=await async function(){const n=t.title&&t.title.toLowerCase(),s=t.description&&t.description.toLowerCase(),i=["icloud","crackedcameralens","faceid issue"];if(!window.deductionMatches){const e=await(0,a.getDeductionMatches)();window.deductionMatches=[],i.forEach((t=>{window.deductionMatches.push([t,e[t]])}))}const o=window.deductionMatches,r=[];for(const t of o){const a=t[0],i=t[1];for(const t of i){const i=new RegExp(t,"i");n&&n.match(i)?(window.textMatchIndex[e].title||(window.textMatchIndex[e].title={}),window.textMatchIndex[e].title.deductions||(window.textMatchIndex[e].title.deductions=[]),window.textMatchIndex[e].title.deductions.push(i),r.push(a)):s&&s.match(i)&&(window.textMatchIndex[e].description||(window.textMatchIndex[e].description={}),window.textMatchIndex[e].description.deductions||(window.textMatchIndex[e].description.deductions=[]),window.textMatchIndex[e].description.deductions.push(i),r.push(a))}}return r}(),t.price?n.listing_price=parseFloat(t.price):n.listing_price=0,unsafeWindow.lastVariant=n,async function(e,t){let n;if(e&&(n=e),!n)return;window.bugReport={};const a=t||await(0,s.fetchListingDetails)({id:n});window.bugReport.listingId=n;const o=i(a.attributes,"model"),r=i(a.attributes,"carrierNetwork");if(document.querySelector("#buglistingdetails").innerHTML="",document.querySelector("#bugvariantdetails").innerHTML="",l("URL",window.location.href),a.title){let e=a.title;e=d(e,"title"),l("Title",e),window.bugReport.listing_title=e}if(a.description){let e=a.description;e=d(e,"description"),l("Description",e),window.bugReport.listing_description=e}if(o){let e=o;e=d(e,"modelFromAttribute"),l("Model",e),window.bugReport.listing_detail_model=e}if(r){let e=r;e=d(e,"networkFromAttribute"),l("Network",e),window.bugReport.listing_detail_network=e}function l(e,t){document.querySelector("#buglistingdetails").innerHTML+=` <div class="report-detail">\n                            <span class="label">${e}</span>\n                            <span id="itemtitle">${t}</span>\n                          </div>`}function c(e,t){document.querySelector("#bugvariantdetails").innerHTML+=` <div class="report-detail">\n                            <span class="label">${e}</span>\n                            <span id="itemtitle">${t}</span>\n                          </div>`}function d(e,t){if(window.textMatchIndex[n]&&window.textMatchIndex[n][t]){if(window.textMatchIndex[n][t].model){const a=window.textMatchIndex[n][t].model.rgx;e=e.replace(a,(e=>`<strong class="blue">${e}</strong>`))}if(window.textMatchIndex[n][t].storage){const a=window.textMatchIndex[n][t].storage.rgx;e=e.replace(a,(e=>`<strong class="green">${e}</strong>`))}if(window.textMatchIndex[n][t].network){const a=window.textMatchIndex[n][t].network.rgx;e=e.replace(a,(e=>`<strong class="purple">${e}</strong>`))}if(window.textMatchIndex[n][t].deductions){const a=window.textMatchIndex[n][t].deductions;for(const t of a)e=e.replace(t,(e=>`<strong class="red">${e}</strong>`))}}return e}window.lastVariant&&(window.lastVariant.model&&(window.bugReport.model=window.lastVariant.model,c("Model",window.lastVariant.model)),window.lastVariant.storage&&(window.bugReport.storage=window.lastVariant.storage,c("Storage",window.lastVariant.storage)),window.lastVariant.network&&(window.bugReport.network=window.lastVariant.network,c("Network",window.lastVariant.network)),window.lastVariant.condition&&(window.bugReport.condition=window.lastVariant.condition,c("Condition",window.lastVariant.condition)))}(e,t),n}window.getVariant=o},3119:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>s});var a=n(6849);async function s(e){return fetch(`https://us-central1-trade-apples.cloudfunctions.net/partners?getDomain=1&uid=${e}`).then((e=>e.text())).then((t=>{try{const n=JSON.parse(t);let a=n&&n.domain;return a||(a=`${e}.tradeapples.com`),`https://${a}`}catch(t){return`https://${e}.tradeapples.com`}})).catch((t=>((0,a.default)({error:"getWebsiteVariable failed.",detail:t.toString()}),`https://${e}.tradeapples.com`)))}},2287:(e,t,n)=>{"use strict";function a(e){return new Promise(((t,n)=>unsafeWindow.isRun?e.ok?void t(e):(console.trace(),console.log("response.statusText",e.statusText),void setTimeout((()=>{n(e.statusText)}),1e4)):t(e)))}n.r(t),n.d(t,{handleFetchErrors:()=>a})},9355:(e,t,n)=>{"use strict";function a(){return!!(document.getElementById("followup_1").value||document.getElementById("followup_2").value||document.getElementById("followup_3").value||document.getElementById("messageonreply_1").value)}n.d(t,{z:()=>a})},7731:(e,t,n)=>{"use strict";n.r(t),n.d(t,{injectLogger:()=>s});const{showLastConsoleLog:a}=n(7091);function s(){void 0===window.everything&&(window.everything=[],console.defaultLog=console.log.bind(console),console.log=function(){a(Array.from(arguments).join(" ")),window.everything.push({type:"log",datetime:(new Date).getTime(),value:Array.from(arguments)}),console.defaultLog.apply(console,[(new Date).toLocaleString(),...arguments])},console.defaultError=console.error.bind(console),console.error=function(){a(Array.from(arguments).join(" ")),window.everything.push({type:"error",datetime:(new Date).getTime(),value:Array.from(arguments)}),console.defaultError.apply(console,arguments)},console.defaultWarn=console.warn.bind(console),console.warn=function(){window.everything.push({type:"warn",datetime:(new Date).getTime(),value:Array.from(arguments)}),console.defaultWarn.apply(console,arguments)},console.defaultDebug=console.debug.bind(console),console.debug=function(){window.everything.push({type:"debug",datetime:(new Date).getTime(),value:Array.from(arguments)}),console.defaultDebug.apply(console,arguments)})}},4559:(e,t,n)=>{"use strict";function a(){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","https://fonts.googleapis.com/icon?family=Material+Icons"),document.head.appendChild(e),e=document.createElement("link"),e.setAttribute("rel","stylesheet"),e.setAttribute("href","https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"),document.head.appendChild(e),e=document.createElement("script"),e.setAttribute("src","https://code.getmdl.io/1.3.0/material.min.js"),document.head.appendChild(e),e=document.createElement("script"),e.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.4.2/dialog-polyfill.min.js"),document.head.appendChild(e),document.head.insertAdjacentHTML("beforeend","<style>\n    #ta .mdl-switch {\n      width: unset;\n    }\n\n    #__next, .MuiPaper-root {\n      width: calc(100% - 370px) !important;\n      left: 0px !important;\n    }\n    </style>"),GM_addElement("script",{src:"https://code.getmdl.io/1.3.0/material.min.js",type:"text/javascript"}),GM_addElement("link",{rel:"stylesheet",href:"https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"}),GM_addElement("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.4.2/dialog-polyfill.min.css"}),GM_addElement("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/icon?family=Material+Icons"}),GM_addStyle("\n  #ta .mdl-switch {\n    width: unset;\n  }\n\n  #__next, .MuiPaper-root {\n    width: calc(100% - 370px) !important;\n    left: 0px !important;\n  }")}n.r(t),n.d(t,{injectMdl:()=>a})},3695:(e,t,n)=>{"use strict";function a(){const e=document.createElement("script");e.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.2/moment.min.js"),document.head.appendChild(e)}n.r(t),n.d(t,{injectMoment:()=>a})},5729:(e,t,n)=>{"use strict";function a(){const e=document.createElement("style");document.head.append(e),e.textContent=".mdl-list__item.taseparator {\n    border-bottom: solid 1px #e0e0e0;\n  }\n  \n  .mdl-list__item.taseparator .mdl-textfield__input {\n    border-bottom: unset;\n    text-align: right;\n  }\n  \n  .mdl-list__item-secondary-action.tawsmall {\n    width: 45px;\n  }\n  \n  [id^=page] .demo-list-control {\n    margin-top: unset;\n    height: calc(100% - 143px);\n    overflow: auto;\n  }\n  \n  #page2 .demo-list-control {\n    /* margin-top: unset;\n    height: fit-content;\n    overflow: auto; */\n    margin-top: unset;\n    height: calc(100% - 219px);\n    overflow: auto;\n  }\n  \n  #ta .mdl-textfield {\n    width: 100%;\n  }\n  \n  /* #ta .mdl-textfield__label {\n    text-align: center;\n  } */\n  \n  .label {\n    font-weight: 700;\n    margin-right: 10px;\n  }\n  \n  #dialog-bug {\n    width: 400px;\n    height: max-content;\n  }\n  \n  .report-detail {\n    display: flex;\n  }\n  \n  #bugvariantdetails {\n    border: solid 1px;\n    padding: 8px;\n  }\n  \n  \n  .blue {\n    color: blue\n  }\n  .green {\n    color: green\n  }\n  .purple {\n    color: purple\n  }\n  .red {\n    color: red\n  }\n  .bgred {\n    background: red !important;\n  }\n\n  .w100 {\n    width: 100%;\n  }\n\n  .h100 {\n    height: 100%\n  }\n\n  .space-between {\n    display: flex;\n    justify-content: space-between;\n  }\n\n  .bgblue {\n    background: rgb(63, 81, 181) !important;\n  }\n\n  .bblue {\n    color: rgb(63, 81, 181) !important;\n  }\n\n  .hoplablue {\n    background-color: #343ca3 !important;\n  }\n  \n  .buttons_container {\n    display: flex;\n    justify-content: space-around;\n    width: 100%;\n    flex-wrap: wrap;\n  }\n\n  .buttons_container > button {\n    margin-top: 14px;\n  }\n  \n  .listing_debugger_container {\n    display: flex;\n    justify-content: flex-start;\n    width: 92%;\n    position: absolute;\n    bottom: 0;\n    flex-direction: column;\n    align-items: stretch;\n    margin-bottom: 30px;\n  }\n\n  .fsmall {\n    font-size: small;\n  }\n\n  .h150 {\n    height: 150px;\n  }\n\n  .nowrap {\n      white-space: pre;\n      overflow-wrap: normal;\n      overflow-x: scroll;\n    }\n\n  .popup-content {\n    min-width: 485px\n  }\n\n  .mb20 {\n    margin-bottom: 20px\n  }\n\n  .login_container {\n    height: 100%;\n  }\n\n  .mdl-menu__container.is-visible {\n    z-index: 9999;\n    position: sticky;\n  }\n  ";const t=document.createElement("style");document.head.append(t),t.textContent=".getmdl-select{outline:none}.getmdl-select .mdl-textfield__input{cursor:pointer}.getmdl-select .selected{background-color:#ddd}.getmdl-select .mdl-icon-toggle__label{float:right;margin-top:-30px;color:rgba(0,0,0,0.4);transform:rotate(0);transition:transform 0.3s}.getmdl-select.is-focused .mdl-icon-toggle__label{color:#3f51b5;transform:rotate(180deg)}.getmdl-select .mdl-menu__container{width:100% !important;margin-top:2px}.getmdl-select .mdl-menu__container .mdl-menu{width:100%}.getmdl-select .mdl-menu__container .mdl-menu .mdl-menu__item{font-size:16px}.getmdl-select__fix-height .mdl-menu__container .mdl-menu{overflow-y:auto;max-height:288px !important}.getmdl-select__fix-height .mdl-menu.mdl-menu--top-left{bottom:auto;top:0}\n/*# sourceMappingURL=getmdl-select.min.css.map */"}n.r(t),n.d(t,{injectStyle:()=>a})},5658:(e,t,n)=>{"use strict";n.r(t),n.d(t,{injectTrackjs:()=>s});var a=n(6849);function s(){console.log("window.TrackJS",window.TrackJS);try{window.TrackJS&&TrackJS.install({token:"16c187efb05541c6b81bee305e0727d1",application:"facebookbot"}),window.TrackJS.addMetadata("application","facebookbot"),window.TrackJS.track("Testing TrackJS!")}catch(e){console.error(e),(0,a.default)({error:"Failed to install trackjs",details:e.toString()})}}},642:(e,t,n)=>{"use strict";function a(){document.body.insertAdjacentHTML("afterbegin",'<div id="ta_maximize" style="user-select: none;position: fixed;border: 1px solid;height: 38px;margin-top: -7px;width: 30px;font-size: -webkit-xxx-large;cursor: pointer;background: rgb(63, 81, 181);z-index: 1;right: 0px;align-items: center;justify-content: center;display: block;color: white;">\n    <svg fill="#000000" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 473 473" xml:space="preserve" style="\n        position: absolute;\n        height: 81%;\n        width: 65%;\n        padding: 0px;\n        color: white;\n        fill: white;\n        margin: 5px;\n    ">\n    <g>\n      <g>\n        <path d="M459.5,0H330.4c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5h96.5L218.8,235.1c-5.3,5.3-5.3,13.8,0,19.1c2.6,2.6,6.1,4,9.5,4\n          s6.9-1.3,9.5-4L446,46.1v96.5c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5V13.5C473,6,467,0,459.5,0z"></path>\n        <path d="M459.5,231.2c-7.5,0-13.5,6-13.5,13.5v130.9c0,38.8-31.6,70.4-70.4,70.4H97.4C58.6,446,27,414.4,27,375.6V97.4\n          C27,58.6,58.6,27,97.4,27h129.9c7.5,0,13.5-6,13.5-13.5S234.8,0,227.3,0H97.4C43.7,0,0,43.7,0,97.4v278.2\n          C0,429.3,43.7,473,97.4,473h278.2c53.7,0,97.4-43.7,97.4-97.4V244.7C473,237.2,467,231.2,459.5,231.2z"></path>\n      </g>\n    </g>\n    </svg>\n  </div>\n  <div id="ta" style="position: fixed;z-index: 900000;background-color: white;border: solid; right: 0px;width: 385px;\n                  height: 600px; \n                  padding-right: unset;\n                  padding-top: unset;\n                  height: 100%;\n                  top: 0;">\n                <div class="login_container">\n                  <iframe id="login_iframe" src="https://login.phones.trade" style="border: none; width: 100%; height: 100%; margin-top: 100%;"></iframe>\n                </div>\n                \x3c!-- MDL Tab Container --\x3e\n                <div id="taheader" class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect" style="height: 100%;">\n                  <div id="info-header" style="display: none; color: white;background: rgb(63,81,181);line-height: 26px;padding: 5px 0px;width: 100%;text-align: center; justify-content: space-around;">\n                  <span id="" style="-webkit-user-select: none;-ms-user-select: none;user-select: none;position: absolute;left: 0px;border: 1px solid;height: 38px;margin-top: -7px;width: 30px;font-size: -webkit-xxx-large;cursor: pointer;">-</span>\n                    <span id="info-subscription"></span>\n                    <span id="info-website"></span>\n                    <span><a id="info-logout" href="#" style="text-decoration: none;color: white;-webkit-highlight: none;">Logout</a></span>\n                  </div>\n                  \x3c!-- Tab Bars --\x3e\n                  <div id="menu" class="mdl-tabs__tab-bar" style="display: none;">\n                      <a href="#page2" class="mdl-tabs__tab is-active" style="width: 100%;">Automate</a>\n                      <a href="#page3" class="mdl-tabs__tab" style="width: 100%;">Content</a>\n                      <a href="#page4" class="mdl-tabs__tab" style="width: 100%;">Settings</a>\n                  </div>\n\n                  \x3c!-- <div id="page1" class="mdl-tabs__panel is-active" style="height: 100%;">\n                    <iframe id="taframe" src="https://sell.phones.trade/?model=12pro&amp;storage=128gb&amp;network=unlocked&amp;condition=usedlikenew&a=1" style="\n                      height: 100%;\n                    "></iframe>\n                    <button id="reportbug2" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" style="position: absolute;\n                      bottom: 0px;\n                      left: 50%;\n                      transform: translate(-50%);\n                      z-index: 1;\n                      width: 100%;\n                      display: none;\n                      height: 44px;">\n                        Report a\n                        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bug" class="svg-inline--fa fa-bug fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 22px;padding-left: 3px;margin-bottom: 3px;"><path fill="currentColor" d="M511.988 288.9c-.478 17.43-15.217 31.1-32.653 31.1H424v16c0 21.864-4.882 42.584-13.6 61.145l60.228 60.228c12.496 12.497 12.496 32.758 0 45.255-12.498 12.497-32.759 12.496-45.256 0l-54.736-54.736C345.886 467.965 314.351 480 280 480V236c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v244c-34.351 0-65.886-12.035-90.636-32.108l-54.736 54.736c-12.498 12.497-32.759 12.496-45.256 0-12.496-12.497-12.496-32.758 0-45.255l60.228-60.228C92.882 378.584 88 357.864 88 336v-16H32.666C15.23 320 .491 306.33.013 288.9-.484 270.816 14.028 256 32 256h56v-58.745l-46.628-46.628c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0L141.255 160h229.489l54.627-54.627c12.498-12.497 32.758-12.497 45.256 0 12.496 12.497 12.496 32.758 0 45.255L424 197.255V256h56c17.972 0 32.484 14.816 31.988 32.9zM257 0c-61.856 0-112 50.144-112 112h224C369 50.144 318.856 0 257 0z"></path></svg>\n                    </button>\n                  </div> --\x3e\n\n                  <div id="page2" class="mdl-tabs__panel is-active" style="position: relative; height: calc(100% - 105px); display: none;">\n                    <ul class="demo-list-control mdl-list">\n                      <li class="mdl-list__item" style="height: 100px;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input" type="text" rows= "3" id="keywords" ></textarea>\n                              <label class="mdl-textfield__label" for="keywords">Search (Keywords & Categories)</label>\n                            </div>\n                          </span>\n                      </li>\n                      <li style="display: flex;justify-content: space-around;">\n                        <a class="bblue" href="#" id="copy_search_filters" style="display: flex;justify-content: center;">[Copy Search &amp; Filters from URL]</a>\n                        <a class="bblue" href="#" id="test_search_filters" style="display: flex;justify-content: center;">[Test Search]</a>\n                      </li>\n                      <li class="mdl-list__item" style="height: fit-content;">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input nowrap" type="text" rows= "3" id="searchwithfilters" ></textarea>\n                            <label class="mdl-textfield__label" for="searchwithfilters">Search With Filters</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 100px; margin-top: 15px;">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows= "3" id="coordinates" ></textarea>\n                            <label class="mdl-textfield__label" for="coordinates">Latitude,Longitude</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 100px;">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows= "3" id="radius" ></textarea>\n                            <label class="mdl-textfield__label" for="radius">Radius (in miles)</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Loop Search & Locations\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-loopsearch">\n                            <input type="checkbox" id="switch-loopsearch" class="mdl-switch__input" checked/>\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="margin-right: -54px;">\n                          Price Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 71px;margin-right: -20px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="100" id="listing_min_price" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="listing_min_price"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content" style="margin-left: 29px;margin-right: -53px;">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 90px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1000" id="listing_max_price" placeholder="0" style="text-align: left;">\n                            <label class="mdl-textfield__label" for="listing_max_price"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 100px;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input" type="text" rows= "3" id="title_must_include" ></textarea>\n                              <label class="mdl-textfield__label" for="title_must_include">Title must contain, any</label>\n                            </div>\n                          </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 100px;">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows= "3" id="skipwords_title" ></textarea>\n                            <label class="mdl-textfield__label" for="skipwords_title">Skip Words Title</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 100px;">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows= "3" id="skipwords_description" ></textarea>\n                            <label class="mdl-textfield__label" for="skipwords_description">Skip Words Description</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 100px;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input" type="text" rows= "3" id="ownerlisting_kw_match" ></textarea>\n                              <label class="mdl-textfield__label" for="ownerlisting_kw_match">Owner Listing Counter Keywords</label>\n                            </div>\n                          </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Owner KW Listings Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="owner_min_lists" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="owner_min_lists"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="3" id="owner_max_lists" placeholder="0">\n                            <label class="mdl-textfield__label" for="owner_max_lists"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Listing Age (days.hours) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="listing_min_age" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="listing_min_age"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="3" id="listing_max_age" placeholder="0">\n                            <label class="mdl-textfield__label" for="listing_max_age"></label>\n                          </span>\n                        </span>\n                      </li>\n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Bot Mode\n                        </span>\n                        <div>\n                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="mode_single">\n                            <input type="radio" id="mode_single" class="mdl-radio__button" name="bot_mode" value="single" checked disabled>\n                            <span class="mdl-radio__label">Single</span>\n                          </label>\n                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="mode_multi">\n                            <input type="radio" id="mode_multi" class="mdl-radio__button" name="bot_mode" value="multi" disabled>\n                            <span class="mdl-radio__label">Multi</span>\n                          </label>\n                        </div>\n                      </li> --\x3e\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Skip Profiles Created => (Year)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="skip_profiles_created_after_year" value=2023 placeholder="2023">\n                            <label class="mdl-textfield__label" for="skip_profiles_created_after_year"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 58px;">  \n                        <div class="w100">\n                          <button id="btn_test_url" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect w100"\n                            height: 44px;">\n                            TEST THIS LISTING\n                          </button>\n                        </div>\n                      </li>\n                      \n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Custom Price Delta\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="text" id="custom_price_delta" placeholder="0">\n                            <label class="mdl-textfield__label" for="custom_price_delta"></label>\n                          </span>\n                        </span>\n                      </li> --\x3e\n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Price Round Up/Down\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="roundupdown" placeholder="0">\n                            <label class="mdl-textfield__label" for="roundupdown"></label>\n                          </span>\n                        </span>\n                      </li> --\x3e\n                     \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Owner Skip Expiry\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="ownerskipexpiry" placeholder="days" value="14">\n                            <label class="mdl-textfield__label" for="ownerskipexpiry"></label>\n                          </span>\n                        </span>\n                      </li> --\x3e\n                      \x3c!--<li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Owner Message Expiry\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="owner_message_expiry" placeholder="days" value="14" min="3">\n                            <label class="mdl-textfield__label" for="owner_message_expiry"></label>\n                          </span>\n                        </span>\n                      </li>--\x3e\n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Continue After Storage\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-continue_after_storage">\n                            <input type="checkbox" id="switch-continue_after_storage" class="mdl-switch__input" />\n                          </label>\n                        </span>\n                      </li> --\x3e\n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Continue After Network\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-continue_after_network">\n                            <input type="checkbox" id="switch-continue_after_network" class="mdl-switch__input" />\n                          </label>\n                        </span>\n                      </li> --\x3e\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px; display: none;">\n                        <span class="mdl-list__item-primary-content">\n                          Send Partner Messages\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-sendpartnermessages">\n                            <input type="checkbox" id="switch-sendpartnermessages" class="mdl-switch__input" />\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="display: none; padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Streak\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="5" id="streak" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="streak"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Then Timeout\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="15" id="streaktimeout" placeholder="0">\n                            <label class="mdl-textfield__label" for="streaktimeout"></label>\n                          </span>\n                        </span>\n                      </li>\n                    \x3c!--  \n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Archive After Sending\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-deleteaftersend">\n                            <input type="checkbox" id="switch-deleteaftersend" class="mdl-switch__input" checked />\n                          </label>\n                        </span>\n                      </li> --\x3e\n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        ">\n                        <div class="buttons_container">\n                          <button id="purge_listings" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                            Purge Listings\n                          </button>\n                          <button id="purge_owners" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                            Purge Owners\n                          </button>\n                          <button id="archive_all_threads" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                            Archive All Threads\n                          </button>\n                        </div>\n                      </li> --\x3e\n                    </ul>\n                    <div id="status" style="color: white;background: black;line-height: 26px;padding: 5px 0px;position: absolute;bottom: 137px;width: 100%;text-align: center;min-height: 61px;align-items: center;display: flex;justify-content: center; z-index: 1">\n                        <span id="statustext" style="\n                    "></span></div>\n                    \n\n\n                    <div id="stats" style="color: white;background: rgb(63,81,181);line-height: 26px;padding: 5px 0px;position: absolute;bottom: 49px;width: 100%;text-align: center;">\n                    <span>Today\'s Stats </span>\n                    <div style="\n                      display: flex;\n                      justify-content: space-evenly;\n                    ">\n                      <span><span id="stat_scraped">0</span> scraped </span>\n                      <span><span id="stat_new_listings">0</span> new </span>\n                      \x3c!-- <span><span id="stat_single_listings">0</span> single</span>\n                      <span><span id="stat_multi_listings">0</span> multi</span> --\x3e\n                      <span><span id="stat_skipped">0</span> skipped</span>\n                    </div>\n                    <div style="\n                      display: flex;\n                      justify-content: space-evenly;\n                    ">\n                      <span><span id="stat_offers">0</span> messaged</span>\n                      <span><span id="stat_runs">0</span> runs </span>\n                      <span><span id="stat_streaks">0</span> streak</span>\n                      <span><span id="stat_ko">0</span> KO</span>\n                    </div>\n                  </div>\n\n\n\n                    <div class="footer" style="\n                      justify-content: space-around;\n                      display: flex;\n                      position: absolute;\n                      bottom: 5px;\n                      width: 100%; align-items: center;\n                      border-top: solid 1px;\n                      border-top-color: #e0e0e0;\n                      height: 44px;\n                      padding-right: 10px;\n                      ">\n                      <span>Run From</span>\n                      <input id="runfrom" type="time" style="width: unset;font-size: 16px;font-family: Lato,&quot;Helvetica Neue&quot;,Arial,sans-serif;font-weight: 400;" class="mdl-textfield__input" value="09:00">\n                      <span>Until</span>\n                      <input id="rununtil" type="time" style="width: unset;font-size: 16px;font-family: Lato,&quot;Helvetica Neue&quot;,Arial,sans-serif;font-weight: 400;" class="mdl-textfield__input" value="18:00">\n                      <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-rununtil">\n                        <input type="checkbox" id="switch-rununtil" class="mdl-switch__input">\n                        <span class="mdl-switch__label"></span>\n                      </label>\n                    </div>\n                  </div>\n\n                  <div id="page3" class="mdl-tabs__panel" style="\n                    height: calc(100% - 105px);\n                    overflow: hidden auto;\n                    position: relative;\n                    display: none;">\n                    <div id="page2loading" class="mdl-spinner mdl-js-spinner is-active" style="position: absolute;left: 50%;top: 30%; display:none;"></div>\n                    <ul class="demo-list-control mdl-list">\n                      <li class="mdl-list__item h150" >  \n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_1" ></textarea>\n                            <label class="mdl-textfield__label" for="message_1">Message 1</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_2" ></textarea>\n                            <label class="mdl-textfield__label" for="message_2">Message 2</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_3" ></textarea>\n                            <label class="mdl-textfield__label" for="message_3">Message 3</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150" >  \n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="followup_1" ></textarea>\n                            <label class="mdl-textfield__label" for="followup_1">Follow-up 1</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="followup_2" ></textarea>\n                            <label class="mdl-textfield__label" for="followup_2">Follow-up 2</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="followup_3" ></textarea>\n                            <label class="mdl-textfield__label" for="followup_3">Follow-up 3</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150" >  \n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="messageonreply_1" ></textarea>\n                            <label class="mdl-textfield__label" for="messageonreply_1">Message-On-Reply 1</label>\n                          </div>\n                        </span>\n                      </li>\n                      \x3c!-- <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="listing_price" ></textarea>\n                            <label class="mdl-textfield__label" for="lowball_message">Lowball</label>\n                          </div>\n                        </span>\n                      </li> --\x3e\n                    \x3c!--  <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_4" ></textarea>\n                            <label class="mdl-textfield__label" for="message_4">Message 4</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_5" ></textarea>\n                            <label class="mdl-textfield__label" for="message_5">Message 5</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 60px; display: none;">\n                        <span class="mdl-list__item-primary-content">\n                          <span class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <input class="mdl-textfield__input" type="text" id="partnermessage">\n                            <label class="mdl-textfield__label" for="partnermessage">Partner Message</label>\n                          </span>\n                        </span>\n                      </li> --\x3e\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Price Delta\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 71px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="text" id="listing_price_delta" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="listing_price_delta"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Rounding\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 90px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="roundupdown" placeholder="0" style="text-align: left;">\n                            <label class="mdl-textfield__label" for="roundupdown"></label>\n                          </span>\n                        </span>\n                      </li>\n                    </ul>\n                    <div class="variables" style="padding-bottom: 10px; position: absolute;\n                    bottom: 55px;\n                    padding: 0px 16px;">\n                        <span style="display: block;">Available Variables:</span>\n                        <span class="variable">[name]</span>\n                        \x3c!-- <span class="variable">[model]</span>\n                        <span class="variable">[network]</span>\n                        <span class="variable">[memory]</span>\n                        <span class="variable">[price]</span> --\x3e\n                        <span class="variable">[price]</span>\n                        <span class="variable">[title]</span>\n                        \x3c!-- <span class="variable">[deductions]</span>\n                        <span class="variable">[condition]</span> --\x3e\n                        \x3c!-- <span class="variable">[quote_link]</span>\n                        <span class="variable">[pickup_link]</span> \n                        <span class="variable">[partner_link]</span> \n                        <span class="variable">[website]</span> --\x3e\n                    </div>\n                    <div class="template-actions" style="\n                      justify-content: space-between;\n                      display: flex;\n                      position: absolute;\n                      bottom: 0px;\n                      width: 100%;\n                    ">\n                      <button id="test_template" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect"\n                        style="width: 50%;\n                        margin-right: 1px;\n                        height: 44px;">\n                        Test\n                      </button>\n                      <button id="restore_defaults" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect"\n                        style="width: 50%;\n                        height: 44px;">\n                        Restore Defaults\n                      </button>\n                    </div>\n                  </div>\n                  <div id="page4" class="mdl-tabs__panel" style="\n                    height: 100%;\n                    overflow: hidden auto;\n                    position: relative;\n                    display: none;\n                    ">\n                    <div id="page2loading" class="mdl-spinner mdl-js-spinner is-active" style="position: absolute;left: 50%;top: 30%; display:none;"></div>\n                    <ul class="demo-list-control mdl-list">\n                      <li id="row_soldphones" class="mdl-list__item taseparator" style="padding-top: unset !important; padding-bottom: unset !important; height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="text-align: center; line-height: 2px; height: 25px;">\n                          Phones sold in the last 30 days: <span id="phones_sold_last_30_days" style="margin-left: 9px;font-weight: 500;">X</span>\n                        </span>\n                      </li>\n                      <li id="row_licenseKeyAddBuy" class="mdl-list__item taseparator" style="padding-top: unset !important; padding-bottom: unset !important; height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="text-align: center; line-height: 2px; height: 25px;">\n                          License Key:\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <button id="btn_add_license_key" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored">\n                            ADD\n                          </button>\n                          <button id="buy_license_key" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored">\n                            BUY\n                          </button>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Owner Message Expiry\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="owner_message_expiry" placeholder="days" value="14" min="7">\n                            <label class="mdl-textfield__label" for="owner_message_expiry"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Archive After Sending\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-deleteaftersend">\n                            <input type="checkbox" id="switch-deleteaftersend" class="mdl-switch__input" checked />\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Follow Up After (mins)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="followup_after" placeholder="minutes" value="20">\n                            <label class="mdl-textfield__label" for="followup_after"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600;">\n                          Timeouts\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Between API Calls (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="5" id="timeout_api_calls_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_api_calls_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="80" id="timeout_api_calls_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_api_calls_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Between Messages (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="5" id="timeout_between_messages_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_between_messages_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="300" id="timeout_between_messages_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_between_messages_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          After Listings Messaged (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="timeout_listings_messaged_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_listings_messaged_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="15" id="timeout_listings_messaged_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_listings_messaged_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          After Streak (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="timeout_streak_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_streak_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="30" id="timeout_streak_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_streak_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          End of Run (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="30" id="timeout_end_of_run_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_end_of_run_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="300" id="timeout_end_of_run_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_end_of_run_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Stop Messaging After (# of messages)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input disabled class="mdl-textfield__input" type="number" id="stop_messaging_after" placeholder="0" value="0">\n                            <label class="mdl-textfield__label" for="stop_messaging_after"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600; margin-left: 36px;">\n                          OpenAI\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-enablegpt">\n                            <input type="checkbox" id="switch-enablegpt" class="mdl-switch__input" />\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="display: flex; flex-direction: column;">\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 100%">\n                          <span class="mdl-textfield mdl-js-textfield openai_init" id="container_openai_apikey">\n                            <input class="mdl-textfield__input" value="" id="openai_apikey" placeholder="API KEY" style="text-align: center; border-bottom: 1px solid; height: 31px;">\n                            <label class="mdl-textfield__label" for="openai_apikey"></label>\n                          </span>\n                        </span>\n                        <div class="openai_ready mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select">\n                          <input type="text" value="" class="mdl-textfield__input" id="assistant_id" style="text-align: center;" readonly>\n                          <input type="hidden" value="" name="assistant_id">\n                          <label for="assistant_id" class="mdl-textfield__label">Assistant ID</label>\n                          <ul for="assistant_id" class="mdl-menu mdl-menu--bottom-left mdl-js-menu">\n                              \x3c!-- <li class="mdl-menu__item" data-val="DEU">Germany</li>\n                              <li class="mdl-menu__item" data-val="BLR">Belarus</li>\n                              <li class="mdl-menu__item" data-val="RUS">Russia</li> --\x3e\n                          </ul>\n                        </div>\n                        <li class="openai_readyflex w100 mdl-list__item taseparator" style="padding-top: unset !important;\n                          padding-bottom: unset !important;\n                          height: 43px;">\n                          <span class="mdl-list__item-primary-content">\n                            Images\n                          </span>\n                          <span class="mdl-list__item-secondary-action tawsmall">\n                            <span class="mdl-textfield mdl-js-textfield">\n                              <input class="mdl-textfield__input" type="number" id="num_images" value="3">\n                              <label class="mdl-textfield__label" for="num_images"></label>\n                            </span>\n                          </span>\n                        </li>\n                        <li class="openai_readyflex w100 mdl-list__item taseparator" style="padding-top: unset !important;\n                          padding-bottom: unset !important;\n                          height: 43px;">\n                          <span class="mdl-list__item-primary-content">\n                            Detail\n                          </span>\n                          <span class="mdl-list__item-secondary-action">\n                            <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="high">\n                              <input checked class="mdl-radio__button" id="high" name="image_detail" type="radio"\n                              value="high">\n                              <span class="mdl-radio__label">High</span>\n                            </label>\n                            <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="low">\n                              <input class="mdl-radio__button" id="low" name="image_detail" type="radio" value="low">\n                              <span class="mdl-radio__label">Low</span>\n                            </label>\n                          </span>\n                        </li>\n                        <div class="buttons_container_container w100">\n                          <div class="buttons_container space-between">\n                            <button id="btn_set_openai_apikey" class="openai_init mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Set Key\n                            </button>\n                            <button id="btn_openai_test" class="openai_ready mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Test\n                            </button>\n                            <button id="btn_copylisting_details" class="openai_ready mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Copy Listing Details\n                            </button>\n                            <button id="btn_eject_openai_apikey" class="openai_ready mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" style="display: none;">\n                              Eject Key\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important; height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600;">\n                          Archive Threads\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="margin-right: -54px;">\n                          Archive \n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 71px;margin-right: -20px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="60" id="amount_to_archive" placeholder="# threads" style="text-align: center;">\n                            <label class="mdl-textfield__label" for="amount_to_archive"></label>\n                          </span>\n                        </span>\n                         <span class="mdl-list__item-primary-content" style="margin-left: 29px;margin-right: -53px;">\n                          Older Than (days)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="7" id="archiveolderthan" placeholder="days">\n                            <label class="mdl-textfield__label" for="archiveolderthan"></label>\n                          </span>\n                        </span>\n                      </li>\n                       <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Skip Unread\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-skipunread">\n                            <input type="checkbox" id="switch-skipunread" class="mdl-switch__input" checked />\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        ">\n                        <div class="buttons_container_container w100">\n                          <div class="buttons_container space-between mb20">\n                            <button id="archive_all_threads" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                              Archive All Threads\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600;">\n                          Purge Lists\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        ">\n                        <div class="buttons_container_container w100">\n                          <div class="buttons_container space-between">\n                            <button id="purge_listings" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                              Purge Listings\n                            </button>\n                            <button id="download_listings" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgblue">\n                              Download Listings\n                            </button>\n                          </div>\n                          <div class="buttons_container space-between">\n                            <button id="purge_owners" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                              Purge Owners\n                            </button>\n                            <button id="download_owners" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgblue">\n                              Download Owners\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                    </ul>\n                </div>\n\n                \n                <dialog id="dialog-bug" class="mdl-dialog">\n                  <h4 class="mdl-dialog__title">Bug Report</h4>\n                  <div class="mdl-dialog__content">\n                    <div id="buglistingdetails">\n                    </div>\n                    <div>\n                        <br>\n                        <p>Based on the info above. The bot determined that the phone variant is:</p>\n                        <div id="bugvariantdetails">\n                        </div>\n                      </div>\n                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                      <textarea class="mdl-textfield__input" type="text" rows= "3" id="bugcomment" ></textarea>\n                      <label class="mdl-textfield__label" for="bugcomment">Bug Details</label>\n                    </div>\n                  </div>\n                  <div class="mdl-dialog__actions">\n                    <button type="button" class="mdl-button sendbug">Submit</button>\n                    <button type="button" class="mdl-button close">Close</button>\n                  </div>\n                </dialog>\n              </div>')}n.r(t),n.d(t,{insertUI:()=>a})},5779:(e,t,n)=>{"use strict";function a(){return new Promise((e=>{const t=new BroadcastChannel("ht_tab_monitor");t.onmessage=n=>{const a=n.data;if(a&&a.message){if("isinjected"===a.message)return t.postMessage({message:"reply-injected"});if("reply-injected"===a.message)return e(!0)}},t.postMessage({message:"isinjected"}),setTimeout((()=>{e(!1)}),1e3)}))}n.r(t),n.d(t,{isInjectedToOtherTab:()=>a})},313:(e,t,n)=>{"use strict";n.d(t,{R:()=>o});var a=n(3539),s=n(5836),i=n(8521);async function o(e,t,n,o,r,l,c){(0,a.CONSOLE_MESSAGE)("custom",`Checking qualifying listings of ${n} (${t}).`,r);let d=0;if(!document.querySelector("#ta #ownerlisting_kw_match").value)return(0,a.CONSOLE_MESSAGE)("custom","No keyword to match title. Skipping range check.",r),!0;Array.isArray(l)&&l.length>0&&(d=(await async function(e){const t=await(0,s.getAllOwnerListingKwMatches)();if(!t||!t.length)return e;const n=[];for(const a of e)for(const e of t)if(a.title.toLowerCase().includes(e.toLowerCase())){n.push(a);break}return n}(l)).length),(0,a.CONSOLE_MESSAGE)("custom",`Found ${d} listings of ${n} (${t}) that matches a kw.`,r);const u=document.getElementById("owner_min_lists").value,m=document.getElementById("owner_max_lists").value;return u&&d<u?((0,a.CONSOLE_MESSAGE)("custom",`Owner ${n} has < min required listings. Skipping.`,r),c||(await(0,i.skips)().saveToSkipListing(e,`Owner Keyword Listings: ${d} < min: ${u}`),await(0,i.skips)().saveToSkipUsers(t,`Owner Keyword Listings: ${d} < min: ${u}`)),console.log(`Owner Listings (${d}) < min(${u}): Fail`),!1):m&&d>m?((0,a.CONSOLE_MESSAGE)("custom",`Owner ${n} has > max required listings. Skipping.`,r),c||(await(0,i.skips)().saveToSkipListing(e,`Owner Keyword Listings: ${d} > max: ${m}`),await(0,i.skips)().saveToSkipUsers(t,`Owner Keyword Listings: ${d} > max: ${m}`)),console.log(`Owner Listings (${d}) > max(${m}): Fail`),!1):(console.log(`Owner Listings min(${u}) <= (${d}) < max(${m}): Pass`),!0)}},5489:(e,t,n)=>{"use strict";n.r(t),n.d(t,{loadInputs:()=>r});var a=n(1334),s=n(4423),i=n(8252);function o(e){return new Promise((t=>{!function n(){if(e.parentNode.MaterialRadio||e.parentNode.MaterialSwitch)return t(e);setTimeout(n,30)}()}))}async function r(){let e=!1;const t=await(0,a.chromeStorageListKeys)();for(const n of t)if(n.startsWith("input_")){const t=n.replace("input_",""),o=await(0,a.chromeStorageGet)(n),r=document.getElementById(t);r&&("checkbox"===r.type?"switch-rununtil"===t?((0,s.o)(!0),e=!0,r.checked=!!o):r.checked=!!o:(r.value=o,(0,i.b)(r)))}else if(n.startsWith("radio_")){const e=n.replace("radio_",""),t=await(0,a.chromeStorageGet)(n);let s=document.getElementsByName(e);if(s&&(s=s[0],s&&((0,i.b)(s),"radio"===s.type))){const e=document.getElementById(t);e&&o(e).then((()=>{e.parentNode.MaterialRadio.check()}))}}e||(0,s.o)(!0)}},4219:(e,t,n)=>{"use strict";n.r(t),n.d(t,{loadStats:()=>i});var a=n(1334),s=n(9171);async function i(){const e=new Date,t=`${e.getFullYear()}${e.getMonth()+1}${e.getDate()}`;let n=await(0,a.chromeStorageGet)(`stats_${t}`);if(n){n=JSON.parse(n);const e=["offers","partners","runs","streaks","ko","new_listings","single_listings","multi_listings","skipped"],t={};["offers","partners","runs","streaks","ko","scraped","new_listings","single_listings","multi_listings","skipped"].forEach((e=>{e in n&&(document.getElementById(`stat_${e}`).textContent=n[e])})),e.forEach((e=>{e in n&&("ko"===e?t.KO=n[e]:t[e]=n[e])})),(0,s._)(t)}}},8792:(e,t,n)=>{"use strict";n.d(t,{AC:()=>o,GF:()=>d,gp:()=>u,tb:()=>l,tf:()=>r,u1:()=>c});var a=n(4484),s=n(1334),i=n(1203);async function o(e,t,n,a){if(await(0,s.chromeStorageListKeys)())return async function(e,t){const i=await(0,s.chromeStorageGet)(e);if(i&&"object"==typeof i){const e=i[t];if(e){if(n)return e&&e.ts||!0;if(a){const t=new Date(e.ts);if(t.setDate(t.getDate()+a),t>new Date)return e&&e.ts||!0}if(e.expiry&&new Date(e.expiry)>new Date)return e&&e.ts||!0}}}(`skip_${e}`,t)}async function r(e,t,n,o){let r=`skip_${e}`,l=await(0,s.chromeStorageGet)(r);if(l||(l={}),"string"==typeof l)try{l=JSON.parse(l)}catch(e){console.log("Failed to convert storedData to JSON",l)}if(Array.isArray(t))for(const s of t){let t="";"object"==typeof n&&n[s]?t=n[s]:"string"==typeof n&&(t=n),t||i.aNoReasonNeeded.includes(e)||(console.error(`local_saveIdToLog: No reason provided for ${e} ${s}`),await(0,a._apiSendBug)({message:`local_saveIdToLog: No reason provided for ${e} ${s}`,data:{listname:e,i:s}}).catch((e=>{console.error("local_saveIdToLog: Failed to send bug report",e)})));const r={ts:"object"==typeof o&&o[s]?o[s]:(new Date).toISOString()};t&&(r.reason=t),l[s]=r}else{const e=o||(new Date).toISOString();l[t]={ts:e},n&&(l[t].reason=n)}await(0,s.chromeStorageSet)(r,l)}function l(e){const t=unsafeWindow[`sync_${e}`];if(!t)return!1;const n=new Date(t);return new Date-n<216e5}async function c(e){const t=`sync_${e}`,n=await(0,s.chromeStorageGet)(t);if(!n)return!1;const a=new Date(n);return new Date-a<9e5}function d(e){const t=`sync_${e}`;unsafeWindow[t]=(new Date).toISOString(),(0,s.chromeStorageSet)(t,(new Date).toISOString())}async function u(e){let t=`skip_${e}`,n=await(0,s.chromeStorageGet)(t);return n||(n={}),n}unsafeWindow.local_isIdInLog=o},1992:(e,t,n)=>{"use strict";n.r(t),n.d(t,{logout:()=>o});var a=n(2608),s=n(1221),i=n(3253);function o(){console.log("Sending logout message"),document.getElementById("login_iframe").contentWindow.postMessage({event:"logout"},"*"),unsafeWindow.isRun&&(unsafeWindow.isRun=0),window.issnatchbot&&(0,i.waitForLogin)(a.onSessionReady),(0,a.updateLoggedInUI)(!0),(0,s.TQ)({clear:!0}),window.issnatchbot=!1}},9485:(e,t,n)=>{"use strict";function a(){const e=document.querySelector("#ta_maximize");e&&(e.style.display="none");const t=document.querySelector("#ta");t&&(t.style.display="block")}function s(){const e=document.querySelector("#ta_maximize");e&&(e.style.display="flex");const t=document.querySelector("#ta");t&&(t.style.display="none")}n.d(t,{E:()=>a,g:()=>s})},2608:(e,t,n)=>{"use strict";n.r(t),n.d(t,{login_callback:()=>w,onSessionReady:()=>g,showSubscription:()=>h,updateLoggedInUI:()=>_});var a=n(1334),s=n(3539),i=n(1992),o=n(9485),r=n(9971),l=n(4147),c=n(2373),d=n(1023);function u(e,t){for(const n in e){const a=m(e[n],t);if(a)return{role:a,domain:n}}return!1}function m(e,t){const n=e.roles;if(Array.isArray(n)){Array.isArray(t)||(t=[t]);for(const e of t)if(n.includes(e))return e}return null}var p=n(1221);function g(e){if(console.log("User Details",e),console.log("You are logged in as ",e.uid),(0,d.showLoading)(!1),e.isAnonymous){let e=document.querySelector(".login_container");e&&(e.style.display="block"),(0,c.checkStoredSubscriptionId)()}else w(e)}function _(e){if(e){let e=document.querySelector(".login_container");e&&(e.style.display="block"),e=document.querySelector("#ta #menu"),e&&(e.style.display="none"),e=document.querySelector("#ta #page2"),e&&(e.style.display=null),e=document.querySelector("#ta #page3"),e&&(e.style.display=null),e=document.querySelector("#ta #page4"),e&&(e.style.display=null),componentHandler&&componentHandler.upgradeDom()}else{let e=document.querySelector(".login_container");e&&(e.style.display="none"),e=document.querySelector("#ta #menu"),e&&(e.style.display="flex"),e=document.querySelector("#ta #page2"),e&&(e.style.display=null),e=document.querySelector("#ta #page3"),e&&(e.style.display=null),e=document.querySelector("#ta #page4"),e&&(e.style.display=null),componentHandler&&componentHandler.upgradeDom()}}async function w(e){_();const t=e&&e.uid;window.taUID=t,unsafeWindow.taUID=t,window.taEmail=e&&e.email,unsafeWindow.taEmail=window.taEmail;const n=await async function(e){const t=e?.claims?.teams;if(t){const e=u(t,["owner","indoor"]);if(e)return{role:"owner",domain:e.domain};const n=u(t,["regular","store_manager"]);if(n)return{role:n.role,domain:n.domain}}return null}(e);console.log("roleAndDomain",n);const a=n?.domain;if(a){const e=await async function(e){try{const t=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/inventory?get_ownerid=1&domain=${e}`),n=await t.json();return console.log("getDomainOwnerId",n),n.ownerid}catch(e){console.error("Failed to get domain owner id",e)}}(a);console.log("teamId",e),e&&(window.taPartnerId=e,unsafeWindow.taPartnerId=window.taPartnerId)}else t&&async function(e){const t=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/partners?isTeammember=1&uid=${e}`).then((e=>e.json()));let n=t&&t.isTeamMember&&t.isTeamMember.partnerId;return n||(n=e),n}(t).then((async e=>{window.taPartnerId=e,unsafeWindow.taPartnerId=window.taPartnerId}));const s=n?.role;let i;"store_manager"!==s&&"outdoor"!==s&&"regular"!==s||(i=await async function(e,t,n){try{return(await fetch(`https://us-central1-trade-apples.cloudfunctions.net/snatchbots?get_phones_sold=1&email=${t}&uid=${e}&teamid=${n}`).then((e=>e.json())))?.phonesSold||0}catch(e){return console.error("Failed to get phones sold",e),0}}(t,window.taEmail,window.taPartnerId)),function(e,t){window.licenseMode="owner"===e||"indoor"===e?"FREEMIUM":"store_manager"===e||"outdoor"===e||"regular"===e?t<20?"TRIAL":"FREEMIUM":"TRIAL"}(s,i),h(s,n?.domain,i),"ACTIVE"===window.licenseMode?(document.getElementById("row_soldphones").style.display="none",document.getElementById("row_licenseKeyAddBuy").style.display="none"):"TRIAL"===window.licenseMode&&(document.getElementById("row_soldphones").style.display="flex",document.getElementById("row_licenseKeyAddBuy").style.display="flex"),window.var_domain=a||"",window.TrackJS&&window.taEmail&&window.TrackJS&&window.TrackJS.configure({userId:window.taEmail}),document.getElementById("taheader").style.display="block",document.getElementById("taheader").style.height="100%"}async function h(e,t,n){try{document.getElementById("phones_sold_last_30_days").textContent=n||0,(0,s.CONSOLE_MESSAGE)("custom","");const i=document.querySelector("#info-header");i&&(i.style.display="flex",i.style.flexDirection="column"),window.isAllowed=!0,await(0,a.chromeStorageGet)("input_switch-rununtil")&&(0,r.O)();const o='<a id="info-logout" href="#" style="color: white;-webkit-highlight: none;">Logout</a>',l=`<span id="ta_minimize" style="user-select: none; position: absolute; left: 0px; height: 38px; margin-top: -7px; width: 30px; font-size: xxx-large; cursor: pointer;">\n          -\n        </span>\n          <span style="text-align: center; line-height: 2px; height: 25px;">\n            <p>License: <span style="font-weight: 500;">FREEMIUM</span></p>\n          </span>\n          <div>\n            <span style="cursor: pointer;" id="logged_email">[${window.taEmail}]</span>\n            <span style="position: absolute; right: 14px;">${o}</span>\n          </div>`,p=`<span id="ta_minimize" style="user-select: none; position: absolute; left: 0px; height: 38px; margin-top: -7px; width: 30px; font-size: xxx-large; cursor: pointer;">\n          -\n        </span>\n          <span style="text-align: center; line-height: 2px; height: 25px;">\n            <p>License: <span style="font-weight: 500;">ACTIVE</span></p>\n          </span>\n          <div>\n            <span style="cursor: pointer;" id="logged_email">[${function(e){if("string"!=typeof e)return"";let t=e.replace(/(snatchbot_sub_)(.{5})(.*)(.{5})/,"$1$2...$4");return t.length<5?e:t}(window.taEmail)}]</span>\n            <span style="position: absolute; right: 14px;">${o}</span>\n          </div>`,g=`<span id="ta_minimize" style="user-select: none; position: absolute; left: 0px; height: 38px; margin-top: -7px; width: 30px; font-size: xxx-large; cursor: pointer;">\n          -\n        </span>\n            <span style="text-align: center; line-height: 2px; height: 25px;">\n              <p>License: <span style="font-weight: 500;">TRIAL</span></p>\n            </span>\n            <div>\n              <span style="cursor: pointer;" id="logged_email">[${window.taEmail}]</span>\n              <span style="position: absolute; right: 14px;">${o}</span>\n            </div>`;if("owner"===e||"indoor"===e)return i&&(i.innerHTML=l),document.getElementById("row_soldphones").style.display="none",document.getElementById("row_licenseKeyAddBuy").style.display="none",f(!0),u(),d(),void c();if("store_manager"===e||"outdoor"===e||"regular"===e)return document.getElementById("row_soldphones").style.display="flex",document.getElementById("row_licenseKeyAddBuy").style.display="flex",f(!0),n<20?(i&&(i.innerHTML=g),f(!1),m(),u(),d(),void c()):(i&&(i.innerHTML=l),u(),d(),void c());if("snatchbot"===e)return i&&(i.innerHTML=p),document.getElementById("row_soldphones").style.display="none",document.getElementById("row_licenseKeyAddBuy").style.display="none",f(!0),u(),d(),void c();document.getElementById("row_soldphones").style.display="flex",document.getElementById("row_licenseKeyAddBuy").style.display="flex",f(!1),i&&(i.innerHTML=g),m();let _=document.querySelector("#info-subscription");_&&(_.textContent=function(e){switch(e){case"owner":return"Owner";case"indoor":return"Indoor";case"outdoor":return"Outdoor";case"store_manager":return"Dropoff Location";case"regular":return"Regular";default:return""}}(e)),_=document.querySelector("#info-website"),_&&(_.textContent=t),u(),d(),c()}catch(e){console.error("Error in showSubscription:",e)}function c(){document.querySelector("#ta_minimize").addEventListener("click",(()=>{(0,o.g)()}))}function d(){document.querySelector("#info-header #info-logout").addEventListener("click",(()=>{console.log("logout"),(0,i.logout)()}))}function u(){document.querySelector("#info-header #logged_email").addEventListener("click",(()=>{let t=`Version:${l.version}\nUID: ${window.taUID}\nEmail: ${window.taEmail}\nPartner ID: ${window.taPartnerId}\nDomain: ${window.var_domain}\nRole: ${e||""}\nLicense: ${window.licenseMode}`;n&&(t+=`\nPhones Sold: ${n}`),console.log("debugInfo",t),navigator.clipboard.writeText(t),alert(t)}))}function m(){if(window.listener_listenAddLicenseKey)return;window.listener_listenAddLicenseKey=!0;const e=document.querySelector("#btn_add_license_key");function t(){const e=prompt("Enter License Key");e&&(0,p.ln)(e)}e.removeEventListener("click",t),e.addEventListener("click",t)}}function f(e){e?(document.getElementById("stop_messaging_after").parentNode.classList.remove("is-disabled"),document.getElementById("stop_messaging_after").disabled=!1):(document.getElementById("stop_messaging_after").parentNode.classList.add("is-disabled"),document.getElementById("stop_messaging_after").disabled=!0)}unsafeWindow.showSubscription=h},9309:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ejectOpenAIApikey:()=>l,generateMessage:()=>d,getAssistants:()=>c,getOpenAIApiKey:()=>i,setOpenAIApiKey:()=>r});var a=n(1334),s=n(1023);async function i(){o(!await(0,a.chromeStorageGet)("openai_apikey"))}function o(e){e?(document.querySelectorAll(".openai_init").forEach((e=>{e.style.display="block"})),document.querySelectorAll(".openai_ready").forEach((e=>{e.style.display="none"})),document.querySelectorAll(".openai_readyflex").forEach((e=>{e.style.display="none"}))):(document.querySelectorAll(".openai_init").forEach((e=>{e.style.display="none"})),document.querySelectorAll(".openai_ready").forEach((e=>{e.style.display="block"})),document.querySelectorAll(".openai_readyflex").forEach((e=>{e.style.display="flex"})),c())}async function r(){const e=document.getElementById("openai_apikey").value;if(!e)return void alert("Please enter your OpenAI API key");(0,s.showLoading)(!0);const t=await fetch("https://api.openai.com/v1/engines",{headers:{Authorization:"Bearer "+e}});(0,s.showLoading)(!1),t.ok?(document.getElementById("openai_apikey").value="",await(0,a.chromeStorageSet)("openai_apikey",e),o(!1)):alert("Invalid OpenAI API key")}async function l(){await(0,a.chromeStorageRemove)("openai_apikey"),o(!0)}async function c(){const e=await(0,a.chromeStorageGet)("openai_apikey");if(!e)return void alert("Please enter your OpenAI API key");(0,s.showLoading)(!0);const t=await fetch("https://us-central1-trade-apples.cloudfunctions.net/chatgpt?get_assistants=1",{headers:{Authorization:"Bearer "+e}}).then((e=>e.json()));return(0,s.showLoading)(!1),async function(e,t){const n=document.querySelector('ul[for="assistant_id"]');n.innerHTML="",e.forEach((e=>{const a=document.createElement("li");a.className="mdl-menu__item",a.dataset.val=e.id,a.textContent=e.name||e.id,e.id===t&&(a.dataset.selected=!0),n.appendChild(a)})),getmdlSelect.init(".getmdl-select"),async function(){document.querySelectorAll('ul[for="assistant_id"] .mdl-menu__item').forEach((function(e){e.addEventListener("click",(function(){var e=this.getAttribute("data-val"),t=this.textContent;console.log("text",t,e),(0,a.chromeStorageSet)("assistant_id",e)}))}))}()}(t,await(0,a.chromeStorageGet)("assistant_id")),t}async function d(e,t){if(!(e||t&&0!==t.length))return void alert("Listing has no text or photos");const n=await(0,a.chromeStorageGet)("openai_apikey");if(!n)return void alert("Please enter your OpenAI API key");const s=await(0,a.chromeStorageGet)("assistant_id");if(!s)return void alert("Please select an assistant");const i={};e&&(i.text=e),t&&t.length>0&&(i.photos=t);const o=parseInt(document.getElementById("num_images").value,10);o&&(i.numPhotos=o,t&&t.length>o&&(i.photos=t.slice(0,o)));const r=document.querySelector('[name="image_detail"]:checked');r&&(i.imageDetail=r.value);try{const e=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/chatgpt?generate_message=1&assistant_id=${s}`,{method:"POST",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"},body:JSON.stringify(i)}),t=await e.json();return console.log("generate_message response",t),t}catch(e){return console.error("Network or fetch error",e),alert("An error occurred while generating the message. Please try again."),{error:"An error occurred while generating the message. Please try again."}}}},9107:(e,t,n)=>{"use strict";function a(e,t){if(!t)return e;const n=t>0?Math.ceil(e/Math.abs(t)):Math.floor(e/Math.abs(t));return Math.abs(n*t)}function s(e,t,n,s,i){n&&(n=Number(n));let o=e;const r=document.querySelector("#listing_price_delta").value||0;o=o.replace(/\[name\]/g,t.split(" ")[0]),o=o.replace(/\[title\]/g,i||"");let l=document.getElementById("roundupdown").value;l&&(l=parseFloat(l));let c=o.match(/\[price\s?-\s?(\d+)\]/);if(void 0!==n&&c&&c.length>1){const e=parseFloat(c[1]);let t=n-parseFloat(e);l&&(t=a(t,l)),t<0&&(t=0),o=o.replace(/\[price\s?-\s?\d+\]/,`$${t}`)}else if(void 0!==n&&o.match(/\[price\]/)){let e=n;r&&(e=function(e,t){return e&&t?(e=String(e).replace(/[^\d\.-]/g,""),e=Number(e),t.includes("%")?(t=String(t).replace(/[^\d\.-]/g,""),e+e*((t=Number(t))/100)):(t=String(t).replace(/[^\d\.-]/g,""),e+(t=Number(t)))):e}(e,r)),l&&(e=a(e,l)),e<0&&(e=0),o=o.replace(/\[price\]/,`$${e}`)}else o=o.replace(/\[price\s?-\s?\d+\]/,"your price");return o}n.r(t),n.d(t,{parseVariables:()=>s})},7850:(e,t,n)=>{"use strict";function a(e){if(e.target.id&&"number"===e.target.type){let t=e.target.value;"0"===t||t.startsWith("-")||(e.target.value=`-${t}`)}}n.r(t),n.d(t,{prefix:()=>a})},3251:(e,t,n)=>{"use strict";n.r(t),n.d(t,{processKeyword:()=>L});var a=n(9088),s=n(1203),i=n(13),o=n(8365),r=n(8521),l=n(6901),c=n(3539),d=n(7367),u=n(1060),m=n(313),p=n(3177),g=n(9688),_=n(7164),w=n(4246);async function h(){const e=document.getElementById("streak").value;document.getElementById("streaktimeout").value;let t=document.getElementById("timeout_streak_min").value;t||(t=t[0]);let n=document.getElementById("timeout_streak_max").value;if(n||(n=n[1]),t&&n&&window.iStreaks>=e){const e=1e3*(0,p.l)(t,n),a=(new Date).getTime()+e;(0,c.CONSOLE_MESSAGE)("timeout",{message:"Streak",hh:moment(a).format("HH"),mm:moment(a).format("mm"),ss:moment(a).format("ss")}),await(0,w.sleep)(e),(await(0,d.stats)()).resetCurrentStreak()}}var f=n(9237),y=n(5639),b=n(1773),x=n(4904),S=n(4898),v=n(4139),E=n(9309),k=n(8944);async function L(e,t,n){if(!window.isAllowed)return console.error("You are not allowed to use this bot! x("),"not-allowed";await(0,c.getConsoleMessages)(),await new Promise((e=>{!function t(){if("complete"===document.readyState)return e();setTimeout(t,30)}()}));const a={keyword:e,radius:document.getElementById("radius").value||"65"};n&&(a.lat=n.lat,a.lon=n.lon);const s=document.querySelector("#listing_max_price").value,i=document.querySelector("#listing_min_price").value;s&&(a.priceMax=s),i&&(a.priceMin=i);let o=!1;String(e).match(/category/i)&&(o=!0,e=(e=e.replace(/\/?category\/?/i,"")).replace(/\/$/,""),a.keyword=e),a.isCategorySearch=o;const{listings:r,cursor:l,isStopAfterXMessagesReached:d}=await(0,g.searchListings)(a);unsafeWindow.listings=r;let u,m=l;if(d||console.log(`Listings Fetched: ${r.length}`),d||(u=await C(r,e,t,!!m,n)),await(0,S.followup)(),u)return u;if(d)return"stop_after_x_messages_reached";for(;m;){a.cursor=m;const{listings:s,cursor:i}=await(0,g.searchListings)(a);if(m=i,console.log(`Listings Fetched: ${s.length}`),u=await C(s,e,t,!!m,n),await(0,S.followup)(),u)return u}return"no more results"}async function C(e,t,n,g,S,L){let C,I,A,O,q=[...e];if(console.log("aListings",q),(0,c.CONSOLE_MESSAGE)("fetch_listings",{num_listings:q.length,keyword:t},n),q.errorDescription)return(0,c.CONSOLE_MESSAGE)("custom","Failed to get listings. API has failed."),await(0,w.sleep)(864e5),"quit";if((await(0,d.stats)()).addRun(),q&&Array.isArray(q)&&(await(0,d.stats)()).addTotalListingsScraped(q),q.forEach(((e,t)=>{e.sortOrder=t})),C=q.length,q=await async function(e){const t=e.length,n=[];await Promise.all(e.map((async e=>{const t=e.id;try{await(0,r.skips)().isSkipListing(t)||n.push(e)}catch(e){console.error(`Error checking listing ${t}:`,e)}})));const a=n.length;return a!==t&&console.log(`Filtered out ${t-a} of ${t} skipped listings.`),n}(q),O=q.length,console.log("In Listing Skiplist: "+(C-O)),O!==C&&((0,c.CONSOLE_MESSAGE)("custom",`Filtered out ${C-O} listings that were in skip list.`),window.debug&&alert(`Filtered out ${C-O} listings that were in skip list.`)),C=q.length,q=await async function(e){const t=e.length,n=[];await Promise.all(e.map((async e=>{const t=e.id;try{await(0,r.skips)().isSkipMessagedListing(t)||n.push(e)}catch(e){console.error(`Error checking listing ${t}:`,e)}})));const a=n.length;return a!==t&&console.log(`Filtered out ${t-a} of ${t} skipped messaged listings.`),n}(q),O=q.length,console.log("In Listings Messaged List: "+(C-O)),O!==C&&((0,c.CONSOLE_MESSAGE)("custom",`Filtered out ${C-O} listings that were messaged before.`),window.debug&&alert(`Filtered out ${C-O} listings that were messaged before.`)),C=q.length,q=await async function(e){const t=e.length,n=[],a=[];await Promise.all(e.map((async e=>{const t=e.id,s=e&&e.seller;if(!s||!s.id)return void console.error(`Failed to get sellerId of listing ${t}!`);const i=s.id;try{await(0,r.skips)().isSkipMessagedUser(i)?a.push((0,d.stats)().then((e=>e.addSkipped()))):n.push(e)}catch(e){console.error(`Error processing listing ${t}:`,e)}})));const s=n.length;return s!==t&&console.log(`Filtered out ${t-s} of ${t} messaged sellers.`),n}(q),O=q.length,console.log("In Owner Messaged List: "+(C-O)),O!==C&&((0,c.CONSOLE_MESSAGE)("custom",`Filtered out ${C-O} owners that were messaged before.`),window.debug&&alert(`Filtered out ${C-O} owners that were messaged before.`)),C=q.length,q=await async function(e){const t=e.length,n=[],a=[];await Promise.all(e.map((async e=>{const t=e.id,s=e&&e.seller;if(!s||!s.id)return void console.error(`Failed to get sellerId of listing ${t}!`);const i=s.id,o=s.name;try{await(0,r.skips)().isSkipUser(i)?(a.push((0,d.stats)().then((e=>e.addSkipped()))),(0,c.CONSOLE_MESSAGE)("user_skip",{owner_id:i,owner_name:o,listing_id:t,listing_name:e.title})):n.push(e)}catch(e){console.error(`Error checking seller ${i} for listing ${t}:`,e)}})));const s=n.length;return s!==t&&console.log(`Filtered out ${t-s} of ${t} skipped sellers.`),n}(q),O=q.length,console.log("In Owner Skip List: "+(C-O)),O!==C&&((0,c.CONSOLE_MESSAGE)("custom",`Filtered out ${C-O} owners that are in skip list.`),window.debug&&alert(`Filtered out ${C-O} owners that are in skip list.`)),C=q.length,I=[...q],q=await(0,o.R)(q),A=[...q],O=q.length,console.log("No match in title: "+(C-O)),O!==C&&((0,c.CONSOLE_MESSAGE)("custom",`Filtered out ${C-O} listings that didn't have match in title.`),window.debug&&alert(`Filtered out ${C-O} listings that didn't have match in title.`)),C=q.length,I=[...q],q=await async function(e){const t=e.length,n=[];for(const t of e){const e=t.title,a=await(0,u.$)(e);a&&(await(0,r.skips)().saveToSkipListing(t.id,`Title Skipword "${a}"`),(await(0,d.stats)()).addSkipped()),a||n.push(t)}const a=(e=n).length;return a!==t&&(0,c.CONSOLE_MESSAGE)("custom",`Skipped ${t-a} containing skip word in title.`),e}(q),O=q.length,console.log("Skip word in title: "+(C-O)),A=[...q],O!==C){(0,c.CONSOLE_MESSAGE)("custom",`Filtered out ${C-O} listings that had skip words in title.`);const e=function(e,t,n){const a=e.map((e=>e.id)),s=t.map((e=>e.id)),i=a.filter((e=>!s.includes(e))),o=e.filter((e=>i.includes(e.id)));return o.map((e=>e.title))}(I,A),t=e.join("\n");window.debug&&(console.log("Removed Titles",t),alert(`Filtered out ${C-O} listings that had skip words in title.`))}C=q.length,q=await(0,l.filterOutListingsNotInPriceRange)(q),O=q.length,console.log("Not in price range: "+(C-O)),O!==C&&((0,c.CONSOLE_MESSAGE)("custom",`Filtered out ${C-O} listings that are not in price range.`),window.debug&&alert(`Filtered out ${C-O} listings that are not in price range.`));const M=q.length;window.debug&&alert("Listings left after filtering: "+M);let U=!1;q.sort(((e,t)=>e.sortOrder-t.sortOrder)),unsafeWindow.aListings=q,console.log(`New Listings: ${M}`);for(let e=0;e<M;e++){if(window.listingsChecked||(window.listingsChecked=0),window.listingsChecked+=1,window.listingsChecked>s.listingsPerKeyword)return window.listingsChecked=0,"listingsPerKeyword reached.";if(!unsafeWindow.isRun)return console.log("Bot stopped."),"quit";if(n!==unsafeWindow.runningInstanceId)return"quit";const t=q[e]&&q[e].id,o=q[e]&&q[e].title;if(!t){console.error("listing has no id");continue}console.log(`(${e+1}/${M}) (${t}) [${o}]`);const l=await(0,i.fetchListingDetails)({id:t});if(l.error){if(console.error("Failed to get listing details.",l.error),"rate_limit_exceeded"===l.error_code){window.isKO=!0;const e=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,t=moment(e).calendar();(0,c.CONSOLE_MESSAGE)("halted_soft",{schedule:t}),(await(0,d.stats)()).addKo(),(await(0,d.stats)()).addSkipped(),await(0,w.sleep)(60*s.waitIfSpamDetected*1e3),window.isKO=!1}continue}Object.keys(l).length;const g=l.seller?.user_id;if(g){const e=await(0,r.skips)().isSkipMessagedUser(g);if(e){console.log(`User was already messaged (${g}): Fail`),(0,c.CONSOLE_MESSAGE)("user_already_messaged",{owner_id:g,listing_id:t},n),(await(0,d.stats)()).addSkipped(),console.log(`User ${g} was already messaged ${moment(e).fromNow()}`),await(0,r.skips)().saveToSkipListing(t,`User ${g} was already messaged ${moment(e).fromNow()}`);continue}}let L,C;if(l.location&&S){if(C=parseInt(document.getElementById("radius").value||"65"),L=(0,b.c)(l.location.latitude,l.location.longitude,S.lat,S.lon),L&&Math.round(L)>C){console.log(`Listing is within range ${Math.round(L)} < ${C} miles: Fail`),(0,c.CONSOLE_MESSAGE)("custom",`Listing ${o} is too far away. ${Math.round(L)}/${C} km.`),(await(0,d.stats)()).addSkipped(),await(0,r.skips)().saveToSkipListing(t,`[${l.location.latitude}, ${l.location.longitude}] - [${S.lat}, ${S.lon}] = [${Math.round(L)}] > [${C}]`);continue}console.log(`Listing is within range ${Math.round(L)} < ${C} miles: Pass`)}const I=l.description;if(I){let e=await(0,u.P)(I);if(e){console.log("Skip word in description: Fail"),(0,c.CONSOLE_MESSAGE)("skipword_found_description",{listing_name:o,listing_id:t},n),(await(0,d.stats)()).addSkipped(),await(0,r.skips)().saveToSkipListing(t,`Description Skipword "${e}"`);continue}}if(console.log("Skip word in description: Pass"),l.creationTime){const e=document.getElementById("listing_max_age");if(e){const t=e.value;if(0!==Number(t))if(Number(t)<1){const e=100*t,n=(0,f.h)(l.creationTime);if(n>e)return(0,c.CONSOLE_MESSAGE)("skip_old_listing_hours",{age:n,listing_id:l.id,listing_name:l.title}),await(0,r.skips)().saveToSkipListing(l.id,`ListingAge ${n}h > MaxAge ${e}h`),(await(0,d.stats)()).addSkipped(),console.log("ListingAge: Fail",n,"hrs >",e),console.log("FAIL: added to listing skip list"),"old_listing_found"}else{const e=(0,f.f)(l.creationTime);if(e>t)return(0,c.CONSOLE_MESSAGE)("skip_old_listing",{age:e,listing_id:l.id,listing_name:l.title}),await(0,r.skips)().saveToSkipListing(l.id,`ListingAge ${e}d > MaxAge ${t}d`),(await(0,d.stats)()).addSkipped(),console.log("ListingAge: Fail",e,"days > ",t),console.log("FAIL: added to listing skip list"),"old_listing_found"}}const t=document.getElementById("listing_min_age");if(t){const e=t.value;if(0!==Number(e))if(Number(e)<1){const t=100*e,n=(0,f.h)(l.creationTime);if(n<t){(0,c.CONSOLE_MESSAGE)("skip_old_listing_hours",{age:n,listing_id:l.id,listing_name:l.title}),(await(0,d.stats)()).addSkipped(),console.log("ListingAge: Fail.",n,"hrs < ",t),console.log("FAIL: added to listing skip list");continue}}else{const t=(0,f.f)(l.creationTime);if(t<e){(0,c.CONSOLE_MESSAGE)("skip_old_listing",{age:t,listing_id:l.id,listing_name:l.title}),(await(0,d.stats)()).addSkipped(),console.log("ListingAge: Fail.",t,"days < ",e),console.log("FAIL: added to listing skip list");continue}}}}console.log("ListingAge: Pass");const A=l&&l.seller&&l.seller.id,O=l&&l.seller&&l.seller.name,N=l&&l.seller&&l.seller.join_year;console.log("ownerJoinedYear",N);let D=document.getElementById("skip_profiles_created_after_year");if(D&&(D=Number(D.value)),D||(D=s.DEFAULT_SKIP_OWNERCREATION_YEAR),D<=(new Date).getFullYear()){if(N&&N>=D){(0,c.CONSOLE_MESSAGE)("custom",`Skipped new account ${O} (${A})`);const e=`Profile Created ${N} >= ${D}`;await(0,r.skips)().saveToSkipListing(t,e),await(0,r.skips)().saveToSkipUsers(A,e),(await(0,d.stats)()).addSkipped(),console.log(`Profile created (${N}) < ${D}: Fail`),console.log("FAIL: added to listing/owner skip list");continue}console.log(`Profile created (${N}) < ${D}: Pass`)}const G=await(0,y.getUserListings)(A,!0);if(G&&Array.isArray(G)&&(await(0,d.stats)()).addTotalListingsScraped(G),await(0,x.TI)("Fetched user listings."),!await(0,m.R)(t,A,O,o,"",G)){await(0,d.stats)().then((e=>e.addSkipped())),console.log("FAIL: added to listing/owner skip list");continue}let F,T;console.log("All Pass: Messaging...");const j=document.getElementById("switch-enablegpt");if(j&&j.checked){const e=(0,v.r)(l,G);console.log("Generating message");const t=await(0,E.generateMessage)(e.text,e.photos);if(console.log("Got GPT response",t),"skip"===t.status){await(0,r.skips)().saveToSkipListing(l.id,t.message);continue}if("message"===t.status){let e=t.message;Array.isArray(e)&&(e=e.join("\n")),F=t.message}else if("error"===t.status)return"halted";T=await(0,_.sendMessage)({listingData:l,instanceId:n,gptMessages:F,searchCoordinates:S,distance:L,radiusSetting:C})}else T=await(0,_.sendMessage)({listingData:l,instanceId:n,searchCoordinates:S,distance:L,radiusSetting:C});if(T){(await(0,k.B)()).addMessageSent(),U=!0;const e=l.price;(0,c.CONSOLE_MESSAGE)("message_sent",{message_sent:T,listing_price:e,listing_id:t,listing_name:o},n);const i=`Messaged [${A}] [${t}]`;await(0,a.addAllUserListingsToSkipList)(A,O,G,i,t),await(0,r.skips)().saveToMessagedUsers(A,t);let d=document.getElementById("timeout_listings_messaged_min").value;d||(d=s.userDelay[0]);let u=document.getElementById("timeout_listings_messaged_max").value;u||(u=s.userDelay[1]);const m=1e3*(0,p.l)(d,u),g=(new Date).getTime()+m;if((0,c.CONSOLE_MESSAGE)("timeout",{message:`Finished sending all messages to ${O} (${A}).`,hh:moment(g).format("HH"),mm:moment(g).format("mm"),ss:moment(g).format("ss")},n),await(0,w.sleep)(m),await(0,k.X)())return}else(0,c.CONSOLE_MESSAGE)("message_not_sent",{listing_id:t,listing_name:o},n),await(0,d.stats)().then((e=>e.addSkipped()));await h()}!U&&g&&await(0,x.VB)("Wait before fetching next results page.")}},4053:(e,t,n)=>{"use strict";n.r(t),n.d(t,{processWriteQueue:()=>i});var a=n(2287),s=n(6849);async function i(){window.writeQueue||(window.writeQueue=[]);const e=[...window.writeQueue];window.writeQueue=[];for(const t of e)try{t.bot="facebook";let e=await fetch("https://cloudlogging.hopla.workers.dev/marketplacebotstats",{method:"POST",headers:{"Content-Length":"application/json"},body:JSON.stringify(t)}).then((async e=>(0,a.handleFetchErrors)(e))).then((e=>e.text())).catch((e=>{console.log(e)}));"ok"!==e&&(0,s.default)({error:"Failed to write to dashboard",data:t,sheetsApiResponse:e})}catch(e){console.error(e),(0,s.default)({error:"Failed to write to dashboard3",data:t})}setTimeout((()=>{i()}),2e3)}},3177:(e,t,n)=>{"use strict";function a(e,t){return e=Number(e),t=Number(t),Math.floor(Math.random()*(t-e+1)+e)}n.d(t,{l:()=>a})},7480:(e,t,n)=>{"use strict";n.r(t),n.d(t,{readCoordinates:()=>s});var a=n(1334);async function s(e){const t=e&&e.getNext;let n=document.getElementById("coordinates").value;if(!n)return;if(!String(n).includes(","))return;const s=n.split("\n").map((e=>e.replace(/\s/g,""))).filter((e=>e.length));let i=await(0,a.chromeStorageGet)("lastCoordIdx");i||0===i?t&&(i=parseInt(i,10)+1):i=0;let o=!1;i>=s.length&&(i=0,o=!0),await(0,a.chromeStorageSet)("lastCoordIdx",i);let r=s[i].split(","),l=r[0],c=r[1];return l&&c&&(l=parseFloat(l),c=parseFloat(c),l&&c)?{lat:l,lon:c,isEnd:o}:void 0}},1063:(e,t,n)=>{"use strict";n.r(t),n.d(t,{restoreDefaults:()=>l});var a=n(1203),s=n(2287),i=n(6849),o=n(4246);async function r(){let e;try{e=await fetch(`https://sheets.hopla.tools/?HT=${a.sheet_id}&format=json&sheet_name=Content`).then((async e=>(0,s.handleFetchErrors)(e))).then((e=>e.text()))}catch(t){return await(0,i.default)({error:"Failed to getDefaultContent. sheets.hopla.tools api response.",res:e}),{}}if(e&&!e.includes("message_1"))return r();try{return JSON.parse(e)}catch(t){return await(0,i.default)({error:"Failed to getDefaultContent. sheets.hopla.tools api response.",res:e}),{}}}function l(){function e(e){if("createEvent"in document){const t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange");e.parentElement&&e.parentElement.MaterialTextfield&&e.parentElement.MaterialTextfield.change(e.value)}document.getElementById("page2loading").style.display="block",async function(){let e;try{e=await fetch(`https://sheets.hopla.tools/?HT=${a.sheet_id}&format=json&sheet_name=Settings`).then((async e=>(0,s.handleFetchErrors)(e))).then((e=>e.text()))}catch(t){return await(0,i.default)({error:"Failed to getDefaultSettings. sheets.hopla.tools api response.",res:e}),{}}if(e&&!e.includes("keywords"))return r();try{return JSON.parse(e)}catch(t){return await(0,i.default)({error:"Failed to getDefaultSettings. sheets.hopla.tools api response.",res:e}),{}}}().then((t=>{if(document.getElementById("page2loading").style.display="none",t.result&&Array.isArray(t.result)&&t.result.length){const n={};t.result.forEach((e=>{n[e.input_name]=e.value}));const a=n.keywords||"",s=n.skip_words_title||"",i=n.skip_words_description||"",o=n.ownerlisting_kw_match||"",r=n.listing_min_price||"",l=n.listing_max_price||"",c=n.listing_max_age||"",d=n.listing_min_age||"",u=n.listing_price_delta||"",m=n.price_rounding||"",p=n.must_have||"",g=n.radius||"",_=n.owner_listings_min||"",w=n.owner_listings_max||"",h=n.skip_profiles||"",f=n.owner_message_expiry||"",y=(n.max_concurrent_convo,n.followup_after||""),b=n.between_api_calls_min||"",x=n.between_api_calls_max||"",S=n.between_messages_min||"",v=n.between_messages_max||"",E=n.after_listings_messaged_min||"",k=n.after_listings_messaged_max||"",L=n.after_streak_min||"",C=n.after_streak_max||"",I=n.end_of_run_min||"",A=n.end_of_run_max||"",O=n.archive_older_than||"",q=n.stop_messaging_after||0;let M=document.querySelector("#keywords");M.value=a,e(M),M=document.querySelector("#skipwords_title"),M.value=s,e(M),M=document.querySelector("#skipwords_description"),M.value=i,e(M),M=document.querySelector("#ownerlisting_kw_match"),M.value=o,e(M),M=document.querySelector("#listing_min_price"),M.value=r,e(M),M=document.querySelector("#listing_max_price"),M.value=l,e(M),M=document.querySelector("#listing_max_age"),M.value=c,e(M),M=document.querySelector("#listing_min_age"),M.value=d,e(M),M=document.querySelector("#listing_price_delta"),M.value=u,e(M),M=document.querySelector("#roundupdown"),M.value=m,e(M),M=document.querySelector("#title_must_include"),M&&(M.value=p,e(M)),M=document.querySelector("#radius"),M&&(M.value=g,e(M)),M=document.querySelector("#owner_min_lists"),M&&(M.value=_,e(M)),M=document.querySelector("#owner_max_lists"),M&&(M.value=w,e(M)),M=document.querySelector("#skip_profiles_created_after_year"),M&&(M.value=h,e(M)),M=document.querySelector("#owner_message_expiry"),M&&(M.value=f,e(M)),M=document.querySelector("#followup_after"),M&&(M.value=y,e(M)),M=document.querySelector("#timeout_api_calls_min"),M&&(M.value=b,e(M)),M=document.querySelector("#timeout_api_calls_max"),M&&(M.value=x,e(M)),M=document.querySelector("#timeout_between_messages_min"),M&&(M.value=S,e(M)),M=document.querySelector("#timeout_between_messages_max"),M&&(M.value=v,e(M)),M=document.querySelector("#timeout_listings_messaged_min"),M&&(M.value=E,e(M)),M=document.querySelector("#timeout_listings_messaged_max"),M&&(M.value=k,e(M)),M=document.querySelector("#timeout_streak_min"),M&&(M.value=L,e(M)),M=document.querySelector("#timeout_streak_max"),M&&(M.value=C,e(M)),M=document.querySelector("#timeout_end_of_run_min"),M&&(M.value=I,e(M)),M=document.querySelector("#timeout_end_of_run_max"),M&&(M.value=A,e(M)),M=document.querySelector("#archive_older_than"),M&&(M.value=O,e(M)),M=document.querySelector("#stop_messaging_after"),M&&(M.value=q,e(M))}})).catch((e=>(console.error("Fetch Failed",e),(0,o.sleep)(1e4).then((()=>l()))))),r().then((t=>{if(document.getElementById("page2loading").style.display="none",t.result&&Array.isArray(t.result)&&t.result.length){const n={};t.result.forEach((e=>{n[e.input_name]=e.value}));const a=n.message_1||"",s=n.message_2||"",i=n.message_3||"",o=n.followup_1||"",r=n.followup_2||"",l=n.followup_3||"",c=n.messageonreply_1||"";let d=document.querySelector("#message_1");d.value=a,e(d),d=document.querySelector("#message_2"),d.value=s,e(d),d=document.querySelector("#message_3"),d.value=i,e(d),d=document.querySelector("#followup_1"),d.value=o,e(d),d=document.querySelector("#followup_2"),d.value=r,e(d),d=document.querySelector("#followup_3"),d.value=l,e(d),d=document.querySelector("#messageonreply_1"),d.value=c,e(d)}})).catch((e=>(console.error("Fetch Failed",e),(0,o.sleep)(1e4).then((()=>l())))))}},425:(e,t,n)=>{"use strict";n.r(t),n.d(t,{retryDelayWithMessage:()=>r});var a=n(1203),s=n(3539),i=n(3177),o=n(4246);async function r(e){const t=60*(0,i.l)(a.botRetryDelay[0],a.botRetryDelay[1])*1e3,n=(new Date).getTime()+t;(0,s.CONSOLE_MESSAGE)("timeout",{message:e||"",hh:moment(n).format("HH"),mm:moment(n).format("mm"),ss:moment(n).format("ss")}),await(0,o.sleep)(t)}},9971:(e,t,n)=>{"use strict";n.d(t,{O:()=>l});var a=n(4484),s=n(1334),i=n(3372),o=n(4423),r=n(390);async function l(){(0,s.chromeStorageSet)("input_switch-rununtil",!0),unsafeWindow.isRun=1,(0,o.o)(!1),async function e(){const t=(0,i.generateId)();unsafeWindow.runningInstanceId=t;try{await(0,r.start)(t)}catch(n){console.trace(),console.error("start Caught error!",t,n),(0,a._apiSendBug)({error:"Facebookbot caught error",details:n.toString()}),setTimeout((()=>{e()}),6e4)}}()}},182:(e,t,n)=>{"use strict";n.r(t),n.d(t,{searchCategoryListings:()=>p});var a=n(1203),s=n(8785),i=n(8528),o=n(3539),r=n(5703),l=n(8544),c=n(2287),d=n(4246),u=n(7367),m=n(5078);async function p({keyword:e,lat:t=7.79716,lon:n=122.763,radius:_=65,count:w=24,priceMin:h=0,priceMax:f=2147483647,cursor:y,previousResults:b,categoryIds:x}){if("string"==typeof _&&(_=parseInt(_,10)),_=Math.round(1.60934*(_+2)),x||(x=await(0,i.L)(`/marketplace/category/${e}`)),!x.length)return console.error("Failed to get category id(s) of category",e),[];const S=String(e).split("?")[1],v=(0,s.urlSearchToApiParameters)(S);let E={sort_by_filter:"CREATION_TIME",sort_order:"DESCEND"};v&&(v.priceRange&&v.priceRange.length&&(void 0!==v.priceRange[0]&&(h=v.priceRange[0]),void 0!==v.priceRange[1]&&(f=v.priceRange[1])),v.filterSortingParams&&(E=v.filterSortingParams));const k={count:24,cursor:null,buyLocation:{latitude:t,longitude:n},marketplaceBrowseContext:"CATEGORY_FEED",marketplaceID:null,categoryIDArray:x,priceRange:[Number(`${Number(h)}00`),Number(`${Number(f)}00`)],topicPageParams:{location_id:"category",url:e},scale:2,sellerID:null,filterSortingParams:E,savedSearchID:null,savedSearchQuery:null,contextual_data:[],numericVerticalFields:[],numericVerticalFieldsBetween:[],stringVerticalFields:[]};y&&(k.cursor=y),k.radius=Math.round(1e3*_),v&&(v.numericVerticalFields&&(k.numericVerticalFields=v.numericVerticalFields),v.numericVerticalFieldsBetween&&(k.numericVerticalFieldsBetween=v.numericVerticalFieldsBetween),v.stringVerticalFields&&(k.stringVerticalFields=v.stringVerticalFields)),window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const L=(0,r.W)(),C=(0,m.getFrom)(document.body.outerHTML,'revision":',",");var I="2";const A=(0,l.getFb_dtsg)();for(var O=0;O<A.length;O++)I+=A.charCodeAt(O);const q=(0,m.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}'),M={av:L,__aaid:"0",__user:L,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19908.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"EXCELLENT",__rev:C,__s:"g2c6r4:k3mks3:2i7wh9",__hsi:"7387745659394770073",__dyn:"7AzHK4HwBgDx-5Q1hyoyEqxd4Ag5S3G2O5U4e2C3-4UKewSAx-bwNw9G2Saxa0DU6u3y4o27wxg3Qwb-q7oc81xoswMwto88422y11wBz822weS4oaEnxO0Bo4O2-2l2UtwxwhU31wiE567Udo5qfK0zEkxe2Gexe5E5e7oqBwJK2W5olwqUW4-5pUfEe88o4qum7-2K0-poarCwLyES0Io5d08O3217wDyUaUcojxK2B0LwnU8oC1Hg6C13whEeE4WVU-4EdrxG1fy8bUaU",__csr:"hG5hAtsOqkOdFs-LERh7thORZEtsFJ9pcGHitsPqcBq9pqQRmllRZ8ypTtdlFQh9Hy4CKJkHfinJ-SA9jKWBK8j8COVaxfBJ7iGdpaQ8zp-nF5hbGXQGAByUiRHgOAVbyk9QiqirByVkmmuEOax7HWKZkiaL-ha2HCU8XG4GADUx29qK8glxOibyoVfz94qAEtzUrK7FFFovzUpDxa5F8cUigC8jzGDxaFVrGbwzAWUlwDwyzo-5UlxmFFUdEO1tx27ouVVd5y8V0wDByUrzpE9oeu11x6i9wGwyK4EmwFyuEC6EowkUgBxi49EiGu26U5KVoSfxK784iewkByo4y742l385G1Vxy7o1xE5K2K1DBwOzohg2Dw6SzogwoU10EbU1i86i021eU0iCLsWx51jo0Y6-04pe7U1ne0dXwba5K096w2JGzEcU2Kw0a7C027-u0nC5ta1Uw28k0bKw2Fo2Uw3jqx91nw2pd02Qo5m0WU0JOi0g18w0VW09QwLw1Mu0120w22qjxiu048qo5lxm2e0pW0uWi0lME3pw2PUf8y9gixq05ko0SQw0Uu",__comet_req:"15",fb_dtsg:A,jazoest:I,lsd:q,__spin_r:"1014674557",__spin_b:"trunk",__spin_t:"1720093577",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:"CometMarketplaceCategoryContentContainerQuery",variables:JSON.stringify(k),server_timestamps:"true",doc_id:"7326806710701188"};let U=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded",pragma:"no-cache",priority:"u=1, i","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not/A)Brand";v="8", "Chromium";v="126", "Google Chrome";v="126"',"sec-ch-ua-full-version-list":'"Not/A)Brand";v="8.0.0.0", "Chromium";v="126.0.6478.116", "Google Chrome";v="126.0.6478.116"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"14.2.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceCategoryContentContainerQuery","x-fb-lsd":"odUwXS9nWS3GOiVcgTcl0R"},referrer:`https://www.facebook.com/marketplace/category/${e}?minPrice=11&maxPrice=112&maxMileage=210000&maxYear=2024&minMileage=1000&carType=convertible%2Ccoupe%2Chatchback&vehicleExteriorColors=black%2Ccharcoal%2Cgrey&exact=false`,referrerPolicy:"strict-origin-when-cross-origin",body:g(M),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,c.handleFetchErrors)(e))).then((e=>e.text()));if(U&&U.match(/api_error_code":368/i)){console.log("Search listing blocked.");const s=(new Date).getTime()+60*a.waitIfSpamDetected*1e3,i=moment(s).calendar();return(0,o.CONSOLE_MESSAGE)("halted_soft",{schedule:i}),(await(0,u.stats)()).addKo(),window.isKO=!0,await(0,d.sleep)(60*a.waitIfSpamDetected*1e3),window.isKO=!1,p({keyword:e,lat:t,lon:n,radius:_,count:w,priceMin:h,priceMax:f,cursor:y,previousResults:b,categoryIds:x})}if(U.includes("for (;;);")&&(U=U.replace("for (;;);","")),U.match(/}\s*{/)&&(U=U.split(/}\s*{/)[0]+"}"),U=JSON.parse(U),U.errorDescription)return console.error("An API request (searchListings) has failed with error",U.errorDescription),U;let N=U.data.viewer.marketplace_feed_stories.edges.filter((e=>e.node.listing||"Results from outside your search"===e.node.header_text)).map((e=>{const t=e.node.listing;return t?{title:t.custom_title||t.marketplace_listing_title,price:t.listing_price.amount,id:t.id,seller:t.marketplace_listing_seller,location:t.location&&t.location.reverse_geocode&&t.location.reverse_geocode.city,location_display:t.location&&t.location.reverse_geocode&&t.location.reverse_geocode.city_page.display_name}:"outsidemarker"}));const D=N.findIndex((e=>"outsidemarker"===e)),G=D>-1;if(G&&(N=N.slice(0,D)),b&&(N=[...b,...N]),N.length<a.listingsPerKeyword&&U.data.viewer.marketplace_feed_stories.page_info.has_next_page){const e=U.data.viewer.marketplace_feed_stories.page_info.end_cursor;return G?{listings:N,cursor:!1}:{listings:N,cursor:e}}return{listings:N,cursor:!1}}function g(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}},9688:(e,t,n)=>{"use strict";n.r(t),n.d(t,{searchListings:()=>w});var a=n(1203),s=n(8785),i=n(8528),o=n(3539),r=n(5703),l=n(8544),c=n(5836),d=n(2287),u=n(182),m=n(4246),p=n(7367),g=n(8944),_=n(5078);async function w({keyword:e,lat:t=7.79716,lon:n=122.763,radius:f=65,count:y=24,priceMin:b=0,priceMax:x=2147483647,cursor:S,previousResults:v,isCategorySearch:E=!1}){if(await(0,g.X)())return{listings:[],cursor:!1,isStopAfterXMessagesReached:!0};if(console.log(`Query ${e} ${t},${n}`),(0,o.CONSOLE_MESSAGE)("fetching_listings",{keyword:e}),E){const a=(0,c.removeParameters)(e),o=await(0,i.L)(`/marketplace/category/${a}`);if(o&&o.length)return(0,u.searchCategoryListings)({keyword:e,lat:t,lon:n,radius:f,count:y,priceMin:b,priceMax:x,cursor:S,previousResults:v,categoryIds:o});const r=String(e).split("?")[1],l=(0,s.urlSearchToApiParameters)(r);l&&l.priceRange&&l.priceRange.length&&(void 0!==l.priceRange[0]&&(b=l.priceRange[0]),void 0!==l.priceRange[1]&&(x=l.priceRange[1])),e=a}"string"==typeof f&&(f=parseInt(f,10)),f=Math.round(1.60934*(f+2)),window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const k=(0,_.getFrom)(document.body.outerHTML,'revision":',",");var L="2";const C=(0,l.getFb_dtsg)();for(var I=0;I<C.length;I++)L+=C.charCodeAt(I);const A=(0,_.getFrom)(document.body.outerHTML,'["LSD",[],{"token":"','"}'),O={buyLocation:{latitude:t,longitude:n},contextual_data:null,count:y,cursor:S,flashSaleEventID:"",hasFlashSaleEventID:!1,marketplaceSearchMetadataCardEnabled:!1,params:{bqf:{callsite:"COMMERCE_MKTPLACE_WWW",query:E?"":e},browse_request_params:{commerce_enable_local_pickup:!0,commerce_enable_shipping:!0,commerce_search_and_rp_available:!0,commerce_search_and_rp_category_id:[],commerce_search_and_rp_condition:null,commerce_search_and_rp_ctime_days:null,filter_location_latitude:t,filter_location_longitude:n,filter_price_lower_bound:100*Number(b)||0,filter_price_upper_bound:100*Number(x)||214748364700,commerce_search_sort_by:"CREATION_TIME_DESCEND",filter_radius_km:f},custom_request_params:{browse_context:null,contextual_filters:[],referral_code:null,saved_search_strid:null,search_vertical:"C2C",seo_url:E?e:null,surface:E?"TOPIC_PAGE":"SEARCH",virtual_contextual_filters:[]}},savedSearchID:null,savedSearchQuery:e,scale:2,shouldIncludePopularSearches:!1,topicPageParams:{location_id:E?"category":"110301228992872",url:E?e:null}},q=(0,r.W)(),M={av:q,__aaid:0,__user:q,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:E?"19908.HYP:comet_pkg.2.1..2.1":"19836.HYP2:comet_pkg.2.1..2.1",dpr:E?"2":"1",__ccg:"EXCELLENT",__rev:k,__s:E?"1trbx4:k3mks3:n68jb4":"yn6ar9:h0u3rd:rqxmb3",__hsi:E?"7387744577350382124":"7361039489586395825",__dyn:E?"7AzHK4HwkEng5K8G6EjBAg5S3G2O5U4e2C1jyUW3q2ibwNw9G2Sawba1DwUx60GE3Qwb-q7oc81xoswMwto886C11wBz81s8hwGxu782lwv89kbxS1Fwc60D8vwRwlE-U2exi4UaEW2G0z9obrwKxm5o7G4-5o4q3y261eBx_wHwfCm2CVEbUGdwb61jg2cwMwrUK2K364UrwFg2fwxyo6O1FwgU4q3G1eKufxa3mUqwjUy2-2K":"7AzHK4HwBgDx-5Q1ryaxG4Qih09y2O5U4e2C3-4UKewSAx-bwNw9G2Saxa1NwJwpUe8hw8u250n82nwb-q7oc81xoswMwto88422y11wBz822wtU4a3a4oaEnxO0Bo4O2-2l2Utwwg4u0Mo4G1hwlo5qfK0zEkxe2Gexe5E5e7oqBwJK2W5olwqUW4-5pUfEdK2616DBx_wHwfCm2CVEbUGdwb6223908O3216xi4UK2K364UrwFgbU5-269wkopg6C13whEeEfE-VU-4EdouwjUy",__csr:E?"hG5iiYQZYyqlQzqnfHAdFnZR7bnQOPFJ7QBCaGQA-yJECBrWCGplBiZviQdlV4teiVe9AAHiGgDj-XXWgmGm4FkOwGDgqGbzoCnGqm44GAByUiWGfKV8oGi4K2iu6Eaem59bwICwFwg86S22HwJx-1izU4K1PGu2eU2JzU1ho2swoo37wg8cU6O0VU5O1jw7fw1ni00jbq027-u04c40bKw3nE08JE5m0WU04jm01A7w7KAw2eE":"gbQBMT4n11k4qf9sQhkpdlnT4tO4OlsBmIlEIhbsAzmyWllQhR8ihSTGWnli_ULpahEGmGHjWCQGLJx2Z8B24HGFVrCKpqVe9BJdui-AGhpGJ2fStpCeh9KbAQmcghDx6HgOmFazet4UKmt3UWWLyUN2e9ghxx1e9CWgG8AyoWVe-58W-8xehzUjDghAzFtfpk9yEiU8EG5ES5USXho-u9xyEWe-RxC9V8vh8th8W68dElxu5QEjyqxPzVEPyE8o8F8im9xeF8jwAwUwp8eEeUfXG8zvx2te6VUkhEW5poWq4E8azWG7E4613wzGUlxO2u8wGK3GewpElypotwgF84a1mDwdB0s8760XEOU14U3nAwMwaW0Uojw4iQ2Nam04ZE11U0lsw86RF5yKWWmK5otB80b9w2l8uw6Jg0k1w6_wiE1Le2O10iwZw1422203EC011WAG034G020q0dUxS0XoKe83Cu0_U3PCw6Gw16qi05581G8e83_woU0K3UyqE2Wg-fw4cw2io6O0amo2Dw820DU7a9HyO0dIOy5Evx1BwxCl98XB9e5Q5O0Ww41Ua0EbEM1cEy5U1cpXa0xU1GE2rg6i3e02li0VAbGom0b1OGEigtAw8C3Ci58lw1-m0s3m0Zogwfq0hwM2swbu087wDwmk4E0Bq0Pobo1jE1VFd0",__comet_req:"15",fb_dtsg:C,jazoest:L,lsd:A,__spin_r:"1012976566",__spin_b:"trunk",__spin_t:"1713875731",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:E?"CometMarketplaceCategoryContentContainerQuery":"CometMarketplaceSearchContentContainerQuery",variables:JSON.stringify(O),server_timestamps:"true",doc_id:E?"7661400373954706":"7308382399275974"};let U=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:h(M),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,d.handleFetchErrors)(e))).then((e=>e.text()));if(U&&U.match(/api_error_code":368/i)){console.log("Search listing blocked.");const s=(new Date).getTime()+60*a.waitIfSpamDetected*1e3,i=moment(s).calendar();return(0,o.CONSOLE_MESSAGE)("halted_soft",{schedule:i}),(await(0,p.stats)()).addKo(),window.isKO=!0,await(0,m.sleep)(60*a.waitIfSpamDetected*1e3),window.isKO=!1,w({keyword:e,lat:t,lon:n,radius:f,count:y,priceMin:b,priceMax:x,cursor:S,previousResults:v})}if(U.includes("for (;;);")&&(U=U.replace("for (;;);","")),U.match(/}\s*{/)&&(U=U.split(/}\s*{/)[0]+"}"),U=JSON.parse(U),U.errorDescription)return console.error("An API request (searchListings) has failed with error",U.errorDescription),U;let N=U.data.marketplace_search.feed_units.edges.filter((e=>e.node.listing||"Results from outside your search"===e.node.header_text)).map((e=>{const t=e.node.listing;return t?{title:t.marketplace_listing_title,price:t.listing_price.amount,id:t.id,seller:t.marketplace_listing_seller,location:t.location&&t.location.reverse_geocode&&t.location.reverse_geocode.city,location_display:t.location&&t.location.reverse_geocode&&t.location.reverse_geocode.city_page.display_name}:"outsidemarker"}));const D=N.findIndex((e=>"outsidemarker"===e)),G=D>-1;if(G&&(N=N.slice(0,D)),v&&(N=[...v,...N]),N.length<a.listingsPerKeyword&&U.data.marketplace_search.feed_units.page_info.has_next_page){const e=U.data.marketplace_search.feed_units.page_info.end_cursor;return G?{listings:N,cursor:!1}:{listings:N,cursor:e}}return{listings:N,cursor:!1}}function h(e){const t=[];for(let n in e)if(e.hasOwnProperty(n)){const a=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${a}=${s}`)}return t.join("&")}},6849:(e,t,n)=>{"use strict";function a(e){return"object"==typeof e&&(window.tabId&&(e.tabId=window.tabId),window.taEmail&&(e.partner_email=window.taEmail),window.taPartnerId&&(e.taPartnerId=window.taPartnerId),e.extension_version=window.extension_version),fetch("https://cloudlogging.hopla.workers.dev/log?function=facebookbot",{method:"POST",body:JSON.stringify(e),mode:"no-cors"})}n.r(t),n.d(t,{default:()=>a})},7164:(e,t,n)=>{"use strict";n.r(t),n.d(t,{sendMessage:()=>b});var a=n(4087),s=n(175),i=n(1203),o=n(4904),r=n(4898),l=n(3539),c=n(533),d=n(9355),u=n(9107),m=n(3177),p=n(4484),g=n(2617),_=n(2287),w=n(4246),h=n(8521),f=n(7367),y=n(8329);async function b({listingData:e,instanceId:t,searchCoordinates:n,distance:h,radiusSetting:f,gptMessages:b,testRun:v}){let E=!1;if(!unsafeWindow.isRun&&!v)return void console.log("bot stopped.");if(t!==unsafeWindow.runningInstanceId)return;const k=e.id,L=e.title,C=e.seller.id,I=e.seller.name,A=(0,c.getKeywordMatched)(L);let O,q="",M="",U=!1;const N=e.price,D=b&&b[0],G=b&&b[1],F=b&&b[2];let T=D||await(0,y.templates)().message_1;if(T){T=(0,u.parseVariables)(T,I,N,A,L);const n=await(0,a.api_sendMessage)(k,T);if("STOP"===n)return void console.log("Stopped sending messages to user because other user is blocked.");if(n.error)return void console.log(n.error);await S(k,C),U||(await x(),U=!0),await(0,r.addFollowupEntry)(k,e),E=!0,O||(O=n),(0,l.CONSOLE_MESSAGE)("message_sent",{message_sent:T,listing_price:N,listing_id:k,listing_name:L},t);const s=1e3*(0,m.l)(i.messageDelay[0],i.messageDelay[1]),c=(new Date).getTime()+s;(0,l.CONSOLE_MESSAGE)("timeout",{message:"Message Sent",hh:moment(c).format("HH"),mm:moment(c).format("mm"),ss:moment(c).format("ss")},t),await(0,w.sleep)(s),q&&(q+="\n"),q+=T,M&&(M+=", "),M+=D?"gptmessage1":"message1",await(0,o.Xh)((D?"GPT ":"")+"Message #1 sent.")}if(T=G||await(0,y.templates)().message_2,T){T=(0,u.parseVariables)(T,I,N,A,L);const n=await(0,a.api_sendMessage)(k,T);if("STOP"===n)return void console.log("Stopped sending messages to user because other user is blocked.");if(n.error)return void console.log(n.error);await S(k,C),U||(await x(),U=!0),await(0,r.addFollowupEntry)(k,e),E=!0,O||(O=n),(0,l.CONSOLE_MESSAGE)("message_sent",{message_sent:T,listing_price:N,listing_id:k,listing_name:L},t);const s=1e3*(0,m.l)(i.messageDelay[0],i.messageDelay[1]),c=(new Date).getTime()+s;(0,l.CONSOLE_MESSAGE)("timeout",{message:"Message Sent",hh:moment(c).format("HH"),mm:moment(c).format("mm"),ss:moment(c).format("ss")},t),await(0,w.sleep)(s),q&&(q+="\n"),q+=T,M&&(M+=", "),M+=G?"gptmessage2":"message2",await(0,o.Xh)((D?"GPT ":"")+"Message #2 sent.")}if(T=F||await(0,y.templates)().message_3,T){T=(0,u.parseVariables)(T,I,N,A,L);const n=await(0,a.api_sendMessage)(k,T);if("STOP"===n)return void console.log("Stopped sending messages to user because other user is blocked.");if(n.error)return void console.log(n.error);await S(k,C),U||(await x(),U=!0),await(0,r.addFollowupEntry)(k,e),E=!0,O||(O=n),(0,l.CONSOLE_MESSAGE)("message_sent",{message_sent:T,listing_price:N,listing_id:k,listing_name:L},t);const s=1e3*(0,m.l)(i.messageDelay[0],i.messageDelay[1]),c=(new Date).getTime()+s;(0,l.CONSOLE_MESSAGE)("timeout",{message:"Message Sent",hh:moment(c).format("HH"),mm:moment(c).format("mm"),ss:moment(c).format("ss")},t),await(0,w.sleep)(s),q&&(q+="\n"),q+=T,M&&(M+=", "),M+=F?"gptmessage3":"message3",await(0,o.Xh)((D?"GPT ":"")+"Message #3 sent.")}if(O&&(O.thread_id&&(O=O.thread_id),!(0,d.z)()&&document.querySelector("#switch-deleteaftersend").checked)){const e=await(0,s.changeArchivedStatus)(O,!0);e&&e.success?console.log("Conversation has been archived:",O):console.error("Failed to delete conversation",O)}window.messagesSent+=1;const j={uid:C,ownerName:I,listingid:k,message:q,templateName:M};return e.location&&(j.listing_lat=e.location.latitude,j.listing_lon=e.location.longitude),n&&n.lat&&n.lon&&(j.search_lat=n.lat,j.search_lon=n.lon),h&&(j.distance=h),f&&(j.radius=f),await async function(e){if(i.disableLogs)return;const{uid:t,ownerName:n,listingid:a,message:s,templateName:o,listing_lat:r,listing_lon:l,search_lat:c,search_lon:d,distance:u,radius:m}=e,h={Date:(new Date).toGMTString(),UserID:t,Name:n,ListingID:a,"Message Sent":s,template:o,tabId:window.tabId,extension_version:window.extension_version};r&&(h["Listing Lat"]=r),l&&(h["Listing Lon"]=l),c&&(h["Search Lat"]=c),d&&(h["Search Lon"]=d),u&&(h.Distance=u),m&&(h["Search Radius"]=m);const f=(0,g.g)();return f&&(h.email=f),async function e(t){try{return fetch("https://sheets.hopla.tools/?HT=9ec6989caf07d1305c6c386880840f8a&mode=log&sheet_name=FacebookBot",{method:"POST",body:JSON.stringify(h)}).then((async e=>(0,_.handleFetchErrors)(e))).then((e=>e.text())).catch((async n=>(console.error("Fetch Failed (sendBotLog)",n,t),t&&t>6?((0,p._apiSendBug)({error:"Failed to write to botlog",data:h,function:"sendBotLog"}),""):(await(0,w.sleep)(1e4),t||(t=0),e(t+=1)))))}catch(e){return console.error("Failed to send bot log.",e),""}}().catch((e=>(console.error("Fetch Failed (sendBotLog))",e),"")))}(j),!!E&&q}async function x(){(await(0,f.stats)()).addOffer(),(await(0,f.stats)()).addStreak()}async function S(e,t){await(0,h.skips)().saveToSkipMessagedListing(e),await(0,h.skips)().saveToMessagedUsers(t,e)}},4423:(e,t,n)=>{"use strict";function a(e){e||window.viewermode?window.isViewMode=!0:(document.querySelector('#ta #menu a[href="#page2"]').click(),window.isViewMode=!1),window.viewermode&&(document.querySelector("#menu").style.display="none")}n.d(t,{o:()=>a})},7091:(e,t,n)=>{"use strict";function a(e){window.isKO||e.match&&(window.navigator.onLine||e.match(/offline/))&&(document.querySelector("#statustext").textContent=e)}n.r(t),n.d(t,{showLastConsoleLog:()=>a})},1023:(e,t,n)=>{"use strict";function a(e){let t=document.querySelector("#loadingoverlay");t?(t.style.display=e?"flex":"none",e&&"string"==typeof e&&(document.querySelector("#loadingtext").innerText=e),e||(document.querySelector("#loadingtext").innerText="Loading. Please wait...")):function(e){const t=document.querySelector("#ta");t&&(t.insertAdjacentHTML("afterbegin",`<div id="loadingoverlay" style="display: ${e?"flex":"none"};" class='loading-one'>\n          <div class='loading-two'>\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"\n                  class='svg'>\n                  <circle r="80" cx="500" cy="90" class='circle-one' />\n                  <circle r="80" cx="500" cy="910" class='circle-one' />\n                  <circle r="80" cx="90" cy="500" class='circle-one' />\n                  <circle r="80" cx="910" cy="500" class='circle-one' />\n                  <circle r="80" cx="212" cy="212" class='circle-one' />\n                  <circle r="80" cx="788" cy="212" class='circle-one' />\n                  <circle r="80" cx="212" cy="788" class='circle-one' />\n                  <circle r="80" cx="788" cy="788" class='circle-one' />\n              </svg>\n          </div>\n          <span id="loadingtext" style="position: fixed; padding-top: 165px;">Loading. Please wait...</span>\n      </div>\n    `),document.head.insertAdjacentHTML("beforeend","<style>\n      /* Loading Overlay - START */\n      .loading-one {\n        box-sizing: border-box;\n        display: flex;\n        position: absolute;\n        flex-flow: column nowrap;\n        align-items: center;\n        justify-content: space-around;\n        background: rgba(255, 255, 255, 0.8);\n        top: 0px;\n        left: 0px;\n        width: 100%;\n        height: 100%;\n        z-index: 2147483647;\n      }\n\n      .loading-two {\n        order: 1;\n        box-sizing: border-box;\n        overflow: visible;\n        flex: 0 0 auto;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        animation-name: around;\n        animation-duration: 2000ms;\n        animation-timing-function: linear;\n        animation-iteration-count: infinite;\n        width: 120px;\n        height: 120px;\n      }\n\n      .circle-one {\n        fill: var(--black);\n      }\n\n      .svg {\n        width: 100%;\n        height: 100%;\n        fill: var(--black);\n      }\n\n      @keyframes around {\n        0% {\n          transform: rotate(0deg)\n        }\n\n        100% {\n          transform: rotate(360deg)\n        }\n      }\n\n      /* Loading Overlay - END */\n    </style>"))}(e)}n.r(t),n.d(t,{showLoading:()=>a})},8521:(e,t,n)=>{"use strict";n.r(t),n.d(t,{skips:()=>h,syncDbSkips:()=>f});var a=n(1334),s=n(1203),i=n(13),o=n(6901),r=n(9237),l=n(3539),c=(n(9105),n(5639)),d=n(2287),u=n(4246),m=n(1060),p=n(4484),g=n(8792),_=n(6849),w=n(7367);function h(){async function e(e,t,n,a){let s=`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?batch=1&listname=${e}`;n&&(s+=`&localcheck=${window.taPartnerId}`),a&&(s+=`&reason=${a}`),await(0,g.tf)(e,t,a);const i=await async function e(n){return fetch(s,{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify(t)}).then((async e=>(0,d.handleFetchErrors)(e))).then((e=>e.text())).catch((async t=>(console.error("Fetch Failed (saveIdToLogBatch)",t,n),n&&n>6?"":(await(0,u.sleep)(1e4),n||(n=0),e(n+=1)))))}().then((async n=>{try{const a=JSON.parse(n);return a.success&&"added"===a.success?a:(await(0,p._apiSendBug)({error:"Failed to copy ids from storage to db",listname:e,aIds:t,response:n}),!1)}catch(a){return await(0,p._apiSendBug)({error:"Failed copy ids from storage to db",listname:e,aIds:t,response:n}),!1}}));return i||((0,_.default)({"Failed to save ids to skiplist":t}),alert("Failed to save skip ids. Developers has been notified about this issue.")),i}async function t(e,t,n,a){let s=`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?listname=${e}&id=${t}&email=${window.taEmail}`;n&&(s+=`&localcheck=${window.taPartnerId}`),a&&(s+=`&reason=${a}`),await(0,g.tf)(e,t,a);const i=await async function e(t){return fetch(s,{method:"POST"}).then((async e=>(0,d.handleFetchErrors)(e))).then((e=>e.text())).catch((async n=>(console.error("Fetch Failed (saveIdToLog)",n,t),t&&t>6?"":(await(0,u.sleep)(1e4),t||(t=0),e(t+=1)))))}().then((n=>{try{const a=JSON.parse(n);return a.success&&"added"===a.success?a:(console.error("Failed to save to log",n),(0,p._apiSendBug)({error:"Failed to save to log",listname:e,id:t,response:n}),!1)}catch(a){return(0,p._apiSendBug)({error:"Failed to save to log",listname:e,id:t,response:n}),!1}}));return i||((0,_.default)({"Failed to save id to skip list":t}),alert("Failed to save skip ids. Developers has been notified about this issue.")),i}async function n(t,n){let s=await(0,a.chromeStorageGet)(t);s&&("string"==typeof s&&(s=JSON.parse(s)),s&&Array.isArray(s)&&s.length&&await e(n,s))}async function f(e,t,n,a,s){await y(e,n,a,s);let i=`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?isexist=${t}&listname=${e}`;n&&(i+="&noexpiry=1"),s&&(i+=`&expiryInDays=${s}`),a&&(i+=`&localcheck=${window.taPartnerId}`);let o=await(0,g.AC)(e,t,n,s);return o||(o=await async function e(t){return fetch(i).then((async e=>(0,d.handleFetchErrors)(e))).then((e=>e.text())).catch((async n=>(console.error("Fetch Failed (isIdInLog)",n,t),!!(t&&t>6)||(await(0,u.sleep)(1e4),t||(t=0),e(t+=1)))))}().then((n=>{try{const a=JSON.parse(n);return"success"in a?a.success:((0,p._apiSendBug)({error:"Failed to check logs",listname:e,id:t,response:n}),!1)}catch(a){return console.error("Failed to check logs",n,a),(0,p._apiSendBug)({error:"Failed to check logs",listname:e,id:t,response:n}),!1}})),o)}async function y(e,t,n,a){const s=(0,g.tb)(e);if(await(0,g.u1)(e)&&s)return;if(unsafeWindow["syncing_"+e])return void await async function(e){return new Promise(((t,n)=>{const a=setInterval((()=>{unsafeWindow[e]||(clearInterval(a),t())}),1e3)}))}("syncing_"+e);unsafeWindow["syncing_"+e]=!0;let i=`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?listname=${e}&sync=1`;t&&(i+="&noexpiry=1"),a&&(i+=`&expiryInDays=${a}`),n&&(i+=`&localcheck=${window.taPartnerId}`);return await async function e(t){return fetch(i).then((async e=>(0,d.handleFetchErrors)(e))).then((e=>e.text())).catch((async n=>(console.error("Fetch Failed (isIdInLog)",n,t),t&&t>6?alert("Failed to sync logs."):(await(0,u.sleep)(1e4),t||(t=0),e(t+=1)))))}().then((async t=>{try{delete unsafeWindow["syncing_"+e];const n=JSON.parse(t);if("success"in n){const t=n.success,a={},s={};for(const e in t){let n=t[e].reason;!n&&t[e].ts&&new Date(t[e].ts)<new Date("2024-06-16")&&(n="added to skip before reason update."),n&&(a[e]=n),s[e]=t[e].ts}return await(0,g.tf)(e,Object.keys(t),a,s),(0,g.GF)(e),n.success}return!1}catch(e){return!1}}))}return{saveToPartnerMessaged:e=>t("partnermessage",e),saveToMessagedUsers:(e,n)=>t("users",e,!0,n),saveToSkipUsers:(e,n)=>t("usersskip",e,!0,n),saveToSkipListing:(e,n)=>t("listings",e,!0,n),saveToSkipListingBatch:(t,n)=>{e("listings",t,!0,n)},saveToSkipMessagedListing:e=>t("listings_messaged",e,!0),isSkipMessagedListing:async e=>{let t="listings_messaged";await n(`skip_${t}`,t);let a=document.getElementById("listing_max_age").value||"";return Number(a)<1&&(a=100*a/24),f(t,e,!1,!0,a)},isSkipListing:async e=>{let t="listings";await n("skip_listings",t);let a=document.getElementById("listing_max_age").value||"";return Number(a)<1&&(a=100*a/24),f(t,e,"",!0,a)},syncRemoteToLocal:y,getOtherIphoneListings:async function(e,t,n,a){if(!t){const n=await(0,i.fetchListingDetails)({id:e});if(n.error){if(console.error("Failed to get listing details.",n.error),"rate_limit_exceeded"===n.error_code){const e=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,t=moment(e).calendar();(0,l.CONSOLE_MESSAGE)("halted_soft",{schedule:t}),(await(0,w.stats)()).addKo(),window.isKO=!0,await(0,u.sleep)(60*s.waitIfSpamDetected*1e3),window.isKO=!1}return}if(!n||!n.owner)return void(0,p._apiSendBug)({error:"getOtherIphoneListings failed. No listing owner returned."});t=n.owner.id}const d=[];(0,l.CONSOLE_MESSAGE)("custom",`Fetching other listings of ${n} (${t})`);const g=await(0,c.getUserListings)(t,!0);let _=document.querySelector("#ta #keywords").value.split(",").map((e=>e.trim())).join("|");_.startsWith("|")&&(_=_.substring(1)),_.endsWith("|")&&(_=_.substring(0,_.length-1));for(const t of g)if(t.id!==e&&t.id!==e&&t.title){const e=t.title,n=t.description,a=t.creationTime,s=Number(t.price),i=new RegExp(_,"i");if(a){const e=document.getElementById("listing_max_age");if(e){const n=e.value,s=(0,r.f)(a);if(s>n){(0,l.CONSOLE_MESSAGE)("skip_old_listing",{age:s,listing_id:t.id,listing_name:t.title});continue}}}if(await h().isSkipListing(t.id))continue;if(!e.match(i))continue;let c=await(0,m.$)(e);if(!c&&n&&(c=await(0,m.P)(n)),c)continue;if(!(0,o.isPriceInRange)(s))continue;d.push(t.id)}return[...new Set(d)]},isSkipMessagedUser:async e=>(await n("skip_users","users"),f("users",e,"",!0,document.getElementById("owner_message_expiry").value||"")),isSkipUser:async e=>(await n("skip_usersskip","usersskip"),f("usersskip",e,"",!0,document.getElementById("owner_message_expiry").value||"")),isSkipPartnerMessage:async e=>(await n("skip_partnermessaged","partnermessage"),f("partnermessage",e,!0))}}function f(){}},4246:(e,t,n)=>{"use strict";function a(e){return new Promise((t=>setTimeout(t,e)))}n.r(t),n.d(t,{sleep:()=>a})},1221:(e,t,n)=>{"use strict";n.d(t,{KR:()=>d,TQ:()=>c,ln:()=>l});var a=n(1334),s=n(1203),i=n(2617),o=n(2608),r=n(1023);async function l(e){(0,r.showLoading)(!0),"string"!=typeof e&&(e="");const t=(0,i.g)(),n=await d(e,t);if((0,r.showLoading)(!1),n&&"active"===n.status)return window.issnatchbot=!0,(0,a.chromeStorageSet)("subscription_id",e),async function(e){(0,o.updateLoggedInUI)(),window.taUID=e,unsafeWindow.taUID=e,window.taPartnerId="snatchbot_"+e,window.taEmail="snatchbot_"+e,unsafeWindow.taEmail=window.taEmail,unsafeWindow.taPartnerId=window.taPartnerId,window.TrackJS&&window.taEmail&&window.TrackJS&&window.TrackJS.configure({userId:window.taEmail}),window.licenseMode="ACTIVE",(0,o.showSubscription)("snatchbot",e),document.getElementById("row_soldphones").style.display="none",document.getElementById("row_licenseKeyAddBuy").style.display="none"}(e),!0;n&&"canceled"===n.status&&(c({clear:!0}),alert("This subscription is already cancelled")),n.status&&alert(n.status),n.error&&alert(n.error)}async function c(e){const t=e&&e.clear,n=await(0,a.chromeStorageGet)("subscription_id");if(n){const e=await async function(e,t){return fetch(`https://us-central1-trade-apples.cloudfunctions.net/snatchbots?app=facebookbot&location_id=${s.losenolead_locationid}&release_subscription_id=${e}&email=${t}`).then((e=>e.json()))}(n,(0,i.g)());e.success?t&&(0,a.chromeStorageSet)("subscription_id",""):console.error("Failed to release subscription",e)}}async function d(e,t){return fetch(`https://us-central1-trade-apples.cloudfunctions.net/snatchbots?app=facebookbot&location_id=${s.losenolead_locationid}&check_subscription_id=${e}&email=${t}`).then((e=>e.json()))}},390:(e,t,n)=>{"use strict";function a(){if(Array.from(document.querySelectorAll("button")).find((e=>"Log in"===e.textContent))&&(alert("You are not logged in! You have to login to offerup first."),1))return!1;let e=document.querySelector("#runfrom").value,t=document.querySelector("#rununtil").value;if(t&&e){const n=function(e,t){const n=new Date,a=60*n.getHours()+n.getMinutes(),[s,i]=e.split(":").map(Number),o=60*s+i,[r,l]=t.split(":").map(Number),c=60*r+l;return o<=c?a>=o&&a<=c:a>=o||a<=c}(e,t);return n}return alert("No schedule set! Bot will not run."),!1}n.r(t),n.d(t,{start:()=>E});var s=n(1203),i=n(3539),o=n(5836),r=n(1334);async function l(){let e=await(0,r.chromeStorageGet)("tsSpamDetected");if(e){e=parseInt(e,10);const t=(new Date).getTime();if(t<e)return e-t}return!1}var c=n(4219),d=n(3251),u=n(4423);function m(){document.querySelector("#switch-rununtil").parentElement.MaterialSwitch?((0,u.o)(!0),document.querySelector("#switch-rununtil").parentElement.MaterialSwitch.off(),(0,r.chromeStorageSet)("input_switch-rununtil",!1),(0,r.chromeStorageRemove)("lastKwIdx")):setTimeout((()=>{m()}),2e3)}var p=n(7091),g=n(4246),_=n(7121),w=n(3443),h=n(2617),f=n(1221),y=n(7367);function b(e){if(window.isWaitingForSchedule)return(0,f.TQ)({clear:!1}),void(0,i.CONSOLE_MESSAGE)("halted_schedule");window.isWaitingForSchedule=!0,document.getElementById("switch-rununtil").checked?((0,f.TQ)({clear:!1}),(0,i.CONSOLE_MESSAGE)("halted_schedule"),a()?(window.isWaitingForSchedule=!1,async function(e,t){await(0,g.sleep)(4e3);const n=await(0,r.chromeStorageGet)("subscription_id");(0,f.KR)(n,(0,h.g)()).then((n=>{n&&"active"===n.status?e():t(n.status||n.error)}))}((()=>{unsafeWindow.isRun=1,(0,y.stats)().then((e=>e.resetCurrentStreak())),E(e)}),(e=>{console.log("Subscription is not active.",e),(0,i.CONSOLE_MESSAGE)("custom",e)}))):setTimeout((()=>{window.isWaitingForSchedule=!1,b(e)}),5e3)):window.isWaitingForSchedule=!1}var x=n(3177);async function S(){const e={listing_max_age:document.getElementById("listing_max_age").value,listing_min_age:document.getElementById("listing_min_age").value,owner_message_expiry:document.getElementById("owner_message_expiry").value};await fetch(`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?savevariables=1&userid=${window.taUID}`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>e.json()))}var v=n(8944);async function E(e){if(window.viewermode)return void(0,p.showLastConsoleLog)("Tab is in viewer mode.");(0,_.X)(!1);const t=setInterval((()=>{a()||(unsafeWindow.isRun=0,(0,f.TQ)(),(0,i.CONSOLE_MESSAGE)("halted_schedule"),clearInterval(t),(0,_.X)(!0),b(e))}),1e4);if(!a())return clearInterval(t),(0,_.X)(!0),void b(e);if(s.showAlerts&&alert("start"),!(0,w.t)())return m(),void(0,_.X)(!0);if((0,c.loadStats)(),await l()){const e=await l(),t=(new Date).getTime()+e,n=moment(t).calendar();(0,i.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),await(0,g.sleep)(e)}const{keyword:n,error:r,coordinates:u}=await(0,o.getKeyword)();if(r)console.error(r);else if(!document.getElementById("switch-loopsearch").checked&&u&&u.isEnd)(0,i.CONSOLE_MESSAGE)("custom","Bot stopped because all Search & Locations completed.");else for(let t=1;t<40;){if(!unsafeWindow.isRun){console.log("Bot stopped.");break}if(e!==unsafeWindow.runningInstanceId)return;if(!unsafeWindow.isRun){console.log("Bot stopped.");break}S();const t=await(0,d.processKeyword)(n,e,u);if(!unsafeWindow.isRun){console.log("Bot stopped.");break}if("no more results"===t){const t=(0,x.l)(1,5),n=(new Date).getTime()+60*t*1e3;return(0,i.CONSOLE_MESSAGE)("timeout",{message:"No listings left..",hh:moment(n).format("HH"),mm:moment(n).format("mm"),ss:moment(n).format("ss")}),await(0,g.sleep)(60*t*1e3),void E(e)}if("listingsPerKeyword reached."===t){const t=(0,x.l)(1,5),n=(new Date).getTime()+60*t*1e3;return(0,i.CONSOLE_MESSAGE)("timeout",{message:"Listings per keyword has been reached. Starting a new search.",hh:moment(n).format("HH"),mm:moment(n).format("mm"),ss:moment(n).format("ss")}),await(0,g.sleep)(60*t*1e3),void E(e)}if("stop_after_x_messages_reached"===t){const t=(0,x.l)(15,20),n=(new Date).getTime()+60*t*1e3,a=await(await(0,v.B)()).getMessagesSent();return(0,i.CONSOLE_MESSAGE)("timeout",{message:`TRIAL: Stopped messaging after sending ${a} messages.`,hh:moment(n).format("HH"),mm:moment(n).format("mm"),ss:moment(n).format("ss")}),await(0,g.sleep)(60*t*1e3),void E(e)}if("not-allowed"===t)return void(0,i.CONSOLE_MESSAGE)("custom","You are not allowed to use this bot.");if("old_listing_found"===t){const t=(0,x.l)(1,5),n=(new Date).getTime()+60*t*1e3;return(0,i.CONSOLE_MESSAGE)("timeout",{message:"Found an old listing. Will move to next keyword..",hh:moment(n).format("HH"),mm:moment(n).format("mm"),ss:moment(n).format("ss")}),await(0,g.sleep)(60*t*1e3),void E(e)}if("halted"===t)return void(0,i.CONSOLE_MESSAGE)("halted");if(window.messagesSent>1&&window.messagesSent%20==0){const e=(new Date).getTime()+60*s.delayPerXMessages*1e3;(0,i.CONSOLE_MESSAGE)("timeout",{message:"20 messages has been sent",hh:moment(e).format("HH"),mm:moment(e).format("mm"),ss:moment(e).format("ss")}),await(0,g.sleep)(60*s.delayPerXMessages*1e3)}}}},7367:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getStats:()=>r,stats:()=>o});var a=n(1334),s=n(9171),i=n(4484);async function o(){const e=new Date,t=`${e.getFullYear()}${e.getMonth()+1}${e.getDate()}`;let n=await(0,a.chromeStorageGet)(`stats_${t}`);function i(){return(0,a.chromeStorageSet)(`stats_${t}`,JSON.stringify(n))}return n=n?JSON.parse(n):{},{addOffer:()=>{const e="offers";n[e]||(n[e]=0),n[e]+=1,i(),document.getElementById("stat_offers").textContent=n[e],(0,s._)({offers:n[e]}),o().then((e=>e.addNewListings()))},addSkipped:e=>{void 0===e&&(e=1);const t="skipped";n[t]||(n[t]=0),n[t]+=e,i(),document.getElementById(`stat_${t}`).textContent=n[t],(0,s._)({skipped:n[t]}),o().then((t=>t.addNewListings(e)))},addPartner:()=>{const e="partners";n[e]||(n[e]=0),n[e]+=1,i(),document.getElementById(`stat_${e}`).textContent=n[e],(0,s._)({partners:n[e]})},addRun:()=>{n.runs||(n.runs=0),n.runs+=1,i(),document.getElementById("stat_runs").textContent=n.runs,(0,s._)({runs:n.runs})},addStreak:()=>{window.iStreaks+=1,document.getElementById("stat_streaks").textContent=window.iStreaks,(0,s._)({streaks:window.iStreaks})},addKo:()=>{n.ko||(n.ko=0),n.ko+=1,i(),document.getElementById("stat_ko").textContent=n.ko,(0,s._)({KO:n.ko})},resetCurrentStreak:()=>{window.iStreaks=0,document.getElementById("stat_streaks").textContent=window.iStreaks,(0,s._)({streaks:0})},addTotalListingsScraped:e=>{const t="scraped";n[t]||(n[t]=0),n[t]+=e.length,i(),document.getElementById(`stat_${t}`).textContent=n[t],(0,s._)({listings_scraped:n[t]})},setThreadsCount:e=>{const t="num_threads";n[t]=e,i(),(0,s._)({num_threads:n[t]})},addNewListings:e=>{void 0===e&&(e=1);const t="new_listings";n[t]||(n[t]=0),n[t]+=e,i(),document.getElementById(`stat_${t}`).textContent=n[t],(0,s._)({new_listings:n[t]})},addSingleListings:()=>{const e="single_listings";n[e]||(n[e]=0),n[e]+=1,i(),document.getElementById(`stat_${e}`).textContent=n[e],(0,s._)({single_listings:n[e]})},addMultiListings:()=>{const e="multi_listings";n[e]||(n[e]=0),n[e]+=1,i(),document.getElementById(`stat_${e}`).textContent=n[e],(0,s._)({multi_listings:n[e]})}}}async function r(){try{const e={},t=new Date,n=`${t.getFullYear()}${t.getMonth()+1}${t.getDate()}`;let s=await(0,a.chromeStorageGet)(`stats_${n}`);if(s){const t=["offers","partners","runs","streaks","ko"];s=JSON.parse(s),t.forEach((t=>{e[t]=s[t]||0}))}return e}catch(e){console.error(e),(0,i._apiSendBug)({error:"Failed to get stats",details:e.toString()})}}},8944:(e,t,n)=>{"use strict";n.d(t,{B:()=>i,X:()=>o});var a=n(1334),s=n(3539);async function i(){const e=new Date,t=`${e.getFullYear()}${e.getMonth()+1}${e.getDate()}`;let n=await(0,a.chromeStorageGet)(`stopAfterXMessages_${t}`);return n=n?JSON.parse(n):{},{addMessageSent:()=>{const e="messages_sent";n[e]||(n[e]=0),n[e]+=1,(0,a.chromeStorageSet)(`stopAfterXMessages_${t}`,JSON.stringify(n))},getMessagesSent:()=>{const e="messages_sent";return n[e]||(n[e]=0),n[e]}}}async function o(){const e=(await i()).getMessagesSent();let t=Number(document.getElementById("stop_messaging_after").value)||0;if("TRIAL"===window.licenseMode&&(t=5),0===t)return!1;const n=e>=t;return n&&(console.log(`TRIAL: Stopped messaging after sending ${e} messages.`),(0,s.CONSOLE_MESSAGE)("custom",`TRIAL: Stopped messaging after sending ${e} messages.`)),n}},8329:(e,t,n)=>{"use strict";n.r(t),n.d(t,{templates:()=>i});var a=n(1334);const s=n(6503);function i(e){return{message_1:(async()=>{const t=await(0,a.chromeStorageGet)("input_message_1")||"";return e?t:s.unspin(t)})(),message_2:(async()=>{const t=await(0,a.chromeStorageGet)("input_message_2")||"";return e?t:s.unspin(t)})(),message_3:(async()=>{const t=await(0,a.chromeStorageGet)("input_message_3")||"";return e?t:s.unspin(t)})(),followup_1:(async()=>{const t=await(0,a.chromeStorageGet)("input_followup_1")||"";return e?t:s.unspin(t)})(),followup_2:(async()=>{const t=await(0,a.chromeStorageGet)("input_followup_2")||"";return e?t:s.unspin(t)})(),followup_3:(async()=>{const t=await(0,a.chromeStorageGet)("input_followup_3")||"";return e?t:s.unspin(t)})(),messageonreply_1:(async()=>{const t=await(0,a.chromeStorageGet)("input_messageonreply_1")||"";return e?t:s.unspin(t)})()}}},3142:(e,t,n)=>{"use strict";n.r(t),n.d(t,{testCategorySearch:()=>o});var a=n(3539),s=n(5836),i=n(9688);async function o(){const{keyword:e,error:t,coordinates:n}=await(0,s.getKeyword)();if(t)return void console.error(t);let o=document.querySelector("#ta #searchwithfilters").value;if(!o)return console.error('No "Search With Filters" found.'),void alert('No "Search With Filters" found.');const r=o.trim().split("\n");!async function(e,t,n){if(!window.isAllowed)return console.error("You are not allowed to use this bot! x("),"not-allowed";(0,a.CONSOLE_MESSAGE)("fetching_listings",{keyword:e},123);const s={keyword:e,radius:document.getElementById("radius").value||"65"};n&&(s.lat=n.lat,s.lon=n.lon);const o=document.querySelector("#listing_max_price").value,r=document.querySelector("#listing_min_price").value;o&&(s.priceMax=o),r&&(s.priceMin=r);let l=!1;String(e).match(/category/i)&&(l=!0,e=(e=e.replace(/\/?category\/?/i,"")).replace(/\/$/,""),s.keyword=e),s.isCategorySearch=l;const{listings:c,cursor:d}=await(0,i.searchListings)(s);c.map((e=>`${e.title}|${e.price}`)).forEach((e=>console.log(e)))}(r[r.length-1],0,n)}},803:(e,t,n)=>{"use strict";n.r(t),n.d(t,{testTemplates:()=>o});var a=n(9107),s=n(8329),i=n(3443);async function o(){const e=[];if(!(0,i.t)())return;const t=(0,s.templates)(),n=Object.keys(t);for(const s of n){let n=await t[s];if(console.log("msg",n),n){try{n=(0,a.parseVariables)(n,"Seller",600,"IPHONE 14 PRO")}catch(e){console.trace(),console.error(e)}n=`${s}: ${n}\n\n`,console.log("msg2",n),e.push(n)}}alert(e.join(""))}},1060:(e,t,n)=>{"use strict";n.d(t,{$:()=>s,P:()=>i});var a=n(1334);async function s(e){const t=await(0,a.chromeStorageGet)("input_skipwords_title");if(t){let n=!1;if(t.split(",").map((e=>e.trim())).forEach((t=>{t&&e&&e.match(new RegExp(t,"i"))&&(n=t)})),n)return n}}async function i(e){const t=await(0,a.chromeStorageGet)("input_skipwords_description");if(t){let n=!1;if(t.split(",").map((e=>e.trim())).forEach((t=>{t&&e&&e.match(new RegExp(t,"i"))&&(n=t)})),n)return n}}},8252:(e,t,n)=>{"use strict";function a(e){if("createEvent"in document){const t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange");e.parentElement&&e.parentElement.MaterialTextfield&&e.parentElement.MaterialTextfield.change(e.value)}n.d(t,{b:()=>a})},7121:(e,t,n)=>{"use strict";function a(e){const t=["#keywords","#skipwords_title","#skipwords_description","#message_1","#acceptmessage","#message_2","#message_3","#followup_1","#followup_2","#followup_3","#messageonreply_1","ownerlisting_kw_match"];for(const n of t){let t=document.querySelector(n);t&&(t.disabled=!e,t.style.opacity=e?"1":"0.8")}}n.d(t,{X:()=>a})},5078:(e,t,n)=>{"use strict";function a(e,t,n){var a=e.indexOf(t)+t.length;if(a<t.length)return"";var s=e.substring(a),i=s.indexOf(n);if(-1===i)throw Error("Could not find endTime `"+n+"` in the given string.");return s.substring(0,i)}n.r(t),n.d(t,{getFrom:()=>a})},6728:(e,t,n)=>{"use strict";function a(e,t){t=Number(t),e=Number(e);const n=new Date(t);return(new Date-n)/864e5>=e}n.r(t),n.d(t,{hasDaysPassed:()=>a})},3443:(e,t,n)=>{"use strict";n.d(t,{t:()=>o});var a=n(3539),s=n(8329);const i=n(6503);function o(){const e=[];return Object.keys((0,s.templates)()).forEach((async t=>{const n=await(0,s.templates)(!0)[t];i.validate(n)||e.push(t)})),!e.length||((0,a.CONSOLE_MESSAGE)("custom","Invalid spintax detected."),alert("You have invalid spintax format in "+e.join(", ")),!1)}},3253:(e,t,n)=>{"use strict";function a(e){var t=window.addEventListener?"addEventListener":"attachEvent";(0,window[t])("attachEvent"==t?"onmessage":"message",(function(t){var n=t[t.message?"message":"data"];"login"===n?.event&&"function"==typeof e&&e(n.user)}),!1)}n.r(t),n.d(t,{waitForLogin:()=>a})},9171:(e,t,n)=>{"use strict";n.d(t,{_:()=>o});var a=n(2617),s=n(1334);function i(){const e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()}`}async function o({offers:e,partners:t,runs:n,streaks:o,KO:r,listings_scraped:l,num_threads:c,new_listings:d,single_listings:u,multi_listings:m}){if(!window.taEmail)return;const p=document.getElementById("roundupdown").value,g=document.getElementById("streaktimeout").value,_=document.getElementById("streak").value,w=document.querySelector("#switch-deleteaftersend").checked,h=document.querySelector("#skipwords_title").value,f=document.querySelector("#skipwords_description").value,y=document.querySelector("#ownerlisting_kw_match").value,b=document.querySelector("#ta #keywords").value,x=document.querySelector("#searchwithfilters").value,S=document.getElementById("followup_after").value,v=document.querySelector("#runfrom").value,E=document.querySelector("#rununtil").value,k=function(){const e=new Date;let t=e.getMonth()+1;t<10&&(t=`0${t}`);let n=e.getDate();return n<10&&(n=`0${n}`),`${e.getFullYear()}-${t}-${n}`}(),L=(0,a.g)()||window.taEmail,C=document.querySelector("#listing_min_price").value,I=document.querySelector("#listing_max_price").value,A=document.querySelector("#coordinates").value,O=document.querySelector("#radius").value,q={key:L,partner_email:window.taEmail,date:k,version:window.extension_version,partner_id:window.taPartnerId};void 0!==e&&(q.offers=e),void 0!==t&&(q.partners=t),void 0!==n&&(q.runs=n),void 0!==o&&(q.streaks=o),void 0!==r&&(q.KO=r),void 0!==v&&(q["run from"]=v),void 0!==E&&(q.until=E),void 0!==p&&(q.rounding=p),void 0!==_&&(q["max streak"]=_),void 0!==g&&(q.timeout=g),void 0!==l&&(q.listings_scraped=l),void 0!==S&&(q.followup_after=S),void 0!==w&&(q["delete after sending"]=w),void 0!==h&&(q.skipwords_title=h),void 0!==f&&(q.skipwords_description=f),void 0!==y&&(q.ownerlisting_kw_match=y),void 0!==b&&(q.keywords=b),void 0!==x&&(q.searchwithfilters=x),void 0!==c&&(q["threads inbox"]=c),void 0!==d&&(q["New Listings"]=d),void 0!==u&&(q["Single Listings"]=u),void 0!==m&&(q["Multi Listings"]=m),void 0!==C&&(q["Price Min"]=C),void 0!==I&&(q["Price Max"]=I),void 0!==A&&(q.coordinates=A),void 0!==O&&(q.radius=O),async function(){const e=(new Date).getTime();let t=await(0,s.chromeStorageGet)("runtimeHits");if(t){t=JSON.parse(t);const a=t[t.length-1];n=a,Date.now()-n>=6e5&&(t.push(e),e-a<12e5&&async function(){const e=i();let t=await(0,s.chromeStorageGet)("runTimePerDay");t?(t=JSON.parse(t),t[e]||(t={},t[e]=0),t[e]=parseInt(t[e])+1):t={[e]:1},(0,s.chromeStorageSet)("runTimePerDay",JSON.stringify(t))}())}else t=[],t.push(e);var n;(0,s.chromeStorageSet)("runtimeHits",JSON.stringify(t))}(),q.runtime_points=await async function(){let e=await(0,s.chromeStorageGet)("runTimePerDay");if(e){const t=i();return e=JSON.parse(e),e[t]?e[t]:0}return 0}(),window.writeQueue||(window.writeQueue=[]),window.writeQueue.push(q)}},6503:(e,t,n)=>{e.exports=n(9819)},9819:(e,t)=>{!function(e){e.isSpintax=function(e){return null!==e.match(/\{[^}]*\|*[^}]*\}/)},e.findSpintax=function(e){return e.match(/\{([^{}]+?)\}/)},e.unspin=function(t,n){for(var a,s,i,o=t,r=0;e.isSpintax(t);){if(r>=1e3)throw new Error("Unable unspin text after 1000 iterations ("+o+")");i=(s=(a=e.findSpintax(t))[1].split("|"))[Math.floor((n||Math.random)()*s.length)],t=t.replace(a[0],i),r++}return t},e.count=function(t){for(var n,a,s,i,o,r=0,l=/%%%\d+%%%/g,c=/%%%(\d+)%%%/,d=t,u=0;e.isSpintax(t);){if(u>=1e3)throw new Error("Unable unspin text after 1000 iterations ("+d+")");for(a=(n=e.findSpintax(t))[1].split("|"),s=0,o=0;o<a.length;o++)a[o].match(l)?s+=parseInt(a[o].match(c)[1])||1:s+=1;t=t.replace(n[0],"%%%N%%%".replace("N",s.toString())),u++}if(t.match(l))for(i=t.match(l),r=1,o=0;o<i.length;o++)r*=parseInt(i[o].match(c)[1])||1;return r},e.validate=function(t){return null===(t=e.unspin(t)).match(/(\{[^}]*\|)|(\|[^{]*\})/)}}(t)},127:(e,t)=>{t.viewModeCheck=function(){window.location.href.match("/inbox|inbox/message")&&(window.viewermode=!0)}},4147:e=>{"use strict";e.exports=JSON.parse('{"name":"facebook-marketplace-bot","version":"24.1114.20","description":"","main":"contentscript.js","dependencies":{"acorn":"^8.8.1","graceful-fs":"^4.2.10","javascript-obfuscator":"^4.0.0","mel-spintax":"^1.0.4","path":"^0.12.7","webpack-cli":"^4.9.2"},"scripts":{"build":"npm run version_update && webpack && npm run show_version","debug":"node debugger.js","lint":"eslint .","test":"echo \\"Error: no test specified\\" && exit 1","version_update_old":"npm version patch --no-git-tag-version","version_update":"node ./version_updater.js","deploy-traderonly":"surge dist/","show_version":"npm -s run env echo \'$npm_package_version\'"},"repository":{"type":"git","url":"git+ssh://git@bitbucket.org/hopla-tools/offerupbot.git"},"author":"Silver Serate","license":"ISC","homepage":"https://bitbucket.org/hopla-tools/offerupbot#readme","devDependencies":{"eslint":"^8.55.0","source-map":"^0.7.4","webpack":"^5.74.0","webpack-obfuscator":"^3.5.1"}}')}},t={};function n(a){var s=t[a];if(void 0!==s)return s.exports;var i=t[a]={exports:{}};return e[a](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{if(window.isAlreadyInjected)throw new Error("Marketplace Bot is already injected to this page.");window.isAlreadyInjected=!0;const{addAllUserListingsToSkipList:e}=n(9088),{attachEvents:t}=n(1424),{showAlerts:a}=n(1203),{generateId:s}=n(3372),{getConsoleMessages:i,CONSOLE_MESSAGE:o}=n(3539),{getPartnerDetails:r}=n(8414),{getQuote:l}=n(2646),{getVariant:c}=n(821),{default:d}=n(3119),{handleFetchErrors:u}=n(2287),{injectLogger:m}=n(7731),{injectMdl:p}=n(4559),{injectMoment:g}=n(3695),{injectStyle:_}=n(5729),{injectTrackjs:w}=n(5658),{insertUI:h}=n(642),{isInjectedToOtherTab:f}=n(5779),{loadInputs:y}=n(5489),{loadStats:b}=n(4219),{logout:x}=n(1992),{onSessionReady:S,login_callback:v}=n(2608),{prefix:E}=n(7850),{processKeyword:k}=n(3251),{processWriteQueue:L}=n(4053),{restoreDefaults:C}=n(1063),{retryDelayWithMessage:I}=n(425),{showLoading:A}=n(1023),{skips:O}=n(8521),{sleep:q}=n(4246),{start:M}=n(390),{stats:U}=n(7367),{testTemplates:N}=n(803),{_apiSendBug:D}=n(4484),{viewModeCheck:G}=n(127),{version:F}=n(4147),{searchListings:T}=n(9688),{fetchListingDetails:j}=n(13),{api_sendMessage:$}=n(4087),{fetchInboxThreads:B}=n(3542),{getKeyword:K}=n(5836),{changeArchivedStatus:P}=n(175),{getUserListings:W}=n(5639),{readCoordinates:R}=n(7480),{archiveAllThreads:V}=n(8048),{getFrom:H}=n(5078),{getFb_dtsg:z}=n(8544),{filterOutListingsNotInPriceRange:Q}=n(6901),{sendMessage:J}=n(7164),{getModelMatches:X}=n(9132),{chromeStorageSet:Y,chromeStorageGet:Z,chromeStorageListKeys:ee}=n(1334),{getUserJoined:te}=n(6564),{default:ne}=n(6849),{getKeywordMatched:ae}=n(533),{parseVariables:se}=n(9107),{downloadOwnerSkipList:ie,downloadListingSkipList:oe}=n(4711),{getCategoryParameters:re}=n(8785),{testCategorySearch:le}=n(3142),{searchCategoryListings:ce}=n(182),{followup:de,addFollowupEntry:ue}=n(4898),{hasDaysPassed:me}=n(6728),{checkStoredSubscriptionId:pe}=n(2373),{templates:ge}=n(8329),{fetchListingImages:_e}=n(6183),{getOpenAIApiKey:we,getAssistants:he}=n(9309),{waitForLogin:fe}=n(3253);window.sleep=q,(async()=>{window.extension_version=F,window.messagesSent=0,window.iStreaks=0,unsafeWindow.isRun=0,window.isViewMode=!0,window.tabId=Math.round(1e4*Math.random()),window.textMatchIndex={},window.isEnterprise=!1,window.bugReport={},window.isKO=!1,window.debug=!1,window.storeFirebaseLog=async function(e,t){return async function n(a){return fetch("https://us-central1-trade-apples.cloudfunctions.net/sendlog",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({logType:"Facebook Marketplace",ts:t||"",log:e})}).then((async e=>u(e))).then((e=>e.text())).catch((async e=>(console.error("Fetch Failed (storeFirebaseLog)",e,a),a&&a>6?"":(await q(1e4),a||(a=0),n(a+=1)))))}().catch((e=>(console.error("Fetch Failed (storeFirebaseLog)",e),"")))},window.testTemplates=N,unsafeWindow.restoreDefaults=C,window.prefix=E,unsafeWindow.skips=O,window.processKeyword=k,window.addAllUserListingsToSkipList=e,window.CONSOLE_MESSAGE=o,window.getConsoleMessages=i,window.getVariant=c,window.getQuote=l,window.showLoading=A,window.login_callback=v,window.getPartnerDetails=r,window.hopla_logout=x,unsafeWindow.sendDebugLog=ne,unsafeWindow._apiSendBug=D,unsafeWindow.parseVariables=se,unsafeWindow.downloadOwnerSkipList=ie,unsafeWindow.downloadListingSkipList=oe,unsafeWindow.stats=U,unsafeWindow.hasDaysPassed=me;let n=!1;if(await f())console.error("Facebook Marketplace Bot is already inject in another tab.");else{unsafeWindow.api_sendMessage=$,window.searchListings=T,unsafeWindow.searchListings=T,unsafeWindow.fetchListingDetails=j,unsafeWindow.getUserListings=W,unsafeWindow.fetchInboxThreads=B,unsafeWindow.readCoordinates=R,window.getKeyword=K,unsafeWindow.changeArchivedStatus=P,unsafeWindow.archiveAllThreads=V,unsafeWindow.getFrom=H,unsafeWindow.getFb_dtsg=z,unsafeWindow.filterOutListingsNotInPriceRange=Q,unsafeWindow.getKeyword=K,unsafeWindow.sendMessage=J,unsafeWindow.getVariant=c,unsafeWindow.getModelMatches=X,unsafeWindow.chromeStorageSet=Y,unsafeWindow.chromeStorageGet=Z,unsafeWindow.getUserJoined=te,unsafeWindow.getKeywordMatched=ae,unsafeWindow.getCategoryParameters=re,unsafeWindow.testCategorySearch=le,unsafeWindow.searchCategoryListings=ce,unsafeWindow.fetchInboxThreads=B,unsafeWindow.addFollowupEntry=ue,unsafeWindow.fetchListingImages=_e,unsafeWindow.followup=de,unsafeWindow.templates=ge,unsafeWindow.getAssistants=he,console.log(`Marketplace Bot Version ${window.extension_version}`);try{!function(){"use strict";let e=!1;a&&alert("Facebook Marketplace Bot has been injected!"),window.addEventListener("online",(()=>{n=!1,console.log("You are back online!"),setTimeout((()=>{document.querySelector("#statustext"),console.log("Will restart bot.");const e=s();unsafeWindow.runningInstanceId=e,M(e)}),1e4)})),window.addEventListener("offline",(async()=>{for(n=!0,console.log("You are offline.");n;)await r(1e3)}));try{o()}catch(e){console.error("Bot crashed. offline",e),D({error:"Found error in the bot.",info:e.toString()})}async function o(){_(),w(),await i(),h(),we(),A(!0),getmdlSelect.init(".getmdl-select"),p(),y(),await pe()||fe(S),b(),t(),L(),window.isAllowed&&(e=!0)}function r(e){return new Promise((t=>setTimeout(t,e)))}unsafeWindow.chromeStorageListKeys=ee,window.main=o,window.start=M,window.loadInputs=y,console.log("Facebook Marketplace Bot is ready!")}()}catch(e){console.trace(),console.error("caught error",e),console.log("Caught error. Will restart bot."),D({error:"Found error in the bot.",info:e.toString()})}}})()})()})();
//# sourceMappingURL=bundle.js.map



})();