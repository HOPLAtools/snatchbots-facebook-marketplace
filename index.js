// ==UserScript==
// @name         [DEV] Facebook Phones.Trade Bot
// @namespace    http://tampermonkey.net/
// @version      25.0716.444
// @description  try to take over the world!
// @author       You
// @match        https://www.facebook.com/*
// @icon         https://www.google.com/s2/favicons?sz=64&domain=facebook.com
// @grant        GM.getValue
// @grant        GM.setValue


// @grant        GM_addElement
// @grant        GM_addStyle
// @run-at document-end
// @sandbox DOM
// @require https://code.getmdl.io/1.3.0/material.min.js
// @require https://cdnjs.cloudflare.com/ajax/libs/getmdl-select/2.0.1/getmdl-select.min.js
// @require https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js
// @require https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.5.6/dialog-polyfill.min.js
// ==/UserScript==

(function() {
  'use strict';
// https://raw.githubusercontent.com/HOPLAtools/snatchbots-facebook-marketplace/development/index.js ;

/*! For license information please see bundle.js.LICENSE.txt */
(()=>{var e={6077:(e,t,n)=>{"use strict";n.r(t),n.d(t,{listenNetworkEvents:()=>o});var i=n(3539),s=n(4246);let r=!1;async function o(){window.addEventListener("online",(()=>{r=!1,console.log("You just got back online. Will restart bot."),(0,i.CONSOLE_MESSAGE)("custom","You just got back online. Will restart bot."),setTimeout((()=>{console.log("Will restart bot."),window.location.reload()}),1e4)})),window.addEventListener("offline",(async()=>{for(r=!0,console.log("You are offline.");r;)await(0,s._)(1e3)}))}},4484:(e,t,n)=>{"use strict";n.r(t),n.d(t,{_apiSendBug:()=>r});var i=n(2617),s=n(4246);function r(e){const t=(new Date).getTime();e.log_id=t;try{e.email||(e.email=(0,i.g)())}catch(e){console.error("failed to add email to log.")}return window.tabId&&(e.tabId=window.tabId),window.userGmail&&(e.partner_email=window.userGmail),unsafeWindow.taPartnerId&&(e.taPartnerId=unsafeWindow.taPartnerId),e.extension_version=window.extension_version,async function t(n){return fetch("https://cloudlogging.hopla.workers.dev/log?function=facebookbot",{method:"POST",body:JSON.stringify(e),mode:"no-cors"}).then((e=>e.text())).catch((async e=>(console.error("Fetch Failed (_apiSendBug)",e,n),n&&n>6?"":(await(0,s._)(1e4),n||(n=0),t(n+=1)))))}().catch((e=>(console.error("Fetch Failed (_apiSendBug)",e),"")))}},1334:(e,t,n)=>{"use strict";async function i(e){return GM.getValue(e)}async function s(e,t){return GM.setValue(e,t)}async function r(e){return GM.deleteValue(e)}async function o(){return await GM.listValues()}n.r(t),n.d(t,{chromeStorageGet:()=>i,chromeStorageListKeys:()=>o,chromeStorageRemove:()=>r,chromeStorageSet:()=>s})},1203:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DEFAULT_SKIP_OWNERCREATION_YEAR:()=>v,MESSAGED_LISTINGS:()=>x,MESSAGED_SELLERS:()=>k,SKIP_LISTINGS:()=>E,SKIP_SELLERS:()=>I,aNoReasonNeeded:()=>b,apiCallDelay:()=>p,botRetryDelay:()=>m,debug_disableMessages:()=>l,delayPerXMessages:()=>d,disableLogs:()=>c,followAfterMinutes:()=>y,intervalConversationsCheck:()=>r,listingsPerKeyword:()=>s,losenolead_locationid:()=>S,maxItemsToOfferPartner:()=>o,messageDelay:()=>u,sheet_id:()=>w,showAlerts:()=>a,timeout_permessage:()=>_,timeout_perpage:()=>g,timeout_streak:()=>f,userDelay:()=>h,waitIfSpamDetected:()=>i});const i=1440,s=120,r=300,o=3,a=!1,l=!1,c=!1,u=[3,10],d=10,h=[20,180],m=[50,70],p=[5,15],f=[20,180],g=[20,180],_=[5,15],y=[15,180],w="1a6324ea456c27346230df0a70458cc9",v=2023,b=["listings_messaged","partnermessage","users"],S="b6gmn59GxMqRwJSxl2DU",E="skip_listings",I="skip_sellers",k="messaged_sellers",x="messaged_listings"},6186:(e,t,n)=>{"use strict";n.d(t,{s:()=>s});var i=n(3539);async function s(e,t){for(let n=t;n>0;n--)console.log(e,n),(0,i.CONSOLE_MESSAGE)("custom",e+n),await new Promise((e=>setTimeout(e,1e3)))}},5425:(e,t,n)=>{"use strict";n.d(t,{S:()=>s,k:()=>r});var i=n(5078);function s(){let e=(0,i.U)(document.body.outerHTML,'revision":',",");return e||(e=(0,i.U)(document.body.outerHTML,'client_revision":',",")),e||1021629914}function r(){return(0,i.U)(document.body.outerHTML,'["LSD",[],{"token":"','"}')||"25z2WHBDl9uMMFBKwsDJPz"}},13:(e,t,n)=>{"use strict";n.d(t,{z:()=>h});var i=n(1203),s=n(5425),r=n(3539),o=n(5703),a=n(8544),l=n(2287),c=n(4246),u=n(7367),d=n(4418);async function h({id:e,includeAllDetails:t=!1}){window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const n={UFI2CommentsProvider_commentsKey:"MarketplacePDP",feedbackSource:56,feedLocation:"MARKETPLACE_MEGAMALL",referralCode:"null",scale:2,should_show_new_pdp:!1,targetId:String(e),useDefaultActor:!1},h=(0,a.H)(),m=(0,s.S)();for(var p="2",f=0;f<h.length;f++)p+=h.charCodeAt(f);const g=(0,o.W)(),_={av:g,__user:g,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${m}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:h,jazoest:p,lsd:"VSZVwWRyifaM82K_F8cOFc",__spin_r:"1007782503",__spin_b:"trunk",__spin_t:"1688385023",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:"CometMarketplaceSearchContentContainerQuery",variables:JSON.stringify(n),server_timestamps:"true",doc_id:"6019983858113356"};let y=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:(0,d.T)(_),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,l.u)(e))).then((e=>e.json()));const w=JSON.stringify(y);if(w&&w.match(/api_error_code":368/i)){const e=(new Date).getTime()+60*i.waitIfSpamDetected*1e3,t=moment(e).calendar();return(0,r.CONSOLE_MESSAGE)("halted_soft",{schedule:t}),(await(0,u.o)()).addKo(),window.isKO=!0,await(0,c._)(60*i.waitIfSpamDetected*1e3),window.isKO=!1,{error:"Rate limit exceeded",error_code:"rate_limit_exceeded"}}const v={};if(y&&y.data&&y.data.viewer&&y.data.viewer.marketplace_product_details_page){const e=y.data.viewer.marketplace_product_details_page.target.id,n=y.data.viewer.marketplace_product_details_page.target.marketplace_listing_title,i=y.data.viewer.marketplace_product_details_page.target.redacted_description.text,s=y.data.viewer.marketplace_product_details_page.target.listing_price.amount,r=y.data.viewer.marketplace_product_details_page.target.marketplace_listing_seller,o=y.data.viewer.marketplace_product_details_page.target.creation_time,a=y.data.viewer.marketplace_product_details_page.target.attribute_data;if(a){const e=a.find((e=>"Condition"===e.attribute_name));e&&(v.condition=e.value)}const l=y.data.viewer.marketplace_product_details_page.target.location;if(l&&(v.location={latitude:l.latitude,longitude:l.longitude}),e&&(v.id=e),n&&(v.title=n),i&&(v.description=i),s&&(v.price=s),r){let e=y.data.viewer.marketplace_product_details_page.target.marketplace_listing_seller.join_time;e&&(e*=1e3,r.join_year=new Date(e).getFullYear()),v.seller=r}o&&(v.creationTime=1e3*o,v.age=Date.now()-v.creationTime);let c=y.data.viewer.marketplace_product_details_page.target.listing_photos;c&&(v.photos=c.map((e=>e.image.uri))),t&&(v.allDetails=y.data.viewer.marketplace_product_details_page.target)}if(0===Object.keys(v).length){if(y.errors&&Array.isArray(y.errors))if(y.errors.length>0){if(console.log("Error",y.errors[0]),368===y.errors[0].api_error_code)return console.log("Fetch listing detail rate limited."),(await(0,u.o)()).addKo(),console.log("Rate limit exceeded"),{error:"Rate limit exceeded",error_code:"rate_limit_exceeded"}}else console.log("No errors",e,y);console.log("No results",e,y)}return v}},6901:(e,t,n)=>{"use strict";n.d(t,{d:()=>l,f:()=>a});var i=n(4484),s=n(3539),r=n(8521),o=n(7367);async function a(e){let t=Number(document.querySelector("#listing_min_price").value)||0,n=Number(document.querySelector("#listing_max_price").value)||214748364700;if(0===t&&0===n)return e;const a=e.length,l=[];let c=0;e=e.filter((e=>{let s=e.price;"string"==typeof s&&(s=Number(s.replace(/[^0-9\.]+/g,""))),isNaN(s)&&(l.push((0,i._apiSendBug)({error:"Price is NaN",listing_id:e.id,price:e.price,listing:e})),s=0);const o=s>=t&&s<=n;if(!o){let i=`Price [${s}] not in range [${t}-${n}].`;s<t&&(i=`Price [${s}] < [${t}]`),s>n&&(i=`Price [${s}] > [${n}]`);const o=(0,r.skips)().saveToSkipListing(e.id,i,"NA");c+=1,l.push(o)}return o})),c>0&&(await(0,o.o)()).addSkipped(c),await Promise.all(l);const u=e.length;return u!==a&&(0,s.CONSOLE_MESSAGE)("price_not_inrange",{num_listings:a-u}),e}function l(e){let t=Number(document.querySelector("#listing_min_price").value)||0,n=Number(document.querySelector("#listing_max_price").value)||0;return 0===t&&0===n||("string"==typeof e&&(e=Number(e.replace(/[^0-9\.]+/g,""))),isNaN(e)&&(e=0),e>=t&&e<=n)}},6081:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getFirebase:()=>r,initFirebase:()=>o});var i=n(389);(0,i.KN)("firebase","11.10.0","app");var s=n(6010);function r(){return window.app||o(),window.app}function o(){const e=(0,i.ZF)({apiKey:"AIzaSyCFIDncvsL-RON_0onDDvw29wAyEfuhqlc",authDomain:"snatchbots-8ff7b.firebaseapp.com",projectId:"snatchbots-8ff7b",storageBucket:"snatchbots-8ff7b.firebasestorage.app",messagingSenderId:"186600433367",appId:"1:186600433367:web:4279a037f45e3e8a8f3292"});window.app=e,window.auth=(0,s.v0)()}},9237:(e,t,n)=>{"use strict";function i(e){const t=new Date,n=new Date(e);return Math.floor((t-n)/864e5)}function s(e){return(new Date-new Date(e))/36e5}n.d(t,{f:()=>i,h:()=>s})},3539:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CONSOLE_MESSAGE:()=>c,getConsoleMessages:()=>l});var i=n(4484),s=n(1203),r=n(2287),o=n(6849),a=n(7091);async function l(){if(window.consoleMessages)return window.consoleMessages;let e;try{e=await fetch(`https://sheets.hopla.tools/?HT=${s.sheet_id}&format=json&sheet_name=ConsoleLogFbBot`).then((async e=>(0,r.u)(e))).then((e=>e.text())).then((async e=>{try{return JSON.parse(e)}catch(t){return await(0,o.Z)({error:"Failed to parse getConsoleMessages api response.",x:e}),{}}}))}catch(e){return await(0,i._apiSendBug)({error:"Failed to get console messages.",e:e.toString()}),console.error("Failed to get console message"),{}}if(e&&e.result){window.consoleMessages={};for(const t of e.result)t.variable&&(window.consoleMessages[t.variable]=t.message||"");return window.consoleMessages}return await(0,o.Z)({error:"Failed to get console messages."}),console.error("Failed to get console message"),{}}function c(e,t,n=!1){if(function(e){return e="object"==typeof e?JSON.stringify(e):e,window.lastLog?window.lastLog===e||void(window.lastLog=e):(window.lastLog=e,!1)}(t||e))return;if("custom"===e)return window.lastLog=t,n&&console.log(t),void(0,a.u)(t);if(!window.consoleMessages)return console.error("Called consoleMessage without initiating."),"";let s=window.consoleMessages[e];if(!s)return(0,i._apiSendBug)({error:"No message found for template.",template_name:e,variables:t}),console.error(`No message found for template: ${e}`),"";if(t)for(const e in t){const n=new RegExp(`{${e}}`,"gi");s=s.replace(n,t[e]||"")}n&&console.log(s),(0,a.u)(s)}},4388:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getCurrentListingInfo:()=>s});var i=n(13);async function s(){let e=window.location.href.match(/\/item\/(\d+)\/?/);if(!e)return void console.log("Current url is not a listing page.");let t=e[1],n=(await(0,i.z)({id:t}))?.seller?.id;console.log("listing_id: "+t+"\nseller_id: "+n)}},5703:(e,t,n)=>{"use strict";function i(){const e=document.cookie.split(";");let t="";for(let n=0;n<e.length;n++){const i=e[n];if(i.includes("c_user")){t=i.split("=")[1];break}}if(!t){const e=document.body.outerHTML.match(/"USER_ID":"(\d+)"/i);e&&(t=e[1])}return window.fbuid=t,t}n.d(t,{W:()=>i})},8544:(e,t,n)=>{"use strict";n.d(t,{H:()=>s});var i=n(5078);function s(){const e=document.body.outerHTML.match(/"fb_dtsg","value":"(.+?)"/);return e&&e.length>1?e[1]:(0,i.U)(document.body.outerHTML,'["DTSGInitData",[],{"token":"','"')||"NAcNhhWzHFUzP5lxJVGtei4dqFjAdspi-QTjezuJHG6hmYpsNW__W3w:2:1712977252"}},2617:(e,t,n)=>{"use strict";function i(){if(window.userEmail)return window.userEmail;const e=document.body.outerHTML.match(/"username":"(.+?)"/);return e&&e.length>1?(window.userEmail=e[1],window.userEmail):void 0}n.d(t,{g:()=>i})},5639:(e,t,n)=>{"use strict";n.d(t,{O:()=>h});var i=n(1203),s=n(5425),r=n(13),o=n(3539),a=n(5703),l=n(8544),c=n(2287),u=n(4246),d=n(7367);async function h(e,t,n,m){let p={scale:2,sellerID:e},f="5916012751817013";n&&(p={availabilities:["IN_STOCK"],count:8,cursor:n,order:"CREATION_TIMESTAMP_DESC",scale:2,search:null,id:e},f="5793095287435129");let g="MarketplaceSellerProfileInventoryQuery";n&&(g="MarketplaceSellerProfileInventoryListPaginationQuery");const _=(0,l.H)(),y=(0,s.S)(),w=(0,s.k)(),v=(0,a.W)(),b=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":g,"x-fb-lsd":w},referrer:"https://www.facebook.com/marketplace/item/2620405768097653/?ref=search&referral_code=null&referral_story_type=post&tracking=browse_serp%3Aa3117bdc-6ff8-4cc8-be80-d19683441210",referrerPolicy:"strict-origin-when-cross-origin",body:`av=${v}&__user=${v}&__a=1&__req=4l&__hs=19542.HYP%3Acomet_pkg.2.1..2.1&dpr=2&__ccg=GOOD&__rev=${y}&__s=12vy3m%3A0e0321%3A5dnfrh&__hsi=7251815563541642227&__dyn=7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2CE4ibyQdwSAxacyUco5S3O2Saw8i2S1DwUx60GE3Qwb-q7oc81xoswIK1Rwwwg8a8465o-cw5Mx62G5Usw9m1YwBgK7o884y0Mo4G4UcUC7Udo5qfK0zEkxe2GewyDwkUtxGm2SUbElxm3y3aexfxmu3W3y261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1Iwqo&__csr=gggP5FNdOTdEQRq5YyQy8vEIAGb94EJdOirtjGB98YyPQDYJ9XCYyKLvtidmW9h2dX8QFyrTjHmnGaVCHbKRyl--GhtVd7JbGnG55VXxibypbCgVatmA8GcHKlBGdQ8HBy49CqCKjyV9V6eULG4t7-dx2cgrBgm-dGu4HK6FBxB1ameyFoS7UG5XCwKxvggBUiAAjKdDGcCGdDgPwWgWdxW6F4u2G4-7ojDwHAxO7bwAxG9yQ-E4C4Uy6e4EW3ycxe264EK3yiu5ocUcVUK2e1kjwEwGxeu7EcUmwby4osw0AOw0LjUco041C1kw0r1Uy0eyw0N2w6xwcy0y80_60b-xq0FpFU94bg3Tg2Cwoo7a3O02FQEkw0Li80So3AU0I60du80MU3bw7eDu4E0bEo-06e82Ozo1Fqx52e8yLw6oBtV8yaxx38a8bU7-0im0u10dC0f7x50&__comet_req=15&fb_dtsg=${_}&jazoest=25236&lsd=${w}&__spin_r=${y}&__spin_b=trunk&__spin_t=1688444885&fb_api_caller_class=RelayModern&fb_api_req_friendly_name=${g}&variables=${JSON.stringify(p)}&server_timestamps=true&doc_id=${f}`,method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,c.u)(e))).then((e=>e.text()));if(b.match(/api_error_code":368/i)){console.log("Get user listings rate limited.");const t=(new Date).getTime()+60*i.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,o.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,d.o)()).addKo(),window.isKO=!0,await(0,u._)(60*i.waitIfSpamDetected*1e3),window.isKO=!1,await h(e)}const S=b.split("\r\n");let E=[];if(m&&(E=[...m]),S.forEach((e=>{try{const t=JSON.parse(e);if(t.data&&t.data.profile&&t.data.profile.marketplace_listing_sets&&t.data.profile.marketplace_listing_sets.edges)t.data.profile.marketplace_listing_sets.edges.forEach((e=>{const t={},n=e.node.canonical_listing.marketplace_listing_title,i=e.node.canonical_listing.listing_price.amount,s=e.node.canonical_listing.id;n&&(t.title=n),i&&(t.price=i),s&&(t.id=s),E.push(t)}));else if(t.data&&t.data.node&&t.data.node.canonical_listing){const e={},n=t.data.node.canonical_listing.marketplace_listing_title,i=t.data.node.canonical_listing.listing_price.amount,s=t.data.node.canonical_listing.id;n&&(e.title=n),i&&(e.price=i),s&&(e.id=s),E.push(e)}}catch(e){console.log(e)}})),!t){const t=[];let n=!1;for(let e=0;e<E.length;e++){const i=E[e].id,s=(0,r.z)({id:i}).then((t=>{t.error?(console.error("Failed to get listing details.",t.error),"rate_limit_exceeded"===t.error_code&&(n=!0)):E[e]={...E[e],...t}}));e%10==0&&(await(0,u._)(2e3),await Promise.all(t),t.length=0),t.push(s)}if(await Promise.all(t),n){const t=(new Date).getTime()+60*i.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,o.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,d.o)()).addKo(),window.isKO=!0,await(0,u._)(60*i.waitIfSpamDetected*1e3),window.isKO=!1,await h(e)}}return E}},2497:(e,t,n)=>{"use strict";n.r(t),n.d(t,{setupGlobalErrorHandlers:()=>r});var i=n(4484),s=n(6186);function r(){window.onerror=function(e,t,n,s,r){let o="";try{r.name&&r.message?o+=r.name+": "+r.message:r.message?o+=r.message:o+=r.toString()+" thrown"}catch(e){o+=""}const a={error:"Uncaught error",message:o||e?.toString(),errorObject:r,url:t,lineNumber:n,columnNumber:s,stack:r?.stack||(new Error).stack,timestamp:(new Date).toISOString()};return console.error("Global error caught:",a),(0,i._apiSendBug)(a),!1},window.onunhandledrejection=function(e){const t=e.reason,n={error:"Unhandled Promise Rejection",message:t?.toString()||"Unknown promise rejection",errorObject:t,stack:t?.stack||(new Error).stack,url:window.location.href,lineNumber:t?.line,columnNumber:t?.column,timestamp:(new Date).toISOString()};console.error("Unhandled promise rejection:",n),(0,i._apiSendBug)(n),(0,s.s)("Bot is restarting in ",60).then((()=>{window.location.reload()}))},window.addEventListener("error",(function(e){const t=e.error,n={error:"Error Event",message:t?.toString()||e.message,errorObject:t,url:e.filename||window.location.href,lineNumber:e.lineno,columnNumber:e.colno,stack:t?.stack||(new Error).stack,timestamp:(new Date).toISOString()};console.error("Error event caught:",n),(0,i._apiSendBug)(n)}),!0)}},2287:(e,t,n)=>{"use strict";function i(e){return new Promise(((t,n)=>unsafeWindow.isRun?e.ok?void t(e):(console.trace(),console.log("response.statusText",e.statusText),void setTimeout((()=>{n(e.statusText)}),1e4)):t(e)))}n.d(t,{u:()=>i})},4559:(e,t,n)=>{"use strict";function i(){let e=document.createElement("link");e.setAttribute("rel","stylesheet"),e.setAttribute("href","https://fonts.googleapis.com/icon?family=Material+Icons"),document.head.appendChild(e),e=document.createElement("link"),e.setAttribute("rel","stylesheet"),e.setAttribute("href","https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"),document.head.appendChild(e),e=document.createElement("script"),e.setAttribute("src","https://code.getmdl.io/1.3.0/material.min.js"),document.head.appendChild(e),e=document.createElement("script"),e.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.4.2/dialog-polyfill.min.js"),document.head.appendChild(e),document.head.insertAdjacentHTML("beforeend","<style>\n    #ta .mdl-switch {\n      width: unset;\n    }\n\n    #__next, .MuiPaper-root {\n      width: calc(100% - 370px) !important;\n      left: 0px !important;\n    }\n    </style>"),GM_addElement("script",{src:"https://code.getmdl.io/1.3.0/material.min.js",type:"text/javascript"}),GM_addElement("link",{rel:"stylesheet",href:"https://code.getmdl.io/1.3.0/material.indigo-pink.min.css"}),GM_addElement("link",{rel:"stylesheet",href:"https://cdnjs.cloudflare.com/ajax/libs/dialog-polyfill/0.4.2/dialog-polyfill.min.css"}),GM_addElement("link",{rel:"stylesheet",href:"https://fonts.googleapis.com/icon?family=Material+Icons"}),GM_addStyle("\n  #ta .mdl-switch {\n    width: unset;\n  }\n\n  #__next, .MuiPaper-root {\n    width: calc(100% - 370px) !important;\n    left: 0px !important;\n  }"),GM_addStyle("\n    .toast {\n    position: fixed;\n    background-color: #323232;\n    color: #fff;\n    text-align: center;\n    border-radius: 5px;\n    padding: 6px 12px;\n    font-size: 14px;\n    opacity: 0;\n    transition: opacity 0.3s, transform 0.3s;\n    z-index: 1000;\n    top: 50px; /* Adjusted dynamically in JS */\n    left: 50px; /* Adjusted dynamically in JS */\n    transform: translateY(-10px);\n    pointer-events: none; /* Prevents blocking other interactions */\n  }\n\n  .toast.show {\n    opacity: 1;\n    transform: translateY(0);\n  }\n\n  ")}n.r(t),n.d(t,{injectMdl:()=>i})},5729:(e,t,n)=>{"use strict";function i(){const e=document.createElement("style");document.head.append(e),e.textContent=".mdl-list__item.taseparator {\n    border-bottom: solid 1px #e0e0e0;\n  }\n  \n  .mdl-list__item.taseparator .mdl-textfield__input {\n    border-bottom: unset;\n    text-align: right;\n  }\n  \n  .mdl-list__item-secondary-action.tawsmall {\n    width: 45px;\n  }\n  \n  [id^=page] .demo-list-control {\n    margin-top: unset;\n    height: calc(100% - 143px);\n    overflow: auto;\n  }\n  \n  #page2 .demo-list-control {\n    /* margin-top: unset;\n    height: fit-content;\n    overflow: auto; */\n    margin-top: unset;\n    height: calc(100% - 219px);\n    overflow: auto;\n  }\n  \n  #ta .mdl-textfield {\n    width: 100%;\n  }\n  \n  /* #ta .mdl-textfield__label {\n    text-align: center;\n  } */\n  \n  .label {\n    font-weight: 700;\n    margin-right: 10px;\n  }\n  \n  #dialog-bug {\n    width: 400px;\n    height: max-content;\n  }\n  \n  .report-detail {\n    display: flex;\n  }\n  \n  #bugvariantdetails {\n    border: solid 1px;\n    padding: 8px;\n  }\n  \n  \n  .blue {\n    color: blue\n  }\n  .green {\n    color: green\n  }\n  .purple {\n    color: purple\n  }\n  .red {\n    color: red\n  }\n  .bgred {\n    background: red !important;\n  }\n\n  .w100 {\n    width: 100%;\n  }\n\n  .h100 {\n    height: 100%\n  }\n\n  .space-between {\n    display: flex;\n    justify-content: space-between;\n  }\n\n  .bgblue {\n    background: rgb(63, 81, 181) !important;\n  }\n\n  .bblue {\n    color: rgb(63, 81, 181) !important;\n  }\n\n  .hoplablue {\n    background-color: #343ca3 !important;\n  }\n  \n  .buttons_container {\n    display: flex;\n    justify-content: space-around;\n    width: 100%;\n    flex-wrap: wrap;\n  }\n\n  .buttons_container > button {\n    margin-top: 14px;\n  }\n  \n  .listing_debugger_container {\n    display: flex;\n    justify-content: flex-start;\n    width: 92%;\n    position: absolute;\n    bottom: 0;\n    flex-direction: column;\n    align-items: stretch;\n    margin-bottom: 30px;\n  }\n\n  .fsmall {\n    font-size: small;\n  }\n\n  .h150 {\n    height: 150px;\n  }\n\n  .nowrap {\n      white-space: pre;\n      overflow-wrap: normal;\n      overflow-x: scroll;\n    }\n\n  .popup-content {\n    min-width: 485px\n  }\n\n  .mb20 {\n    margin-bottom: 20px\n  }\n\n  .login_container {\n    height: 100%;\n  }\n\n  .mdl-menu__container.is-visible {\n    z-index: 9999;\n    position: sticky;\n  }\n  ";const t=document.createElement("style");document.head.append(t),t.textContent=".getmdl-select{outline:none}.getmdl-select .mdl-textfield__input{cursor:pointer}.getmdl-select .selected{background-color:#ddd}.getmdl-select .mdl-icon-toggle__label{float:right;margin-top:-30px;color:rgba(0,0,0,0.4);transform:rotate(0);transition:transform 0.3s}.getmdl-select.is-focused .mdl-icon-toggle__label{color:#3f51b5;transform:rotate(180deg)}.getmdl-select .mdl-menu__container{width:100% !important;margin-top:2px}.getmdl-select .mdl-menu__container .mdl-menu{width:100%}.getmdl-select .mdl-menu__container .mdl-menu .mdl-menu__item{font-size:16px}.getmdl-select__fix-height .mdl-menu__container .mdl-menu{overflow-y:auto;max-height:288px !important}.getmdl-select__fix-height .mdl-menu.mdl-menu--top-left{bottom:auto;top:0}\n/*# sourceMappingURL=getmdl-select.min.css.map */"}n.r(t),n.d(t,{injectStyle:()=>i})},584:(e,t,n)=>{"use strict";n.r(t),n.d(t,{insertDraggableIcon:()=>r});var i=n(9485),s=n(9868);function r(){const e=document.createElement("img");e.id="pt-draggable-icon",e.src="https://raw.githubusercontent.com/HOPLAtools/snatchbots-facebook-marketplace/refs/heads/main/resources/img/snatchbots_logo.webp",e.style.position="absolute",e.style.bottom="0",e.style.right="0",e.style.height="100px",e.style.cursor="move",e.style.zIndex="999999",e.style.position="fixed",e.style.boxShadow="0px 0px 10px 0px rgba(0,0,0,0.75)",e.draggable=!1,(0,s.j)(),e.style.borderRadius="50%",e.style.display="none";let t=!1,n=0,r=0,o=!1;e.addEventListener("mousedown",(()=>{o=!1})),document.addEventListener("mousemove",(()=>{t&&(window.iconDragged=!0,o=!0)})),e.addEventListener("click",(()=>{o||(0,i.E)()})),e.addEventListener("mousedown",(i=>{t=!0,n=i.clientX-e.offsetLeft,r=i.clientY-e.offsetTop,e.style.cursor="grabbing"})),document.addEventListener("mousemove",(i=>{t&&(e.style.left=i.clientX-n+"px",e.style.top=i.clientY-r+"px")})),document.addEventListener("mouseup",(()=>{t=!1,e.style.cursor="move"})),document.body.appendChild(e)}},642:(e,t,n)=>{"use strict";function i(){document.body.insertAdjacentHTML("afterbegin",'\n  <div id="ta" style="position: fixed;z-index: 900000;background-color: white;border: solid; right: 0px;width: 385px;\n                  height: 600px; \n                  padding-right: unset;\n                  padding-top: unset;\n                  height: 100%;\n                  top: 0;">\n                <div class="login_container">\n                  <iframe id="login_iframe" src="https://login-snatchbots.hopla.workers.dev" style="border: none; width: 100%; height: 100%; margin-top: 100%;"></iframe>\n                </div>\n                \x3c!-- MDL Tab Container --\x3e\n                <div id="taheader" class="mdl-tabs mdl-js-tabs mdl-js-ripple-effect" style="height: 100%;">\n                  <div id="info-header" style="display: none; color: white;background: rgb(63,81,181);line-height: 26px;padding: 5px 0px;width: 100%;text-align: center; justify-content: space-around;">\n                  <span id="" style="-webkit-user-select: none;-ms-user-select: none;user-select: none;position: absolute;left: 0px;border: 1px solid;height: 38px;margin-top: -7px;width: 30px;font-size: -webkit-xxx-large;cursor: pointer;">-</span>\n                    <span id="info-subscription"></span>\n                    <span id="info-website"></span>\n                    <span><a id="info-logout" href="#" style="text-decoration: none;color: white;-webkit-highlight: none;">Logout</a></span>\n                  </div>\n                  \x3c!-- Tab Bars --\x3e\n                  <div id="menu" class="mdl-tabs__tab-bar" style="display: none;">\n                      <a href="#page2" class="mdl-tabs__tab is-active" style="width: 100%;">Automate</a>\n                      <a href="#page3" class="mdl-tabs__tab" style="width: 100%;">Content</a>\n                      <a href="#page4" class="mdl-tabs__tab" style="width: 100%;">Settings</a>\n                  </div>\n\n                  \x3c!-- <div id="page1" class="mdl-tabs__panel is-active" style="height: 100%;">\n                    <iframe id="taframe" src="https://sell.phones.trade/?model=12pro&amp;storage=128gb&amp;network=unlocked&amp;condition=usedlikenew&a=1" style="\n                      height: 100%;\n                    "></iframe>\n                    <button id="reportbug2" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" style="position: absolute;\n                      bottom: 0px;\n                      left: 50%;\n                      transform: translate(-50%);\n                      z-index: 1;\n                      width: 100%;\n                      display: none;\n                      height: 44px;">\n                        Report a\n                        <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="bug" class="svg-inline--fa fa-bug fa-w-16" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="width: 22px;padding-left: 3px;margin-bottom: 3px;"><path fill="currentColor" d="M511.988 288.9c-.478 17.43-15.217 31.1-32.653 31.1H424v16c0 21.864-4.882 42.584-13.6 61.145l60.228 60.228c12.496 12.497 12.496 32.758 0 45.255-12.498 12.497-32.759 12.496-45.256 0l-54.736-54.736C345.886 467.965 314.351 480 280 480V236c0-6.627-5.373-12-12-12h-24c-6.627 0-12 5.373-12 12v244c-34.351 0-65.886-12.035-90.636-32.108l-54.736 54.736c-12.498 12.497-32.759 12.496-45.256 0-12.496-12.497-12.496-32.758 0-45.255l60.228-60.228C92.882 378.584 88 357.864 88 336v-16H32.666C15.23 320 .491 306.33.013 288.9-.484 270.816 14.028 256 32 256h56v-58.745l-46.628-46.628c-12.496-12.497-12.496-32.758 0-45.255 12.498-12.497 32.758-12.497 45.256 0L141.255 160h229.489l54.627-54.627c12.498-12.497 32.758-12.497 45.256 0 12.496 12.497 12.496 32.758 0 45.255L424 197.255V256h56c17.972 0 32.484 14.816 31.988 32.9zM257 0c-61.856 0-112 50.144-112 112h224C369 50.144 318.856 0 257 0z"></path></svg>\n                    </button>\n                  </div> --\x3e\n\n                  <div id="page2" class="mdl-tabs__panel is-active" style="position: relative; height: calc(100% - 105px); display: none;">\n                    <ul class="demo-list-control mdl-list">\n                      <li class="mdl-list__item" style="height: 58px; display: flex; justify-content: center;">\n                        <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" style="margin-right: 20px;" for="mode-scrape">\n                          <input type="radio" id="mode-scrape" class="mdl-radio__button" name="run-mode" value="scrape" checked>\n                          <span class="mdl-radio__label">Scrape</span>\n                        </label>\n                        <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="mode-webhook">\n                          <input type="radio" id="mode-webhook" class="mdl-radio__button" name="run-mode" value="webhook">\n                          <span class="mdl-radio__label">Webhook</span>\n                        </label>\n                      </li>\n                      <div id="scrape_mode">\n                        <li class="mdl-list__item" style="height: 100px;">\n                            <span class="mdl-list__item-primary-content">\n                              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                                <textarea class="mdl-textfield__input" type="text" rows= "3" id="keywords" ></textarea>\n                                <label class="mdl-textfield__label" for="keywords">Search (Keywords & Categories)</label>\n                              </div>\n                            </span>\n                        </li>\n                        <li style="display: flex;justify-content: space-around;" class="mode_scrape">\n                          <a class="bblue" href="#" id="copy_search_filters" style="display: flex;justify-content: center;">[Copy Search &amp; Filters from URL]</a>\n                          <a class="bblue" href="#" id="test_search_filters" style="display: flex;justify-content: center;">[Test Search]</a>\n                        </li>\n                        <li class="mdl-list__item" style="height: fit-content;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input nowrap" type="text" rows= "3" id="searchwithfilters" ></textarea>\n                              <label class="mdl-textfield__label" for="searchwithfilters">Search With Filters</label>\n                            </div>\n                          </span>\n                        </li>\n                        <li class="mdl-list__item" style="height: 100px; margin-top: 15px;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input" type="text" rows= "3" id="coordinates" ></textarea>\n                              <label class="mdl-textfield__label" for="coordinates">Latitude,Longitude</label>\n                            </div>\n                          </span>\n                        </li>\n                        <li class="mdl-list__item" style="height: 100px;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input" type="text" rows= "3" id="radius" ></textarea>\n                              <label class="mdl-textfield__label" for="radius">Radius (in miles)</label>\n                            </div>\n                          </span>\n                        </li>\n                        <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                          padding-bottom: unset !important;\n                          height: 43px;">\n                          <span class="mdl-list__item-primary-content">\n                            Loop Search & Locations\n                          </span>\n                          <span class="mdl-list__item-secondary-action">\n                            <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-loopsearch">\n                              <input type="checkbox" id="switch-loopsearch" class="mdl-switch__input" checked/>\n                            </label>\n                          </span>\n                        </li>\n                        <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                          padding-bottom: unset !important;\n                          height: 43px;">\n                          <span class="mdl-list__item-primary-content" style="margin-right: -54px;">\n                            Price Min\n                          </span>\n                          <span class="mdl-list__item-secondary-action tawsmall" style="width: 71px;margin-right: -20px;">\n                            <span class="mdl-textfield mdl-js-textfield">\n                              <input class="mdl-textfield__input" type="number" value="100" id="listing_min_price" placeholder="0" style="text-align: unset;">\n                              <label class="mdl-textfield__label" for="listing_min_price"></label>\n                            </span>\n                          </span>\n                          <span class="mdl-list__item-primary-content" style="margin-left: 29px;margin-right: -53px;">\n                            Max\n                          </span>\n                          <span class="mdl-list__item-secondary-action tawsmall" style="width: 90px;">\n                            <span class="mdl-textfield mdl-js-textfield">\n                              <input class="mdl-textfield__input" type="number" value="1000" id="listing_max_price" placeholder="0" style="text-align: left;">\n                              <label class="mdl-textfield__label" for="listing_max_price"></label>\n                            </span>\n                          </span>\n                        </li>\n                        <li class="mdl-list__item" style="height: 100px;">\n                            <span class="mdl-list__item-primary-content">\n                              <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                                <textarea class="mdl-textfield__input" type="text" rows= "3" id="title_must_include" ></textarea>\n                                <label class="mdl-textfield__label" for="title_must_include">Title must contain, any</label>\n                              </div>\n                            </span>\n                        </li>\n                        <li class="mdl-list__item" style="height: 100px;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input" type="text" rows= "3" id="skipwords_title" ></textarea>\n                              <label class="mdl-textfield__label" for="skipwords_title">Skip Words Title</label>\n                            </div>\n                          </span>\n                        </li>\n                      </div>\n                      <li class="mdl-list__item" style="height: 100px;">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows= "3" id="skipwords_description" ></textarea>\n                            <label class="mdl-textfield__label" for="skipwords_description">Skip Words Description</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 100px;">\n                          <span class="mdl-list__item-primary-content">\n                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                              <textarea class="mdl-textfield__input" type="text" rows= "3" id="ownerlisting_kw_match" ></textarea>\n                              <label class="mdl-textfield__label" for="ownerlisting_kw_match">Owner Listing Counter Keywords</label>\n                            </div>\n                          </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Owner KW Listings Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="owner_min_lists" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="owner_min_lists"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="3" id="owner_max_lists" placeholder="0">\n                            <label class="mdl-textfield__label" for="owner_max_lists"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Listing Age (days.hours) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="listing_min_age" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="listing_min_age"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="3" id="listing_max_age" placeholder="0">\n                            <label class="mdl-textfield__label" for="listing_max_age"></label>\n                          </span>\n                        </span>\n                      </li>\n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Bot Mode\n                        </span>\n                        <div>\n                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="mode_single">\n                            <input type="radio" id="mode_single" class="mdl-radio__button" name="bot_mode" value="single" checked disabled>\n                            <span class="mdl-radio__label">Single</span>\n                          </label>\n                          <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="mode_multi">\n                            <input type="radio" id="mode_multi" class="mdl-radio__button" name="bot_mode" value="multi" disabled>\n                            <span class="mdl-radio__label">Multi</span>\n                          </label>\n                        </div>\n                      </li> --\x3e\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Skip Profiles Created => (Year)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="skip_profiles_created_after_year" value=2023 placeholder="2023">\n                            <label class="mdl-textfield__label" for="skip_profiles_created_after_year"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 58px;">  \n                        <div class="w100">\n                          <button id="btn_test_url" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect w100"\n                            height: 44px;">\n                            TEST THIS LISTING\n                          </button>\n                        </div>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="display: none; padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Streak\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="5" id="streak" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="streak"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Then Timeout\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="15" id="streaktimeout" placeholder="0">\n                            <label class="mdl-textfield__label" for="streaktimeout"></label>\n                          </span>\n                        </span>\n                      </li>\n                    \x3c!--  \n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Archive After Sending\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-deleteaftersend">\n                            <input type="checkbox" id="switch-deleteaftersend" class="mdl-switch__input" checked />\n                          </label>\n                        </span>\n                      </li> --\x3e\n                      \x3c!-- <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        ">\n                        <div class="buttons_container">\n                          <button id="purge_listings" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                            Purge Listings\n                          </button>\n                          <button id="purge_owners" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                            Purge Owners\n                          </button>\n                          <button id="archive_all_threads" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                            Archive All Threads\n                          </button>\n                        </div>\n                      </li> --\x3e\n                    </ul>\n                    <div id="status" style="color: white;background: black;line-height: 26px;padding: 5px 0px;position: absolute;bottom: 137px;width: 100%;text-align: center;min-height: 61px;align-items: center;display: flex;justify-content: center; z-index: 1">\n                        <span id="statustext" style="\n                    "></span></div>\n                    \n\n\n                    <div id="stats" style="color: white;background: rgb(63,81,181);line-height: 26px;padding: 5px 0px;position: absolute;bottom: 49px;width: 100%;text-align: center;">\n                    <span>Today\'s Stats </span>\n                    <div style="\n                      display: flex;\n                      justify-content: space-evenly;\n                    ">\n                      <span><span id="stat_scraped">0</span> scraped </span>\n                      <span><span id="stat_new_listings">0</span> new </span>\n                      \x3c!-- <span><span id="stat_single_listings">0</span> single</span>\n                      <span><span id="stat_multi_listings">0</span> multi</span> --\x3e\n                      <span><span id="stat_skipped">0</span> skipped</span>\n                    </div>\n                    <div style="\n                      display: flex;\n                      justify-content: space-evenly;\n                    ">\n                      <span><span id="stat_offers">0</span> messaged</span>\n                      <span><span id="stat_runs">0</span> runs </span>\n                      <span><span id="stat_streaks">0</span> streak</span>\n                      <span><span id="stat_ko">0</span> KO</span>\n                    </div>\n                  </div>\n\n\n\n                    <div class="footer" style="\n                      justify-content: space-around;\n                      display: flex;\n                      position: absolute;\n                      bottom: 5px;\n                      width: 100%; align-items: center;\n                      border-top: solid 1px;\n                      border-top-color: #e0e0e0;\n                      height: 44px;\n                      padding-right: 10px;\n                      ">\n                      <span>Run From</span>\n                      <input id="runfrom" type="time" style="width: unset;font-size: 16px;font-family: Lato,&quot;Helvetica Neue&quot;,Arial,sans-serif;font-weight: 400;" class="mdl-textfield__input" value="09:00">\n                      <span>Until</span>\n                      <input id="rununtil" type="time" style="width: unset;font-size: 16px;font-family: Lato,&quot;Helvetica Neue&quot;,Arial,sans-serif;font-weight: 400;" class="mdl-textfield__input" value="18:00">\n                      <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-rununtil">\n                        <input type="checkbox" id="switch-rununtil" class="mdl-switch__input">\n                        <span class="mdl-switch__label"></span>\n                      </label>\n                    </div>\n                  </div>\n\n                  <div id="page3" class="mdl-tabs__panel" style="\n                    height: calc(100% - 105px);\n                    overflow: hidden auto;\n                    position: relative;\n                    display: none;">\n                    <div id="page2loading" class="mdl-spinner mdl-js-spinner is-active" style="position: absolute;left: 50%;top: 30%; display:none;"></div>\n                    <ul class="demo-list-control mdl-list">\n                      <li class="mdl-list__item h150" >  \n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_1" ></textarea>\n                            <label class="mdl-textfield__label" for="message_1">Message 1</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_2" ></textarea>\n                            <label class="mdl-textfield__label" for="message_2">Message 2</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_3" ></textarea>\n                            <label class="mdl-textfield__label" for="message_3">Message 3</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150" >  \n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="followup_1" ></textarea>\n                            <label class="mdl-textfield__label" for="followup_1">Follow-up 1</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="followup_2" ></textarea>\n                            <label class="mdl-textfield__label" for="followup_2">Follow-up 2</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="followup_3" ></textarea>\n                            <label class="mdl-textfield__label" for="followup_3">Follow-up 3</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150" >  \n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="messageonreply_1" ></textarea>\n                            <label class="mdl-textfield__label" for="messageonreply_1">Message-On-Reply 1</label>\n                          </div>\n                        </span>\n                      </li>\n                      \x3c!-- <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="listing_price" ></textarea>\n                            <label class="mdl-textfield__label" for="lowball_message">Lowball</label>\n                          </div>\n                        </span>\n                      </li> --\x3e\n                    \x3c!--  <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_4" ></textarea>\n                            <label class="mdl-textfield__label" for="message_4">Message 4</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item h150">\n                        <span class="mdl-list__item-primary-content">\n                          <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <textarea class="mdl-textfield__input" type="text" rows="5" id="message_5" ></textarea>\n                            <label class="mdl-textfield__label" for="message_5">Message 5</label>\n                          </div>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item" style="height: 60px; display: none;">\n                        <span class="mdl-list__item-primary-content">\n                          <span class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                            <input class="mdl-textfield__input" type="text" id="partnermessage">\n                            <label class="mdl-textfield__label" for="partnermessage">Partner Message</label>\n                          </span>\n                        </span>\n                      </li> --\x3e\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Price Delta\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 71px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="text" id="listing_price_delta" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="listing_price_delta"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content">\n                          Rounding\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 90px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="roundupdown" placeholder="0" style="text-align: left;">\n                            <label class="mdl-textfield__label" for="roundupdown"></label>\n                          </span>\n                        </span>\n                      </li>\n                    </ul>\n                    <div class="variables" style="padding-bottom: 10px; position: absolute;\n                    bottom: 55px;\n                    padding: 0px 16px;">\n                        <span style="display: block;">Available Variables:</span>\n                        <span class="variable">[name]</span>\n                        \x3c!-- <span class="variable">[model]</span>\n                        <span class="variable">[network]</span>\n                        <span class="variable">[memory]</span>\n                        <span class="variable">[price]</span> --\x3e\n                        <span class="variable">[price]</span>\n                        <span class="variable">[title]</span>\n                        \x3c!-- <span class="variable">[deductions]</span>\n                        <span class="variable">[condition]</span> --\x3e\n                        \x3c!-- <span class="variable">[quote_link]</span>\n                        <span class="variable">[pickup_link]</span> \n                        <span class="variable">[partner_link]</span> \n                        <span class="variable">[website]</span> --\x3e\n                    </div>\n                    <div class="template-actions" style="\n                      justify-content: space-between;\n                      display: flex;\n                      position: absolute;\n                      bottom: 0px;\n                      width: 100%;\n                    ">\n                      <button id="test_template" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect"\n                        style="width: 50%;\n                        margin-right: 1px;\n                        height: 44px;">\n                        Test\n                      </button>\n                      <button id="restore_defaults" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect"\n                        style="width: 50%;\n                        height: 44px;">\n                        Restore Defaults\n                      </button>\n                    </div>\n                  </div>\n                  <div id="page4" class="mdl-tabs__panel" style="\n                    height: 100%;\n                    overflow: hidden auto;\n                    position: relative;\n                    display: none;\n                    ">\n                    <div id="page2loading" class="mdl-spinner mdl-js-spinner is-active" style="position: absolute;left: 50%;top: 30%; display:none;"></div>\n                    <ul class="demo-list-control mdl-list">\n                      <li id="row_eject_subscriptionid" class="mdl-list__item taseparator" style="height: 49px; display: none;">\n                        <div class="buttons_container_container w100" style="margin-bottom: 14px;">\n                          <div class="buttons_container space-between">\n                            <button id="btn_eject_subscription" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Eject Subscription ID\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                      <li id="row_verify_subscriptionid" class="mdl-list__item taseparator" style="height: 49px; display: none;">\n                        <div class="buttons_container_container w100" style="margin-bottom: 14px;">\n                          <div class="buttons_container space-between">\n                            <button id="row_verify_subscriptionid" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Verify Subscription ID\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                      <li id="row_soldphones" class="mdl-list__item taseparator" style="padding-top: unset !important; padding-bottom: unset !important; height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="text-align: center; line-height: 2px; height: 25px;">\n                          Phones sold in the last 30 days: <span id="phones_sold_last_30_days" style="margin-left: 9px;font-weight: 500;">X</span>\n                        </span>\n                      </li>\n                      <li id="row_licenseKeyAddBuy" class="mdl-list__item taseparator" style="padding-top: unset !important; padding-bottom: unset !important; height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="text-align: center; line-height: 2px; height: 25px;">\n                          License Key:\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <button id="btn_add_license_key" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored">\n                            ADD\n                          </button>\n                          <button id="buy_license_key" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored">\n                            BUY\n                          </button>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Owner Message Expiry\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="owner_message_expiry" placeholder="days" value="14" min="7">\n                            <label class="mdl-textfield__label" for="owner_message_expiry"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Archive After Sending\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-deleteaftersend">\n                            <input type="checkbox" id="switch-deleteaftersend" class="mdl-switch__input" checked />\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Follow Up After (mins)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" id="followup_after" placeholder="minutes" value="20">\n                            <label class="mdl-textfield__label" for="followup_after"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600;">\n                          Timeouts\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Between API Calls (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="5" id="timeout_api_calls_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_api_calls_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="80" id="timeout_api_calls_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_api_calls_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Between Messages (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="5" id="timeout_between_messages_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_between_messages_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="300" id="timeout_between_messages_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_between_messages_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          After Listings Messaged (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="timeout_listings_messaged_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_listings_messaged_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="15" id="timeout_listings_messaged_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_listings_messaged_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          After Streak (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="1" id="timeout_streak_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_streak_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="30" id="timeout_streak_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_streak_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          End of Run (secs) Min\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="30" id="timeout_end_of_run_min" placeholder="0" style="text-align: unset;">\n                            <label class="mdl-textfield__label" for="timeout_end_of_run_min"></label>\n                          </span>\n                        </span>\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Max\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 30px">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="300" id="timeout_end_of_run_max" placeholder="0">\n                            <label class="mdl-textfield__label" for="timeout_end_of_run_max"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall">\n                          Stop Messaging After (# of messages)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input disabled class="mdl-textfield__input" type="number" id="stop_messaging_after" placeholder="0" value="0">\n                            <label class="mdl-textfield__label" for="stop_messaging_after"></label>\n                          </span>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                            padding-bottom: unset !important;\n                            height: 43px;">\n                        <span class="mdl-list__item-primary-content fsmall" style="width: 145px;">\n                          Webhook API Key\n                        </span>\n                        <span class="mdl-list__item-secondary-action" style="display: flex; align-items: center; gap: 8px; position: relative;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input readonly class="mdl-textfield__input" type="password" id="webhook_api_key" style="font-size: small;">\n                            <label class="mdl-textfield__label" for="webhook_api_key"></label>\n                          </span>\n                          <i class="material-icons" id="toggleWebhookApiKeyVisibility" style="cursor: pointer;">visibility</i>\n                          <i class="material-icons" id="copyWebhookApiKey" style="cursor: pointer;">content_copy</i>\n                          <i class="material-icons" id="resetWebhookApiKey" style="cursor: pointer;">refresh</i>\n                        </span>\n                      </li>\n\n                      \x3c!-- Toast Notification --\x3e\n                      <div id="toast" class="toast">Copied!</div>\n\n                      \n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600; margin-left: 36px;">\n                          OpenAI\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-enablegpt">\n                            <input type="checkbox" id="switch-enablegpt" class="mdl-switch__input" />\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="display: flex; flex-direction: column;">\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 100%">\n                          <span class="mdl-textfield mdl-js-textfield openai_init" id="container_openai_apikey">\n                            <input class="mdl-textfield__input" value="" id="openai_apikey" placeholder="API KEY" style="text-align: center; border-bottom: 1px solid; height: 31px;">\n                            <label class="mdl-textfield__label" for="openai_apikey"></label>\n                          </span>\n                        </span>\n                        <div class="openai_ready mdl-textfield mdl-js-textfield mdl-textfield--floating-label getmdl-select">\n                          <input type="text" value="" class="mdl-textfield__input" id="assistant_id" style="text-align: center;" readonly>\n                          <input type="hidden" value="" name="assistant_id">\n                          <label for="assistant_id" class="mdl-textfield__label">Assistant ID</label>\n                          <ul for="assistant_id" class="mdl-menu mdl-menu--bottom-left mdl-js-menu">\n                              \x3c!-- <li class="mdl-menu__item" data-val="DEU">Germany</li>\n                              <li class="mdl-menu__item" data-val="BLR">Belarus</li>\n                              <li class="mdl-menu__item" data-val="RUS">Russia</li> --\x3e\n                          </ul>\n                        </div>\n                        <li class="openai_readyflex w100 mdl-list__item taseparator" style="padding-top: unset !important;\n                          padding-bottom: unset !important;\n                          height: 43px;">\n                          <span class="mdl-list__item-primary-content">\n                            Images\n                          </span>\n                          <span class="mdl-list__item-secondary-action tawsmall">\n                            <span class="mdl-textfield mdl-js-textfield">\n                              <input class="mdl-textfield__input" type="number" id="num_images" value="3">\n                              <label class="mdl-textfield__label" for="num_images"></label>\n                            </span>\n                          </span>\n                        </li>\n                        <li class="openai_readyflex w100 mdl-list__item taseparator" style="padding-top: unset !important;\n                          padding-bottom: unset !important;\n                          height: 43px;">\n                          <span class="mdl-list__item-primary-content">\n                            Detail\n                          </span>\n                          <span class="mdl-list__item-secondary-action">\n                            <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="high">\n                              <input checked class="mdl-radio__button" id="high" name="image_detail" type="radio"\n                              value="high">\n                              <span class="mdl-radio__label">High</span>\n                            </label>\n                            <label class="mdl-radio mdl-js-radio mdl-js-ripple-effect" for="low">\n                              <input class="mdl-radio__button" id="low" name="image_detail" type="radio" value="low">\n                              <span class="mdl-radio__label">Low</span>\n                            </label>\n                          </span>\n                        </li>\n                        <div class="buttons_container_container w100">\n                          <div class="buttons_container space-between">\n                            <button id="btn_set_openai_apikey" class="openai_init mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Set Key\n                            </button>\n                            <button id="btn_openai_test" class="openai_ready mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Test\n                            </button>\n                            <button id="btn_copylisting_details" class="openai_ready mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                              Copy Listing Details\n                            </button>\n                            <button id="btn_eject_openai_apikey" class="openai_ready mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect" style="display: none;">\n                              Eject Key\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important; height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600;">\n                          Archive Threads\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="margin-right: -54px;">\n                          Archive \n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall" style="width: 71px;margin-right: -20px;">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="60" id="amount_to_archive" placeholder="# threads" style="text-align: center;">\n                            <label class="mdl-textfield__label" for="amount_to_archive"></label>\n                          </span>\n                        </span>\n                         <span class="mdl-list__item-primary-content" style="margin-left: 29px;margin-right: -53px;">\n                          Older Than (days)\n                        </span>\n                        <span class="mdl-list__item-secondary-action tawsmall">\n                          <span class="mdl-textfield mdl-js-textfield">\n                            <input class="mdl-textfield__input" type="number" value="7" id="archiveolderthan" placeholder="days">\n                            <label class="mdl-textfield__label" for="archiveolderthan"></label>\n                          </span>\n                        </span>\n                      </li>\n                       <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content">\n                          Skip Unread\n                        </span>\n                        <span class="mdl-list__item-secondary-action">\n                          <label class="mdl-switch mdl-js-switch mdl-js-ripple-effect" for="switch-skipunread">\n                            <input type="checkbox" id="switch-skipunread" class="mdl-switch__input" checked />\n                          </label>\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        ">\n                        <div class="buttons_container_container w100">\n                          <div class="buttons_container space-between mb20">\n                            <button id="archive_all_threads" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                              Archive All Threads\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                      <li id="sync_remote_container" class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px; display: flex; justify-content: center;">\n                        <button id="sync_list_to_remote" class="mdl-button mdl-js-button mdl-button--raised mdl-button--colored mdl-js-ripple-effect">\n                          Sync local list to remote\n                        </button>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        height: 43px;">\n                        <span class="mdl-list__item-primary-content" style="justify-content: center; font-weight: 600;">\n                          Purge Lists\n                        </span>\n                      </li>\n                      <li class="mdl-list__item taseparator" style="padding-top: unset !important;\n                        padding-bottom: unset !important;\n                        ">\n                        <div class="buttons_container_container w100">\n                          <div class="buttons_container space-between">\n                            <button id="purge_listings" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                              Purge Listings\n                            </button>\n                            <button id="download_listings" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgblue">\n                              Download Listings\n                            </button>\n                          </div>\n                          <div class="buttons_container space-between">\n                            <button id="purge_owners" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgred">\n                              Purge Owners\n                            </button>\n                            <button id="download_owners" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent bgblue">\n                              Download Owners\n                            </button>\n                          </div>\n                        </div>\n                      </li>\n                    </ul>\n                </div>\n\n                \n                <dialog id="dialog-bug" class="mdl-dialog">\n                  <h4 class="mdl-dialog__title">Bug Report</h4>\n                  <div class="mdl-dialog__content">\n                    <div id="buglistingdetails">\n                    </div>\n                    <div>\n                        <br>\n                        <p>Based on the info above. The bot determined that the phone variant is:</p>\n                        <div id="bugvariantdetails">\n                        </div>\n                      </div>\n                    <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">\n                      <textarea class="mdl-textfield__input" type="text" rows= "3" id="bugcomment" ></textarea>\n                      <label class="mdl-textfield__label" for="bugcomment">Bug Details</label>\n                    </div>\n                  </div>\n                  <div class="mdl-dialog__actions">\n                    <button type="button" class="mdl-button sendbug">Submit</button>\n                    <button type="button" class="mdl-button close">Close</button>\n                  </div>\n                </dialog>\n              </div>')}n.r(t),n.d(t,{insertUI:()=>i})},5779:(e,t,n)=>{"use strict";function i(){return new Promise((e=>{const t=new BroadcastChannel("ht_tab_monitor");t.onmessage=n=>{const i=n.data;if(i&&i.message){if("isinjected"===i.message)return t.postMessage({message:"reply-injected"});if("reply-injected"===i.message)return e(!0)}},t.postMessage({message:"isinjected"}),setTimeout((()=>{e(!1)}),1e3)}))}n.r(t),n.d(t,{isInjectedToOtherTab:()=>i})},5489:(e,t,n)=>{"use strict";n.r(t),n.d(t,{loadInputs:()=>l});var i=n(1334),s=n(4423),r=n(8252);function o(e){return new Promise((t=>{!function n(){if(e.parentNode.MaterialRadio||e.parentNode.MaterialSwitch)return t(e);setTimeout(n,30)}()}))}var a=n(8277);async function l(){let e=!1;const t=await(0,i.chromeStorageListKeys)();for(const n of t)if(n.startsWith("input_")){const t=n.replace("input_",""),o=await(0,i.chromeStorageGet)(n),a=document.getElementById(t);a&&("checkbox"===a.type?"switch-rununtil"===t?((0,s.o)(!0),e=!0,a.checked=!!o):a.checked=!!o:(a.value=o,(0,r.b)(a)))}else if(n.startsWith("radio_")){const e=n.replace("radio_",""),t=await(0,i.chromeStorageGet)(n);let s=document.getElementsByName(e);if("run-mode"===e&&"mode-webhook"===t&&(0,a.D)("webhook"),s&&(s=s[0],s&&((0,r.b)(s),"radio"===s.type))){const e=document.getElementById(t);e&&o(e).then((()=>{e.parentNode.MaterialRadio.check()}))}}e||(0,s.o)(!0)}},4118:(e,t,n)=>{"use strict";async function i(){"undefined"!=typeof getmdlSelect&&getmdlSelect.init?getmdlSelect.init(".getmdl-select"):console.warn("getmdlSelect is not defined or its init method is unavailable.")}n.r(t),n.d(t,{initMdl:()=>i})},9485:(e,t,n)=>{"use strict";n.d(t,{E:()=>s,g:()=>r});var i=n(9868);function s(){const e=document.querySelector("#pt-draggable-icon");e&&(e.style.display="none");const t=document.querySelector("#ta");t&&(t.style.display="block")}function r(){(0,i.j)();const e=document.querySelector("#pt-draggable-icon");e&&(e.style.display="flex");const t=document.querySelector("#ta");t&&(t.style.display="none")}},1585:(e,t,n)=>{"use strict";n.r(t),n.d(t,{login_callback:()=>nn,onSessionReady:()=>en,showSubscription:()=>sn,updateLoggedInUI:()=>tn});var i=n(1334),s=n(1203),r=n(5703),o=n(1023),a=n(8104),l=n(1311);async function c(){(async function(){try{const e=(0,a.ad)(),t=await(0,l.getInstanceId)();if(!t)throw new Error("Instance ID is undefined");const n=(0,a.JU)(e,"settings",window.userGmail,"instances",t),i=await(0,a.QT)(n);if(!i.exists())return;return i.data()?.subscription_owner??void 0}catch(e){return void console.error("Error checking instance ownership:",e)}})().then((e=>{e?(document.getElementById("row_eject_subscriptionid").style.display="flex",document.getElementById("row_verify_subscriptionid").style.display="none"):(document.getElementById("row_verify_subscriptionid").style.display="flex",document.getElementById("row_eject_subscriptionid").style.display="none")}))}async function u({subscription_id:e,auth_key:t}){if((0,o.Q)(!0),"string"!=typeof e&&(e=""),!window.userGmail)return console.error("User is not logged in to Phones.Trade"),void alert("You need to be logged in to Phones.Trade to use snatchbot");const n=(0,r.W)();if(!e&&!t)return void alert("You need to provide a subscription_id or auth_key");if(!window.userGmail)return void alert("You need to be logged in to use snatchbot");if(!n)return void alert("You need to be logged in to facebook to use snatchbot");const a={email:window.userGmail,facebookUid:n,...e&&{subscriptionId:e},...t&&{auth_key:t}};let u={};try{if(u=await async function({subscriptionId:e,auth_key:t,email:n,facebookUid:i}){const r=await(0,l.getInstanceId)();return fetch(`https://us-central1-snatchbots-8ff7b.cloudfunctions.net/subscription?instanceId=${r}&locationId=${s.losenolead_locationid}&app=facebook&email=${n}&accountUid=${i}${t?`&auth_key=${t}`:""}${e?`&subscriptionId=${e}`:""}`).then((e=>e.json())).catch((e=>(console.error("Failed to check subscription id",e),{})))}(a),!u)return console.error("No response from API while checking subscription ID."),void alert("Failed to verify subscription. Please try again.")}catch(e){return console.error("Error while checking subscription ID:",e),void alert("An error occurred while verifying your subscription. Please try again later.")}return(0,o.Q)(!1),u.error?(t&&await(0,i.chromeStorageSet)("auth_key",""),console.error("API returned an error:",u.error),void alert(u.error)):u&&"active"===u.status?(window.issnatchbot=!0,(0,i.chromeStorageSet)("auth_key",u.auth_key),async function(){tn(),window.licenseMode="ACTIVE",sn(window.$role,window.$teamDomain,window.$phonesSold,!0),unsafeWindow.$isStoreOrRegular||(document.getElementById("row_soldphones").style.display="none"),document.getElementById("row_licenseKeyAddBuy").style.display="none",c()}(),!0):(document.getElementById("row_eject_subscriptionid").style.display="none",u&&"canceled"===u.status?(d({clear:!0}),void alert("This subscription is already cancelled")):"paused"===u?.status||"past_due"===u?.status?(d({clear:!0}),void alert("This subscription is "+u.status)):(u.status&&alert(u.status),void(u.error&&alert(u.error))))}async function d({clear:e=!1}={}){const t=await(0,i.chromeStorageGet)("auth_key");if(t){if(!window.userGmail)return console.error("User is not logged in to Phones.Trade"),void alert("You need to be logged in to Phones.Trade to use snatchbot");try{const n=await async function({auth_key:e,email:t}){const n=await(0,l.getInstanceId)();return fetch(`https://us-central1-snatchbots-8ff7b.cloudfunctions.net/subscription?eject_subscription=1&email=${t}&auth_key=${e}&instanceId=${n}`).then((e=>e.json())).catch((e=>(console.error("Failed to check subscription id",e),{})))}({auth_key:t,email:window.userGmail});if(n?.error)return console.error("Failed to eject subscription:",n.error),alert("Failed to eject subscription: "+n.error),n;e&&await(0,i.chromeStorageSet)("auth_key","")}catch(e){console.error("Failed to release subscription:",e)}}}async function h(){try{const e=await(0,i.chromeStorageGet)("auth_key"),t=(0,r.W)();if(!e)return void console.warn("No subscription ID found in storage.");if(!window.userGmail)return console.error("User is not logged in to Phones.Trade."),void alert("You need to be logged in to Phones.Trade to use snatchbot.");if(!t)return console.error("Facebook user ID is not available."),void alert("You need to be logged in to Facebook to use snatchbot.");const n=await async function({auth_key:e,email:t,facebookUid:n}){const i=await(0,l.getInstanceId)();return fetch(`https://us-central1-snatchbots-8ff7b.cloudfunctions.net/subscription?disable_active_status=1&instanceId=${i}&locationId=${s.losenolead_locationid}&app=facebook&email=${t}&accountUid=${n}&auth_key=${e}`).then((e=>e.json())).catch((e=>(console.error("Failed to check subscription id",e),{})))}({auth_key:e,email:window.userGmail,facebookUid:t});n.error?console.error("Failed to disable active status:",n.error):console.log("Active status disabled successfully.")}catch(e){console.error("An error occurred while disabling active status:",e)}}var m=n(3253);var p=n(9485),f=n(4484),g=n(6186),_=n(4423),y=n(3539);async function w(e){const t=e&&e.getNext;let n=document.getElementById("coordinates").value;if(!n)return;if(!String(n).includes(","))return;const s=n.split("\n").map((e=>e.replace(/\s/g,""))).filter((e=>e.length));let r=await(0,i.chromeStorageGet)("lastCoordIdx");r||0===r?t&&(r=parseInt(r,10)+1):r=0;let o=!1;r>=s.length&&(r=0,o=!0),await(0,i.chromeStorageSet)("lastCoordIdx",r);let a=s[r].split(","),l=a[0],c=a[1];return l&&c&&(l=parseFloat(l),c=parseFloat(c),l&&c)?{lat:l,lon:c,isEnd:o}:void 0}async function v(){let e=await(0,i.chromeStorageGet)("lastKwIdx");e=e||0===e?parseInt(e,10)+1:0;let t=document.querySelector("#ta #keywords").value,n=document.querySelector("#ta #searchwithfilters").value;if(!t.trim()&&!n.trim())return console.error("No keywords found."),alert("No keywords found."),{error:"no keyword found"};t=t.split(/[\n,]+/).map((e=>e.trim())),n&&(n=n.split("\n").map((e=>e.trim())),t=t.concat(n));let s,r=!1;return e>=t.length&&(e=0,s=await w({getNext:!0})),n&&(r=n.includes(t[e])),s=await w({getNext:!1}),await(0,i.chromeStorageSet)("lastKwIdx",e),String(t[e]).trim().length?{keyword:t[e],coordinates:s,isSearchWithFilter:r}:v()}function b(e){return e?String(e).split("?")[0].trim():e}async function S(){let e=await(0,i.chromeStorageGet)("tsSpamDetected");if(e){e=parseInt(e,10);const t=(new Date).getTime();if(t<e)return e-t}return!1}var E=n(5272);async function I(e){if(!e)return void console.error("Failed to load stats. No fbuid");const t=(0,a.ad)(window.app),n=(0,E.L)(),i=(0,a.JU)(t,"statistics",e,"dates",n);window.unsubscribeLoadStats&&window.unsubscribeLoadStats(),window.unsubscribeLoadStats=(0,a.cf)(i,(e=>{const t=e.data(),n=["offers","partners","runs","streaks","ko","scraped","new_listings","single_listings","multi_listings","skipped"];e.exists()?n.forEach((e=>{if(e in t){const n=document.getElementById(`stat_${e}`);n&&(n.textContent=t[e])}})):n.forEach((e=>{const t=document.getElementById(`stat_${e}`);t&&(t.textContent=0)}))}))}var k=n(8521);async function x(e,t,n,i,s){if(n){const r=n.filter((e=>e.id)).map((e=>e.id));if(s){const e=r.indexOf(s);e>-1&&r.splice(e,1)}return(0,y.CONSOLE_MESSAGE)("custom",`Adding ${r.length} listings of ${t} (${e}) to skip list.`),(0,k.skips)().saveToSkipListingBatch(r,i,"NA")}}var T=n(13),C=n(7367);function A(e){let t=document.querySelector("#ta #title_must_include").value;const n=e.title;if(!n)return!1;t=t.trim().replace(/,+$/,"");let i=t.split(",").map((e=>e.trim())).join("|");i.startsWith("|")&&(i=i.substring(1)),i.endsWith("|")&&(i=i.substring(0,i.length-1));const s=new RegExp(i,"i");return!!n.match(s)}var O=n(6901),N=n(1060);async function L(e,t,n,i,s,r,o){(0,y.CONSOLE_MESSAGE)("custom",`Checking qualifying listings of ${n} (${t}).`,s);let a=0;if(!document.querySelector("#ta #ownerlisting_kw_match").value)return(0,y.CONSOLE_MESSAGE)("custom","No keyword to match title. Skipping range check.",s),!0;Array.isArray(r)&&r.length>0&&(a=(await async function(e){const t=await async function(){let e=document.querySelector("#ta #ownerlisting_kw_match").value;return e?(e=e.trim().replace(/,+$/,""),e=e.split(",").map((e=>e.trim())),e):(console.error("No keywords found."),{error:"no keyword found"})}();if(!t||!t.length)return e;const n=[];for(const i of e)for(const e of t)i.title.toLowerCase().includes(e.toLowerCase())&&n.push(i);return n}(r)).length),(0,y.CONSOLE_MESSAGE)("custom",`Found ${a} listings of ${n} (${t}) that matches a kw.`,s);const l=document.getElementById("owner_min_lists").value,c=document.getElementById("owner_max_lists").value;return l&&a<l?((0,y.CONSOLE_MESSAGE)("custom",`Owner ${n} has < min required listings. Skipping.`,s),o||(await(0,k.skips)().saveToSkipListing(e,`Owner Keyword Listings: ${a} < min: ${l}`),await(0,k.skips)().saveToSkipUsers(t,`Owner Keyword Listings: ${a} < min: ${l}`)),console.log(`Owner Listings (${a}) < min(${l}): Fail`),!1):c&&a>c?((0,y.CONSOLE_MESSAGE)("custom",`Owner ${n} has > max required listings. Skipping.`,s),o||(await(0,k.skips)().saveToSkipListing(e,`Owner Keyword Listings: ${a} > max: ${c}`),await(0,k.skips)().saveToSkipUsers(t,`Owner Keyword Listings: ${a} > max: ${c}`)),console.log(`Owner Listings (${a}) > max(${c}): Fail`),!1):(console.log(`Owner Listings min(${l}) <= (${a}) < max(${c}): Pass`),!0)}function D(e,t){return e=Number(e),t=Number(t),Math.floor(Math.random()*(t-e+1)+e)}const R=[{graphqlName:"bathrooms",maxDefault:120,maxParam:"maxBathrooms",minDefault:0,minParam:"minBathrooms"},{graphqlName:"area_size",maxParam:"maxAreaSize",minParam:"minAreaSize"},{graphqlName:"bedrooms",maxDefault:120,maxParam:"maxBedrooms",minDefault:0,minParam:"minBedrooms"},{graphqlName:"rooms",maxDefault:120,maxParam:"maxRooms",minDefault:0,minParam:"minRooms"},{graphqlName:"odometer",maxParam:"maxMileage",minParam:"minMileage"},{graphqlName:"year",maxParam:"maxYear",minParam:"minYear"}],M={catFriendly:{graphqlName:"cat_friendly"},dogFriendly:{graphqlName:"dog_friendly"},isC2CListingOnly:{graphqlName:"is_c2c_listing_only"},isFurnished:{graphqlName:"is_furnished"},minMPG:{graphqlName:"min_mpg"},minSafetyRating:{graphqlName:"min_safety_rating"},minSeatingCapacity:{graphqlName:"min_seating_capacity"},sellerType:{graphqlName:"is_dealership_owned",transform:function(e){return"dealership"===e?1:0}},transmissionType:{graphqlName:"is_manual_transmission",transform:function(e){return"manual"===e?1:0}}},P={carfaxHistory:{graphqlName:"carfax_history"},carType:{graphqlName:"vehicle_type"},conditions:{graphqlName:"condition"},constructionStatus:{graphqlName:"construction_status"},dealerBranch:{graphqlName:"dealer_branch"},make:{graphqlName:"canonical_make_id"},model:{graphqlName:"canonical_model_id"},pivots:{graphqlName:"commerce_search_and_rp_fb_product_category_id"},privateRoomBathroomType:{graphqlName:"private_room_bathroom_type"},propertyType:{graphqlName:"property_type"},rentalRoomType:{graphqlName:"rental_room_type"},saleType:{graphqlName:"sale_type"},topLevelVehicleType:{graphqlName:"vehicle_type"},vehicleExteriorColors:{graphqlName:"exterior_colors"},vehicleInteriorColors:{graphqlName:"interior_colors"}},U={BEST_MATCH:null,CREATION_TIME_ASCEND:{sort_by_filter:"CREATION_TIME",sort_order:"ASCEND"},CREATION_TIME_DESCEND:{sort_by_filter:"CREATION_TIME",sort_order:"DESCEND"},DISTANCE_ASCEND:{sort_by_filter:"DISTANCE",sort_order:"ASCEND"},DISTANCE_DESCEND:{sort_by_filter:"DISTANCE",sort_order:"DESCEND"},PRICE_ASCEND:{sort_by_filter:"PRICE_AMOUNT",sort_order:"ASCEND"},PRICE_DESCEND:{sort_by_filter:"PRICE_AMOUNT",sort_order:"DESCEND"},VEHICLE_YEAR_ASCEND:{sort_by_filter:"VEHICLE_YEAR",sort_order:"ASCEND"},VEHICLE_YEAR_DESCEND:{sort_by_filter:"VEHICLE_YEAR",sort_order:"DESCEND"},VEHICLE_MILEAGE_ASCEND:{sort_by_filter:"VEHICLE_MILEAGE",sort_order:"ASCEND"},VEHICLE_MILEAGE_DESCEND:{sort_by_filter:"VEHICLE_MILEAGE",sort_order:"DESCEND"}};var F=n(8252);function q(){const{validParameters:e,unhandledParams:t,priceRange:n}=j(window.location.search);console.log("validParameters",e);const i=function(){let e=window.location.href;e=e.replace(/marketplace\/\d+/,"marketplace/category");let t=e.match(/(category\/.+)\?/);return t&&t.length>1?t[1]:(t=e.match(/(category\/.+)\??/),t&&t.length>1?t[1]:(t=e.match(/\/marketplace\/(.+?\/search)\??/),t&&t.length>1?t[1]:""))}();if(!i)return console.error("Failed to get category.",i),void alert("Failed to get category name. make sure you are in a category page. i.e., facbook.com/marketplace/category/<name>");const s=document.getElementById("searchwithfilters");let r=s.value,o=i+"?"+e.join("&");var a,l;"?"===o&&(o=""),r&&(r+="\n"),o&&(r+=o),s.value=r.trim(),(0,F.b)(s),a=document.getElementById("searchwithfilters"),l=new Event("change",{bubbles:!0,cancelable:!0}),a.dispatchEvent(l),t.length&&((0,f._apiSendBug)({message:"Unhandled url parameters were found",unhandledParams:t.join(",")}),console.log(`Parameters ${t.join(", ")} are not supported, we have been notified`))}function j(e){const t=function(e){const t="string"==typeof e?e:window.location.search,n=new URLSearchParams(t),i={};return n.forEach(((e,t)=>{i[t]=e})),i}(e),n=[],i={},s=[],r=[],o=[],a=[];let l="",c="",u="",d="";const h=["exact"];for(const e in t){const m=R.find((t=>t.minParam===e||t.maxParam===e));if(m){i[m.graphqlName]||(i[m.graphqlName]={});let s=e.startsWith("min")?"min":"";s||(s=e.startsWith("max")?"max":"");let r=t[e];isNaN(r)||(r=Number(r)),s&&(n.push(`${e}=${t[e]}`),i[m.graphqlName][s]=r);continue}const p=P[e];if(p){n.push(`${e}=${t[e]}`),s.push({name:p.graphqlName,value:t[e]});continue}const f=M[e];if(f)n.push(`${e}=${t[e]}`),r.push({name:f.graphqlName,value:f.transform?f.transform(t[e]):t[e]});else if("minPrice"!==e)if("maxPrice"!==e)if("sortBy"!==e)if("deliveryMethod"!==e)if("itemCondition"!==e)if("query"!==e)h.includes(e)||a.push(e);else{const i=t[e];n.push(`${e}=${i}`),d=i}else{const i=String(t[e]).toLowerCase();n.push(`${e}=${i}`),u=i}else{const i=String(t[e]).toLowerCase();n.push(`${e}=${i}`),c=i}else{let i=String(t[e]).toUpperCase(),s=U[i];s&&(l=s),n.push(`${e}=${t[e]}`)}else n.push(`${e}=${t[e]}`),o[1]=t[e];else n.push(`${e}=${t[e]}`),o[0]=t[e]}const m=[];for(const e in i){let t=i[e].min,n=i[e].max;t&&!n&&(i[e].max=2147483647),n&&!t&&(i[e].min=0),m.push({name:e,min:t||0,max:n||2147483647})}return{validParameters:n,numericVerticalFields:r,numericVerticalFieldsBetween:m,stringVerticalFields:s,filterSortingParams:l,deliveryMethod:c,priceRange:o,commerce_search_and_rp_condition:u,query:d,unhandledParams:a}}var V=n(5425),G=n(8544);async function B(e){const t=e||new URL(window.location.href).pathname,n=(0,r.W)();window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const i=(0,V.S)();var s="2";const o=(0,G.H)();for(var a=0;a<o.length;a++)s+=o.charCodeAt(a);const l=(0,V.k)();let c=await fetch("https://www.facebook.com/ajax/bulk-route-definitions/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded",pragma:"no-cache",priority:"u=1, i","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not/A)Brand";v="8", "Chromium";v="126", "Google Chrome";v="126"',"sec-ch-ua-full-version-list":'"Not/A)Brand";v="8.0.0.0", "Chromium";v="126.0.6478.116", "Google Chrome";v="126.0.6478.116"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"14.2.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-asbd-id":"129477","x-fb-lsd":"HJHbStuhz9hBrOnKneloOI"},referrer:"https://www.facebook.com/marketplace/category/apparel",referrerPolicy:"strict-origin-when-cross-origin",body:`route_urls[\n      0\n    ]=${encodeURIComponent(t)}&routing_namespace=fb_comet&__aaid=0&__user=${n}&__a=1&__req=${(window.global.reqCounter++).toString(36)}&__hs=19912.HYP%3Acomet_pkg.2.1..2.1&dpr=2&__ccg=GOOD&__rev=${i}&__s=jryowq%3Abq7uyb%3A604en2&__hsi=7389116395254251180&__dyn=7xeu4HwkEng5K8G6EjBAg5S1Dxu13wvoKewSwAyUco38yE2OwpUe8hwaG0Z82_CwjE1xoswMwto2awgo9oO0n24oaEd82lwv89k2C0iK0D8vwRwpHw8W58jwGzE2ZwJK2W5olwuEjxu16wUwxwl8vw4DBwFKq2-azo11E2cwMwrUK2K364UrwFg2Xwr86C0No4WVU-4EdrxG1fy8bUaU&__csr=gEYl4uQN4AAHORPV2bSzkBlTLOuhF9aRWiRRBHXLhvhAA8AWVifUFi4DC_WHpqjjzVoCUF9eUKGIHUC4pVWCjDU88rzaKq5EyuiQUvxO6UigC3W5UgwDwsXgx1-68S0O8mwbW0Du3a08uw6lw9C0uq07dE01lYUG0bLg1F80lDw0Bqw0hS806ui0cPw&__comet_req=15&fb_dtsg=${o}&jazoest=${s}&lsd=${l}&__spin_r=${i}&__spin_b=trunk&__spin_t=1720412726`,method:"POST",mode:"cors",credentials:"include"}).then((e=>e.text()));c=c.replace("for (;;);","");try{c=JSON.parse(c)}catch(e){return console.error("Faild to get category ids for",t),[]}try{return c.payload.payloads[t].result.exports.rootView.props.categoryIDs}catch(e){return console.error(e),alert("Failed to get category IDs"),[]}}var $=n(2287),K=n(6849),W=n(4246),z=n(4418);async function H({keyword:e,lat:t=7.79716,lon:n=122.763,radius:i=65,count:o=24,priceMin:a=0,priceMax:l=2147483647,cursor:c,previousResults:u,categoryIds:d}){"string"==typeof i&&(i=parseInt(i,10));let h=i;if(h>500&&(h=500),h=Math.round(1.60934*(h+2)),d||(d=await B(`/marketplace/category/${e}`)),!d.length)return console.error("Failed to get category id(s) of category",e),[];const m=b(e),p=j(String(e).split("?")[1]);let f=!1,g={sort_by_filter:"CREATION_TIME",sort_order:"DESCEND"};p&&(p.priceRange&&p.priceRange.length&&(void 0!==p.priceRange[0]&&(a=p.priceRange[0]),void 0!==p.priceRange[1]&&(l=p.priceRange[1])),p.filterSortingParams&&(g=p.filterSortingParams,"CREATION_TIME"!==g?.sort_by_filter&&(f=!0)));const _={count:24,cursor:null,buyLocation:{latitude:t,longitude:n},marketplaceBrowseContext:"CATEGORY_FEED",marketplaceID:null,categoryIDArray:d,priceRange:[100*Number(a)||0,100*Number(l)||214748364700],topicPageParams:{location_id:"category",url:m},scale:2,sellerID:null,filterSortingParams:g,savedSearchID:null,savedSearchQuery:null,contextual_data:[],numericVerticalFields:[],numericVerticalFieldsBetween:[],stringVerticalFields:[],params:{bqf:{callsite:"COMMERCE_MKTPLACE_SEO",query:""},browse_request_params:{commerce_enable_local_pickup:!0,commerce_enable_shipping:!0,commerce_search_and_rp_available:!0,commerce_search_and_rp_category_id:d,commerce_search_and_rp_condition:null,commerce_search_and_rp_ctime_days:null,filter_location_latitude:t,filter_location_longitude:n,filter_price_lower_bound:100*Number(a)||0,filter_price_upper_bound:100*Number(l)||214748364700,filter_radius_km:Math.round(h)},custom_request_params:{browse_context:null,contextual_filters:[],referral_code:null,saved_search_strid:null,search_vertical:null,seo_url:m,surface:"TOPIC_PAGE",virtual_contextual_filters:[]}}};c&&(_.cursor=c),_.radius=Math.round(1e3*h),p&&(p.numericVerticalFields&&(_.numericVerticalFields=p.numericVerticalFields),p.numericVerticalFieldsBetween&&(_.numericVerticalFieldsBetween=p.numericVerticalFieldsBetween),p.stringVerticalFields&&(_.stringVerticalFields=p.stringVerticalFields),p.deliveryMethod&&("local_pick_up"===p.deliveryMethod?(_.params.browse_request_params.commerce_enable_shipping=!1,_.params.browse_request_params.commerce_enable_local_pickup=!0):"shipping"===p.deliveryMethod?(_.params.browse_request_params.commerce_enable_shipping=!0,_.params.browse_request_params.commerce_enable_local_pickup=!1):(_.params.browse_request_params.commerce_enable_shipping=!0,_.params.browse_request_params.commerce_enable_local_pickup=!0))),window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const w=(0,r.W)(),v=(0,V.S)();var S="2";const E=(0,G.H)();for(var I=0;I<E.length;I++)S+=E.charCodeAt(I);const k=(0,V.k)(),x={av:w,__aaid:"0",__user:w,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19908.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"EXCELLENT",__rev:v,__s:"g2c6r4:k3mks3:2i7wh9",__hsi:"7387745659394770073",__dyn:"7AzHK4HwBgDx-5Q1hyoyEqxd4Ag5S3G2O5U4e2C3-4UKewSAx-bwNw9G2Saxa0DU6u3y4o27wxg3Qwb-q7oc81xoswMwto88422y11wBz822weS4oaEnxO0Bo4O2-2l2UtwxwhU31wiE567Udo5qfK0zEkxe2Gexe5E5e7oqBwJK2W5olwqUW4-5pUfEe88o4qum7-2K0-poarCwLyES0Io5d08O3217wDyUaUcojxK2B0LwnU8oC1Hg6C13whEeE4WVU-4EdrxG1fy8bUaU",__csr:"hG5hAtsOqkOdFs-LERh7thORZEtsFJ9pcGHitsPqcBq9pqQRmllRZ8ypTtdlFQh9Hy4CKJkHfinJ-SA9jKWBK8j8COVaxfBJ7iGdpaQ8zp-nF5hbGXQGAByUiRHgOAVbyk9QiqirByVkmmuEOax7HWKZkiaL-ha2HCU8XG4GADUx29qK8glxOibyoVfz94qAEtzUrK7FFFovzUpDxa5F8cUigC8jzGDxaFVrGbwzAWUlwDwyzo-5UlxmFFUdEO1tx27ouVVd5y8V0wDByUrzpE9oeu11x6i9wGwyK4EmwFyuEC6EowkUgBxi49EiGu26U5KVoSfxK784iewkByo4y742l385G1Vxy7o1xE5K2K1DBwOzohg2Dw6SzogwoU10EbU1i86i021eU0iCLsWx51jo0Y6-04pe7U1ne0dXwba5K096w2JGzEcU2Kw0a7C027-u0nC5ta1Uw28k0bKw2Fo2Uw3jqx91nw2pd02Qo5m0WU0JOi0g18w0VW09QwLw1Mu0120w22qjxiu048qo5lxm2e0pW0uWi0lME3pw2PUf8y9gixq05ko0SQw0Uu",__comet_req:"15",fb_dtsg:E,jazoest:S,lsd:k,__spin_r:"1014674557",__spin_b:"trunk",__spin_t:"1720093577",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:"CometMarketplaceCategoryContentContainerQuery",variables:JSON.stringify(_),server_timestamps:"true",doc_id:"24060183263649701"};let T=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded",pragma:"no-cache",priority:"u=1, i","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not/A)Brand";v="8", "Chromium";v="126", "Google Chrome";v="126"',"sec-ch-ua-full-version-list":'"Not/A)Brand";v="8.0.0.0", "Chromium";v="126.0.6478.116", "Google Chrome";v="126.0.6478.116"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"14.2.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceCategoryContentContainerQuery","x-fb-lsd":"odUwXS9nWS3GOiVcgTcl0R"},referrer:`https://www.facebook.com/marketplace/category/${e}?minPrice=11&maxPrice=112&maxMileage=210000&maxYear=2024&minMileage=1000&carType=convertible%2Ccoupe%2Chatchback&vehicleExteriorColors=black%2Ccharcoal%2Cgrey&exact=false`,referrerPolicy:"strict-origin-when-cross-origin",body:(0,z.T)(x),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,$.u)(e))).then((e=>e.text()));if(T&&T.match(/api_error_code":368/i)){console.log("Search listing blocked.");const r=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,h=moment(r).calendar();return(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:h}),(await(0,C.o)()).addKo(),window.isKO=!0,await(0,W._)(60*s.waitIfSpamDetected*1e3),window.isKO=!1,H({keyword:e,lat:t,lon:n,radius:i,count:o,priceMin:a,priceMax:l,cursor:c,previousResults:u,categoryIds:d})}const A=T;T.includes("for (;;);")&&(T=T.replace("for (;;);","")),T.match(/}\s*{/)&&(T=T.split(/}\s*{/)[0]+"}");try{T=JSON.parse(T)}catch(e){return console.error("An API request (searchCategoryListings) has failed with error",A),(0,K.Z)({error:"Failed to parse facebook api response",e:e.toString(),resultsBackup:A}),T={error:"Failed to parse facebook api response",e:e.toString(),resultsBackup:A},T}if(T.errorDescription)return console.error("An API request (searchCategoryListings) has failed with error",T.errorDescription),T;let O=T.data.viewer.marketplace_feed_stories.edges.filter((e=>e.node.listing||"Results from outside your search"===e.node.header_text)).map((e=>{const t=e.node.listing;return t?{title:t.custom_title||t.marketplace_listing_title,price:t.listing_price?.amount,id:t.id,seller:t.marketplace_listing_seller,location:t.location?.reverse_geocode?.city,location_display:t.location?.reverse_geocode?.city_page?.display_name}:"outsidemarker"}));const N=O.findIndex((e=>"outsidemarker"===e)),L=N>-1;if(L&&(O=O.slice(0,N)),u&&(O=[...u,...O]),O.length<s.listingsPerKeyword&&T.data.viewer.marketplace_feed_stories.page_info.has_next_page){const e=T.data.viewer.marketplace_feed_stories.page_info.end_cursor;return L?{listings:O,cursor:!1,isNotSortedByCreationTime:f}:{listings:O,cursor:e,isNotSortedByCreationTime:f}}return{listings:O,cursor:!1,isNotSortedByCreationTime:f}}async function Q(){const e=new Date,t=`${e.getFullYear()}${e.getMonth()+1}${e.getDate()}`;let n=await(0,i.chromeStorageGet)(`stopAfterXMessages_${t}`);return n=n?JSON.parse(n):{},{addMessageSent:()=>{const e="messages_sent";n[e]||(n[e]=0),n[e]+=1,(0,i.chromeStorageSet)(`stopAfterXMessages_${t}`,JSON.stringify(n))},getMessagesSent:()=>{const e="messages_sent";return n[e]||(n[e]=0),n[e]}}}async function J(){const e=(await Q()).getMessagesSent();let t=Number(document.getElementById("stop_messaging_after").value)||0;if("TRIAL"===window.licenseMode&&(t=5),0===t)return!1;const n=e>=t;return n&&(console.log(`${"TRIAL"===window.licenseMode?"TRIAL: ":""}Stopped messaging after sending ${e} messages.`),(0,y.CONSOLE_MESSAGE)("custom",`${"TRIAL"===window.licenseMode?"TRIAL: ":""}Stopped messaging after sending ${e} messages.`)),n}async function Y({keyword:e,lat:t=7.79716,lon:n=122.763,radius:i=65,count:o=24,priceMin:a=0,priceMax:l=2147483647,cursor:c,previousResults:u,isSearchWithFilter:d=!1}){if(await J())return{listings:[],cursor:!1,isStopAfterXMessagesReached:!0};const h=c?.slice(-5)||"none";console.log(`Query ${e} Cursor[${h}] ${t},${n}`),(0,y.CONSOLE_MESSAGE)("fetching_listings",{keyword:e});const m=String(e).match(/\/search/i),p=String(e).match(/query=/i);let f,g,_=null;if(d&&!m&&!p){g=b(e);const s=await B(`/marketplace/category/${g}`);if(s&&s.length)return H({keyword:e,lat:t,lon:n,radius:i,count:o,priceMin:a,priceMax:l,cursor:c,previousResults:u,categoryIds:s})}d&&(f=j(String(e).split("?")[1]),f&&(f.priceRange&&f.priceRange.length&&(void 0!==f.priceRange[0]&&(a=f.priceRange[0]),void 0!==f.priceRange[1]&&(l=f.priceRange[1])),f.commerce_search_and_rp_condition&&(_=f.commerce_search_and_rp_condition)),e=f?.query||g||e,console.log("keyword",e));let w=i=function(e){return"string"==typeof e&&(e=parseInt(e,10)),"number"!=typeof e||isNaN(e)||e<0?(console.error("Invalid radius value:",e),0):e}(i);w>500&&(w=500),w=Math.round(1.60934*(w+2)),window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const v=(0,V.S)();var S="2";const E=(0,G.H)();for(var I=0;I<E.length;I++)S+=E.charCodeAt(I);const k=(0,V.k)(),x={buyLocation:{latitude:t,longitude:n},contextual_data:null,count:o,cursor:c,flashSaleEventID:"",hasFlashSaleEventID:!1,marketplaceSearchMetadataCardEnabled:!1,params:{bqf:{callsite:"COMMERCE_MKTPLACE_WWW",query:e},browse_request_params:{commerce_enable_local_pickup:!f?.deliveryMethod||"local_pick_up"===f?.deliveryMethod,commerce_enable_shipping:!f?.deliveryMethod||"shipping"===f?.deliveryMethod,commerce_search_and_rp_available:!0,commerce_search_and_rp_category_id:[],commerce_search_and_rp_condition:_||null,commerce_search_and_rp_ctime_days:null,filter_location_latitude:t,filter_location_longitude:n,filter_price_lower_bound:100*Number(a)||0,filter_price_upper_bound:100*Number(l)||214748364700,commerce_search_sort_by:"CREATION_TIME_DESCEND",filter_radius_km:w},custom_request_params:{browse_context:null,contextual_filters:[],referral_code:null,saved_search_strid:null,search_vertical:"C2C",seo_url:d?e:null,surface:d?"TOPIC_PAGE":"SEARCH",virtual_contextual_filters:[]}},savedSearchID:null,savedSearchQuery:e,scale:2,shouldIncludePopularSearches:!1,topicPageParams:{location_id:d?"category":"110301228992872",url:d?e:null}},T=(0,r.W)(),A={av:T,__aaid:0,__user:T,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:d?"19908.HYP:comet_pkg.2.1..2.1":"19836.HYP2:comet_pkg.2.1..2.1",dpr:d?"2":"1",__ccg:"EXCELLENT",__rev:v,__s:d?"1trbx4:k3mks3:n68jb4":"yn6ar9:h0u3rd:rqxmb3",__hsi:d?"7387744577350382124":"7361039489586395825",__dyn:d?"7AzHK4HwkEng5K8G6EjBAg5S3G2O5U4e2C1jyUW3q2ibwNw9G2Sawba1DwUx60GE3Qwb-q7oc81xoswMwto886C11wBz81s8hwGxu782lwv89kbxS1Fwc60D8vwRwlE-U2exi4UaEW2G0z9obrwKxm5o7G4-5o4q3y261eBx_wHwfCm2CVEbUGdwb61jg2cwMwrUK2K364UrwFg2fwxyo6O1FwgU4q3G1eKufxa3mUqwjUy2-2K":"7AzHK4HwBgDx-5Q1ryaxG4Qih09y2O5U4e2C3-4UKewSAx-bwNw9G2Saxa1NwJwpUe8hw8u250n82nwb-q7oc81xoswMwto88422y11wBz822wtU4a3a4oaEnxO0Bo4O2-2l2Utwwg4u0Mo4G1hwlo5qfK0zEkxe2Gexe5E5e7oqBwJK2W5olwqUW4-5pUfEdK2616DBx_wHwfCm2CVEbUGdwb6223908O3216xi4UK2K364UrwFgbU5-269wkopg6C13whEeEfE-VU-4EdouwjUy",__csr:d?"hG5iiYQZYyqlQzqnfHAdFnZR7bnQOPFJ7QBCaGQA-yJECBrWCGplBiZviQdlV4teiVe9AAHiGgDj-XXWgmGm4FkOwGDgqGbzoCnGqm44GAByUiWGfKV8oGi4K2iu6Eaem59bwICwFwg86S22HwJx-1izU4K1PGu2eU2JzU1ho2swoo37wg8cU6O0VU5O1jw7fw1ni00jbq027-u04c40bKw3nE08JE5m0WU04jm01A7w7KAw2eE":"gbQBMT4n11k4qf9sQhkpdlnT4tO4OlsBmIlEIhbsAzmyWllQhR8ihSTGWnli_ULpahEGmGHjWCQGLJx2Z8B24HGFVrCKpqVe9BJdui-AGhpGJ2fStpCeh9KbAQmcghDx6HgOmFazet4UKmt3UWWLyUN2e9ghxx1e9CWgG8AyoWVe-58W-8xehzUjDghAzFtfpk9yEiU8EG5ES5USXho-u9xyEWe-RxC9V8vh8th8W68dElxu5QEjyqxPzVEPyE8o8F8im9xeF8jwAwUwp8eEeUfXG8zvx2te6VUkhEW5poWq4E8azWG7E4613wzGUlxO2u8wGK3GewpElypotwgF84a1mDwdB0s8760XEOU14U3nAwMwaW0Uojw4iQ2Nam04ZE11U0lsw86RF5yKWWmK5otB80b9w2l8uw6Jg0k1w6_wiE1Le2O10iwZw1422203EC011WAG034G020q0dUxS0XoKe83Cu0_U3PCw6Gw16qi05581G8e83_woU0K3UyqE2Wg-fw4cw2io6O0amo2Dw820DU7a9HyO0dIOy5Evx1BwxCl98XB9e5Q5O0Ww41Ua0EbEM1cEy5U1cpXa0xU1GE2rg6i3e02li0VAbGom0b1OGEigtAw8C3Ci58lw1-m0s3m0Zogwfq0hwM2swbu087wDwmk4E0Bq0Pobo1jE1VFd0",__comet_req:"15",fb_dtsg:E,jazoest:S,lsd:k,__spin_r:"1012976566",__spin_b:"trunk",__spin_t:"1713875731",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:d?"CometMarketplaceCategoryContentContainerQuery":"CometMarketplaceSearchContentContainerQuery",variables:JSON.stringify(x),server_timestamps:"true",doc_id:d?"7661400373954706":"7308382399275974"};let O=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:(0,z.T)(A),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,$.u)(e))).then((e=>e.text()));if(O&&O.match(/api_error_code":368/i)){console.log("Search listing blocked.");const r=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,d=moment(r).calendar();return(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:d}),(await(0,C.o)()).addKo(),window.isKO=!0,await(0,W._)(60*s.waitIfSpamDetected*1e3),window.isKO=!1,Y({keyword:e,lat:t,lon:n,radius:i,count:o,priceMin:a,priceMax:l,cursor:c,previousResults:u})}const N=O;try{O=function(e){try{JSON.parse(e)}catch(t){e.includes("for (;;);")&&(e=e.replace("for (;;);","")),e.match(/}\s*{/)&&(e=e.split(/}\s*{/)[0]+"}")}return e}(O),O=JSON.parse(O)}catch(e){return console.error(e),console.error("An API request (searchListings) has failed with error:",N),(0,K.Z)({error:"Failed to parse facebook api response",e:e.toString(),resultsBackup:N}),O={error:"Failed to parse facebook api response",e:e.toString(),resultsBackup:N},O}if(O.errorDescription)return console.error("An API request (searchListings) has failed with error",O.errorDescription),O;const L=O?.data?.marketplace_search?.feed_units?.edges;if(!L)return console.error("An API request (searchListings) has failed with error",O),(0,K.Z)({error:"An API request (searchListings) has failed with error",results:O}),{listings:[],cursor:!1};let D=L.filter((e=>e.node.listing||"Results from outside your search"===e.node.header_text)).map((e=>{const t=e.node.listing;return t?{title:t?.marketplace_listing_title,price:t?.listing_price?.amount,id:t?.id,seller:t?.marketplace_listing_seller,location:t?.location?.reverse_geocode?.city,location_display:t?.location?.reverse_geocode?.city_page?.display_name}:"outsidemarker"}));const R=D.findIndex((e=>"outsidemarker"===e)),M=R>-1;if(M&&(D=D.slice(0,R)),u&&(D=[...u,...D]),D.length<s.listingsPerKeyword&&O?.data?.marketplace_search?.feed_units?.page_info?.has_next_page){const e=O?.data?.marketplace_search?.feed_units?.page_info?.end_cursor;return M?{listings:D,cursor:!1}:{listings:D,cursor:e}}return{listings:D,cursor:!1}}async function X(e,t){t=t.replace(/\n/g," "),t=(t=encodeURIComponent(t)).replace(/%22/g,"%5C%22");const n=(0,r.W)(),i=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","cache-control":"no-cache","content-type":"application/x-www-form-urlencoded",pragma:"no-cache","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceMessageSellerMutation","x-fb-lsd":"eGdwssYEVXB7hv3L3hNExb"},referrer:`https://www.facebook.com/marketplace/item/${e}/?ref=browse_tab&referral_code=marketplace_top_picks&referral_story_type=top_picks`,referrerPolicy:"strict-origin-when-cross-origin",body:`av=${n}&__user=${n}&__a=1&__req=w&__hs=19538.HYP%3Acomet_pkg.2.1..2.1&dpr=2&__ccg=GOOD&__rev=1007773680&__s=pz5dko%3Au0mc7e%3Aeov58w&__hsi=7250295222789373259&__dyn=7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2CE4ibyQdwSAxacyUco5S3O2Saw8i2S1DwUx60GE3Qwb-q7oc81xoswIK1Rwwwg8a8465o-cw5Mx62G5Usw9m1YwBgK7o884y0Mo4G4UcUC7Udo5qfK0zEkxe2GewyDwkUtxGm2SUbElxm3y3aexfxmu3W3y261eBx_y88E3qxWm2Sq2-azo7u3C223908O321LwTwNxe6Uak1xwJwxyo6O1Fw&__csr=gL15aAxKBbb6JOO9iH4nR6Rbth1cOT9czcPOvjXldQQTTbF9OPn4qhfsHVuHiOr8AVqHCCG-FsC8CaVdfZVq8FaHhFe-aBZ4-O7ighK5FF-QEqm8y9EgVoKtoSVUJ4gR7Az4icAjghzaBxa9xi6o--u4UsWAyoOfKfwACxR1e9z8WbK1dAxqUG5UOcy8GUipGDCG2bxdem6S3e5EqxGdzElUy5VpFoKexO3SqfwWCz89qwg82gwyGu4k5ofUcoarwtUW7VoWawspEWVojxa6ofotw0Jnw0D8w0gO401VrDwea02WK0qO0xE2Ww1Mqu0yo8FEuBgnwbfway1Nw-wJw0Nkw0FsggwBw1360eIoS0RU2Qw7EwKDg0bDA06EqwSw6AhFd0FQi0q92oqA84IM5S0pa0tuu0ii0ehUfo&__comet_req=15&fb_dtsg=${(0,G.H)()}&jazoest=25701&lsd=eGdwssYEVXB7hv3L3hNExb&__spin_r=1007773680&__spin_b=trunk&__spin_t=1688090903&fb_api_caller_class=RelayModern&fb_api_req_friendly_name=CometMarketplaceMessageSellerMutation&variables=%7B%22input%22%3A%7B%22attribution_id_v2%22%3A%22CometMarketplaceHoistedPermalinkContentContainer.react%2Ccomet.marketplace.item%2Cvia_cold_start%2C1688090903780%2C951%2C1606854132932955%2C%22%2C%22listing_id%22%3A%22${e}%22%2C%22message%22%3A%22${t}%22%2C%22referral_surface%22%3A%22browse_tab%22%2C%22surface%22%3A%22product_details%22%2C%22tracking%22%3Anull%2C%22ui_component%22%3A%22contact_seller_button%22%2C%22actor_id%22%3A%22100023618722690%22%2C%22client_mutation_id%22%3A%222%22%7D%7D&server_timestamps=true&doc_id=4861194384003324`,method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,$.u)(e))).then((e=>e.text()));if(i&&i.match(/api_error_code":368/i)){console.log("Send message blocked.");const n=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,i=moment(n).calendar();return(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:i}),(await(0,C.o)()).addKo(),window.isKO=!0,await(0,W._)(60*s.waitIfSpamDetected*1e3),window.isKO=!1,await X(e,t)}if(i&&i.match(/User Verification Needed/i))return console.log("Verification needed."),(0,y.CONSOLE_MESSAGE)("custom","Account verification required.."),await(0,W._)(864e5),"STOP";if(i&&i.match(/1378009/i))return console.log("Failed to send message. Not all buyers can message this seller.",e),{error:i};if(i&&i.match(/A server error field_exception occured/i))return console.log("field_exception detected. Retrying."),(0,y.CONSOLE_MESSAGE)("custom","field_exception detected. Will reload in 3 minutes to fix session."),await(0,f._apiSendBug)({error:"field_exception",response:i,listing_id:e,message:t}),await(0,W._)(18e4),void window.location.reload();if(i&&i.match(/missing_required_variable_value/i))return console.log("missing_required_variable_value detected. Retrying."),(0,y.CONSOLE_MESSAGE)("custom","missing_required_variable_value detected. Will reload in 3 minutes to fix session."),await(0,f._apiSendBug)({error:"missing_required_variable_value",response:i,listing_id:e,message:t}),await(0,W._)(18e4),void window.location.reload();if(i&&i.match(/error/i))return(0,y.CONSOLE_MESSAGE)("custom","Failed to send message. Unhandled error. Will halt bot and reload in 30 minutes to fix session."),await(0,f._apiSendBug)({error:"Failed to send message. Unhandled error.",response:i,listing_id:e,message:t}),await(0,W._)(18e4),window.location.reload(),{error:i};let o;try{o=i.match(/thread_id":"(\d+)"/i)[1]}catch(e){console.error("Failed to get thread_id",i)}const a={success:!0};return o&&(a.thread_id=o),a}async function Z(e,t){if(!e)return{error:"threadId is required"};void 0===t&&(t=!0),window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const n=(0,G.H)(),i=(0,V.S)();for(var s="2",o=0;o<n.length;o++)s+=n.charCodeAt(o);const a=(0,V.k)(),l="ids["+e+"]",c=(0,r.W)(),u={av:c,__user:c,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${i}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:n,jazoest:s,lsd:a,server_timestamps:"true",[l]:t};let d=await fetch("https://www.facebook.com/ajax/mercury/change_archived_status.php",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:(0,z.T)(u),method:"POST",mode:"cors",credentials:"include",connection:"keep-alive"}).then((e=>e.text()));return d.match(/server_change_archived_status/i)?{success:!0}:(console.log("results",d),{error:"Failed to archive thread",response:d})}async function ee(e,t,n){const i=1e3*D(e=Number(e),t=Number(t)),s=(new Date).getTime()+i;n&&(n+=". ");const r=`${n}Timeout for ${i/1e3} seconds.`;(0,y.CONSOLE_MESSAGE)("timeout",{message:r,hh:moment(s).format("HH"),mm:moment(s).format("mm"),ss:moment(s).format("ss")}),await(0,W._)(i)}async function te(e){let t=document.getElementById("timeout_api_calls_min").value;t||(t=s.apiCallDelay[0]);let n=document.getElementById("timeout_api_calls_max").value;n||(n=s.apiCallDelay[1]),await ee(t,n,e)}async function ne(e){let t=document.getElementById("timeout_between_messages_min").value;t||(t=s.timeout_permessage[0]);let n=document.getElementById("timeout_between_messages_max").value;n||(n=s.timeout_permessage[1]),await ee(t,n,e)}const{chromeStorageGet:ie,chromeStorageSet:se}=n(1334),{hasMinutesPassed:re}=n(5965);async function oe(e){if(!e)return void console.error("Failed to clean up followups/MORs. Missing key");let t=await ie(e);if(t&&(t=JSON.parse(t)),!Array.isArray(t))return;let n=!1;for(let e=t.length-1;e>=0;e--){const i=t[e],s=i.tsLastMsg||i.tsAdded,r=i.listingid,o=i.listingData.title,a=i.listingData.seller.name;if(re(4320,s)){n=!0;const i=Math.floor((Date.now()-new Date(s))/864e5);console.log(`Cleaning up entry as it's ${i} days old. [${a}] [${o}] [${r}] `),t.splice(e,1)}}await se(e,JSON.stringify(t)),n&&console.log("Done cleaning up followups/MORs")}async function ae(e){if(!e.DisablelastFetchInboxThreads){let e=await(0,i.chromeStorageGet)("lastFetchInboxThreads")||0;if(e&&(new Date).getTime()-e<9e5)throw new Error("fetchInboxThreads already ran less than 15 minutes ago. Skipping.");await(0,i.chromeStorageSet)("lastFetchInboxThreads",(new Date).getTime())}window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const t={};let n=e&&e.cursor;const o=e&&e.previousThreads;n&&(t.cursor=n,t.count=12);let a=e&&e.page;a||(a=1),console.log("Fetching inbox threads.. Page:",a);const l=function(){const e=new Date;return e.setDate(e.getDate()-1),e.getTime()}(),c=(0,G.H)(),u=(0,V.S)();for(var d="2",h=0;h<c.length;h++)d+=c.charCodeAt(h);const m=(0,V.k)(),p=n?"CometMarketplaceInboxBuyerTabViewPaginationQuery":"CometMarketplaceInboxBuyerTabViewContainerQuery",f=n?"6063301870422274":"9150907031651351",g=(0,r.W)(),_={av:g,__user:g,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${u}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:c,jazoest:d,lsd:m,__spin_r:u,__spin_b:"trunk",__spin_t:"1688385023",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:p,variables:JSON.stringify(t),server_timestamps:"true",doc_id:f};let w=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:(0,z.T)(_),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,$.u)(e))).then((e=>e.json()));const v=JSON.stringify(w);if(v&&v.match(/api_error_code":368/i)){console.log("Fetch inbox thread rate limited.");const t=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,C.o)()).addKo(),window.isKO=!0,await(0,W._)(60*s.waitIfSpamDetected*1e3),window.isKO=!1,e.DisablelastFetchInboxThreads=!0,ae(e)}let b=[];if(!unsafeWindow.isRun&&!e.testrun)return b;const S=w&&w.data&&w.data.viewer&&w.data.viewer.marketplaceInboxBuyerMessageThreads&&w.data.viewer.marketplaceInboxBuyerMessageThreads.edges;if(S)for(let t=0;t<S.length;t++){const n=S[t],i=n&&n.node;if(e&&e.limitDays&&i&&i.updated_time_precise<=l)return o&&(b=o.concat(b)),console.log("Found a thread that is more than a day old. Paging has been stopped.",i?.marketplace_thread_data?.messageable_item?.marketplace_listing_title,new Date(Number(i.updated_time_precise)),l),b;b.push(i)}o&&(b=o.concat(b));const E=w&&w.data&&w.data.viewer&&w.data.viewer.marketplaceInboxBuyerMessageThreads&&w.data.viewer.marketplaceInboxBuyerMessageThreads.page_info;return E&&E.has_next_page?(n=E.end_cursor,await(0,W._)(D(5e3,1e4)),ae({...e,cursor:n,previousThreads:b,page:a+1,DisablelastFetchInboxThreads:!0})):b}function le(){return!!(document.getElementById("followup_1").value||document.getElementById("followup_2").value||document.getElementById("followup_3").value||document.getElementById("messageonreply_1").value)}function ce(e){try{let t=document.querySelector("#ta #keywords").value.split("\n").map((e=>e.trim())).join("|");t.startsWith("|")&&(t=t.substring(1)),t.endsWith("|")&&(t=t.substring(0,t.length-1));const n=new RegExp(t,"i");if(e.match(n))return e.match(n)[0]}catch(t){(0,f._apiSendBug)({location:"getKeywordMatched",err:t,extra:{title:e}})}}function ue(e,t){if(!t)return e;const n=t>0?Math.ceil(e/Math.abs(t)):Math.floor(e/Math.abs(t));return Math.abs(n*t)}function de(e,t,n,i,s){n&&(n=Number(n));let r=e;const o=document.querySelector("#listing_price_delta").value||0;r=r.replace(/\[name\]/g,t.split(" ")[0]),r=r.replace(/\[title\]/g,s||"");let a=document.getElementById("roundupdown").value;a&&(a=parseFloat(a));let l=r.match(/\[price\s?-\s?(\d+)\]/);if(void 0!==n&&l&&l.length>1){const e=parseFloat(l[1]);let t=n-parseFloat(e);a&&(t=ue(t,a)),t<0&&(t=0),r=r.replace(/\[price\s?-\s?\d+\]/,`$${t}`)}else if(void 0!==n&&r.match(/\[price\]/)){let e=n;o&&(e=function(e,t){return e&&t?(e=String(e).replace(/[^\d\.-]/g,""),e=Number(e),t.includes("%")?(t=String(t).replace(/[^\d\.-]/g,""),e+e*((t=Number(t))/100)):(t=String(t).replace(/[^\d\.-]/g,""),e+(t=Number(t)))):e}(e,o)),a&&(e=ue(e,a)),e<0&&(e=0),r=r.replace(/\[price\]/,`$${e}`)}else r=r.replace(/\[price\s?-\s?\d+\]/,"your price");return r}const he=n(6503);function me(e){return{message_1:(async()=>{const t=await(0,i.chromeStorageGet)("input_message_1")||"";return e?t:he.unspin(t)})(),message_2:(async()=>{const t=await(0,i.chromeStorageGet)("input_message_2")||"";return e?t:he.unspin(t)})(),message_3:(async()=>{const t=await(0,i.chromeStorageGet)("input_message_3")||"";return e?t:he.unspin(t)})(),followup_1:(async()=>{const t=await(0,i.chromeStorageGet)("input_followup_1")||"";return e?t:he.unspin(t)})(),followup_2:(async()=>{const t=await(0,i.chromeStorageGet)("input_followup_2")||"";return e?t:he.unspin(t)})(),followup_3:(async()=>{const t=await(0,i.chromeStorageGet)("input_followup_3")||"";return e?t:he.unspin(t)})(),messageonreply_1:(async()=>{const t=await(0,i.chromeStorageGet)("input_messageonreply_1")||"";return e?t:he.unspin(t)})()}}async function pe(e){let t,n="",i="",r=await me().followup_1,o=await me().followup_2,a=await me().followup_3,l=r,c="1";if(e.last_template_sent&&("1"===e.last_template_sent?o?(l=o,c="2"):a&&(l=a,c="3"):"2"===e.last_template_sent&&a&&(l=a,c="3")),l){const r=await async function(e,t){const n=e.id,i=e.title,r=e.seller.name,o=(ce(i),e.price);let a;if(t){t=de(t,r,o,0,i);const e=await X(n,t);if("STOP"===e)return void console.log("Stopped sending messages to user because other user is blocked.");if(e.error)return void console.log(e.error);a||(a=e),(0,y.CONSOLE_MESSAGE)("message_sent",{message_sent:t,listing_price:o,listing_id:n,listing_name:i});const l=1e3*D(s.messageDelay[0],s.messageDelay[1]),c=(new Date).getTime()+l;return(0,y.CONSOLE_MESSAGE)("timeout",{message:"Message Sent",hh:moment(c).format("HH"),mm:moment(c).format("mm"),ss:moment(c).format("ss")}),await(0,W._)(l),{message:t,postMsgId:a}}}(e.listingData,l);r&&(l=r.message,!t&&r.postMsgId&&(t=r.postMsgId)),n&&(n+="\n"),n+=l,i&&(i+=", "),i+=`followup${c}`;const u={last_template_sent:c};let d=!1;return"1"===c?o||a||(d=!0):"2"===c?a||(d=!0):"3"===c&&(d=!0),d&&(await async function(){if(t&&(t.thread_id&&(t=t.thread_id),document.querySelector("#switch-deleteaftersend").checked)){const e=await Z(t,!0);e&&e.success?console.log("Conversation has been archived:",t):console.error("Failed to archive conversation",t)}}(),u.isLastMessageSent=!0),u}return{isLastMessageSent:!0}}async function fe(e){let t,n="",i="",r=await me().messageonreply_1;if(r){const o=await async function(e,t){const n=e.id,i=e.title,r=e.seller.name,o=(ce(i),e.price);let a;if(t){t=de(t,r,o,0,i);const e=await X(n,t);if("STOP"===e)return void console.log("Stopped sending messages to user because other user is blocked.");if(e.error)return void console.log(e.error);a||(a=e),(0,y.CONSOLE_MESSAGE)("message_sent",{message_sent:t,listing_price:o,listing_id:n,listing_name:i});const l=1e3*D(s.messageDelay[0],s.messageDelay[1]),c=(new Date).getTime()+l;return(0,y.CONSOLE_MESSAGE)("timeout",{message:"Message Sent",hh:moment(c).format("HH"),mm:moment(c).format("mm"),ss:moment(c).format("ss")}),await(0,W._)(l),{message:t,postMsgId:a}}}(e.listingData,r);return o&&(r=o.message,!t&&o.postMsgId&&(t=o.postMsgId)),n&&(n+="\n"),n+=r,i&&(i+=", "),i+="messageonreply1",{last_template_sent:"1"}}return{isLastMessageSent:!0}}var ge=n(5965);const _e="toFollowUp",ye="toMOR";async function we(){if(!le())return await oe(_e),void await oe(ye);try{const e=await ae({limitDays:!0}),t=ve({threads:e,hasUnRead:!0}),n=ve({threads:e,hasUnRead:!1});await Se(t),await Ee(n)}catch(e){if("fetchInboxThreads already ran less than 15 minutes ago. Skipping."!==e.message)throw console.error("Error in followup",e),e;console.log("fetchInboxThreads already ran less than 15 minutes ago. Skipping.")}}function ve({threads:e,hasUnRead:t}){const n=[];return e.forEach((e=>{const i=e.unread_count,s=e.updated_time_precise;if(t&&0===i)return;if(!t&&i>0)return;const r=e.messages.edges;if(r&&r.length){const t=r[0].node.__typename,i=e.marketplace_thread_data&&e.marketplace_thread_data.messageable_item&&e.marketplace_thread_data.messageable_item.id,o=e.marketplace_thread_data&&e.marketplace_thread_data.messageable_item&&e.marketplace_thread_data.messageable_item.marketplace_listing_title;"UserMessage"===t&&n.push({listingId:i,updated_time_precise:s,title:o,info:e})}})),n}async function be(e,t){if(!e)return void console.error("Failed to add followup entry. Missing listingid");let n=await(0,i.chromeStorageGet)(_e);n||(n="[]"),n=JSON.parse(n);const s=(new Date).toISOString(),r={listingid:e,tsAdded:s,listingData:t},o=n.find((t=>t.listingid===e));if(o&&n.indexOf(o)>-1){const e=n.indexOf(o);n[e]=r}else n.push(r);await async function(e,t){const n=ye;if(!e)return void console.error("Failed to add MOR entry. Missing listingid");let s=await(0,i.chromeStorageGet)(n);s||(s="[]"),s=JSON.parse(s);const r=(new Date).toISOString(),o={listingid:e,tsAdded:r,listingData:t},a=s.find((t=>t.listingid===e));if(a&&s.indexOf(a)>-1){const e=s.indexOf(a);s[e]=o}else s.push(o);await(0,i.chromeStorageSet)(n,JSON.stringify(s))}(e,t),await(0,i.chromeStorageSet)(_e,JSON.stringify(n))}async function Se(e){let t=await(0,i.chromeStorageGet)(ye);if(t&&(t=JSON.parse(t)),!Array.isArray(t))return;let n=!1;for(let s=t.length-1;s>=0;s--){if(!unsafeWindow.isWaitingForWebhook&&window.webhookMode)return void console.log("isWaitingForWebhook is false. Will stop MOR.");const r=t[s],o=r.tsLastMsg||r.tsAdded,a=r.listingid,l=r.listingData.title,c=r.listingData.seller.name,u=e.find((e=>e.listingId===a));if(u&&new Date(Number(u.updated_time_precise))>=new Date(o))console.log(`Sending Message-On-Reply to seller [${c}] [${l}]`),await fe(r),t.splice(s,1),console.log(`Message-On-Reply has been sent to listing [${c}] [${l}]`),await(0,i.chromeStorageSet)(ye,JSON.stringify(t)),await ne("Message-On-Reply sent."),n=!0;else if((0,ge.hasMinutesPassed)(10080,o)){t.splice(s,1),await(0,i.chromeStorageSet)(ye,JSON.stringify(t));continue}}n&&console.log("Done sending MORs")}async function Ee(e){let t=await(0,i.chromeStorageGet)(_e);t&&(t=JSON.parse(t));let n=!1;if(Array.isArray(t)){for(let s=t.length-1;s>=0;s--){if(!unsafeWindow.isWaitingForWebhook)return void console.log("isWaitingForWebhook is false. Will stop followup.");const r=t[s],o=r.tsLastMsg||r.tsAdded,a=r.listingid,l=r.listingData.title,c=r.listingData.seller.name,u=e.find((e=>e.listingId===a)),d=document.getElementById("followup_after").value;if((0,ge.hasMinutesPassed)(d,o))if(u&&new Date(Number(u.updated_time_precise))<=new Date(o)){console.log(`Entry is due for followup [${c}] [${l}]`);const e=await pe(r);e.isLastMessageSent?(console.log("last followup message was sent. Will remove followup entry."),t.splice(s,1)):(e.last_template_sent&&(r.last_template_sent=e.last_template_sent),r.tsLastMsg=(new Date).toISOString()),n=!0,console.log(`Followup message has been sent to listing [${c}] [${l}]`),await(0,i.chromeStorageSet)(_e,JSON.stringify(t)),await ne(`FollowUp #${e.last_template_sent||"3"} sent.`)}else console.log(`Has unread message. Will not follow up [${c}] [${l}]}`),t.splice(s,1),await(0,i.chromeStorageSet)(_e,JSON.stringify(t))}n&&console.log("Done sending followups")}}var Ie=n(2617);async function ke({listingData:e,instanceId:t,searchCoordinates:n,distance:i,radiusSetting:r,gptMessages:o,testRun:a}){let l=!1;if(!unsafeWindow.isRun&&!a)return void console.log("bot stopped. - 2");if(t!==unsafeWindow.runningInstanceId)return;const c=e.id,u=e.title,d=e.seller.id,h=e.seller.name;if(await(0,k.skips)().hasBeenMessaged(d))return void console.log(`Skipping user ${d} (${h}) as they have already been messaged`);ce(u);let m,p="",g="",_=!1;const w=e.price,v=o&&o[0],b=o&&o[1],S=o&&o[2];let E=v||await me().message_1;if(E){E=de(E,h,w,0,u);const n=await X(c,E);if("STOP"===n)return void console.log("Stopped sending messages to user because other user is blocked.");if(n.error)return void console.log(n.error);await Te(c,d,e.creationTime),_||(await xe(),_=!0),await be(c,e),l=!0,m||(m=n),(0,y.CONSOLE_MESSAGE)("message_sent",{message_sent:E,listing_price:w,listing_id:c,listing_name:u},t),p&&(p+="\n"),p+=E,g&&(g+=", "),g+=v?"gptmessage1":"message1",await ne((v?"GPT ":"")+"Message #1 sent.")}if(E=b||await me().message_2,E){E=de(E,h,w,0,u);const n=await X(c,E);if("STOP"===n)return void console.log("Stopped sending messages to user because other user is blocked.");if(n.error)return void console.log(n.error);await Te(c,d,e.creationTime),_||(await xe(),_=!0),await be(c,e),l=!0,m||(m=n),(0,y.CONSOLE_MESSAGE)("message_sent",{message_sent:E,listing_price:w,listing_id:c,listing_name:u},t),p&&(p+="\n"),p+=E,g&&(g+=", "),g+=b?"gptmessage2":"message2",await ne((v?"GPT ":"")+"Message #2 sent.")}if(E=S||await me().message_3,E){E=de(E,h,w,0,u);const n=await X(c,E);if("STOP"===n)return void console.log("Stopped sending messages to user because other user is blocked.");if(n.error)return void console.log(n.error);await Te(c,d,e.creationTime),_||(await xe(),_=!0),await be(c,e),l=!0,m||(m=n),(0,y.CONSOLE_MESSAGE)("message_sent",{message_sent:E,listing_price:w,listing_id:c,listing_name:u},t),p&&(p+="\n"),p+=E,g&&(g+=", "),g+=S?"gptmessage3":"message3",await ne((v?"GPT ":"")+"Message #3 sent.")}if(m&&(m.thread_id&&(m=m.thread_id),!le()&&document.querySelector("#switch-deleteaftersend").checked)){const e=await Z(m,!0);e&&e.success?console.log("Conversation has been archived:",m):console.error("Failed to delete conversation",m)}window.messagesSent+=1;const I={uid:d,ownerName:h,listingid:c,message:p,templateName:g};return e.location&&(I.listing_lat=e.location.latitude,I.listing_lon=e.location.longitude),n&&n.lat&&n.lon&&(I.search_lat=n.lat,I.search_lon=n.lon),i&&(I.distance=i),r&&(I.radius=r),await async function(e){try{if(s.disableLogs)return;const{uid:t,ownerName:n,listingid:i,message:r,templateName:o,listing_lat:a,listing_lon:l,search_lat:c,search_lon:u,distance:d,radius:h}=e,m={Date:(new Date).toGMTString(),UserID:t,Name:n,ListingID:i,"Message Sent":r,template:o,tabId:window.tabId,extension_version:window.extension_version,gmail:window.userGmail||""};a&&(m["Listing Lat"]=a),l&&(m["Listing Lon"]=l),c&&(m["Search Lat"]=c),u&&(m["Search Lon"]=u),d&&(m.Distance=d),h&&(m["Search Radius"]=h);const p=(0,Ie.g)();return p&&(m.email=p),async function e(t,n){try{return fetch("https://sheets.hopla.tools/?HT=9ec6989caf07d1305c6c386880840f8a&mode=log&sheet_name=FacebookBot",{method:"POST",body:JSON.stringify(t)}).then((async e=>(0,$.u)(e))).then((e=>e.text())).catch((async i=>(console.error("Fetch Failed (sendBotLog)",i,n),n&&n>6?((0,f._apiSendBug)({error:"Failed to write to botlog",data:t,function:"sendBotLog"}),""):(await(0,W._)(1e4),n||(n=0),e(t,n+=1)))))}catch(e){return console.error("Failed to send bot log.",e),""}}(m).catch((e=>(console.error("Fetch Failed (sendBotLog))",e),"")))}catch(e){(0,f._apiSendBug)({error:"Failed to send bot log.",e:e.toString()}),alert("Failed to send bot log.")}}(I),!!l&&p}async function xe(){(await(0,C.o)()).addOffer(),(await(0,C.o)()).addStreak()}async function Te(e,t,n="NA"){await(0,k.skips)().saveToSkipMessagedListing(e,n),await(0,k.skips)().saveToMessagedUsers(t,e)}async function Ce(){const e=document.getElementById("streak").value;document.getElementById("streaktimeout").value;let t=document.getElementById("timeout_streak_min").value;t||(t=s.timeout_streak[0]);let n=document.getElementById("timeout_streak_max").value;if(n||(n=s.timeout_streak[1]),t&&n&&window.iStreaks>=e){const e=1e3*D(t,n),i=(new Date).getTime()+e;(0,y.CONSOLE_MESSAGE)("timeout",{message:"Streak",hh:moment(i).format("HH"),mm:moment(i).format("mm"),ss:moment(i).format("ss")}),await(0,W._)(e),(await(0,C.o)()).resetCurrentStreak()}}function Ae(){return new Promise((e=>{!function t(){if("complete"===document.readyState)return e();setTimeout(t,30)}()}))}var Oe=n(9237),Ne=n(5639);function Le(e,t,n,i){const s=De(n-e),r=De(i-t),o=Math.sin(s/2)*Math.sin(s/2)+Math.cos(De(e))*Math.cos(De(n))*Math.sin(r/2)*Math.sin(r/2);return 2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o))*6371*.621371}function De(e){return e*(Math.PI/180)}function Re(e,t){const n={};for(const t in e.allDetails)"title"!==t&&"price"!==t&&"description"!==t&&"location"!==t&&"photos"!==t&&"seller"!==t&&(n[t]=e.allDetails[t]);delete n.listing_photos,delete n.commerce_badges_info;for(const e in n)if((e.startsWith("__")||null===n[e])&&delete n[e],"object"==typeof n[e])for(const t in n[e])(t.startsWith("__")||null===n[e][t])&&delete n[e][t];let i="";i+=`Title: ${e.title}\n`,i+=`Price: ${e.price}\n`,n.condition&&(i+=`Condition: ${n.condition}\n`),i+=`Description: ${e.description}\n`,i+="# Seller Details\n",i+=`Name: ${e.seller.name}\n`,n.location_text&&n.location_text.text&&(i+=`Location: ${n.location_text.text}\n`),e.location&&e.location.latitude&&(i+=`Latitude: ${e.location.latitude}\n`),e.location&&e.location.longitude&&(i+=`Longitude: ${e.location.longitude}\n`),i+="Stats:\n",i+=` - five_star_ratings_average: ${e.seller.marketplace_ratings_stats_by_role.seller_stats.five_star_ratings_average}\n`,i+=` - five_star_total_rating_count_by_role: ${e.seller.marketplace_ratings_stats_by_role.seller_stats.five_star_total_rating_count_by_role}\n`,i+=`Join Date: ${new Date(1e3*e.seller.join_time).toLocaleString("default",{month:"long",year:"numeric"})}\n`,i+="# Additional Listing Details\n",n.vehicle_exterior_color&&(i+=`vehicle_exterior_color: ${n.vehicle_exterior_color}\n`),n.vehicle_features&&(i+=`vehicle_features: ${n.vehicle_features.join(", ")}\n`),n.vehicle_fuel_type&&(i+=`vehicle_fuel_type: ${n.vehicle_fuel_type}\n`),n.vehicle_interior_color&&(i+=`vehicle_interior_color: ${n.vehicle_interior_color}\n`),n.vehicle_is_paid_off&&(i+=`vehicle_is_paid_off: ${n.vehicle_is_paid_off}\n`),n.vehicle_make_display_name&&(i+=`vehicle_make_display_name: ${n.vehicle_make_display_name}\n`),n.vehicle_model_display_name&&(i+=`vehicle_model_display_name: ${n.vehicle_model_display_name}\n`),n.vehicle_number_of_owners&&(i+=`vehicle_number_of_owners: ${n.vehicle_number_of_owners}\n`),n.vehicle_odometer_data&&(i+=`vehicle_odometer_data: ${JSON.stringify(n.vehicle_odometer_data)}\n`),n.vehicle_title_status&&(i+=`vehicle_title_status: ${n.vehicle_title_status}\n`),n.vehicle_transmission_type&&(i+=`vehicle_transmission_type: ${n.vehicle_transmission_type}\n`),n.vehicle_trim_display_name&&(i+=`vehicle_trim_display_name: ${n.vehicle_trim_display_name}\n`),i+="# Other Seller Listings:\n",i+=t.map((e=>`- Title: ${e.title}, Price: ${e.price}`)).join("\n");const s={text:i};return s.photos=e.photos,s.listingDetails=e,s}var Me=n(9309);function Pe(){if(Array.from(document.querySelectorAll("button")).find((e=>"Log in"===e.textContent))&&(alert("You are not logged in! You have to login to offerup first."),1))return!1;let e=document.querySelector("#runfrom").value,t=document.querySelector("#rununtil").value;if(t&&e){const n=function(e,t){const n=new Date,i=60*n.getHours()+n.getMinutes(),[s,r]=e.split(":").map(Number),o=60*s+r,[a,l]=t.split(":").map(Number),c=60*a+l;return o<=c?i>=o&&i<=c:i>=o||i<=c}(e,t);return n}return alert("No schedule set! Bot will not run."),!1}async function Ue(e,t,n,i){if(!window.isAllowed)return console.error("You are not allowed to use this bot! x("),"not-allowed";await(0,y.getConsoleMessages)(),await Ae();const s={keyword:e,radius:document.getElementById("radius").value||"65"};n&&(s.lat=n.lat,s.lon=n.lon);const r=document.querySelector("#listing_max_price").value,o=document.querySelector("#listing_min_price").value;r&&(s.priceMax=r),o&&(s.priceMin=o),String(e).match(/category/i)&&(e=(e=e.replace(/\/?category\/?/i,"")).replace(/\/$/,""),s.keyword=e),s.isSearchWithFilter=i;const{listings:a,cursor:l,isStopAfterXMessagesReached:c,isNotSortedByCreationTime:u,error:d}=await Y(s);if(d)return"keyword-search-failed";unsafeWindow.listings=a;let h,m=l;if(c||console.log(`Listings Fetched: ${a.length}`),c||(h=await Fe(a,e,t,!!m,n,u)),await we(),h)return h;if(c)return"stop_after_x_messages_reached";for(;m;){s.cursor=m;const{listings:i,cursor:r,isNotSortedByCreationTime:o,error:a}=await Y(s);if(a)return"keyword-search-failed";if(m=r,console.log(`Listings Fetched: ${i.length}`),h=await Fe(i,e,t,!!m,n,o),await we(),h)return h}return"no more results"}async function Fe(e,t,n,i,r,o){if(!unsafeWindow.isRun)return console.log("Bot stopped. - 6"),"quit";let a,l,c,u,d=[...e];if(console.log("aListings",d),(0,y.CONSOLE_MESSAGE)("fetch_listings",{num_listings:d.length,keyword:t},n),d.errorDescription)return(0,y.CONSOLE_MESSAGE)("custom","Failed to get listings. API has failed."),await(0,W._)(864e5),"quit";if((await(0,C.o)()).addRun(),d&&Array.isArray(d)&&(await(0,C.o)()).addTotalListingsScraped(d),d.forEach(((e,t)=>{e.sortOrder=t})),a=d.length,d=await async function(e){const t=e.length,n=[];await Promise.all(e.map((async e=>{const t=e.id;try{await(0,k.skips)().isSkipListing(t)||n.push(e)}catch(e){console.error(`Error checking listing ${t}:`,e)}})));const i=n.length;return i!==t&&console.log(`Filtered out ${t-i} of ${t} skipped listings.`),n}(d),u=d.length,console.log("In Listing Skiplist: "+(a-u)),u!==a&&((0,y.CONSOLE_MESSAGE)("custom",`Filtered out ${a-u} listings that were in skip list.`),window.debug&&alert(`Filtered out ${a-u} listings that were in skip list.`)),a=d.length,d=await async function(e){const t=e.length,n=[];await Promise.all(e.map((async e=>{const t=e.id;try{await(0,k.skips)().isSkipMessagedListing(t)||n.push(e)}catch(e){console.error(`Error checking listing ${t}:`,e)}})));const i=n.length;return i!==t&&console.log(`Filtered out ${t-i} of ${t} skipped messaged listings.`),n}(d),u=d.length,console.log("In Listings Messaged List: "+(a-u)),u!==a&&((0,y.CONSOLE_MESSAGE)("custom",`Filtered out ${a-u} listings that were messaged before.`),window.debug&&alert(`Filtered out ${a-u} listings that were messaged before.`)),a=d.length,d=await async function(e){const t=e.length,n=[],i=[];await Promise.all(e.map((async e=>{const t=e.id,s=e&&e.seller;if(!s||!s.id)return void console.error(`Failed to get sellerId of listing ${t}!`);const r=s.id;try{await(0,k.skips)().isSkipMessagedUser(r)?i.push((0,C.o)().then((e=>e.addSkipped()))):n.push(e)}catch(e){console.error(`Error processing listing ${t}:`,e)}})));const s=n.length;return s!==t&&console.log(`Filtered out ${t-s} of ${t} messaged sellers.`),n}(d),u=d.length,console.log("In Owner Messaged List: "+(a-u)),u!==a&&((0,y.CONSOLE_MESSAGE)("custom",`Filtered out ${a-u} owners that were messaged before.`),window.debug&&alert(`Filtered out ${a-u} owners that were messaged before.`)),a=d.length,d=await async function(e){const t=e.length,n=[],i=[];await Promise.all(e.map((async e=>{const t=e.id,s=e&&e.seller;if(!s||!s.id)return void console.error(`Failed to get sellerId of listing ${t}!`);const r=s.id,o=s.name;try{await(0,k.skips)().isSkipUser(r)?(i.push((0,C.o)().then((e=>e.addSkipped()))),(0,y.CONSOLE_MESSAGE)("user_skip",{owner_id:r,owner_name:o,listing_id:t,listing_name:e.title})):n.push(e)}catch(e){console.error(`Error checking seller ${r} for listing ${t}:`,e)}})));const s=n.length;return s!==t&&console.log(`Filtered out ${t-s} of ${t} skipped sellers.`),n}(d),u=d.length,console.log("In Owner Skip List: "+(a-u)),u!==a&&((0,y.CONSOLE_MESSAGE)("custom",`Filtered out ${a-u} owners that are in skip list.`),window.debug&&alert(`Filtered out ${a-u} owners that are in skip list.`)),a=d.length,l=[...d],d=await async function(e,t){const n=e.length,i=[...e];e=e.filter(A);const s=i.filter((t=>!e.includes(t))),r=[];let o=document.querySelector("#ta #title_must_include").value;s.forEach((async e=>{const n=(0,k.skips)().saveToSkipListing(e.id,`Title does not contain match. Title = ${e.title}. Query = ${t}. Title must contain = ${o}`,"NA");r.push(n)})),(await(0,C.o)()).addSkipped(s.length),await Promise.all(r);const a=e.length;return a!==n&&(0,y.CONSOLE_MESSAGE)("skip_no_keyword",{num_listings:n-a}),e}(d,t),c=[...d],u=d.length,console.log("No match in title: "+(a-u)),u!==a&&((0,y.CONSOLE_MESSAGE)("custom",`Filtered out ${a-u} listings that didn't have match in title.`),window.debug&&alert(`Filtered out ${a-u} listings that didn't have match in title.`)),a=d.length,l=[...d],d=await async function(e){const t=e.length,n=[];for(const t of e){const e=t.title,i=await(0,N.$)(e);i&&(await(0,k.skips)().saveToSkipListing(t.id,`Title Skipword "${i}"`),(await(0,C.o)()).addSkipped()),i||n.push(t)}const i=(e=n).length;return i!==t&&(0,y.CONSOLE_MESSAGE)("custom",`Skipped ${t-i} containing skip word in title.`),e}(d),u=d.length,console.log("Skip word in title: "+(a-u)),c=[...d],u!==a){(0,y.CONSOLE_MESSAGE)("custom",`Filtered out ${a-u} listings that had skip words in title.`);const e=function(e,t,n){const i=e.map((e=>e.id)),s=t.map((e=>e.id)),r=i.filter((e=>!s.includes(e))),o=e.filter((e=>r.includes(e.id)));return o.map((e=>e.title))}(l,c),t=e.join("\n");window.debug&&(console.log("Removed Titles",t),alert(`Filtered out ${a-u} listings that had skip words in title.`))}a=d.length,d=await(0,O.f)(d),u=d.length,console.log("Not in price range: "+(a-u)),u!==a&&((0,y.CONSOLE_MESSAGE)("custom",`Filtered out ${a-u} listings that are not in price range.`),window.debug&&alert(`Filtered out ${a-u} listings that are not in price range.`));const h=d.length;window.debug&&alert("Listings left after filtering: "+h);let m=!1;d.sort(((e,t)=>e.sortOrder-t.sortOrder)),unsafeWindow.aListings=d,console.log(`New Listings: ${h}`);for(let e=0;e<h;e++){if(!Pe())return"schedule_not_active";if(window.listingsChecked||(window.listingsChecked=0),window.listingsChecked+=1,window.listingsChecked>s.listingsPerKeyword)return window.listingsChecked=0,"listingsPerKeyword reached.";if(!unsafeWindow.isRun)return console.log("Bot stopped. - 1"),"quit";if(n!==unsafeWindow.runningInstanceId)return"quit";const t=d[e]&&d[e].id,i=d[e]&&d[e].title;if(!t){console.error("listing has no id");continue}console.log(`(${e+1}/${h}) (${t}) [${i}]`);const a=await(0,T.z)({id:t});if(a.error){if(console.error("Failed to get listing details.",a.error),"rate_limit_exceeded"===a.error_code){window.isKO=!0;const e=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,t=moment(e).calendar();(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:t}),(await(0,C.o)()).addKo(),(await(0,C.o)()).addSkipped(),await(0,W._)(60*s.waitIfSpamDetected*1e3),window.isKO=!1}continue}Object.keys(a).length;const l=a.seller?.user_id;if(l&&await(0,k.skips)().isSkipMessagedUser(l)){console.log(`User was already messaged (${l}): Fail`),(0,y.CONSOLE_MESSAGE)("user_already_messaged",{owner_id:l,listing_id:t},n),(await(0,C.o)()).addSkipped(),console.log(`User ${l} was already messaged.`),await(0,k.skips)().saveToSkipListing(t,`User ${l} was already messaged.`,a.creationTime);continue}let c,u;if(a.location&&r){if(u=parseInt(document.getElementById("radius").value||"65"),c=Le(a.location.latitude,a.location.longitude,r.lat,r.lon),c&&Math.round(c)>u){console.log(`Listing is within range ${Math.round(c)} < ${u} miles: Fail`),(0,y.CONSOLE_MESSAGE)("custom",`Listing ${i} is too far away. ${Math.round(c)}/${u} km.`),(await(0,C.o)()).addSkipped(),await(0,k.skips)().saveToSkipListing(t,`[${a.location.latitude}, ${a.location.longitude}] - [${r.lat}, ${r.lon}] = [${Math.round(c)}] > [${u}]`,a.creationTime);continue}console.log(`Listing is within range ${Math.round(c)} < ${u} miles: Pass`)}const p=a.description;if(p){let e=await(0,N.P)(p);if(e){console.log("Skip word in description: Fail"),(0,y.CONSOLE_MESSAGE)("skipword_found_description",{listing_name:i,listing_id:t},n),(await(0,C.o)()).addSkipped(),await(0,k.skips)().saveToSkipListing(t,`Description Skipword "${e}"`,a.creationTime);continue}}if(console.log("Skip word in description: Pass"),a.creationTime){const e=document.getElementById("listing_max_age");if(e){const t=e.value;if(0!==Number(t))if(Number(t)<1){const e=100*t,n=(0,Oe.h)(a.creationTime);if(n>e){if((0,y.CONSOLE_MESSAGE)("skip_old_listing_hours",{age:n,listing_id:a.id,listing_name:a.title}),await(0,k.skips)().saveToSkipListing(a.id,`ListingAge ${n}h > MaxAge ${e}h`,a.creationTime),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail",n,"hrs >",e),console.log("FAIL: added to listing skip list"),o)continue;return"old_listing_found"}}else{const e=(0,Oe.f)(a.creationTime);if(e>t){if((0,y.CONSOLE_MESSAGE)("skip_old_listing",{age:e,listing_id:a.id,listing_name:a.title}),await(0,k.skips)().saveToSkipListing(a.id,`ListingAge ${e}d > MaxAge ${t}d`,a.creationTime),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail",e,"days > ",t),console.log("FAIL: added to listing skip list"),o)continue;return"old_listing_found"}}}const t=document.getElementById("listing_min_age");if(t){const e=t.value;if(0!==Number(e))if(Number(e)<1){const t=100*e,n=(0,Oe.h)(a.creationTime);if(n<t){(0,y.CONSOLE_MESSAGE)("skip_old_listing_hours",{age:n,listing_id:a.id,listing_name:a.title}),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail.",n,"hrs < ",t),console.log("FAIL: added to listing skip list");continue}}else{const t=(0,Oe.f)(a.creationTime);if(t<e){(0,y.CONSOLE_MESSAGE)("skip_old_listing",{age:t,listing_id:a.id,listing_name:a.title}),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail.",t,"days < ",e),console.log("FAIL: added to listing skip list");continue}}}}console.log("ListingAge: Pass");const f=a&&a.seller&&a.seller.id,g=a&&a.seller&&a.seller.name,_=a&&a.seller&&a.seller.join_year;console.log("ownerJoinedYear",_);let w=document.getElementById("skip_profiles_created_after_year");if(w&&(w=Number(w.value)),w||(w=s.DEFAULT_SKIP_OWNERCREATION_YEAR),w<=(new Date).getFullYear()){if(_&&_>=w){(0,y.CONSOLE_MESSAGE)("custom",`Skipped new account ${g} (${f})`);const e=`Profile Created ${_} >= ${w}`;await(0,k.skips)().saveToSkipListing(t,e),a.creationTime,await(0,k.skips)().saveToSkipUsers(f,e,a.creationTime),(await(0,C.o)()).addSkipped(),console.log(`Profile created (${_}) < ${w}: Fail`),console.log("FAIL: added to listing/owner skip list");continue}console.log(`Profile created (${_}) < ${w}: Pass`)}const v=await(0,Ne.O)(f,!0);if(v&&Array.isArray(v)&&(await(0,C.o)()).addTotalListingsScraped(v),await te("Fetched user listings."),!await L(t,f,g,0,"",v)){await(0,C.o)().then((e=>e.addSkipped())),console.log("FAIL: added to listing/owner skip list");continue}let b,S;console.log("All Pass: Messaging...");const E=document.getElementById("switch-enablegpt");if(E&&E.checked){const e=Re(a,v);console.log("Generating message");const t=await(0,Me.generateMessage)(e.text,e.photos);if(console.log("Got GPT response",t),"skip"===t.status){await(0,k.skips)().saveToSkipListing(a.id,t.message,a.creationTime);continue}if("message"===t.status){let e=t.message;Array.isArray(e)&&(e=e.join("\n")),b=t.message}else if("error"===t.status)return"halted";S=await ke({listingData:a,instanceId:n,gptMessages:b,searchCoordinates:r,distance:c,radiusSetting:u})}else S=await ke({listingData:a,instanceId:n,searchCoordinates:r,distance:c,radiusSetting:u});if(S){(await Q()).addMessageSent(),m=!0;const e=a.price;(0,y.CONSOLE_MESSAGE)("message_sent",{message_sent:S,listing_price:e,listing_id:t,listing_name:i},n);const r=`Messaged owner [${f}] on listing [${t}]`;await x(f,g,v,r,t),await(0,k.skips)().saveToMessagedUsers(f,t,a.creationTime);let o=document.getElementById("timeout_listings_messaged_min").value;o||(o=s.userDelay[0]);let l=document.getElementById("timeout_listings_messaged_max").value;l||(l=s.userDelay[1]);const c=1e3*D(o,l),u=(new Date).getTime()+c;if((0,y.CONSOLE_MESSAGE)("timeout",{message:`Finished sending all messages to ${g} (${f}).`,hh:moment(u).format("HH"),mm:moment(u).format("mm"),ss:moment(u).format("ss")},n),await(0,W._)(c),await J())return}else(0,y.CONSOLE_MESSAGE)("message_not_sent",{listing_id:t,listing_name:i},n),await(0,C.o)().then((e=>e.addSkipped()));await Ce()}if(!Pe())return"schedule_not_active";!m&&i&&await async function(e){let t=document.getElementById("timeout_end_of_run_min").value;t||(t=s.timeout_perpage[0]);let n=document.getElementById("timeout_end_of_run_max").value;n||(n=s.timeout_perpage[1]),await ee(t,n,"Wait before fetching next results page.")}()}function qe(){document.querySelector("#switch-rununtil").parentElement.MaterialSwitch?((0,_.o)(!0),document.querySelector("#switch-rununtil").parentElement.MaterialSwitch.off(),(0,i.chromeStorageSet)("input_switch-rununtil",!1),(0,i.chromeStorageRemove)("lastKwIdx")):setTimeout((()=>{qe()}),2e3)}var je=n(7091);function Ve(e){!function(e){document.querySelectorAll('[name="run-mode"]').forEach((t=>{t.disabled=!e}))}(e);const t=["#keywords","#skipwords_title","#skipwords_description","#message_1","#acceptmessage","#message_2","#message_3","#followup_1","#followup_2","#followup_3","#messageonreply_1","ownerlisting_kw_match"];for(const n of t){let t=document.querySelector(n);t&&(t.disabled=!e,t.style.opacity=e?"1":"0.8")}}const Ge=n(6503);function Be(){const e=[];return Object.keys(me()).forEach((async t=>{const n=await me(!0)[t];Ge.validate(n)||e.push(t)})),!e.length||((0,y.CONSOLE_MESSAGE)("custom","Invalid spintax detected."),alert("You have invalid spintax format in "+e.join(", ")),!1)}async function $e(){const e=await(0,i.chromeStorageGet)("auth_key");if(e)return u({auth_key:e})}function Ke(e){window.isWaitingForSchedule=!0,document.getElementById("switch-rununtil").checked?(h(),(0,y.CONSOLE_MESSAGE)("halted_schedule"),Pe()?(window.isWaitingForSchedule=!1,$e().then((t=>{t?(unsafeWindow.isRun=1,(0,C.o)().then((e=>e.resetCurrentStreak())),Je(e)):(console.log("Subscription is not active."),(0,g.s)("Subscription is not active. Reloading in",10).then((()=>{window.location.reload()})))}))):setTimeout((()=>{window.isWaitingForSchedule=!1,Ke(e)}),5e3)):window.isWaitingForSchedule=!1}async function We(){const e={listing_max_age:document.getElementById("listing_max_age").value,listing_min_age:document.getElementById("listing_min_age").value,owner_message_expiry:document.getElementById("owner_message_expiry").value};await fetch(`https://us-central1-trade-apples.cloudfunctions.net/facebookbot?savevariables=1&userid=${window.taUID}`,{method:"POST",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).catch((e=>{console.error("Failed to save user variables",e)}))}async function ze(){if(!window.userGmail)return void console.error("Failed to get listing. No user Gmail");(0,y.CONSOLE_MESSAGE)("custom","Waiting for webhook"),unsafeWindow.isWaitingForWebhook=!0;const e=window.hookEntries?.shift();if(!e)return await(0,W._)(1e3),ze();try{const t=(0,a.ad)(),n=await(0,a.i3)(t,(async t=>{const n=(await t.get(e)).data();if(!n.account_id)return t.update(e,{account_id:window.fbuid,instance_id:window.instanceId,snatchbot_ts:(0,a.Bt)()}),unsafeWindow.isWaitingForWebhook=!1,n})).catch((e=>{console.error("runTransaction failed",e)}));return n?((0,y.CONSOLE_MESSAGE)("custom","Webhook received: "+n?.listing_id),n):(await(0,W._)(1e3),ze())}catch(e){console.error("Error getting listing",e)}}async function He(){if(await J())return;const e=await ze();if(console.log({listingHookData:e}),await async function(){return new Promise(((e,t)=>{const n=setInterval((()=>{unsafeWindow.isWaitingForStopFollowup||(e(),clearInterval(n))}),1e3)}))}(),e?.listing_id){(0,y.CONSOLE_MESSAGE)("custom","Processing listing: "+e.listing_id);const t=await async function({listing_id:e,seller_id:t}){let n=await(0,k.skips)().isSkipListing(e);if(n)return(0,y.CONSOLE_MESSAGE)("custom","Listing is already in skip list: "+e,!0),{skip:!0,reason:"already in skip list"};if((0,y.CONSOLE_MESSAGE)("custom","Listing is not in skip list: "+e,!0),n=await(0,k.skips)().isSkipMessagedListing(e),n)return(0,y.CONSOLE_MESSAGE)("custom","Listing is already in messaged list: "+e,!0),{skip:!0,reason:"already in messaged list"};if((0,y.CONSOLE_MESSAGE)("custom","Listing is not in messaged list: "+e,!0),t){if(await(0,k.skips)().isSkipMessagedUser(t))return(0,y.CONSOLE_MESSAGE)("custom","Seller is already in messaged list: "+t,!0),{skip:!0,reason:"already in messaged list"};if((0,y.CONSOLE_MESSAGE)("custom","Seller is not in messaged list: "+t,!0),await(0,k.skips)().isSkipUser(t))return(0,y.CONSOLE_MESSAGE)("custom","Seller is already in skip list: "+t,!0),{skip:!0,reason:"already in skip list"};(0,y.CONSOLE_MESSAGE)("custom","Seller is not in skip list: "+t,!0)}return async function({listing_id:e,listingData:t}){if((0,y.CONSOLE_MESSAGE)("custom","Processing listing: "+e,!0),t.error){if(console.error("Failed to get listing details.",t.error),"rate_limit_exceeded"===t.error_code){window.isKO=!0;const e=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,t=moment(e).calendar();(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:t}),(await(0,C.o)()).addKo(),(await(0,C.o)()).addSkipped(),await(0,W._)(60*s.waitIfSpamDetected*1e3),window.isKO=!1}return{error:t.error,error_code:t.error_code}}if(0===Object.keys(t).length)return(0,y.CONSOLE_MESSAGE)("custom","LISTING SKIPPED - no listing data.: "+e,!0),{skip:!0,reason:"no listing data"};const n=t.seller?.user_id;if(n&&await(0,k.skips)().isSkipMessagedUser(n))return console.log(`User was already messaged (${n}): Fail`),(0,y.CONSOLE_MESSAGE)("user_already_messaged",{owner_id:n,listing_id:e}),(await(0,C.o)()).addSkipped(),console.log(`User ${n} was already messaged`),await(0,k.skips)().saveToSkipListing(e,`User ${n} was already messaged.`,t.creationTime),{skip:!0,reason:"already messaged"};const i=t.description;if(i){let n=await(0,N.P)(i);if(n)return console.log(`Skip word in description: Fail [${n}]`),(0,y.CONSOLE_MESSAGE)("skipword_found_description",{listing_name:t.title,listing_id:e}),(await(0,C.o)()).addSkipped(),await(0,k.skips)().saveToSkipListing(e,`Description Skipword "${n}"`,t.creationTime),{skip:!0,reason:"skipword_found_description"}}if(console.log("Skip word in description: Pass"),t.creationTime){const e=document.getElementById("listing_max_age");if(e){const n=e.value;if(0!==Number(n))if(Number(n)<1){const e=100*n,i=(0,Oe.h)(t.creationTime);if(i>e)return(0,y.CONSOLE_MESSAGE)("skip_old_listing_hours",{age:i,listing_id:t.id,listing_name:t.title}),await(0,k.skips)().saveToSkipListing(t.id,`ListingAge ${i}h > MaxAge ${e}h`,t.creationTime),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail",i,"hrs >",e),console.log("FAIL: added to listing skip list"),{skip:!0,reason:"skip_old_listing"}}else{const e=(0,Oe.f)(t.creationTime);if(e>n)return(0,y.CONSOLE_MESSAGE)("skip_old_listing",{age:e,listing_id:t.id,listing_name:t.title}),await(0,k.skips)().saveToSkipListing(t.id,`ListingAge ${e}d > MaxAge ${n}d`,t.creationTime),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail",e,"days > ",n),console.log("FAIL: added to listing skip list"),{skip:!0,reason:"skip_old_listing"}}}const n=document.getElementById("listing_min_age");if(n){const e=n.value;if(0!==Number(e))if(Number(e)<1){const n=100*e,i=(0,Oe.h)(t.creationTime);if(i<n)return(0,y.CONSOLE_MESSAGE)("skip_old_listing_hours",{age:i,listing_id:t.id,listing_name:t.title}),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail.",i,"hrs < ",n),console.log("FAIL: added to listing skip list"),{skip:!0,reason:"skip_old_listing"}}else{const n=(0,Oe.f)(t.creationTime);if(n<e)return(0,y.CONSOLE_MESSAGE)("skip_old_listing",{age:n,listing_id:t.id,listing_name:t.title}),(await(0,C.o)()).addSkipped(),console.log("ListingAge: Fail.",n,"days < ",e),console.log("FAIL: added to listing skip list"),{skip:!0,reason:"skip_old_listing"}}}}console.log("ListingAge: Pass");const r=t&&t.seller&&t.seller.id,o=t&&t.seller&&t.seller.name,l=t&&t.seller&&t.seller.join_year;console.log("ownerJoinedYear",l);let c=document.getElementById("skip_profiles_created_after_year");if(c&&(c=Number(c.value)),c||(c=s.DEFAULT_SKIP_OWNERCREATION_YEAR),c<=(new Date).getFullYear()){if(l&&l>=c){(0,y.CONSOLE_MESSAGE)("custom",`Skipped new account ${o} (${r})`);const n=`Profile Created ${l} >= ${c}`;return await(0,k.skips)().saveToSkipListing(e,n),t.creationTime,await(0,k.skips)().saveToSkipUsers(r,n,t.creationTime),(await(0,C.o)()).addSkipped(),console.log(`Profile created (${l}) < ${c}: Fail`),console.log("FAIL: added to listing/owner skip list"),{skip:!0,reason:"skip_new_account"}}console.log(`Profile created (${l}) < ${c}: Pass`)}const u=await(0,Ne.O)(r,!0);if(u&&Array.isArray(u)&&(await(0,C.o)()).addTotalListingsScraped(u),await te("Fetched user listings."),!await L(e,r,o,t.title,"",u))return await(0,C.o)().then((e=>e.addSkipped())),console.log("FAIL: added to listing/owner skip list"),{skip:!0,reason:"skip_owner_kw_listings"};let d,h;console.log("All Pass: Messaging...");const m=document.getElementById("switch-enablegpt");if(m&&m.checked){const e=Re(t,u);(0,y.CONSOLE_MESSAGE)("custom","Generating message");const n=await(0,Me.generateMessage)(e.text,e.photos);if((0,y.CONSOLE_MESSAGE)("custom","Got GPT response: "+JSON.stringify(n),!0),"skip"===n.status)return await(0,k.skips)().saveToSkipListing(t.id,n.message,t.creationTime),{skip:!0,reason:"skip_gpt: "+String(n.message).replace(/<\/?skip>/g,"").trim()};if("message"===n.status){let e=n.message;Array.isArray(e)&&(e=e.join("\n")),d=n.message}else if("error"===n.status)return{skip:!0,reason:"skip_gpt_error"};h=await ke({listingData:t,instanceId:unsafeWindow.runningInstanceId,gptMessages:d})}else h=await ke({listingData:t,instanceId:unsafeWindow.runningInstanceId});if(h){await async function(e){if(!e)return void console.error("Failed to update mesaged ts. Missing listing_id");if(!window.userGmail)return void console.error("Failed to update mesaged ts. No user Gmail");const t=(0,a.ad)(),n=(0,a.JU)(t,"webhook",window.userGmail,"facebook",e);return(0,a.r7)(n,{messaged_ts:(0,a.Bt)()})}(e),(await Q()).addMessageSent();const n=t.price;(0,y.CONSOLE_MESSAGE)("message_sent",{message_sent:h,listing_price:n,listing_id:e,listing_name:t.title});const i=`Messaged owner [${r}] on listing [${e}]`;await x(r,o,u,i,e),await(0,k.skips)().saveToMessagedUsers(r,e,t.creationTime);let l=document.getElementById("timeout_listings_messaged_min").value;l||(l=s.userDelay[0]);let c=document.getElementById("timeout_listings_messaged_max").value;c||(c=s.userDelay[1]);const d=1e3*D(l,c),m=(new Date).getTime()+d;(0,y.CONSOLE_MESSAGE)("timeout",{message:`Finished sending all messages to ${o} (${r}).`,hh:moment(m).format("HH"),mm:moment(m).format("mm"),ss:moment(m).format("ss")}),await(0,W._)(d)}else(0,y.CONSOLE_MESSAGE)("message_not_sent",{listing_id:e,listing_name:t.title}),await(0,C.o)().then((e=>e.addSkipped()));await Ce()}({listing_id:e,listingData:await(0,T.z)({id:e})})}({listing_id:e.listing_id,seller_id:e.seller_id});t?.skip&&((0,y.CONSOLE_MESSAGE)("custom","Listing skipped: "+e.listing_id),await async function(e,t){if(!e)return void console.error("Failed to update skip reason. Missing listing_id");if(!t)return void console.error("Failed to update skip reason. Missing reason");if(!window.userGmail)return void console.error("Failed to update skip reason. No user Gmail");const n=(0,a.ad)(),i=(0,a.JU)(n,"webhook",window.userGmail,"facebook",e);return(0,a.r7)(i,{skip_reason:t,skip_ts:(0,a.Bt)()})}(e.listing_id,t.reason))}return He()}async function Qe(){return unsafeWindow.isFollowUpInterValRunning=!0,unsafeWindow.isWaitingForWebhook&&(unsafeWindow.isWaitingForStopFollowup=!0,await async function(){if(!le())return await oe(_e),void await oe(ye);let e,t;try{const n=await ae({limitDays:!0});e=ve({threads:n,hasUnRead:!0}),t=ve({threads:n,hasUnRead:!1}),await(0,i.chromeStorageSet)("aLatestUnreadThreadInfos",JSON.stringify(e)),await(0,i.chromeStorageSet)("aLatestReadThreadInfos",JSON.stringify(t))}catch(n){"fetchInboxThreads already ran less than 15 minutes ago. Skipping."===n.message&&(e=await(0,i.chromeStorageGet)("aLatestUnreadThreadInfos"),e&&(e=JSON.parse(e)),t=await(0,i.chromeStorageGet)("aLatestReadThreadInfos"),t&&(t=JSON.parse(t)))}e&&await Se(e),t&&await Ee(t)}(),unsafeWindow.isWaitingForStopFollowup=!1),await(0,W._)(5e3),Qe()}async function Je(e){if(window.viewermode)return void(0,je.u)("Tab is in viewer mode.");if(Ve(!1),!Pe())return Ve(!0),void Ke(e);if(s.showAlerts&&alert("start"),!Be())return qe(),void Ve(!0);if(I((0,r.W)()),await async function(){if(await S()){const e=await S(),t=(new Date).getTime()+e,n=moment(t).calendar();return(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),await(0,W._)(e),!0}return!1}(),"webhook"===await async function(){return"mode-webhook"===await(0,i.chromeStorageGet)("radio_run-mode")?"webhook":"scrape"}())return void await async function(){return window.webhookMode=!0,await(0,y.getConsoleMessages)(),await Ae(),unsafeWindow.isFollowUpInterValRunning||Qe(),unsafeWindow.isSnapshotListening||async function(){if(unsafeWindow.isSnapshotListening=!0,!window.userGmail)return void console.error("Failed to listen snapshots. No user Gmail");console.log("Running listenSnapshots");const e=(0,a.ad)(),t=(0,a.IO)((0,a.hJ)(e,"webhook",window.userGmail,"facebook"),(0,a.ar)("account_id","==",""));(0,a.cf)(t,(async e=>{if(e.empty)return console.log("no hooks available."),void(window.hookEntries=[]);const t=e.docs.map((e=>e.ref));window.hookEntries=t}))}(),He()}();const t=await v();if(t.error)return void console.error(t.error);const{keyword:n,coordinates:o,isSearchWithFilter:l}=t;if(!await async function(e,t){return!(document.getElementById("switch-loopsearch").checked||!t||!t.isEnd)&&((0,y.CONSOLE_MESSAGE)("custom","Bot stopped because all Search & Locations completed."),!0)}(0,o))for(;;){if(!unsafeWindow.isRun||e!==unsafeWindow.runningInstanceId){console.log("Bot stopped. - 3");break}We(),console.log("Checking stored subscription ID..."),await $e()||console.log("No valid subscription ID found. Running in TRIAL mode.");const t=await Ue(n,e,o,l);if(await Ye(t,e))return;window.messagesSent>1&&window.messagesSent%20==0&&await Xe()}}async function Ye(e,t){const n=D(1,5),i=(new Date).getTime()+60*n*1e3,s={schedule_not_active:"Schedule is not active.","keyword-search-failed":"Failed to search keyword. Starting a new search.","no more results":"No listings left.","listingsPerKeyword reached.":"Listings per keyword has been reached. Starting a new search.",stop_after_x_messages_reached:`Stopped messaging after sending ${await(await Q()).getMessagesSent()} messages.`,"not-allowed":"You are not allowed to use this bot.",old_listing_found:"Found an old listing. Will move to next keyword.",halted:"Bot halted."};return e in s&&("halted"===e||"not-allowed"===e?((0,y.CONSOLE_MESSAGE)("custom",s[e]),!0):((0,y.CONSOLE_MESSAGE)("timeout",{message:s[e],hh:moment(i).format("HH"),mm:moment(i).format("mm"),ss:moment(i).format("ss")}),await(0,W._)(60*n*1e3),Je(t),!0))}async function Xe(){const e=(new Date).getTime()+60*s.delayPerXMessages*1e3;(0,y.CONSOLE_MESSAGE)("timeout",{message:"20 messages have been sent",hh:moment(e).format("HH"),mm:moment(e).format("mm"),ss:moment(e).format("ss")}),await(0,W._)(60*s.delayPerXMessages*1e3)}const Ze="bot_running_lock";async function et(e){try{const t=await(0,i.chromeStorageGet)(Ze);t&&t.instanceId===e&&(await(0,i.chromeStorageRemove)(Ze),console.log(`Removed lock for instance ${e} during cleanup`),(0,y.CONSOLE_MESSAGE)("custom",`Removed lock for instance ${e} during cleanup`))}catch(e){console.error("Error during cleanup:",e)}}async function tt(e=0){try{const t=await(0,i.chromeStorageGet)(Ze);if(t){const n=(new Date).getTime()-new Date(t.timestamp).getTime();if(n<3e4)return void await async function(e,t,n){const i=Math.max(1e3,3e4-t+2e3),s=2-n,r=`Another bot instance (${e.instanceId}) is already running. Started ${Math.round(t/1e3)}s ago. Will retry in ${Math.round(i/1e3)}s (including 2s allowance)... Retries left: ${s}`;console.log(r),(0,y.CONSOLE_MESSAGE)("custom",r),n<2?setTimeout((()=>tt(n+1)),i):console.error("Max retries reached. Aborting...")}(t,n,e);console.log(`Found stale lock from instance ${t.instanceId} (${Math.round(n/1e3)}s old). Taking over...`),(0,y.CONSOLE_MESSAGE)("custom",`Found stale lock from instance ${t.instanceId} (${Math.round(n/1e3)}s old). Taking over...`)}const n=Math.round(1e3*Math.random());unsafeWindow.runningInstanceId=n,await async function(e,t){await nt(e),console.log(`Bot instance ${e} starting...${t>0?` (after ${t} retries)`:""}`),(0,y.CONSOLE_MESSAGE)("custom",`Bot instance ${e} starting...${t>0?` (after ${t} retries)`:""}`),GM.addValueChangeListener("page_unload",(async()=>await et(e))),window.addEventListener("beforeunload",(()=>GM.setValue("page_unload",Date.now()))),window.addEventListener("unload",(async()=>await et(e))),(0,i.chromeStorageSet)("input_switch-rununtil",!0),unsafeWindow.isRun=1,(0,_.o)(!1)}(n,e);const s=setInterval((async()=>{try{if(!unsafeWindow.isRun)return void await async function(e,t){clearInterval(t),await et(e)}(n,s);await nt(n)}catch(e){console.error("Error in lock refresh:",e)}}),1e4);await async function(){try{await Je(unsafeWindow.runningInstanceId)}catch(e){console.trace(),console.error("Error during bot start:",unsafeWindow.runningInstanceId,e);const t=(new Error).stack.split("\n"),n=(t[2]||"").split(":")[1]?.trim()||"unknown";await(0,f._apiSendBug)({error:"Facebookbot encountered an error",details:e.toString(),lineNumber:n,trace:t.join("\n")});const i=unsafeWindow.runningInstanceId,s=`Bot instance ${i} encountered an error. Removing lock before restart...`;console.log(s),(0,y.CONSOLE_MESSAGE)("custom",s),await et(i),await(0,g.s)("Bot is restarting in ",60),window.location.reload()}}()}catch(e){throw console.error("Error in runBot:",e),e}}async function nt(e){await(0,i.chromeStorageSet)(Ze,{timestamp:(new Date).toISOString(),instanceId:e})}var it=n(4147);function st(e,t){for(const n in e){const i=rt(e[n],t);if(i)return{role:i,domain:n}}return!1}function rt(e,t){const n=e.roles;if(Array.isArray(n)){Array.isArray(t)||(t=[t]);for(const e of t)if(n.includes(e))return e}return null}function ot(e,t){t=Number(t),e=Number(e);const n=new Date(t);return(new Date-n)/864e5>=e}async function at(e){window.global||(window.global={}),window.global.reqCounter||(window.global.reqCounter=0);const t={};let n=e&&e.cursor;const i=e&&e.previousThreads;n&&(t.cursor=n,t.count=12);let o=e&&e.page;o||(o=1),console.log("Fetching inbox threads. Page: ",o);const a=(0,G.H)(),l=(0,V.S)();for(var c="2",u=0;u<a.length;u++)c+=a.charCodeAt(u);const d=(0,V.k)(),h=n?"CometMarketplaceInboxBuyerTabViewPaginationQuery":"CometMarketplaceInboxBuyerTabViewContainerQuery",m=n?"6063301870422274":"9150907031651351",p=(0,r.W)(),f={av:p,__user:p,__a:"1",__req:(window.global.reqCounter++).toString(36),__hs:"19541.HYP:comet_pkg.2.1..2.1",dpr:"2",__ccg:"GOOD",__rev:`${l}`,__s:"r7e81o:lrt2ad:isoco8",__hsi:"7251558458098997704",__dyn:"7AzHJ16UW5Eb8ng5K8G6EjBWobVo66u2i5U4e2C17yUJ3odEnz8K2aewnof8boG0x8bo6u3y4o2Gwfi0LVEtwMw65xO2OU7m2210wEwgolzUO0-E4a3a4oaEnxO0Bo7O2l2Utwwwi831wiEjwZx-3m1mzXw8W58jwGzE8FU5e7oqBwJK2W5olwUwOzEjUlDw-wQK261eBx_y88E3qxWm2Sq2-azo7u3C223908O3216xi4UdUcojxK2B0oobo8oC1hxG1Fw",__csr:"g9Ahf9sGvRRfitNb4HbYZWGGrmxGNIjiq8IgkBbsPYJlWOQP4rEzKGRh6QYx6FlFyQHXAGRry-iBAXh27t6t4mVaigiAh9ULpfCGeVK-uqil4BVF68UZ2QAECeDVy-iaBVVbKWBUKm8iByUvKElhu46cyoybGbyomwxJ93Hz8pzoy4Q4e5aKazEDgK2S9AABx626mUThEap8pCxaqeAhUjyk5Z0zyESdwqqye8KmEKu5UnHwHx-1cKE4O2qUqgjzEqK364UvxO2e2W7U-1gxqVXx29DwZxiawnUcEjxO00BAE2Vg07KK031W2i0nO0yE2HU0obCg6m1Cx-0PQ0XA2-0hm1cwGw0GLqx500LThFU0_60f5x51i0pm0muOwmU-051A07rA04c86S0hEHDwgU1TQqjglwjA1FpU3oQ7iqh2a1HwNw44g2gwb60iTwd-0f9x90",__comet_req:"15",fb_dtsg:a,jazoest:c,lsd:d,__spin_r:l,__spin_b:"trunk",__spin_t:"1688385023",fb_api_caller_class:"RelayModern",fb_api_req_friendly_name:h,variables:JSON.stringify(t),server_timestamps:"true",doc_id:m};let g=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not.A/Brand";v="8", "Chromium";v="114", "Google Chrome";v="114"',"sec-ch-ua-full-version-list":'"Not.A/Brand";v="8.0.0.0", "Chromium";v="114.0.5735.198", "Google Chrome";v="114.0.5735.198"',"sec-ch-ua-mobile":"?0","sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"13.4.1"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1440","x-asbd-id":"129477","x-fb-friendly-name":"CometMarketplaceSearchContentContainerQuery","x-fb-lsd":"IudQ3V8x_C_Vv_XEg-5tyu"},referrer:"https://www.facebook.com/marketplace/110301228992872/search?query=rice",referrerPolicy:"strict-origin-when-cross-origin",body:(0,z.T)(f),method:"POST",mode:"cors",credentials:"include"}).then((async e=>(0,$.u)(e))).then((e=>e.json()));const _=JSON.stringify(g);if(_&&_.match(/api_error_code":368/i)){console.log("Fetch inbox thread rate limited.");const t=(new Date).getTime()+60*s.waitIfSpamDetected*1e3,n=moment(t).calendar();return(0,y.CONSOLE_MESSAGE)("halted_soft",{schedule:n}),(await(0,C.o)()).addKo(),window.isKO=!0,await(0,W._)(60*s.waitIfSpamDetected*1e3),window.isKO=!1,at(e)}let w=[];const v=g&&g.data&&g.data.viewer&&g.data.viewer.marketplaceInboxBuyerMessageThreads&&g.data.viewer.marketplaceInboxBuyerMessageThreads.edges;if(v){const e=document.getElementById("archiveolderthan").value;for(let t=0;t<v.length;t++){const n=v[t],i=n&&n.node;if(i&&i.updated_time_precise)if(ot(e,i.updated_time_precise))w.push(i);else{let t;try{t=i.marketplace_thread_data.messageable_item.marketplace_listing_title}catch(e){}console.log(`Thread ${t} last update is less than <`,e,"will not archive")}}}const b=document.querySelector("#switch-skipunread").checked;let S=await async function(e,t=!0){const n=document.getElementById("amount_to_archive").value||0;let i=0;for(const s of e){const r=s&&s.thread_key&&s.thread_key.thread_fbid;if(r){if(t&&s.unread_count>0){console.log("threadid",r,"has unread messages",s.unread_count);continue}if(!t&&s.unread_count>0&&console.log("Did not skip unread because skipunread is false"),await Z(r,!0),window.iArchived||(window.iArchived=0),window.iArchived+=1,i+=1,window.iArchived>=n){window.iArchived=0;const t=`Archived ${i} threads of ${e.length} threads in Page.`;return console.log(t),console.log(`Reached max archive of ${n}`),"max archive reached"}const o=D(1,5);console.log("Archived",r,"Timeout for",o,"s"),await(0,W._)(1e3*o)}}const s=`Archived ${i} threads of ${e.length} threads in Page.`;console.log(s)}(w,b);if("max archive reached"===S)return w;i&&(w=i.concat(w));const E=g&&g.data&&g.data.viewer&&g.data.viewer.marketplaceInboxBuyerMessageThreads&&g.data.viewer.marketplaceInboxBuyerMessageThreads.page_info;if(E&&E.has_next_page){n=E.end_cursor;const e=D(5,10);return await(0,W._)(1e3*e),console.log("Timeout for",e,"s"),at({cursor:n,previousThreads:w,page:o+1})}return w}async function lt(){"ARCHIVE"===prompt("Are you sure you want to archive all read threads in your marketplace inbox? Type ARCHIVE to confirm:")&&((0,y.CONSOLE_MESSAGE)("custom","Archiving read threads..."),async function(){console.log("Starting to archive threads with no unread messages..."),await at();const e="Finished archiving read threads.";console.log(e),(0,y.CONSOLE_MESSAGE)("custom",e)}())}async function ct(){if(!window.location.href.includes("marketplace/item/"))return void alert("This is not a listing page. Make sure you are in listing page such as facebook.com/marketplace/item/1329223407934470/");let e;try{e=window.location.href.match(/\/item\/(\d+)/)[1]}catch(e){return void alert("Error getting listing id from url")}const t=await(0,T.z)({id:e,includeAllDetails:!0}).catch((()=>{alert("Error fetching listing details")}));let n=[];const i=t&&t.seller&&t.seller.id;if(console.log("ownerid",i),i){const e=await(0,Ne.O)(i,!0);console.log("ownerListings",e),n=e}return Re(t,n)}async function ut(){(0,o.Q)(!0);const e=await ct();let t=e.photos;const n=parseInt(document.getElementById("num_images").value,10);n&&t&&t.length>n&&(t=t.slice(0,n));try{navigator.clipboard.writeText(e.text+"\nPhotos: "+JSON.stringify(t))}catch(e){console.log("Error copying to clipboard",e)}(0,o.Q)(!1),await(0,W._)(1e3),alert("Details has beed copied to clipboard")}async function dt(){const e=(0,a.ad)();(0,o.Q)("Please wait while we are downloading the Owner Skip List"),(0,y.CONSOLE_MESSAGE)("custom","Please wait while we are downloading the Owner Skip List");const t=(0,a.hJ)(e,"facebook_lists",window.userGmail,s.SKIP_SELLERS);mt((await(0,a.PL)(t)).docs.map((e=>e.data())),"Owner Skip List.json"),(0,y.CONSOLE_MESSAGE)("custom","Owner Skip List downloaded successfully"),(0,o.Q)(!1)}async function ht(){const e=(0,a.ad)();(0,o.Q)("Please wait while we are downloading the Listings Skip List"),(0,y.CONSOLE_MESSAGE)("custom","Please wait while we are downloading the Listings Skip List");const t=(0,a.hJ)(e,"facebook_lists",window.userGmail,s.SKIP_LISTINGS);mt((await(0,a.PL)(t)).docs.map((e=>e.data())),"Listings Skip List.json"),(0,y.CONSOLE_MESSAGE)("custom","Listings Skip List downloaded successfully"),(0,o.Q)(!1)}function mt(e,t){const n=JSON.stringify(e,null,2),i=new Blob([n],{type:"text/plain"}),s=URL.createObjectURL(i),r=document.createElement("a");r.setAttribute("href",s),r.setAttribute("download",t),document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(s)}function pt(e){const t=e.target.textContent;if(window.lastInputId){const e=document.getElementById(window.lastInputId[0]);let n=e.value;n=[n.slice(0,window.lastInputId[1]),t,n.slice(window.lastInputId[1])].join(""),e.value=n,e.parentNode.classList.add("is-focused"),e.focus();const i=window.lastInputId[1]+t.length;e.setSelectionRange(i,i)}}function ft(e){let t=e.target.value;t=t.split("\n").map((e=>e.replace(/[^0-9,.-]/g,""))).filter((e=>e.length)),t=t.join("\n"),e.target.value=t}function gt(e){let t=e.target.value;t=t.replace(/[^0-9.-]/g,""),e.target.value=t}function _t(e){let t=e.target.value;t=t.replace(/[^0-9.\-%]/g,""),e.target.value=t}async function yt(){(0,o.Q)("Getting listing details..."),(0,y.CONSOLE_MESSAGE)("custom","Getting listing details...");const e=await ct();if(!e)return void(0,o.Q)(!1);(0,o.Q)("Generating message..."),(0,y.CONSOLE_MESSAGE)("custom","Generating message...");const t=await(0,Me.generateMessage)(e.text,e.photos);if((0,o.Q)(!1),(0,y.CONSOLE_MESSAGE)("custom","Message generated."),"skip"!==t.status){if("message"===t.status){let e=t.message;return Array.isArray(e)&&(e=e.join("\n")),void alert(e)}return"error"===t.status?((0,o.Q)(!1),void alert(t.message)):void 0}alert(t.message)}async function wt(){"LISTINGS"===prompt("Are you sure you want to purge your listings skip list? Type LISTINGS to confirm:")&&((0,y.CONSOLE_MESSAGE)("custom","Purging listings..."),async function(){(0,o.Q)("Purging listings skip list..."),await bt(s.SKIP_LISTINGS,"Listings skip list purged successfully."),(0,o.Q)(!1)}())}async function vt(){"OWNERS"===prompt("Are you sure you want to purge your owners skip list? Type OWNERS to confirm:")&&((0,y.CONSOLE_MESSAGE)("custom","Purging owners..."),async function(){(0,o.Q)("Purging owner skip list..."),await bt(s.SKIP_SELLERS,"Owners skip list purged successfully."),(0,o.Q)(!1)}())}async function bt(e,t){const n=(0,a.ad)(),i=(0,a.hJ)(n,"facebook_lists",window.userGmail,e),s=await(0,a.PL)(i);let r=(0,a.qs)(n),o=0,l=0;console.log("Total documents to delete:",s.size);for(const t of s.docs)r.delete(t.ref),o++,o>=200&&(await St(r,e,l),l+=o,r=(0,a.qs)(n),o=0);o>0&&await St(r,e,l),(0,y.CONSOLE_MESSAGE)("custom",t)}async function St(e,t,n){await e.commit(),(0,o.Q)(`Purging ${t}... ${n+200} documents deleted`)}async function Et(){let e;try{e=await fetch(`https://sheets.hopla.tools/?HT=${s.sheet_id}&format=json&sheet_name=Content`).then((async e=>(0,$.u)(e))).then((e=>e.text()))}catch(t){return await(0,K.Z)({error:"Failed to getDefaultContent. sheets.hopla.tools api response.",res:e}),{}}if(e&&!e.includes("message_1"))return Et();try{return JSON.parse(e)}catch(t){return await(0,K.Z)({error:"Failed to getDefaultContent. sheets.hopla.tools api response.",res:e}),{}}}function It(){function e(e){if("createEvent"in document){const t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange");e.parentElement&&e.parentElement.MaterialTextfield&&e.parentElement.MaterialTextfield.change(e.value)}document.getElementById("page2loading").style.display="block",async function(){let e;try{e=await fetch(`https://sheets.hopla.tools/?HT=${s.sheet_id}&format=json&sheet_name=Settings`).then((async e=>(0,$.u)(e))).then((e=>e.text()))}catch(t){return await(0,K.Z)({error:"Failed to getDefaultSettings. sheets.hopla.tools api response.",res:e}),{}}if(e&&!e.includes("keywords"))return Et();try{return JSON.parse(e)}catch(t){return await(0,K.Z)({error:"Failed to getDefaultSettings. sheets.hopla.tools api response.",res:e}),{}}}().then((t=>{if(document.getElementById("page2loading").style.display="none",t.result&&Array.isArray(t.result)&&t.result.length){const n={};t.result.forEach((e=>{n[e.input_name]=e.value}));const i=n.keywords||"",s=n.skip_words_title||"",r=n.skip_words_description||"",o=n.ownerlisting_kw_match||"",a=n.listing_min_price||"",l=n.listing_max_price||"",c=n.listing_max_age||"",u=n.listing_min_age||"",d=n.listing_price_delta||"",h=n.price_rounding||"",m=n.must_have||"",p=n.radius||"",f=n.owner_listings_min||"",g=n.owner_listings_max||"",_=n.skip_profiles||"",y=n.owner_message_expiry||"",w=(n.max_concurrent_convo,n.followup_after||""),v=n.between_api_calls_min||"",b=n.between_api_calls_max||"",S=n.between_messages_min||"",E=n.between_messages_max||"",I=n.after_listings_messaged_min||"",k=n.after_listings_messaged_max||"",x=n.after_streak_min||"",T=n.after_streak_max||"",C=n.end_of_run_min||"",A=n.end_of_run_max||"",O=n.archive_older_than||"",N=n.stop_messaging_after||0;let L=document.querySelector("#keywords");L.value=i,e(L),L=document.querySelector("#skipwords_title"),L.value=s,e(L),L=document.querySelector("#skipwords_description"),L.value=r,e(L),L=document.querySelector("#ownerlisting_kw_match"),L.value=o,e(L),L=document.querySelector("#listing_min_price"),L.value=a,e(L),L=document.querySelector("#listing_max_price"),L.value=l,e(L),L=document.querySelector("#listing_max_age"),L.value=c,e(L),L=document.querySelector("#listing_min_age"),L.value=u,e(L),L=document.querySelector("#listing_price_delta"),L.value=d,e(L),L=document.querySelector("#roundupdown"),L.value=h,e(L),L=document.querySelector("#title_must_include"),L&&(L.value=m,e(L)),L=document.querySelector("#radius"),L&&(L.value=p,e(L)),L=document.querySelector("#owner_min_lists"),L&&(L.value=f,e(L)),L=document.querySelector("#owner_max_lists"),L&&(L.value=g,e(L)),L=document.querySelector("#skip_profiles_created_after_year"),L&&(L.value=_,e(L)),L=document.querySelector("#owner_message_expiry"),L&&(L.value=y,e(L)),L=document.querySelector("#followup_after"),L&&(L.value=w,e(L)),L=document.querySelector("#timeout_api_calls_min"),L&&(L.value=v,e(L)),L=document.querySelector("#timeout_api_calls_max"),L&&(L.value=b,e(L)),L=document.querySelector("#timeout_between_messages_min"),L&&(L.value=S,e(L)),L=document.querySelector("#timeout_between_messages_max"),L&&(L.value=E,e(L)),L=document.querySelector("#timeout_listings_messaged_min"),L&&(L.value=I,e(L)),L=document.querySelector("#timeout_listings_messaged_max"),L&&(L.value=k,e(L)),L=document.querySelector("#timeout_streak_min"),L&&(L.value=x,e(L)),L=document.querySelector("#timeout_streak_max"),L&&(L.value=T,e(L)),L=document.querySelector("#timeout_end_of_run_min"),L&&(L.value=C,e(L)),L=document.querySelector("#timeout_end_of_run_max"),L&&(L.value=A,e(L)),L=document.querySelector("#archive_older_than"),L&&(L.value=O,e(L)),L=document.querySelector("#stop_messaging_after"),L&&(L.value=N,e(L))}})).catch((e=>(console.error("Fetch Failed",e),(0,W._)(1e4).then((()=>It()))))),Et().then((t=>{if(document.getElementById("page2loading").style.display="none",t.result&&Array.isArray(t.result)&&t.result.length){const n={};t.result.forEach((e=>{n[e.input_name]=e.value}));const i=n.message_1||"",s=n.message_2||"",r=n.message_3||"",o=n.followup_1||"",a=n.followup_2||"",l=n.followup_3||"",c=n.messageonreply_1||"";let u=document.querySelector("#message_1");u.value=i,e(u),u=document.querySelector("#message_2"),u.value=s,e(u),u=document.querySelector("#message_3"),u.value=r,e(u),u=document.querySelector("#followup_1"),u.value=o,e(u),u=document.querySelector("#followup_2"),u.value=a,e(u),u=document.querySelector("#followup_3"),u.value=l,e(u),u=document.querySelector("#messageonreply_1"),u.value=c,e(u)}})).catch((e=>(console.error("Fetch Failed",e),(0,W._)(1e4).then((()=>It())))))}async function kt(e){const t=e.target.id;if(t)if("radio"===e.target.type){const n=e.target.name;(0,i.chromeStorageSet)(`radio_${n}`,t)}else"checkbox"===e.target.type?((0,i.chromeStorageSet)(`input_${t}`,e.target.checked),"switch-rununtil"===t&&(e.target.checked?(await(0,g.s)("Bot is starting in ",5),window.location.reload()):(unsafeWindow.isRun=0,delete unsafeWindow.runningInstanceId,(0,_.o)(!0),await h(),await(0,g.s)("Bot is stopping in ",5),window.location.reload()))):(0,i.chromeStorageSet)(`input_${t}`,e.target.value)}async function xt(){window.confirm("Are you sure you want to eject the subscription id?")&&await d({clear:!0}).then((e=>{e?.error||window.location.reload()}))}async function Tt(){const e=prompt("Enter your subscription ID:");e?async function({subscription_id:e}){if((0,o.Q)(!0),"string"!=typeof e&&(e=""),!window.userGmail)return console.error("User is not logged in to Phones.Trade"),void alert("You need to be logged in to Phones.Trade to use snatchbot");const t=(0,r.W)();if(!e)return void alert("You need to provide a subscription_id");if(!window.userGmail)return void alert("You need to be logged in to use snatchbot");if(!t)return void alert("You need to be logged in to facebook to use snatchbot");const n={email:window.userGmail,facebookUid:t,...e&&{subscriptionId:e}};let a={};try{if(a=await async function({subscriptionId:e,email:t,facebookUid:n}){const i=await(0,l.getInstanceId)();return fetch(`http://127.0.0.1:5001/snatchbots-8ff7b/us-central1/subscription?verify_subscription_owner=1&instanceId=${i}&locationId=${s.losenolead_locationid}&app=facebook&email=${t}&accountUid=${n}&subscriptionId=${e}`).then((e=>e.json())).catch((e=>(console.error("Failed to check subscription id",e),{})))}(n),!a)return console.error("No response from API while checking subscription ID."),void alert("Failed to verify subscription. Please try again.")}catch(e){return console.error("Error while checking subscription ID:",e),void alert("An error occurred while verifying your subscription. Please try again later.")}if((0,o.Q)(!1),a.error)alert(a.error);else{if(a&&"active"===a.status)return window.issnatchbot=!0,(0,i.chromeStorageSet)("auth_key",a.auth_key),async function(){tn(),window.licenseMode="ACTIVE",sn(window.$role,window.$teamDomain,window.$phonesSold,!0),unsafeWindow.$isStoreOrRegular||(document.getElementById("row_soldphones").style.display="none"),document.getElementById("row_licenseKeyAddBuy").style.display="none",c()}(),!0;document.getElementById("row_eject_subscriptionid").style.display="none",a.status&&alert(a.status),a.error&&alert(a.error)}}({subscription_id:e}).catch((e=>{console.error("Error verifying subscription ID:",e),alert("An error occurred while verifying your subscription ID.")})):alert("Subscription ID is required.")}const Ct=["skip_listings_messaged","skip_listings","skip_users","skip_usersskip"],At="seller",Ot="listing";async function Nt(){await Lt()&&confirm(`Would you like to sync your local skip/message list to ${window.userGmail}?`)&&await async function(){if(await(0,i.chromeStorageListKeys)()){for(const s of Ct){const o=await(0,i.chromeStorageGet)(s);o&&"object"==typeof o&&(unsafeWindow[s]=o,"skip_listings_messaged"===s&&await n(o).then((async()=>{(0,y.CONSOLE_MESSAGE)("custom","Synced messaged listings.",!0)})),"skip_listings"===s&&await r(o).then((async()=>{(0,y.CONSOLE_MESSAGE)("custom","Synced skip listings.",!0)})),"skip_users"===s&&await t(o).then((async()=>{(0,y.CONSOLE_MESSAGE)("custom","Synced messaged users.",!0)})),"skip_usersskip"===s&&await e(o).then((async()=>{(0,y.CONSOLE_MESSAGE)("custom","Synced skip users.",!0)})))}(0,y.CONSOLE_MESSAGE)("custom","Lists has been synced.",!0),Lt().then((e=>{document.getElementById("sync_remote_container").style.display=e?"flex":"none"}))}async function e(e){(0,y.CONSOLE_MESSAGE)("custom","Syncing skip users.",!0);const t=[];for(const n in e){const i=e[n].ts,s=e[n].reason;i&&t.push({id:n,timestamp:i,reason:s})}return Dt(s.SKIP_SELLERS,t,At)}async function t(e){(0,y.CONSOLE_MESSAGE)("custom","Syncing messaged users.",!0);const t=[];for(const n in e){const i=e[n].ts,s=e[n].reason;i&&t.push({id:n,timestamp:i,reason:s})}return Dt(s.MESSAGED_SELLERS,t,At)}async function n(e){(0,y.CONSOLE_MESSAGE)("custom","Syncing messaged listings.",!0);const t=[];for(const n in e){const i=e[n].ts;i&&t.push({id:n,timestamp:i})}return Dt(s.MESSAGED_LISTINGS,t,Ot)}async function r(e){(0,y.CONSOLE_MESSAGE)("custom","Syncing skip listings.",!0);const t=[];for(const n in e){const i=e[n].ts,s=e[n].reason;i&&t.push({id:n,timestamp:i,reason:s})}return Dt(s.SKIP_LISTINGS,t,Ot)}}()}async function Lt(){if(await(0,i.chromeStorageListKeys)())for(const e of Ct){const t=await(0,i.chromeStorageGet)(e);if(t&&"object"==typeof t&&Object.keys(t).length>0)return!0}}async function Dt(e,t,n="listing"){if(!t||!t.length)return;if(!Array.isArray(t))return void console.error("saveIdToSkipListBatch: aEntries is not an array",t);const i=(0,a.ad)();let s=(0,a.qs)(i),r=0;for(const{id:o,timestamp:l,reason:c}of t){if(!o||!l){console.error("saveIdToSkipListBatch: id or timestamp is missing",o,l);continue}r++,r>200&&(await s.commit(),s=(0,a.qs)(i),r=0);const t=(0,a.JU)(i,"facebook_lists",window.userGmail,e,o);if(n===Ot)s.set(t,Rt({listing_id:o,timestamp:l,reason:c}));else{if(n!==At)return void console.error("Unhandled type parameter passed to saveIdToSkipListBatch",n);s.set(t,Mt({seller_id:o,timestamp:l,reason:c}))}}await s.commit()}function Rt({listing_creation_ts:e="NA",listing_id:t,reason:n,timestamp:i}){const s=window.fbuid||(0,r.W)();if(s){if(!e||!t||!i){const n=[];return e||n.push("listing_creation_ts"),t||n.push("listing_id"),i||n.push("timestamp"),void console.error("Failed to create skip doc object. Missing required fields.: ",n)}return{account_id:s,instance_id:window.instanceId,listing_creation_ts:e,listing_id:t,reason:n||"",timestamp:i,from_local_sync:!0}}console.error("No Facebook User ID found")}function Mt({listing_creation_ts:e="NA",seller_id:t,reason:n,timestamp:i}){const s=window.fbuid||(0,r.W)();if(s){if(!e||!t||!i){const n=[];return e||n.push("listing_creation_ts"),t||n.push("seller_id"),i||n.push("timestamp"),void console.error("Failed to create skip doc object. Missing required fields.: ",n)}return{account_id:s,instance_id:window.instanceId,listing_creation_ts:e,seller_id:t,reason:n||"",timestamp:i,from_local_sync:!0}}console.error("No Facebook User ID found")}async function Pt(){(0,o.Q)(!0);let e=window.location.href;if(!e)return(0,o.Q)(!1),void alert("Please enter a valid listing URL.");let t="";if(isNaN(e)){let n=e.match(/marketplace\/item\/(\d+)\/?/);n&&(t=n[1])}else t=e;if(!t)return(0,o.Q)(!1),void alert("Current page is not a listing page.");const n=await(0,T.z)({id:t});if(console.log("listingDetails",n),0===Object.keys(n).length)return(0,o.Q)(!1),void alert("Faild to get listing details. Listing not found.");let i=await A(n);const a=await(0,N.$)(n.title),l=function(e){let t=Number(document.querySelector("#listing_min_price").value)||0,n=Number(document.querySelector("#listing_max_price").value)||214748364700,i=e.price;return"string"==typeof i&&(i=Number(i.replace(/[^0-9\.]+/g,""))),isNaN(i)&&(i=0),i>=t&&i<=n}(n),c=await(0,k.skips)().isSkipListing(t),u=await(0,k.skips)().isSkipMessagedListing(t),d=await(0,k.skips)().isSkipMessagedUser(n.seller.id);console.log("isMessagedSeller",d),d&&console.log(`User ${n.seller.id} was already messaged.`);const h=await(0,k.skips)().isSkipUser(n.seller.id),m=await async function(e){const t=await w();if(e.location&&t){let n=parseInt(document.getElementById("radius").value||"65");const i=Le(e.location.latitude,e.location.longitude,t.lat,t.lon);return console.log("distance",e.location.latitude,e.location.longitude,t.lat,t.lon,i),console.log("radius",n),i<=n}}(n),p=await(0,N.P)(n.description),g=await async function(e){const t=document.getElementById("listing_max_age").value;if(Number(t)<1){const n=100*t;return(0,Oe.h)(e.creationTime)<=n}return(0,Oe.f)(e.creationTime)<=t}(n),_=await async function(e){const t=e&&e.seller&&e.seller.id;let n=document.getElementById("skip_profiles_created_after_year");n&&(n=Number(n.value)),n||(n=s.DEFAULT_SKIP_OWNERCREATION_YEAR);const i=await async function(e){if(!e)return console.error("getUserJoined: Missing userid."),await(0,f._apiSendBug)({error:"Failed to get user joined date",userid:e||"missing uid"}),!1;const t=(0,r.W)(),n=(0,G.H)(),i=(0,V.S)(),s=(0,V.k)(),o=await fetch("https://www.facebook.com/api/graphql/",{headers:{accept:"*/*","accept-language":"en-US,en;q=0.9","content-type":"application/x-www-form-urlencoded",dpr:"0.75","sec-ch-prefers-color-scheme":"light","sec-ch-ua":'"Not_A Brand";v="8", "Chromium";v="120", "Google Chrome";v="120"',"sec-ch-ua-full-version-list":'"Not_A Brand";v="8.0.0.0", "Chromium";v="120.0.6099.109", "Google Chrome";v="120.0.6099.109"',"sec-ch-ua-mobile":"?0","sec-ch-ua-model":'""',"sec-ch-ua-platform":'"macOS"',"sec-ch-ua-platform-version":'"14.2.0"',"sec-fetch-dest":"empty","sec-fetch-mode":"cors","sec-fetch-site":"same-origin","viewport-width":"1394","x-asbd-id":"129477","x-fb-friendly-name":"MarketplaceSellerProfileDialogQuery","x-fb-lsd":"ZeZ9a75KiNNAXAW98DvOh7"},referrer:"https://www.facebook.com/marketplace/item/440485838707747?referral_code=null&referral_story_type=post&tracking=browse_serp%3Ade2d0f81-0cc3-4442-9f0c-aea8a4ee2388",referrerPolicy:"strict-origin-when-cross-origin",body:`av=${t}&__user=${t}&__a=1&__req=30&__hs=19711.HYP%3Acomet_pkg.2.1..2.1&dpr=1&__ccg=EXCELLENT&__rev=1010509199&__s=43vc1w%3Atx9r56%3Aw3n2se&__hsi=7314513933974460203&__dyn=7AzHK4HwkEng5K8G6EjBAo2nDwAxu13wFG1gyUW3qi7UK360CEboG0IE6u3y4o2Gwn82nwb-q7oc81xoswIK1Rwwwqo465o-cwfG1Rx62G5Usw9m1YwBgK7o884y0Mo4G17yovwRwlE-U2exi4UaEW2G1jxS6FobrwKxm5o7G4-5pUfEe88o4Wm7-2K0-poarCwLyESE6C14wkQ0z8c86-3u364UrwFg662S269wqQ1FwgU4q3G1eKufxa&__csr=ghTqFY8laAGfH5lqllslsATsQj49RtXczaJqvbkGb8BYBaFbA9O4VZbLWQniK-V6UF29K8jLhayuiKi8g-aUBdetXAqyVk9h4l344DCJ3Ukm2t4UGlK8gtx-23x7xO5UG362S39a585lxKi48nwUVo8Ecolx-0FE6C5FoowwwhUd8768wkFU8o2Ywr85K3a1wwCwCxu0dpw1PW0acw0oHe00TGYM0Qmfw5bw2lo0HW0tG9g0QS0buU0ek80m5w77w2mu025i03vG08Cw1nG&__comet_req=15&fb_dtsg=${n}&jazoest=25599&lsd=${s}&__aaid=0&__spin_r=${i}&__spin_b=trunk&__spin_t=1703042987&fb_api_caller_class=RelayModern&fb_api_req_friendly_name=MarketplaceSellerProfileDialogQuery&variables=%7B%22isCOBMOB%22%3Afalse%2C%22isSelfProfile%22%3Afalse%2C%22productID%22%3A%22440485838707747%22%2C%22scale%22%3A1%2C%22sellerId%22%3A%22${e}%22%2C%22show_reviews%22%3Atrue%2C%22useContextualViewHeader%22%3Afalse%7D&server_timestamps=true&doc_id=25261541876769985`,method:"POST",mode:"cors",credentials:"include"}).then((e=>e.json())).catch((e=>(console.error(e),{})));if(o.data?.user?.items?.nodes?.length>0){const e=o.data.user.items.nodes.find((e=>e.title?.text.match(/joined/i)))?.title?.text;let t=String(e).match(/\d{4}/)?.[0];if(t)return Number(t)}return console.error("Failed to get user joined year",e,o),!1}(t);return i&&i>=n}(n),y=n.seller.id,v=n.seller.name,b=(n.title,await(0,Ne.O)(y,!0)),S=await L(t,y,v,0,"",b,!0);console.log("isListingsCountInRange",S),(0,o.Q)(!1),await(0,W._)(1e3);let E=`Keyword in title ${i?"✅":"❌"}\n`;E+=`No skipword in title ${a?"❌":"✅"}\n`,E+=`Price in range: ${l?"✅":"❌"}\n`,E+=`Listing not in SkipList ${c?"❌":"✅"}\n`,E+=`Listing not in MessagedList ${u?"❌":"✅"}\n`,E+=`Seller not in SkipList ${h?"❌":"✅"}\n`,E+=`Seller not in MessagedList ${d?"❌":"✅"}\n`,E+=`Listing distance in range ${m?"✅":"❌"}\n`,E+=`No skipword in description: ${p?"❌":"✅"}\n`,E+=`Listing age not maxed ${g?"✅":"❌"}\n`;let I=document.getElementById("skip_profiles_created_after_year");I&&(I=Number(I.value)),I||(I=s.DEFAULT_SKIP_OWNERCREATION_YEAR),E+=`Seller profile creation date is < ${I} ${_?"❌":"✅"}\n`,E+=`Owner listings count in range ${S?"✅":"❌"}\n`,alert(E)}function Ut(){!async function(){const{keyword:e,error:t,coordinates:n}=await v();if(t)return void console.error(t);let i=document.querySelector("#ta #searchwithfilters").value;if(!i)return console.error('No "Search With Filters" found.'),void alert('No "Search With Filters" found.');const s=i.trim().split("\n");!async function(e,t,n){if(!window.isAllowed)return console.error("You are not allowed to use this bot! x("),"not-allowed";(0,y.CONSOLE_MESSAGE)("fetching_listings",{keyword:e},123);const i={keyword:e,radius:document.getElementById("radius").value||"65"};n&&(i.lat=n.lat,i.lon=n.lon);const s=document.querySelector("#listing_max_price").value,r=document.querySelector("#listing_min_price").value;s&&(i.priceMax=s),r&&(i.priceMin=r);let o=!1;String(e).match(/category/i)&&(o=!0,e=(e=e.replace(/\/?category\/?/i,"")).replace(/\/$/,""),i.keyword=e),i.isSearchWithFilter=o;const{listings:a,cursor:l,error:c}=await Y(i);if(c)return console.error(c),"keyword-search-failed";a.map((e=>`${e.title}|${e.price}`)).forEach((e=>console.log(e)))}(s[s.length-1],0,n)}()}async function Ft(){const e=[];if(!Be())return;const t=me(),n=Object.keys(t);for(const i of n){let n=await t[i];if(console.log("msg",n),n){try{n=de(n,"Seller",600)}catch(e){console.trace(),console.error(e)}n=`${i}: ${n}\n\n`,console.log("msg2",n),e.push(n)}}alert(e.join(""))}function qt(e,t){e.target.value<t&&(e.target.value=t)}function jt(e,t){e.target.value>t&&(e.target.value=t)}function Vt(e,t,n){let i=t.value;i=Number(i);let s=e.value;s=Number(s),i-s<n&&(t.value=s+n)}function Gt(e,t){let n=e.target.value,i=t.value;Number(n)>Number(i)&&(t.value=n)}function Bt(e,t){let n=e.target.value,i=t.value;Number(n)<Number(i)&&(e.target.value=i)}async function $t(){if(!window.userGmail)return void console.error("Failed to reset webhook api key. No user Gmail");const e=document.getElementById("webhook_api_key").value,t=Array.from(crypto.getRandomValues(new Uint8Array(8))).map((e=>e.toString(16).padStart(2,"0"))).join("");document.getElementById("webhook_api_key").value=t;const n=(0,a.ad)(),i=(0,a.JU)(n,"webhook",window.userGmail);await(0,a.r7)(i,{facebook_apikey:t}).catch((()=>(0,a.pl)(i,{facebook_apikey:t}).catch((t=>{console.error("Failed to update webhook api key",t),document.getElementById("webhook_api_key").value=e}))))}function Kt(){confirm("Are you sure you want to reset the Webhook API Key?")&&$t()}function Wt(){const e=document.getElementById("webhook_api_key");e&&(e.type="password"===e.type?"text":"password",e.focus())}function zt(e){let t=document.getElementById("webhook_api_key");navigator.clipboard.writeText(t.value).then((()=>{!function(e){let t=document.getElementById("toast"),n=e.getBoundingClientRect();t.style.top=n.top-30+"px",t.style.left=n.left-50+"px",t.classList.add("show"),setTimeout((()=>{t.classList.remove("show")}),1500)}(e.target),console.log("Copied to clipboard!")})).catch((e=>console.error("Failed to copy: ",e)))}var Ht=n(8277);function Qt(e){e.target.value>14&&(e.target.value=14)}async function Jt(){window.writeQueue||(window.writeQueue=[]);const e=[...window.writeQueue];window.writeQueue=[];for(const t of e)try{t.bot="facebook";let e=await fetch("https://cloudlogging.hopla.workers.dev/marketplacebotstats",{method:"POST",headers:{"Content-Length":"application/json"},body:JSON.stringify(t)}).then((async e=>(0,$.u)(e))).then((e=>e.text())).catch((e=>{console.log(e)}));"ok"!==e&&(0,K.Z)({error:"Failed to write to dashboard",data:t,sheetsApiResponse:e})}catch(e){console.error(e),(0,K.Z)({error:"Failed to write to dashboard3",data:t})}setTimeout((()=>{Jt()}),2e3)}var Yt=n(6010),Xt=n(6081);const{version:Zt}=it;async function en(e){if(console.log("User Details",e),console.log("You are logged in as ",e.uid),(0,o.Q)(!1),e.isAnonymous){const e=document.querySelector(".login_container");e&&(e.style.display="block"),window.app||(0,Xt.initFirebase)(),(0,Yt.v0)().signOut()}else(async function(e,t){window.app||(0,Xt.initFirebase)();const n=(0,Yt.v0)(),i=n.currentUser?.uid;if(i===e)return;i&&i!==e&&(console.log("local - User is already logged in with different uid",i),await n.signOut());const s=await async function(e){const t=(await fetch(`https://us-central1-snatchbots-8ff7b.cloudfunctions.net/accesstokenToCustomToken?token=${e}`).then((e=>e.json())).catch((e=>{console.error("Failed to get custom token",e)})))?.token;if(t)return t}(t);s&&await(0,Yt._p)(n,s)})(e.uid,e.stsTokenManager?.accessToken),await nn(e),I((0,r.W)()),document.querySelector("#roundupdown").addEventListener("change",window.prefix),document.querySelector("#roundupdown").addEventListener("change",kt),document.querySelector("#streak").addEventListener("change",kt),document.querySelector("#streaktimeout").addEventListener("change",kt),document.querySelector("#followup_after").addEventListener("change",kt),document.querySelector("#followup_after").addEventListener("change",(e=>{qt(e,s.followAfterMinutes[0]),jt(e,s.followAfterMinutes[1])})),document.querySelector("#keywords").addEventListener("change",kt),document.querySelector("#keywords").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#searchwithfilters").addEventListener("change",kt),document.querySelector("#searchwithfilters").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#title_must_include").addEventListener("change",kt),document.querySelector("#title_must_include").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#skipwords_title").addEventListener("change",kt),document.querySelector("#skipwords_title").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#skipwords_description").addEventListener("change",kt),document.querySelector("#skipwords_description").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#ownerlisting_kw_match").addEventListener("change",kt),document.querySelector("#ownerlisting_kw_match").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#coordinates").addEventListener("change",ft),document.querySelector("#coordinates").addEventListener("change",kt),document.querySelector("#coordinates").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#radius").addEventListener("change",gt),document.querySelector("#radius").addEventListener("change",kt),document.querySelector("#radius").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#message_1").addEventListener("change",kt),document.querySelector("#message_1").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#message_2").addEventListener("change",kt),document.querySelector("#message_2").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#message_3").addEventListener("change",kt),document.querySelector("#message_3").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#followup_1").addEventListener("change",kt),document.querySelector("#followup_1").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#followup_2").addEventListener("change",kt),document.querySelector("#followup_2").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#followup_3").addEventListener("change",kt),document.querySelector("#followup_3").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#messageonreply_1").addEventListener("change",kt),document.querySelector("#messageonreply_1").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_min_price").addEventListener("change",kt),document.querySelector("#listing_min_price").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_min_price").addEventListener("change",(e=>{Gt(e,document.querySelector("#listing_max_price"))})),document.querySelector("#listing_max_price").addEventListener("change",kt),document.querySelector("#listing_max_price").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_max_price").addEventListener("change",(e=>{Bt(e,document.querySelector("#listing_min_price"))})),document.querySelector("#owner_min_lists").addEventListener("change",kt),document.querySelector("#owner_min_lists").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#owner_min_lists").addEventListener("change",(e=>{Gt(e,document.querySelector("#owner_max_lists"))})),document.querySelector("#owner_max_lists").addEventListener("change",kt),document.querySelector("#owner_max_lists").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#owner_max_lists").addEventListener("change",(e=>{Bt(e,document.querySelector("#owner_min_lists"))})),document.querySelector("#listing_price_delta").addEventListener("change",_t),document.querySelector("#listing_price_delta").addEventListener("change",kt),document.querySelector("#listing_price_delta").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_max_age").addEventListener("change",gt),document.querySelector("#listing_max_age").addEventListener("change",kt),document.querySelector("#listing_max_age").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_max_age").addEventListener("change",(e=>{Bt(e,document.querySelector("#listing_min_age"))})),document.querySelector("#listing_min_age").addEventListener("change",gt),document.querySelector("#listing_min_age").addEventListener("change",kt),document.querySelector("#listing_min_age").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#listing_min_age").addEventListener("change",(e=>{Gt(e,document.querySelector("#listing_max_age"))})),document.querySelector("#skip_profiles_created_after_year").addEventListener("change",gt),document.querySelector("#skip_profiles_created_after_year").addEventListener("change",kt),document.querySelector("#skip_profiles_created_after_year").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#runfrom").addEventListener("change",kt),document.querySelector("#rununtil").addEventListener("change",kt),document.querySelector("#switch-deleteaftersend").addEventListener("change",kt),document.querySelector("#switch-rununtil").addEventListener("change",kt),document.querySelector("#switch-rununtil").addEventListener("change",(()=>{Ve(!document.querySelector("#switch-rununtil").checked)})),document.querySelectorAll("#ta .variables .variable").forEach((e=>e.addEventListener("click",pt))),document.querySelectorAll("#ta #login_with_subscription_id").forEach((e=>e.addEventListener("click",u))),document.querySelector("#ta #test_template").addEventListener("click",Ft),document.querySelector("#copy_search_filters").addEventListener("click",q),document.querySelector("#test_search_filters").addEventListener("click",Ut),document.querySelector("#ta #restore_defaults").addEventListener("click",It),document.querySelector("#purge_listings").addEventListener("click",wt),document.querySelector("#purge_owners").addEventListener("click",vt),document.querySelector("#archive_all_threads").addEventListener("click",lt),document.querySelector("#owner_message_expiry").addEventListener("change",Qt),document.querySelector("#btn_test_url").addEventListener("click",Pt),document.querySelector("#download_listings").addEventListener("click",ht),document.querySelector("#download_owners").addEventListener("click",dt),document.querySelector("#switch-loopsearch").addEventListener("change",kt),document.querySelector("#timeout_api_calls_min").addEventListener("change",kt),document.querySelector("#timeout_api_calls_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_api_calls_min").addEventListener("change",(e=>{qt(e,s.apiCallDelay[0]),Vt(e.target,document.querySelector("#timeout_api_calls_max"),5)})),document.querySelector("#timeout_api_calls_max").addEventListener("change",kt),document.querySelector("#timeout_api_calls_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_api_calls_max").addEventListener("change",(e=>{jt(e,s.apiCallDelay[1]),Vt(document.querySelector("#timeout_api_calls_min"),e.target,5)})),document.querySelector("#timeout_listings_messaged_min").addEventListener("change",kt),document.querySelector("#timeout_listings_messaged_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_listings_messaged_min").addEventListener("change",(e=>{qt(e,s.userDelay[0]),Vt(e.target,document.querySelector("#timeout_listings_messaged_max"),10)})),document.querySelector("#timeout_listings_messaged_max").addEventListener("change",kt),document.querySelector("#timeout_listings_messaged_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_listings_messaged_max").addEventListener("change",(e=>{jt(e,s.userDelay[1]),Vt(document.querySelector("#timeout_listings_messaged_min"),e.target,10)})),document.querySelector("#timeout_streak_min").addEventListener("change",kt),document.querySelector("#timeout_streak_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_streak_min").addEventListener("change",(e=>{qt(e,s.timeout_streak[0]),Vt(e.target,document.querySelector("#timeout_streak_max"),10)})),document.querySelector("#timeout_streak_max").addEventListener("change",kt),document.querySelector("#timeout_streak_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_streak_max").addEventListener("change",(e=>{jt(e,s.timeout_streak[1]),Vt(document.querySelector("#timeout_streak_min"),e.target,10)})),document.querySelector("#timeout_end_of_run_min").addEventListener("change",kt),document.querySelector("#timeout_end_of_run_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_end_of_run_min").addEventListener("change",(e=>{qt(e,s.timeout_perpage[0]),Vt(e.target,document.querySelector("#timeout_end_of_run_max"),10)})),document.querySelector("#timeout_end_of_run_max").addEventListener("change",kt),document.querySelector("#timeout_end_of_run_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_end_of_run_max").addEventListener("change",(e=>{jt(e,s.timeout_perpage[1]),Vt(document.querySelector("#timeout_end_of_run_min"),e.target,10)})),document.querySelector("#stop_messaging_after").addEventListener("change",kt),document.querySelector("#stop_messaging_after").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_between_messages_min").addEventListener("change",kt),document.querySelector("#timeout_between_messages_min").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_between_messages_min").addEventListener("change",(e=>{qt(e,s.timeout_permessage[0]),Vt(e.target,document.querySelector("#timeout_between_messages_max"),5)})),document.querySelector("#timeout_between_messages_max").addEventListener("change",kt),document.querySelector("#timeout_between_messages_max").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#timeout_between_messages_max").addEventListener("change",(e=>{jt(e,s.timeout_permessage[1]),Vt(document.querySelector("#timeout_between_messages_min"),e.target,5)})),document.querySelector("#archiveolderthan").addEventListener("change",kt),document.querySelector("#archiveolderthan").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#amount_to_archive").addEventListener("change",kt),document.querySelector("#amount_to_archive").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#switch-skipunread").addEventListener("change",kt),document.querySelector("#btn_set_openai_apikey").addEventListener("click",Me.setOpenAIApiKey),document.querySelector("#btn_eject_openai_apikey").addEventListener("click",Me.ejectOpenAIApikey),document.querySelector("#num_images").addEventListener("change",kt),document.querySelector("#num_images").addEventListener("blur",(e=>{window.lastInputId=[e.target.id,e.target.selectionStart]})),document.querySelector("#high").addEventListener("change",kt),document.querySelector("#low").addEventListener("change",kt),document.querySelector("#switch-enablegpt").addEventListener("change",kt),document.querySelector("#btn_openai_test").addEventListener("click",yt),document.querySelector("#btn_copylisting_details").addEventListener("click",ut),document.querySelector("#buy_license_key").addEventListener("click",(()=>{window.open("https://snatchbots.com","_blank")})),document.querySelector("#btn_eject_subscription").addEventListener("click",xt),document.querySelector("#row_verify_subscriptionid").addEventListener("click",Tt),document.querySelector("#toggleWebhookApiKeyVisibility").addEventListener("click",Wt),document.getElementById("copyWebhookApiKey").addEventListener("click",zt),document.getElementById("resetWebhookApiKey").addEventListener("click",Kt),document.getElementById("sync_list_to_remote").addEventListener("click",Nt),document.querySelectorAll('[name="run-mode"]').forEach((e=>{e.addEventListener("change",(e=>{kt(e);const t=document.querySelector('[name="run-mode"]:checked').value;(0,Ht.D)(t)}))})),document.getElementById("login_iframe").onload=function(){console.log("Iframe has loaded successfully!"),(0,o.Q)(!1)},Jt(),window.isAllowed=!0,(0,i.chromeStorageGet)("input_switch-rununtil").then((e=>{e&&tt()}))}function tn(e){if(e){let e=document.querySelector(".login_container");e&&(e.style.display="block"),e=document.querySelector("#ta #menu"),e&&(e.style.display="none"),e=document.querySelector("#ta #page2"),e&&(e.style.display=null),e=document.querySelector("#ta #page3"),e&&(e.style.display=null),e=document.querySelector("#ta #page4"),e&&(e.style.display=null),componentHandler&&componentHandler.upgradeDom()}else{let e=document.querySelector(".login_container");e&&(e.style.display="none"),e=document.querySelector("#ta #menu"),e&&(e.style.display="flex"),e=document.querySelector("#ta #page2"),e&&(e.style.display=null),e=document.querySelector("#ta #page3"),e&&(e.style.display=null),e=document.querySelector("#ta #page4"),e&&(e.style.display=null),componentHandler&&componentHandler.upgradeDom()}}async function nn(e){tn();const t=e&&e.uid;window.taUID=t,unsafeWindow.taUID=t,window.userGmail=e&&e.email;const n=await async function(e){const t=await async function(e){if(!e)return console.warn("API_getTeams called without email"),null;try{const t=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/snatchbots?getTeams=1&email=${e}`).then((e=>e.json()));return t.error?(console.error("API_getTeams error",t.error),null):t?.teams}catch(e){console.error("API_getTeams error",e)}}(e?.email);if(t){const e=st(t,["owner","indoor"]);if(e)return{role:"owner",domain:e.domain};const n=st(t,["regular","store_manager"]);if(n)return{role:n.role,domain:n.domain}}return null}(e),i=n?.role;unsafeWindow.$isStoreOrRegular="store_manager"===i||"outdoor"===i||"regular"===i,unsafeWindow.$isStoreOrRegular&&(document.getElementById("row_soldphones").style.display="flex");const s=n?.domain;if(s){const e=await async function(e){try{const t=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/inventory?get_ownerid=1&domain=${e}`);return(await t.json()).ownerid}catch(e){e.message.includes("CORS")?console.warn("CORS error when trying to get domain owner id, ignoring",e):console.error("Failed to get domain owner id",e)}}(s);console.log("teamId",e),e&&(window.taPartnerId=e,unsafeWindow.taPartnerId=window.taPartnerId)}else if(t){const e=await async function(e){const t=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/partners?isTeammember=1&uid=${e}`).then((e=>e.json())).catch((e=>(console.error("Failed to get partner details",e),{})));let n=t&&t.isTeamMember&&t.isTeamMember.partnerId;return n||(n=e),n}(t);window.taPartnerId=e,unsafeWindow.taPartnerId=window.taPartnerId}let r;window.var_domain=s||"",unsafeWindow.$isStoreOrRegular&&(r=await async function(e,t,n){try{return(await fetch(`https://us-central1-trade-apples.cloudfunctions.net/snatchbots?get_phones_sold=1&email=${t}&uid=${e}&teamid=${n}`).then((e=>e.json())))?.phonesSold||0}catch(e){return console.error("Failed to get phones sold",e),0}}(t,e&&e.email,window.taPartnerId));const o=await $e();!function(e,t,n){n?(window.licenseMode="ACTIVE",c()):"owner"===e||"indoor"===e?(window.licenseMode="FREEMIUM",document.getElementById("row_eject_subscriptionid").style.display="none"):"store_manager"===e||"outdoor"===e||"regular"===e?(window.licenseMode=t<20?"TRIAL":"FREEMIUM",document.getElementById("row_eject_subscriptionid").style.display="none"):(window.licenseMode="TRIAL",document.getElementById("row_eject_subscriptionid").style.display="none")}(i,r,o),window.$role=i,window.$phonesSold=r,window.$teamDomain=s,sn(i,s,r,o),async function(){if(!window.userGmail)return void console.error("Failed to load webhook api key. No user Gmail");const e=(0,a.ad)(),t=(0,a.JU)(e,"webhook",window.userGmail),n=(await(0,a.QT)(t)).data()?.facebook_apikey;n?document.getElementById("webhook_api_key").value=n:$t()}(),Lt().then((e=>{document.getElementById("sync_remote_container").style.display=e?"flex":"none"}))}async function sn(e,t,n,i){try{document.getElementById("phones_sold_last_30_days").textContent=n||0;const r=document.querySelector("#info-header");r&&(r.style.display="flex",r.style.flexDirection="column"),window.isAllowed=!0;const l='<a id="info-logout" href="#" style="color: white;-webkit-highlight: none;">Logout</a>',u=`<span id="ta_minimize" style="user-select: none; position: absolute; left: 0px; height: 38px; margin-top: -7px; width: 30px; font-size: xxx-large; cursor: pointer;">\n          -\n        </span>\n          <span style="text-align: center; line-height: 2px; height: 25px;">\n            <p>License: <span style="font-weight: 500;">FREEMIUM</span></p>\n          </span>\n          <div>\n            <span style="cursor: pointer;" id="logged_email">[${rn(window.userGmail)}]</span>\n            <span style="position: absolute; right: 14px;">${l}</span>\n          </div>`,h=`<span id="ta_minimize" style="user-select: none; position: absolute; left: 0px; height: 38px; margin-top: -7px; width: 30px; font-size: xxx-large; cursor: pointer;">\n          -\n        </span>\n          <span style="text-align: center; line-height: 2px; height: 25px;">\n            <p>License: <span style="font-weight: 500;">ACTIVE</span></p>\n          </span>\n          <div>\n            <span style="cursor: pointer;" id="logged_email">[${function(e){if("string"!=typeof e)return"";let t=e.replace(/(snatchbot(?:_sub)?_)(.{5})(.*)(.{5})/,"$1$2...$4");return t.length<5?e:t}(window.userGmail)}]</span>\n            <span style="position: absolute; right: 14px;">${l}</span>\n          </div>`,m=`<span id="ta_minimize" style="user-select: none; position: absolute; left: 0px; height: 38px; margin-top: -7px; width: 30px; font-size: xxx-large; cursor: pointer;">\n          -\n        </span>\n            <span style="text-align: center; line-height: 2px; height: 25px;">\n              <p>License: <span style="font-weight: 500;">TRIAL</span></p>\n            </span>\n            <div>\n              <span style="cursor: pointer;" id="logged_email">[${rn(window.userGmail)}]</span>\n              <span style="position: absolute; right: 14px;">${l}</span>\n            </div>`,p="store_manager"===e||"outdoor"===e||"regular"===e;if("owner"===e||"indoor"===e)return r&&(r.innerHTML=u),document.getElementById("row_soldphones").style.display="none",document.getElementById("row_licenseKeyAddBuy").style.display="none",document.getElementById("row_eject_subscriptionid").style.display="none",on(!0),a(),o(),void s();if(i)return r&&(r.innerHTML=h),p||(document.getElementById("row_soldphones").style.display="none"),document.getElementById("row_licenseKeyAddBuy").style.display="none",c(),on(!0),a(),o(),void s();if(p)return document.getElementById("row_soldphones").style.display="flex",document.getElementById("row_licenseKeyAddBuy").style.display="flex",on(!0),n<20?(r&&(r.innerHTML=m),on(!1),d(),a(),o(),void s()):(r&&(r.innerHTML=u),a(),o(),void s());document.getElementById("row_soldphones").style.display="none",document.getElementById("row_licenseKeyAddBuy").style.display="flex",on(!1),r&&(r.innerHTML=m),d();let f=document.querySelector("#info-subscription");f&&(f.textContent=function(e){switch(e){case"owner":return"Owner";case"indoor":return"Indoor";case"outdoor":return"Outdoor";case"store_manager":return"Dropoff Location";case"regular":return"Regular";default:return""}}(e)),f=document.querySelector("#info-website"),f&&(f.textContent=t),a(),o(),s()}catch(e){console.error("Error in showSubscription:",e)}function s(){document.querySelector("#ta_minimize").addEventListener("click",(()=>{(0,p.g)()}))}function o(){document.querySelector("#info-header #info-logout").addEventListener("click",(()=>{console.log("logout"),async function(){console.log("Sending logout message"),document.getElementById("login_iframe").contentWindow.postMessage({event:"logout"},"*"),unsafeWindow.isRun&&(unsafeWindow.isRun=0),await h(),window.issnatchbot&&(0,m.waitForLogin)(en),tn(!0)}()}))}function a(){document.querySelector("#info-header #logged_email").addEventListener("click",(async()=>{let t=`Version:${Zt}\nUID: ${window.taUID}\nEmail: ${window.userGmail}\nPartner ID: ${window.taPartnerId}\nDomain: ${window.var_domain}\nRole: ${e||""}\nLicense: ${window.licenseMode}`;n&&(t+=`\nPhones Sold: ${n}`);const i=await(0,l.getInstanceId)();i&&(t+=`\nInstance ID: ${i}`);const s=(0,r.W)();s&&(t+=`\nFacebook UID: ${s}`),console.log("debugInfo",t),navigator.clipboard.writeText(t),alert(t)}))}function d(){if(window.listener_listenAddLicenseKey)return;window.listener_listenAddLicenseKey=!0;const e=document.querySelector("#btn_add_license_key");function t(){const e=prompt("Enter License Key");e&&u({subscription_id:e})}e.removeEventListener("click",t),e.addEventListener("click",t)}}function rn(e){return(e=e||"").length<5?e:e=e.replace(/(.{5})(.*)(@.*)/,"$1***$3")}function on(e){e?(document.getElementById("stop_messaging_after").parentNode.classList.remove("is-disabled"),document.getElementById("stop_messaging_after").disabled=!1):(document.getElementById("stop_messaging_after").parentNode.classList.add("is-disabled"),document.getElementById("stop_messaging_after").disabled=!0)}unsafeWindow.showSubscription=sn},9309:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ejectOpenAIApikey:()=>l,generateMessage:()=>u,getAssistants:()=>c,loadOpenAIApiKey:()=>r,setOpenAIApiKey:()=>a});var i=n(1334),s=n(1023);async function r(){o(!await(0,i.chromeStorageGet)("openai_apikey"))}function o(e){e?(document.querySelectorAll(".openai_init").forEach((e=>{e.style.display="block"})),document.querySelectorAll(".openai_ready").forEach((e=>{e.style.display="none"})),document.querySelectorAll(".openai_readyflex").forEach((e=>{e.style.display="none"}))):(document.querySelectorAll(".openai_init").forEach((e=>{e.style.display="none"})),document.querySelectorAll(".openai_ready").forEach((e=>{e.style.display="block"})),document.querySelectorAll(".openai_readyflex").forEach((e=>{e.style.display="flex"})),c())}async function a(){const e=document.getElementById("openai_apikey").value;if(!e)return void alert("Please enter your OpenAI API key");(0,s.Q)(!0);const t=`https://us-central1-trade-apples.cloudfunctions.net/snatchbots?validate_openai_key=1&key=${e}`,n=await fetch(t).then((e=>e.text())).catch((e=>(console.error("Error validating OpenAI API key",e),"")));let r={};try{r=JSON.parse(n)}catch(e){console.error("Error parsing JSON",e,n),r={error:"Error parsing JSON"}}(0,s.Q)(!1),r?.valid?(document.getElementById("openai_apikey").value="",await(0,i.chromeStorageSet)("openai_apikey",e),o(!1)):alert("Invalid OpenAI API key")}async function l(){await(0,i.chromeStorageRemove)("openai_apikey"),o(!0)}async function c(){const e=await(0,i.chromeStorageGet)("openai_apikey");if(!e)return void alert("Please enter your OpenAI API key");(0,s.Q)(!0);const t=await fetch("https://us-central1-trade-apples.cloudfunctions.net/chatgpt?get_assistants=1",{headers:{Authorization:"Bearer "+e}}).then((e=>e.text())).then((e=>{try{return JSON.parse(e)}catch(t){if(console.log("text",e),e.includes("The service you requested is not available yet."))return[];throw t}})).catch((e=>(console.error("Error fetching assistants",e),(0,s.Q)(!1),[])));return(0,s.Q)(!1),async function(e,t){const n=document.querySelector('ul[for="assistant_id"]');n.innerHTML="",e.forEach((e=>{const i=document.createElement("li");i.className="mdl-menu__item",i.dataset.val=e.id,i.textContent=e.name||e.id,e.id===t&&(i.dataset.selected=!0),n.appendChild(i)})),getmdlSelect.init(".getmdl-select"),async function(){document.querySelectorAll('ul[for="assistant_id"] .mdl-menu__item').forEach((function(e){e.addEventListener("click",(function(){var e=this.getAttribute("data-val"),t=this.textContent;console.log("text",t,e),(0,i.chromeStorageSet)("assistant_id",e)}))}))}()}(t,await(0,i.chromeStorageGet)("assistant_id")),t}async function u(e,t){if(!(e||t&&0!==t.length))return void alert("Listing has no text or photos");const n=await(0,i.chromeStorageGet)("openai_apikey");if(!n)return void alert("Please enter your OpenAI API key");const s=await(0,i.chromeStorageGet)("assistant_id");if(!s)return void alert("Please select an assistant");const r={};e&&(r.text=e),t&&t.length>0&&(r.photos=t);const o=parseInt(document.getElementById("num_images").value,10);o&&(r.numPhotos=o,t&&t.length>o&&(r.photos=t.slice(0,o)));const a=document.querySelector('[name="image_detail"]:checked');a&&(r.imageDetail=a.value);try{const e=await fetch(`https://us-central1-trade-apples.cloudfunctions.net/chatgpt?generate_message=1&assistant_id=${s}`,{method:"POST",headers:{Authorization:"Bearer "+n,"Content-Type":"application/json"},body:JSON.stringify(r)}).then((e=>e.json())).catch((e=>(console.error("Error generating message",e),{error:"An error occurred while generating the message. Please try again."})));return console.log("generate_message response",e),e}catch(e){return console.error("Network or fetch error",e),alert("An error occurred while generating the message. Please try again."),{error:"An error occurred while generating the message. Please try again."}}}},9868:(e,t,n)=>{"use strict";function i(){if(window.iconDragged)return;const e=document.querySelector("#ta_minimize");if(e){const t=e.getBoundingClientRect(),n=document.querySelector("#pt-draggable-icon");n.style.left=t.left+"px",n.style.top=t.top+"px"}}n.d(t,{j:()=>i})},6849:(e,t,n)=>{"use strict";function i(e){return"object"==typeof e&&(window.tabId&&(e.tabId=window.tabId),window.userGmail&&(e.partner_email=window.userGmail),window.taPartnerId&&(e.taPartnerId=window.taPartnerId),e.extension_version=window.extension_version),fetch("https://cloudlogging.hopla.workers.dev/log?function=facebookbot",{method:"POST",body:JSON.stringify(e),mode:"no-cors"})}n.d(t,{Z:()=>i})},4423:(e,t,n)=>{"use strict";function i(e){e||window.viewermode?window.isViewMode=!0:(document.querySelector('#ta #menu a[href="#page2"]').click(),window.isViewMode=!1),window.viewermode&&(document.querySelector("#menu").style.display="none")}n.d(t,{o:()=>i})},7091:(e,t,n)=>{"use strict";function i(e){window.isKO||e.match&&(window.navigator.onLine||e.match(/offline/))&&(document.querySelector("#statustext").textContent=e)}n.d(t,{u:()=>i})},1023:(e,t,n)=>{"use strict";function i(e){if(window.lastLoadingState===e)return;window.lastLoadingState=e;let t=document.querySelector("#loadingoverlay");t?(t.style.display=e?"flex":"none",e&&"string"==typeof e&&(document.querySelector("#loadingtext").innerText=e),e||(document.querySelector("#loadingtext").innerText="Loading. Please wait...")):function(e){const t=document.querySelector("#ta");t&&(t.insertAdjacentHTML("afterbegin",`<div id="loadingoverlay" style="display: ${e?"flex":"none"};" class='loading-one'>\n          <div class='loading-two'>\n              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"\n                  class='svg'>\n                  <circle r="80" cx="500" cy="90" class='circle-one' />\n                  <circle r="80" cx="500" cy="910" class='circle-one' />\n                  <circle r="80" cx="90" cy="500" class='circle-one' />\n                  <circle r="80" cx="910" cy="500" class='circle-one' />\n                  <circle r="80" cx="212" cy="212" class='circle-one' />\n                  <circle r="80" cx="788" cy="212" class='circle-one' />\n                  <circle r="80" cx="212" cy="788" class='circle-one' />\n                  <circle r="80" cx="788" cy="788" class='circle-one' />\n              </svg>\n          </div>\n          <span id="loadingtext" style="position: fixed; padding-top: 165px;">Loading. Please wait...</span>\n      </div>\n    `),document.head.insertAdjacentHTML("beforeend","<style>\n      /* Loading Overlay - START */\n      .loading-one {\n        box-sizing: border-box;\n        display: flex;\n        position: absolute;\n        flex-flow: column nowrap;\n        align-items: center;\n        justify-content: space-around;\n        background: rgba(255, 255, 255, 0.8);\n        top: 0px;\n        left: 0px;\n        width: 100%;\n        height: 100%;\n        z-index: 2147483647;\n      }\n\n      .loading-two {\n        order: 1;\n        box-sizing: border-box;\n        overflow: visible;\n        flex: 0 0 auto;\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        animation-name: around;\n        animation-duration: 2000ms;\n        animation-timing-function: linear;\n        animation-iteration-count: infinite;\n        width: 120px;\n        height: 120px;\n      }\n\n      .circle-one {\n        fill: var(--black);\n      }\n\n      .svg {\n        width: 100%;\n        height: 100%;\n        fill: var(--black);\n      }\n\n      @keyframes around {\n        0% {\n          transform: rotate(0deg)\n        }\n\n        100% {\n          transform: rotate(360deg)\n        }\n      }\n\n      /* Loading Overlay - END */\n    </style>"))}(e)}n.d(t,{Q:()=>i})},8521:(e,t,n)=>{"use strict";n.r(t),n.d(t,{skips:()=>g});var i=n(1203),s=n(13),r=n(6901),o=n(9237),a=n(3539),l=n(5639),c=n(4246),u=n(1060),d=n(4484),h=n(7367),m=n(8104),p=n(5703);function f({listing_creation_ts:e="NA",listing_id:t,reason:n,timestamp:i}){const s=window.fbuid||(0,p.W)();if(s){if(!e||!t||!i){const n=[];return e||n.push("listing_creation_ts"),t||n.push("listing_id"),i||n.push("timestamp"),void console.error("Failed to create skip doc object. Missing required fields.: ",n)}return{account_id:(0,m.vr)(s),instance_id:window.instanceId,listing_creation_ts:e,listing_id:t,reason:n||"",timestamp:i}}console.error("No Facebook User ID found")}function g(){async function e(e,t,n,i,s){s||(s=Date.now());const r=(0,m.ad)(),o=(0,m.JU)(r,"facebook_lists",window.userGmail,e,t);(0,m.pl)(o,f({listing_creation_ts:i,listing_id:t,reason:n,timestamp:s}))}async function t(e,t,n,i){const s=(0,m.ad)(),r=(0,m.JU)(s,"facebook_lists",window.userGmail,e,t);(0,m.pl)(r,function({listing_creation_ts:e,seller_id:t,reason:n,timestamp:i}){const s=window.fbuid||(0,p.W)();if(s){if(!e||!t||!i){const n=[];return e||n.push("listing_creation_ts"),t||n.push("seller_id"),i||n.push("timestamp"),void console.error("Failed to create skip doc object. Missing required fields.: ",n)}return{account_id:(0,m.vr)(s),instance_id:window.instanceId,listing_creation_ts:e,seller_id:t,reason:n||"",timestamp:i}}console.error("No Facebook User ID found")}({listing_creation_ts:i,seller_id:t,reason:n,timestamp:Date.now()}))}async function n(e,t,n){const i=(0,m.ad)();console.log("Checking if id is in list:",window.userGmail,e,t);const s=(0,m.JU)(i,"facebook_lists",window.userGmail,e,t),r=(await(0,m.QT)(s)).data();if(!r)return!1;if(!n)return!0;const o=r.timestamp;return o?!function(e,t){const n=24*t*60*60*1e3,i=(new Date).getTime()-e;return console.log("age,expiryMs",i,n),i>n}(o,n):void 0}return{saveToMessagedUsers:(e,n,s="NA")=>t(i.MESSAGED_SELLERS,e,`Messaged on listing: ${n}`,s),hasBeenMessaged:async e=>n(i.MESSAGED_SELLERS,e),saveToSkipUsers:(e,n,s="NA")=>t(i.SKIP_SELLERS,e,n,s),saveToSkipListing:(t,n,s="NA")=>e(i.SKIP_LISTINGS,t,n,s),saveToSkipListingBatch:(e,t)=>{!async function(e,t,n,i){if(!t||!t.length)return;Array.isArray(t)||(t=[t]);const s=(0,m.ad)();let r=(0,m.qs)(s),o=0;for(const i of t){o++,o>200&&(await r.commit(),r=(0,m.qs)(s),o=0);const t=(0,m.JU)(s,"facebook_lists",window.userGmail,e,i);r.set(t,f({listing_creation_ts:undefined,listing_id:i,reason:n,timestamp:Date.now()}))}await r.commit()}(i.SKIP_LISTINGS,e,t)},saveToSkipMessagedListing:(t,n="NA")=>e(i.MESSAGED_LISTINGS,t,!0,n),isSkipMessagedListing:async e=>{let t=document.getElementById("listing_max_age").value||"";return Number(t)<1&&(t=100*t/24),n(i.MESSAGED_LISTINGS,e,t)},isSkipListing:async e=>{let t=document.getElementById("listing_max_age").value||"";return Number(t)<1&&(t=100*t/24),n(i.SKIP_LISTINGS,e,t)},getOtherIphoneListings:async function(e,t,n){if(!t){const n=await(0,s.z)({id:e});if(n.error){if(console.error("Failed to get listing details.",n.error),"rate_limit_exceeded"===n.error_code){const e=(new Date).getTime()+60*i.waitIfSpamDetected*1e3,t=moment(e).calendar();(0,a.CONSOLE_MESSAGE)("halted_soft",{schedule:t}),(await(0,h.o)()).addKo(),window.isKO=!0,await(0,c._)(60*i.waitIfSpamDetected*1e3),window.isKO=!1}return}if(!n||!n.owner)return void(0,d._apiSendBug)({error:"getOtherIphoneListings failed. No listing owner returned."});t=n.owner.id}const m=[];(0,a.CONSOLE_MESSAGE)("custom",`Fetching other listings of ${n} (${t})`);const p=await(0,l.O)(t,!0);let f=document.querySelector("#ta #keywords").value.split(",").map((e=>e.trim())).join("|");f.startsWith("|")&&(f=f.substring(1)),f.endsWith("|")&&(f=f.substring(0,f.length-1));for(const t of p)if(t.id!==e&&t.id!==e&&t.title){const e=t.title,n=t.description,i=t.creationTime,s=Number(t.price),l=new RegExp(f,"i");if(i){const e=document.getElementById("listing_max_age");if(e){const n=e.value,s=(0,o.f)(i);if(s>n){(0,a.CONSOLE_MESSAGE)("skip_old_listing",{age:s,listing_id:t.id,listing_name:t.title});continue}}}if(await g().isSkipListing(t.id))continue;if(!e.match(l))continue;let c=await(0,u.$)(e);if(!c&&n&&(c=await(0,u.P)(n)),c)continue;if(!(0,r.d)(s))continue;m.push(t.id)}return[...new Set(m)]},isSkipMessagedUser:async e=>{const t=document.getElementById("owner_message_expiry").value||"";return n(i.MESSAGED_SELLERS,e,t)},isSkipUser:async e=>{const t=document.getElementById("owner_message_expiry").value||"";return n(i.SKIP_SELLERS,e,t)}}}},4246:(e,t,n)=>{"use strict";function i(e){return new Promise((t=>setTimeout(t,e)))}n.d(t,{_:()=>i})},7367:(e,t,n)=>{"use strict";n.d(t,{o:()=>o});var i=n(8104),s=n(5703),r=n(5272);async function o(){const e=(0,i.ad)(window.app),t=(0,s.W)(),n=(0,r.L)();async function a(s,r){if(!s)return void console.error("Failed to add stat. No key provided");r||(r=1);const o=(0,i.JU)(e,"statistics",t,"dates",n);return(0,i.pl)(o,{[s]:(0,i.nP)(r)},{merge:!0})}return{addOffer:async()=>{a("offers"),o().then((e=>e.addNewListings()))},addSkipped:e=>{void 0===e&&(e=1),a("skipped",e),o().then((t=>t.addNewListings(e)))},addPartner:()=>{a("partners")},addRun:()=>{a("runs")},addStreak:()=>{a("streaks")},addKo:()=>{a("ko")},resetCurrentStreak:()=>{a("streaks")},addTotalListingsScraped:e=>{a("scraped",e.length)},addNewListings:e=>{a("new_listings",e)}}}},1060:(e,t,n)=>{"use strict";n.d(t,{$:()=>s,P:()=>r});var i=n(1334);async function s(e){const t=await(0,i.chromeStorageGet)("input_skipwords_title");if(t){let n=!1;if(t.split(",").map((e=>e.trim())).forEach((t=>{t&&e&&e.match(new RegExp(t,"i"))&&(n=t)})),n)return n}}async function r(e){const t=await(0,i.chromeStorageGet)("input_skipwords_description");if(t){let n=!1;if(t.split(",").map((e=>e.trim())).forEach((t=>{t&&e&&e.match(new RegExp(t,"i"))&&(n=t)})),n)return n}}},8252:(e,t,n)=>{"use strict";function i(e){if("createEvent"in document){const t=document.createEvent("HTMLEvents");t.initEvent("change",!1,!0),e.dispatchEvent(t)}else e.fireEvent("onchange");e.parentElement&&e.parentElement.MaterialTextfield&&e.parentElement.MaterialTextfield.change(e.value)}n.d(t,{b:()=>i})},5078:(e,t,n)=>{"use strict";function i(e,t,n){var i=e.indexOf(t)+t.length;if(i<t.length)return"";var s=e.substring(i),r=s.indexOf(n);if(-1===r)throw Error("Could not find endTime `"+n+"` in the given string.");return s.substring(0,r)}n.d(t,{U:()=>i})},5272:(e,t,n)=>{"use strict";function i(){const e=new Date;return`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}${String(e.getDate()).padStart(2,"0")}`}n.d(t,{L:()=>i})},1311:(e,t,n)=>{"use strict";n.r(t),n.d(t,{getInstanceId:()=>s});var i=n(1334);async function s(){let e=await(0,i.chromeStorageGet)("instanceId");return e||(e=await async function(){return Array.from(crypto.getRandomValues(new Uint8Array(8))).map((e=>e.toString(16).padStart(2,"0"))).join("")}(),await(0,i.chromeStorageSet)("instanceId",e)),e}},5965:(e,t,n)=>{"use strict";function i(e,t){const n=new Date(t);return(new Date-n)/1e3/60>=e}n.r(t),n.d(t,{hasMinutesPassed:()=>i})},4418:(e,t,n)=>{"use strict";function i(e){const t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const i=encodeURIComponent(n),s=encodeURIComponent(e[n]);t.push(`${i}=${s}`)}return t.join("&")}n.d(t,{T:()=>i})},3253:(e,t,n)=>{"use strict";function i(e){var t=window.addEventListener?"addEventListener":"attachEvent";(0,window[t])("attachEvent"==t?"onmessage":"message",(function(t){var n=t[t.message?"message":"data"];"login"===n?.event&&"function"==typeof e&&e(n.user)}),!1)}n.r(t),n.d(t,{waitForLogin:()=>i})},8277:(e,t,n)=>{"use strict";function i(e){const t="webhook"===e?"none":"";document.getElementById("scrape_mode").style.display=t}n.d(t,{D:()=>i})},5406:(e,t,n)=>{"use strict";n.d(t,{BH:()=>m,LL:()=>O,ZR:()=>A,tV:()=>a,L:()=>o,Sg:()=>g,ne:()=>F,vZ:()=>D,pd:()=>U,aH:()=>d,q4:()=>c,P0:()=>u,Pz:()=>h,m9:()=>V,z$:()=>v,ru:()=>E,Xx:()=>p,L_:()=>S,xb:()=>L,w1:()=>k,hl:()=>T,uI:()=>b,b$:()=>I,G6:()=>x,Uo:()=>f,xO:()=>M,zd:()=>P,dp:()=>w,eu:()=>C});const i=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const s=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,l=a?e[t+2]:0,c=s>>2,u=(3&s)<<4|o>>4;let d=(15&o)<<2|l>>6,h=63&l;a||(h=64,r||(d=64)),i.push(n[c],n[u],n[d],n[h])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],o=t<e.length?n[e.charAt(t)]:0;++t;const a=t<e.length?n[e.charAt(t)]:64;++t;const l=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==o||null==a||null==l)throw new r;const c=s<<2|o>>4;if(i.push(c),64!==a){const e=o<<4&240|a>>2;if(i.push(e),64!==l){const e=a<<6&192|l;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},a=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},l=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const e=process.env.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"==typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}const t=e&&a(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`)}},c=e=>{var t,n;return null===(n=null===(t=l())||void 0===t?void 0:t.emulatorHosts)||void 0===n?void 0:n[e]},u=e=>{const t=c(e);if(!t)return;const n=t.lastIndexOf(":");if(n<=0||n+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(n+1),10);return"["===t[0]?[t.substring(1,n-1),i]:[t.substring(0,n),i]},d=()=>{var e;return null===(e=l())||void 0===e?void 0:e.config},h=e=>{var t;return null===(t=l())||void 0===t?void 0:t[`_${e}`]};class m{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function p(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(e){return!1}}async function f(e){return(await fetch(e,{credentials:"include"})).ok}function g(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const r=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(r)),""].join(".")}const _={};let y=!1;function w(e,t){if("undefined"==typeof window||"undefined"==typeof document||!p(window.location.host)||_[e]===t||_[e]||y)return;function n(e){return`__firebase__banner__${e}`}_[e]=t;const i="__firebase__banner",s=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(_))_[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function r(){const e=function(e){let t=document.getElementById(e),n=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),n=!0),{created:n,element:t}}(i),t=n("text"),r=document.getElementById(t)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),l=n("preprendIcon"),c=document.getElementById(l)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(a,o);const n=function(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{y=!0,function(){const e=document.getElementById(i);e&&e.remove()}()},e}();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(c,l),t.append(c,r,a,n),document.body.appendChild(t)}s?(r.innerText="Preview backend disconnected.",c.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(c.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',r.innerText="Preview backend running in this workspace."),r.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",r):r()}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())}function S(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function E(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function I(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function k(){const e=v();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function x(){return!function(){var e;const t=null===(e=l())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function T(){try{return"object"==typeof indexedDB}catch(e){return!1}}function C(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class A extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,A.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,O.prototype.create)}}class O{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(N,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new A(i,o,n)}}const N=/\{\$([^}]+)}/g;function L(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function D(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(R(n)&&R(r)){if(!D(n,r))return!1}else if(n!==r)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function R(e){return null!==e&&"object"==typeof e}function M(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function P(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function U(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}function F(e,t){const n=new q(e,t);return n.subscribe.bind(n)}class q{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=j),void 0===i.error&&(i.error=j),void 0===i.complete&&(i.complete=j);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function j(){}function V(e){return e&&e._delegate?e._delegate:e}},6503:(e,t,n)=>{e.exports=n(9819)},9819:(e,t)=>{!function(e){e.isSpintax=function(e){return null!==e.match(/\{[^}]*\|*[^}]*\}/)},e.findSpintax=function(e){return e.match(/\{([^{}]+?)\}/)},e.unspin=function(t,n){for(var i,s,r,o=t,a=0;e.isSpintax(t);){if(a>=1e3)throw new Error("Unable unspin text after 1000 iterations ("+o+")");r=(s=(i=e.findSpintax(t))[1].split("|"))[Math.floor((n||Math.random)()*s.length)],t=t.replace(i[0],r),a++}return t},e.count=function(t){for(var n,i,s,r,o,a=0,l=/%%%\d+%%%/g,c=/%%%(\d+)%%%/,u=t,d=0;e.isSpintax(t);){if(d>=1e3)throw new Error("Unable unspin text after 1000 iterations ("+u+")");for(i=(n=e.findSpintax(t))[1].split("|"),s=0,o=0;o<i.length;o++)i[o].match(l)?s+=parseInt(i[o].match(c)[1])||1:s+=1;t=t.replace(n[0],"%%%N%%%".replace("N",s.toString())),d++}if(t.match(l))for(r=t.match(l),a=1,o=0;o<r.length;o++)a*=parseInt(r[o].match(c)[1])||1;return a},e.validate=function(t){return null===(t=e.unspin(t)).match(/(\{[^}]*\|)|(\|[^{]*\})/)}}(t)},389:(e,t,n)=>{"use strict";n.d(t,{Jn:()=>U,qX:()=>D,rh:()=>R,Xd:()=>L,Mq:()=>q,ZF:()=>F,KN:()=>j});var i=n(8463),s=n(3333),r=n(5406);let o,a;const l=new WeakMap,c=new WeakMap,u=new WeakMap,d=new WeakMap,h=new WeakMap;let m={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return c.get(e);if("objectStoreNames"===t)return e.objectStoreNames||u.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return f(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function p(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(a||(a=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(g(this),e),f(l.get(this))}:function(...e){return f(t.apply(g(this),e))}:function(e,...n){const i=t.call(g(this),e,...n);return u.set(i,e.sort?e.sort():[e]),f(i)}:(e instanceof IDBTransaction&&function(e){if(c.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));c.set(e,t)}(e),n=e,(o||(o=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((e=>n instanceof e))?new Proxy(e,m):e);var t,n}function f(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(f(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&l.set(t,e)})).catch((()=>{})),h.set(t,e),t}(e);if(d.has(e))return d.get(e);const t=p(e);return t!==e&&(d.set(e,t),h.set(t,e)),t}const g=e=>h.get(e),_=["get","getKey","getAll","getAllKeys","count"],y=["put","add","delete","clear"],w=new Map;function v(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(w.get(t))return w.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=y.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!_.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return w.set(t,r),r}var b;b=m,m={...b,get:(e,t,n)=>v(e,t)||b.get(e,t,n),has:(e,t)=>!!v(e,t)||b.has(e,t)};class S{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const E="@firebase/app",I="0.13.2",k=new s.Yd("@firebase/app"),x="[DEFAULT]",T={[E]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},C=new Map,A=new Map,O=new Map;function N(e,t){try{e.container.addComponent(t)}catch(n){k.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function L(e){const t=e.name;if(O.has(t))return k.debug(`There were multiple attempts to register component ${t}.`),!1;O.set(t,e);for(const t of C.values())N(t,e);for(const t of A.values())N(t,e);return!0}function D(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function R(e){return null!=e&&void 0!==e.settings}const M=new r.LL("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class P{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new i.wA("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw M.create("app-deleted",{appName:this._name})}}const U="11.10.0";function F(e,t={}){let n=e;"object"!=typeof t&&(t={name:t});const s=Object.assign({name:x,automaticDataCollectionEnabled:!0},t),o=s.name;if("string"!=typeof o||!o)throw M.create("bad-app-name",{appName:String(o)});if(n||(n=(0,r.aH)()),!n)throw M.create("no-options");const a=C.get(o);if(a){if((0,r.vZ)(n,a.options)&&(0,r.vZ)(s,a.config))return a;throw M.create("duplicate-app",{appName:o})}const l=new i.H0(o);for(const e of O.values())l.addComponent(e);const c=new P(n,s,l);return C.set(o,c),c}function q(e="[DEFAULT]"){const t=C.get(e);if(!t&&e===x&&(0,r.aH)())return F();if(!t)throw M.create("no-app",{appName:e});return t}function j(e,t,n){var s;let r=null!==(s=T[e])&&void 0!==s?s:e;n&&(r+=`-${n}`);const o=r.match(/\s|\//),a=t.match(/\s|\//);if(o||a){const e=[`Unable to register library "${r}" with version "${t}":`];return o&&e.push(`library name "${r}" contains illegal characters (whitespace or "/")`),o&&a&&e.push("and"),a&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void k.warn(e.join(" "))}L(new i.wA(`${r}-version`,(()=>({library:r,version:t})),"VERSION"))}const V="firebase-heartbeat-store";let G=null;function B(){return G||(G=function(e,t,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=f(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(f(o.result),e.oldVersion,e.newVersion,f(o.transaction),e)})),n&&o.addEventListener("blocked",(e=>n(e.oldVersion,e.newVersion,e))),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(e=>s(e.oldVersion,e.newVersion,e)))})).catch((()=>{})),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(V)}catch(e){console.warn(e)}}}).catch((e=>{throw M.create("idb-open",{originalErrorMessage:e.message})}))),G}async function $(e,t){try{const n=(await B()).transaction(V,"readwrite"),i=n.objectStore(V);await i.put(t,K(e)),await n.done}catch(e){if(e instanceof r.ZR)k.warn(e.message);else{const t=M.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});k.warn(t.message)}}}function K(e){return`${e.name}!${e.options.appId}`}class W{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new H(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){var e,t;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=z();if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some((e=>e.date===i)))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:n}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,n=e[0].date;for(let i=1;i<e.length;i++)e[i].date<n&&(n=e[i].date,t=i);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(e){k.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=z(),{heartbeatsToSend:n,unsentEntries:i}=function(e,t=1024){const n=[];let i=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),Q(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Q(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),s=(0,r.L)(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(e){return k.warn(e),""}}}function z(){return(new Date).toISOString().substring(0,10)}class H{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,r.hl)()&&(0,r.eu)().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await B()).transaction(V),n=await t.objectStore(V).get(K(e));return await t.done,n}catch(e){if(e instanceof r.ZR)k.warn(e.message);else{const t=M.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});k.warn(t.message)}}}(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return $(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return $(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Q(e){return(0,r.L)(JSON.stringify({version:2,heartbeats:e})).length}L(new i.wA("platform-logger",(e=>new S(e)),"PRIVATE")),L(new i.wA("heartbeat",(e=>new W(e)),"PRIVATE")),j(E,I,""),j(E,I,"esm2017"),j("fire-js","")},8463:(e,t,n)=>{"use strict";n.d(t,{H0:()=>a,wA:()=>s});var i=n(5406);class s{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const r="[DEFAULT]";class o{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new i.BH;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:r})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e="[DEFAULT]"){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e="[DEFAULT]"){return this.instances.has(e)}getOptions(e="[DEFAULT]"){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===r?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e="[DEFAULT]"){return this.component?this.component.multipleInstances?e:r:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class a{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new o(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},3333:(e,t,n)=>{"use strict";n.d(t,{Yd:()=>c,in:()=>s});const i=[];var s;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(s||(s={}));const r={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},o=s.INFO,a={[s.DEBUG]:"log",[s.VERBOSE]:"log",[s.INFO]:"info",[s.WARN]:"warn",[s.ERROR]:"error"},l=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),s=a[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${i}]  ${e.name}:`,...n)};class c{constructor(e){this.name=e,this._logLevel=o,this._logHandler=l,this._userLogHandler=null,i.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in s))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?r[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,s.DEBUG,...e),this._logHandler(this,s.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,s.VERBOSE,...e),this._logHandler(this,s.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,s.INFO,...e),this._logHandler(this,s.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,s.WARN,...e),this._logHandler(this,s.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,s.ERROR,...e),this._logHandler(this,s.ERROR,...e)}}},6010:(e,t,n)=>{"use strict";n.d(t,{v0:()=>cn,_p:()=>Xe});var i=n(389),s=n(5406),r=n(3333);function o(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}Object.create,Object.create;var a=n(8463);const l=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},c=new s.LL("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),u=new r.Yd("@firebase/auth");function d(e,...t){u.logLevel<=r.in.ERROR&&u.error(`Auth (${i.Jn}): ${e}`,...t)}function h(e,...t){throw g(e,...t)}function m(e,...t){return g(e,...t)}function p(e,t,n){const i=Object.assign(Object.assign({},l()),{[t]:n});return new s.LL("auth","Firebase",i).create(t,{appName:e.name})}function f(e){return p(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function g(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return c.create(e,...t)}function _(e,t,...n){if(!e)throw g(t,...n)}function y(e){const t="INTERNAL ASSERTION FAILED: "+e;throw d(t),new Error(t)}function w(e,t){e||y(t)}function v(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function b(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class S{constructor(e,t){this.shortDelay=e,this.longDelay=t,w(t>e,"Short delay should be less than long delay!"),this.isMobile=(0,s.uI)()||(0,s.b$)()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===b()||"https:"===b()||(0,s.ru)()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function E(e,t){w(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class I{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:"undefined"!=typeof globalThis&&globalThis.fetch?globalThis.fetch:"undefined"!=typeof fetch?fetch:void y("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:"undefined"!=typeof globalThis&&globalThis.Headers?globalThis.Headers:"undefined"!=typeof Headers?Headers:void y("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:"undefined"!=typeof globalThis&&globalThis.Response?globalThis.Response:"undefined"!=typeof Response?Response:void y("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const k={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"},x=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],T=new S(3e4,6e4);function C(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function A(e,t,n,i,r={}){return O(e,r,(async()=>{let r={},o={};i&&("GET"===t?o=i:r={body:JSON.stringify(i)});const a=(0,s.xO)(Object.assign({key:e.config.apiKey},o)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:l},r);return(0,s.L_)()||(c.referrerPolicy="no-referrer"),e.emulatorConfig&&(0,s.Xx)(e.emulatorConfig.host)&&(c.credentials="include"),I.fetch()(await L(e,e.config.apiHost,n,a),c)}))}async function O(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},k),t);try{const t=new R(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw M(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw M(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw M(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw M(e,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw p(e,a,o);h(e,a)}}catch(t){if(t instanceof s.ZR)throw t;h(e,"network-request-failed",{message:String(t)})}}async function N(e,t,n,i,s={}){const r=await A(e,t,n,i,s);return"mfaPendingCredential"in r&&h(e,"multi-factor-auth-required",{_serverResponse:r}),r}async function L(e,t,n,i){const s=`${t}${n}?${i}`,r=e,o=r.config.emulator?E(e.config,s):`${e.config.apiScheme}://${s}`;return x.includes(n)&&(await r._persistenceManagerAvailable,"COOKIE"===r._getPersistenceType())?r._getPersistence()._getFinalTarget(o).toString():o}function D(e){switch(e){case"ENFORCE":return"ENFORCE";case"AUDIT":return"AUDIT";case"OFF":return"OFF";default:return"ENFORCEMENT_STATE_UNSPECIFIED"}}class R{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(m(this.auth,"network-request-failed"))),T.get())}))}}function M(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=m(e,t,i);return s.customData._tokenResponse=n,s}function P(e){return void 0!==e&&void 0!==e.enterprise}class U{constructor(e){if(this.siteKey="",this.recaptchaEnforcementState=[],void 0===e.recaptchaKey)throw new Error("recaptchaKey undefined");this.siteKey=e.recaptchaKey.split("/")[3],this.recaptchaEnforcementState=e.recaptchaEnforcementState}getProviderEnforcementState(e){if(!this.recaptchaEnforcementState||0===this.recaptchaEnforcementState.length)return null;for(const t of this.recaptchaEnforcementState)if(t.provider&&t.provider===e)return D(t.enforcementState);return null}isProviderEnabled(e){return"ENFORCE"===this.getProviderEnforcementState(e)||"AUDIT"===this.getProviderEnforcementState(e)}isAnyProviderEnabled(){return this.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")||this.isProviderEnabled("PHONE_PROVIDER")}}async function F(e,t){return A(e,"GET","/v2/recaptchaConfig",C(e,t))}async function q(e,t){return A(e,"POST","/v1/accounts:lookup",t)}function j(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function V(e){return 1e3*Number(e)}function G(e){const[t,n,i]=e.split(".");if(void 0===t||void 0===n||void 0===i)return d("JWT malformed, contained fewer than 3 sections"),null;try{const e=(0,s.tV)(n);return e?JSON.parse(e):(d("Failed to decode base64 JWT payload"),null)}catch(e){return d("Caught error parsing JWT payload as JSON",null==e?void 0:e.toString()),null}}function B(e){const t=G(e);return _(t,"internal-error"),_(void 0!==t.exp,"internal-error"),_(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}async function $(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof s.ZR&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class K{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){try{await this.user.getIdToken(!0)}catch(e){return void("auth/network-request-failed"===(null==e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class W{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=j(this.lastLoginAt),this.creationTime=j(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function z(e){var t;const n=e.auth,i=await e.getIdToken(),s=await $(e,q(n,{idToken:i}));_(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const o=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?H(r.providerUserInfo):[],a=(l=e.providerData,c=o,[...l.filter((e=>!c.some((t=>t.providerId===e.providerId)))),...c]);var l,c;const u=e.isAnonymous,d=!(e.email&&r.passwordHash||(null==a?void 0:a.length)),h=!!u&&d,m={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new W(r.createdAt,r.lastLoginAt),isAnonymous:h};Object.assign(e,m)}function H(e){return e.map((e=>{var{providerId:t}=e,n=o(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}}))}class Q{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){_(e.idToken,"internal-error"),_(void 0!==e.idToken,"internal-error"),_(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):B(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){_(0!==e.length,"internal-error");const t=B(e);this.updateTokensAndExpiration(e,null,t)}async getToken(e,t=!1){return t||!this.accessToken||this.isExpired?(_(this.refreshToken,e,"user-token-expired"),this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null):this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:r}=await async function(e,t){const n=await O(e,{},(async()=>{const n=(0,s.xO)({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:r}=e.config,o=await L(e,i,"/v1/token",`key=${r}`),a=await e._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:n};return e.emulatorConfig&&(0,s.Xx)(e.emulatorConfig.host)&&(l.credentials="include"),I.fetch()(o,l)}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(r))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new Q;return n&&(_("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(_("string"==typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(_("number"==typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new Q,this.toJSON())}_performRefresh(){return y("not implemented")}}function J(e,t){_("string"==typeof e||void 0===e,"internal-error",{appName:t})}class Y{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=o(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new K(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new W(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await $(this,this.stsTokenManager.getToken(this.auth,e));return _(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=(0,s.m9)(e),i=await n.getIdToken(t),r=G(i);_(r&&r.exp&&r.auth_time&&r.iat,n.auth,"internal-error");const o="object"==typeof r.firebase?r.firebase:void 0,a=null==o?void 0:o.sign_in_provider;return{claims:r,token:i,authTime:j(V(r.auth_time)),issuedAtTime:j(V(r.iat)),expirationTime:j(V(r.exp)),signInProvider:a||null,signInSecondFactor:(null==o?void 0:o.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=(0,s.m9)(e);await z(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(_(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){const t=new Y(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){_(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await z(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){if((0,i.rh)(this.auth.app))return Promise.reject(f(this.auth));const e=await this.getIdToken();return await $(this,async function(e,t){return A(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,o,a,l,c;const u=null!==(n=t.displayName)&&void 0!==n?n:void 0,d=null!==(i=t.email)&&void 0!==i?i:void 0,h=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,m=null!==(r=t.photoURL)&&void 0!==r?r:void 0,p=null!==(o=t.tenantId)&&void 0!==o?o:void 0,f=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,g=null!==(l=t.createdAt)&&void 0!==l?l:void 0,y=null!==(c=t.lastLoginAt)&&void 0!==c?c:void 0,{uid:w,emailVerified:v,isAnonymous:b,providerData:S,stsTokenManager:E}=t;_(w&&E,e,"internal-error");const I=Q.fromJSON(this.name,E);_("string"==typeof w,e,"internal-error"),J(u,e.name),J(d,e.name),_("boolean"==typeof v,e,"internal-error"),_("boolean"==typeof b,e,"internal-error"),J(h,e.name),J(m,e.name),J(p,e.name),J(f,e.name),J(g,e.name),J(y,e.name);const k=new Y({uid:w,auth:e,email:d,emailVerified:v,displayName:u,isAnonymous:b,photoURL:m,phoneNumber:h,tenantId:p,stsTokenManager:I,createdAt:g,lastLoginAt:y});return S&&Array.isArray(S)&&(k.providerData=S.map((e=>Object.assign({},e)))),f&&(k._redirectEventId=f),k}static async _fromIdTokenResponse(e,t,n=!1){const i=new Q;i.updateFromServerResponse(t);const s=new Y({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await z(s),s}static async _fromGetAccountInfoResponse(e,t,n){const i=t.users[0];_(void 0!==i.localId,"internal-error");const s=void 0!==i.providerUserInfo?H(i.providerUserInfo):[],r=!(i.email&&i.passwordHash||(null==s?void 0:s.length)),o=new Q;o.updateFromIdToken(n);const a=new Y({uid:i.localId,auth:e,stsTokenManager:o,isAnonymous:r}),l={uid:i.localId,displayName:i.displayName||null,photoURL:i.photoUrl||null,email:i.email||null,emailVerified:i.emailVerified||!1,phoneNumber:i.phoneNumber||null,tenantId:i.tenantId||null,providerData:s,metadata:new W(i.createdAt,i.lastLoginAt),isAnonymous:!(i.email&&i.passwordHash||(null==s?void 0:s.length))};return Object.assign(a,l),a}}const X=new Map;function Z(e){w(e instanceof Function,"Expected a class definition");let t=X.get(e);return t?(w(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,X.set(e,t),t)}class ee{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}ee.type="NONE";const te=ee;function ne(e,t,n){return`firebase:${e}:${t}:${n}`}class ie{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=ne(this.userKey,i.apiKey,s),this.fullPersistenceKey=ne("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);if(!e)return null;if("string"==typeof e){const t=await q(this.auth,{idToken:e}).catch((()=>{}));return t?Y._fromGetAccountInfoResponse(this.auth,t,e):null}return Y._fromJSON(this.auth,e)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new ie(Z(te),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=i[0]||Z(te);const r=ne(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(r);if(t){let i;if("string"==typeof t){const n=await q(e,{idToken:t}).catch((()=>{}));if(!n)break;i=await Y._fromGetAccountInfoResponse(e,n,t)}else i=Y._fromJSON(e,t);n!==s&&(o=i),s=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(r)}catch(e){}}))),new ie(s,e,n)):new ie(s,e,n)}}function se(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(le(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(re(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ue(t))return"Blackberry";if(de(t))return"Webos";if(oe(t))return"Safari";if((t.includes("chrome/")||ae(t))&&!t.includes("edge/"))return"Chrome";if(ce(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function re(e=(0,s.z$)()){return/firefox\//i.test(e)}function oe(e=(0,s.z$)()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ae(e=(0,s.z$)()){return/crios\//i.test(e)}function le(e=(0,s.z$)()){return/iemobile/i.test(e)}function ce(e=(0,s.z$)()){return/android/i.test(e)}function ue(e=(0,s.z$)()){return/blackberry/i.test(e)}function de(e=(0,s.z$)()){return/webos/i.test(e)}function he(e=(0,s.z$)()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function me(e=(0,s.z$)()){return he(e)||ce(e)||de(e)||ue(e)||/windows phone/i.test(e)||le(e)}function pe(e,t=[]){let n;switch(e){case"Browser":n=se((0,s.z$)());break;case"Worker":n=`${se((0,s.z$)())}-${e}`;break;default:n=e}const r=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${i.Jn}/${r}`}class fe{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){if(this.auth.currentUser===e)return;const t=[];try{for(const n of this.queue)await n(e),n.onAbort&&t.push(n.onAbort)}catch(e){t.reverse();for(const e of t)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null==e?void 0:e.message})}}}class ge{constructor(e){var t,n,i,s;const r=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=null!==(t=r.minPasswordLength)&&void 0!==t?t:6,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),void 0!==r.containsLowercaseCharacter&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),void 0!==r.containsUppercaseCharacter&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),void 0!==r.containsNumericCharacter&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),void 0!==r.containsNonAlphanumericCharacter&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,"ENFORCEMENT_STATE_UNSPECIFIED"===this.enforcementState&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=null!==(i=null===(n=e.allowedNonAlphanumericCharacters)||void 0===n?void 0:n.join(""))&&void 0!==i?i:"",this.forceUpgradeOnSignin=null!==(s=e.forceUpgradeOnSignin)&&void 0!==s&&s,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,n,i,s,r,o;const a={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,a),this.validatePasswordCharacterOptions(e,a),a.isValid&&(a.isValid=null===(t=a.meetsMinPasswordLength)||void 0===t||t),a.isValid&&(a.isValid=null===(n=a.meetsMaxPasswordLength)||void 0===n||n),a.isValid&&(a.isValid=null===(i=a.containsLowercaseLetter)||void 0===i||i),a.isValid&&(a.isValid=null===(s=a.containsUppercaseLetter)||void 0===s||s),a.isValid&&(a.isValid=null===(r=a.containsNumericCharacter)||void 0===r||r),a.isValid&&(a.isValid=null===(o=a.containsNonAlphanumericCharacter)||void 0===o||o),a}validatePasswordLengthOptions(e,t){const n=this.customStrengthOptions.minPasswordLength,i=this.customStrengthOptions.maxPasswordLength;n&&(t.meetsMinPasswordLength=e.length>=n),i&&(t.meetsMaxPasswordLength=e.length<=i)}validatePasswordCharacterOptions(e,t){let n;this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);for(let i=0;i<e.length;i++)n=e.charAt(i),this.updatePasswordCharacterOptionsStatuses(t,n>="a"&&n<="z",n>="A"&&n<="Z",n>="0"&&n<="9",this.allowedNonAlphanumericCharacters.includes(n))}updatePasswordCharacterOptionsStatuses(e,t,n,i,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=n)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=i)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}}class _e{constructor(e,t,n,i){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=n,this.config=i,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new we(this),this.idTokenSubscription=new we(this),this.beforeStateQueue=new fe(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=c,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=i.sdkClientVersion,this._persistenceManagerAvailable=new Promise((e=>this._resolvePersistenceManagerAvailable=e))}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Z(t)),this._initializationPromise=this.queue((async()=>{var n,i,s;if(!this._deleted&&(this.persistenceManager=await ie.create(this,e),null===(n=this._resolvePersistenceManagerAvailable)||void 0===n||n.call(this),!this._deleted)){if(null===(i=this._popupRedirectResolver)||void 0===i?void 0:i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(s=this.currentUser)||void 0===s?void 0:s.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUserFromIdToken(e){try{const t=await q(this,{idToken:e}),n=await Y._fromGetAccountInfoResponse(this,t,e);await this.directlySetCurrentUser(n)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(e){var t;if((0,i.rh)(this.app)){const e=this.app.settings.authIdToken;return e?new Promise((t=>{setTimeout((()=>this.initializeCurrentUserFromIdToken(e).then(t,t)))})):this.directlySetCurrentUser(null)}const n=await this.assertedPersistence.getCurrentUser();let s=n,r=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,i=null==s?void 0:s._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==i||!(null==o?void 0:o.user)||(s=o.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(e){s=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return _(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){try{await z(e)}catch(e){if("auth/network-request-failed"!==(null==e?void 0:e.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){if((0,i.rh)(this.app))return Promise.reject(f(this));const t=e?(0,s.m9)(e):null;return t&&_(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&_(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return(0,i.rh)(this.app)?Promise.reject(f(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(e){return(0,i.rh)(this.app)?Promise.reject(f(this)):this.queue((async()=>{await this.assertedPersistence.setPersistence(Z(e))}))}_getRecaptchaConfig(){return null==this.tenantId?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(e){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)}_getPasswordPolicyInternal(){return null===this.tenantId?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const e=await async function(e,t={}){return A(e,"GET","/v2/passwordPolicy",C(e,t))}(this),t=new ge(e);null===this.tenantId?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new s.LL("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}authStateReady(){return new Promise(((e,t)=>{if(this.currentUser)e();else{const n=this.onAuthStateChanged((()=>{n(),e()}),t)}}))}async revokeAccessToken(e){if(this.currentUser){const t={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:await this.currentUser.getIdToken()};null!=this.tenantId&&(t.tenantId=this.tenantId),await async function(e,t){return A(e,"POST","/v2/accounts:revokeToken",C(e,t))}(this,t)}}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&Z(e)||this._popupRedirectResolver;_(t,this,"argument-error"),this.redirectPersistenceManager=await ie.create(this,[Z(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t);let r=!1;const o=this._isInitialized?Promise.resolve():this._initializationPromise;if(_(o,this,"internal-error"),o.then((()=>{r||s(this.currentUser)})),"function"==typeof t){const s=e.addObserver(t,n,i);return()=>{r=!0,s()}}{const n=e.addObserver(t);return()=>{r=!0,n()}}}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return _(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=pe(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());n&&(t["X-Firebase-Client"]=n);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){var e;if((0,i.rh)(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await(null===(e=this.appCheckServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getToken());return(null==t?void 0:t.error)&&function(e,...t){u.logLevel<=r.in.WARN&&u.warn(`Auth (${i.Jn}): ${e}`,...t)}(`Error while retrieving App Check token: ${t.error}`),null==t?void 0:t.token}}function ye(e){return(0,s.m9)(e)}class we{constructor(e){this.auth=e,this.observer=null,this.addObserver=(0,s.ne)((e=>this.observer=e))}get next(){return _(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let ve={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function be(e){return ve.loadJS(e)}function Se(e){return`__${e}${Math.floor(1e6*Math.random())}`}class Ee{constructor(){this.enterprise=new Ie}ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}class Ie{ready(e){e()}execute(e,t){return Promise.resolve("token")}render(e,t){return""}}const ke="NO_RECAPTCHA";class xe{constructor(e){this.type="recaptcha-enterprise",this.auth=ye(e)}async verify(e="verify",t=!1){function n(t,n,i){const s=window.grecaptcha;P(s)?s.enterprise.ready((()=>{s.enterprise.execute(t,{action:e}).then((e=>{n(e)})).catch((()=>{n(ke)}))})):i(Error("No reCAPTCHA enterprise script loaded."))}return this.auth.settings.appVerificationDisabledForTesting?(new Ee).execute("siteKey",{action:"verify"}):new Promise(((e,i)=>{(async function(e){if(!t){if(null==e.tenantId&&null!=e._agentRecaptchaConfig)return e._agentRecaptchaConfig.siteKey;if(null!=e.tenantId&&void 0!==e._tenantRecaptchaConfigs[e.tenantId])return e._tenantRecaptchaConfigs[e.tenantId].siteKey}return new Promise((async(t,n)=>{F(e,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}).then((i=>{if(void 0!==i.recaptchaKey){const n=new U(i);return null==e.tenantId?e._agentRecaptchaConfig=n:e._tenantRecaptchaConfigs[e.tenantId]=n,t(n.siteKey)}n(new Error("recaptcha Enterprise site key undefined"))})).catch((e=>{n(e)}))}))})(this.auth).then((s=>{if(!t&&P(window.grecaptcha))n(s,e,i);else{if("undefined"==typeof window)return void i(new Error("RecaptchaVerifier is only supported in browser"));let t=ve.recaptchaEnterpriseScript;0!==t.length&&(t+=s),be(t).then((()=>{n(s,e,i)})).catch((e=>{i(e)}))}})).catch((e=>{i(e)}))}))}}async function Te(e,t,n,i=!1,s=!1){const r=new xe(e);let o;if(s)o=ke;else try{o=await r.verify(n)}catch(e){o=await r.verify(n,!0)}const a=Object.assign({},t);if("mfaSmsEnrollment"===n||"mfaSmsSignIn"===n){if("phoneEnrollmentInfo"in a){const e=a.phoneEnrollmentInfo.phoneNumber,t=a.phoneEnrollmentInfo.recaptchaToken;Object.assign(a,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:t,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}else if("phoneSignInInfo"in a){const e=a.phoneSignInInfo.recaptchaToken;Object.assign(a,{phoneSignInInfo:{recaptchaToken:e,captchaResponse:o,clientType:"CLIENT_TYPE_WEB",recaptchaVersion:"RECAPTCHA_ENTERPRISE"}})}return a}return i?Object.assign(a,{captchaResp:o}):Object.assign(a,{captchaResponse:o}),Object.assign(a,{clientType:"CLIENT_TYPE_WEB"}),Object.assign(a,{recaptchaVersion:"RECAPTCHA_ENTERPRISE"}),a}async function Ce(e,t,n,i,s){var r,o;if("EMAIL_PASSWORD_PROVIDER"===s){if(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.isProviderEnabled("EMAIL_PASSWORD_PROVIDER")){const s=await Te(e,t,n,"getOobCode"===n);return i(e,s)}return i(e,t).catch((async s=>{if("auth/missing-recaptcha-token"===s.code){console.log(`${n} is protected by reCAPTCHA Enterprise for this project. Automatically triggering the reCAPTCHA flow and restarting the flow.`);const s=await Te(e,t,n,"getOobCode"===n);return i(e,s)}return Promise.reject(s)}))}if("PHONE_PROVIDER"===s){if(null===(o=e._getRecaptchaConfig())||void 0===o?void 0:o.isProviderEnabled("PHONE_PROVIDER")){const s=await Te(e,t,n);return i(e,s).catch((async s=>{var r;if("AUDIT"===(null===(r=e._getRecaptchaConfig())||void 0===r?void 0:r.getProviderEnforcementState("PHONE_PROVIDER"))&&("auth/missing-recaptcha-token"===s.code||"auth/invalid-app-credential"===s.code)){console.log(`Failed to verify with reCAPTCHA Enterprise. Automatically triggering the reCAPTCHA v2 flow to complete the ${n} flow.`);const s=await Te(e,t,n,!1,!0);return i(e,s)}return Promise.reject(s)}))}{const s=await Te(e,t,n,!1,!0);return i(e,s)}}return Promise.reject(s+" provider is not supported.")}function Ae(e){const t=e.indexOf(":");return t<0?"":e.substr(0,t+1)}function Oe(e){if(!e)return null;const t=Number(e);return isNaN(t)?null:t}class Ne{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return y("not implemented")}_getIdTokenResponse(e){return y("not implemented")}_linkToIdToken(e,t){return y("not implemented")}_getReauthenticationResolver(e){return y("not implemented")}}async function Le(e,t){return A(e,"POST","/v1/accounts:signUp",t)}async function De(e,t){return N(e,"POST","/v1/accounts:signInWithPassword",C(e,t))}class Re extends Ne{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new Re(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new Re(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return Ce(e,{returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signInWithPassword",De,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return N(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{email:this._email,oobCode:this._password});default:h(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return Ce(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password,clientType:"CLIENT_TYPE_WEB"},"signUpPassword",Le,"EMAIL_PASSWORD_PROVIDER");case"emailLink":return async function(e,t){return N(e,"POST","/v1/accounts:signInWithEmailLink",C(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:h(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function Me(e,t){return N(e,"POST","/v1/accounts:signInWithIdp",C(e,t))}class Pe extends Ne{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new Pe(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):h("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=o(t,["providerId","signInMethod"]);if(!n||!i)return null;const r=new Pe(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return Me(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,Me(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,Me(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=(0,s.xO)(t)}return e}}async function Ue(e,t){return A(e,"POST","/v1/accounts:sendVerificationCode",C(e,t))}const Fe={USER_NOT_FOUND:"user-not-found"};class qe extends Ne{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new qe({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new qe({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return N(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await N(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,t));if(n.temporaryProof)throw M(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return N(e,"POST","/v1/accounts:signInWithPhoneNumber",C(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),Fe)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new qe({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class je{constructor(e){var t,n,i,r,o,a;const l=(0,s.zd)((0,s.pd)(e)),c=null!==(t=l.apiKey)&&void 0!==t?t:null,u=null!==(n=l.oobCode)&&void 0!==n?n:null,d=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=l.mode)&&void 0!==i?i:null);_(c&&u&&d,"argument-error"),this.apiKey=c,this.operation=d,this.code=u,this.continueUrl=null!==(r=l.continueUrl)&&void 0!==r?r:null,this.languageCode=null!==(o=l.lang)&&void 0!==o?o:null,this.tenantId=null!==(a=l.tenantId)&&void 0!==a?a:null}static parseLink(e){const t=function(e){const t=(0,s.zd)((0,s.pd)(e)).link,n=t?(0,s.zd)((0,s.pd)(t)).deep_link_id:null,i=(0,s.zd)((0,s.pd)(e)).deep_link_id;return(i?(0,s.zd)((0,s.pd)(i)).link:null)||i||n||t||e}(e);try{return new je(t)}catch(e){return null}}}class Ve{constructor(){this.providerId=Ve.PROVIDER_ID}static credential(e,t){return Re._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=je.parseLink(t);return _(n,"argument-error"),Re._fromEmailAndCode(e,n.code,n.tenantId)}}Ve.PROVIDER_ID="password",Ve.EMAIL_PASSWORD_SIGN_IN_METHOD="password",Ve.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class Ge{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Be extends Ge{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class $e extends Be{constructor(){super("facebook.com")}static credential(e){return Pe._fromParams({providerId:$e.PROVIDER_ID,signInMethod:$e.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return $e.credentialFromTaggedObject(e)}static credentialFromError(e){return $e.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return $e.credential(e.oauthAccessToken)}catch(e){return null}}}$e.FACEBOOK_SIGN_IN_METHOD="facebook.com",$e.PROVIDER_ID="facebook.com";class Ke extends Be{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return Pe._fromParams({providerId:Ke.PROVIDER_ID,signInMethod:Ke.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ke.credentialFromTaggedObject(e)}static credentialFromError(e){return Ke.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ke.credential(t,n)}catch(e){return null}}}Ke.GOOGLE_SIGN_IN_METHOD="google.com",Ke.PROVIDER_ID="google.com";class We extends Be{constructor(){super("github.com")}static credential(e){return Pe._fromParams({providerId:We.PROVIDER_ID,signInMethod:We.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return We.credentialFromTaggedObject(e)}static credentialFromError(e){return We.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return We.credential(e.oauthAccessToken)}catch(e){return null}}}We.GITHUB_SIGN_IN_METHOD="github.com",We.PROVIDER_ID="github.com";class ze extends Be{constructor(){super("twitter.com")}static credential(e,t){return Pe._fromParams({providerId:ze.PROVIDER_ID,signInMethod:ze.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ze.credentialFromTaggedObject(e)}static credentialFromError(e){return ze.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ze.credential(t,n)}catch(e){return null}}}ze.TWITTER_SIGN_IN_METHOD="twitter.com",ze.PROVIDER_ID="twitter.com";class He{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await Y._fromIdTokenResponse(e,n,i),r=Qe(n);return new He({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=Qe(n);return new He({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function Qe(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Je extends s.ZR{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Je.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Je(e,t,n,i)}}function Ye(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Je._fromErrorAndOperation(e,n,t,i);throw n}))}async function Xe(e,t){if((0,i.rh)(e.app))return Promise.reject(f(e));const n=ye(e),s=await async function(e,t){return N(e,"POST","/v1/accounts:signInWithCustomToken",C(e,t))}(n,{token:t,returnSecureToken:!0}),r=await He._fromIdTokenResponse(n,"signIn",s);return await n._updateCurrentUser(r.user),r}function Ze(e,t){return A(e,"POST","/v2/accounts/mfaEnrollment:start",C(e,t))}new WeakMap;const et="__sak";class tt{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(et,"1"),this.storage.removeItem(et),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class nt extends tt{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=me(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;t?this.detachListener():this.stopPolling();const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},r=this.storage.getItem(n);(0,s.w1)()&&10===document.documentMode&&r!==e.newValue&&e.newValue!==e.oldValue?setTimeout(i,10):i()}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}nt.type="LOCAL";const it=nt;class st extends tt{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}st.type="SESSION";const rt=st;class ot{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new ot(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function at(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}ot.receivers=[];class lt{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const l=at("",20);i.port1.start();const c=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===l)switch(t.data.status){case"ack":clearTimeout(c),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(c),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:l,data:t},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function ct(){return window}function ut(){return void 0!==ct().WorkerGlobalScope&&"function"==typeof ct().importScripts}const dt="firebaseLocalStorageDb",ht="firebaseLocalStorage",mt="fbase_key";class pt{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function ft(e,t){return e.transaction([ht],t?"readwrite":"readonly").objectStore(ht)}function gt(){const e=indexedDB.open(dt,1);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(ht,{keyPath:mt})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(ht)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(dt);return new pt(e).toPromise()}(),t(await gt()))}))}))}async function _t(e,t,n){const i=ft(e,!0).put({[mt]:t,value:n});return new pt(i).toPromise()}function yt(e,t){const n=ft(e,!0).delete(t);return new pt(n).toPromise()}class wt{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await gt()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ut()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=ot._getInstance(ut()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new lt(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await gt();return await _t(e,et,"1"),await yt(e,et),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>_t(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=ft(e,!1).get(t),i=await new pt(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>yt(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=ft(e,!1).getAll();return new pt(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;if(0!==e.length)for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}wt.type="LOCAL";const vt=wt;function bt(e,t){return A(e,"POST","/v2/accounts/mfaSignIn:start",C(e,t))}Se("rcb"),new S(3e4,6e4);const St="recaptcha";async function Et(e,t,n){var i;if(!e._getRecaptchaConfig())try{await async function(e){const t=ye(e),n=await F(t,{clientType:"CLIENT_TYPE_WEB",version:"RECAPTCHA_ENTERPRISE"}),i=new U(n);null==t.tenantId?t._agentRecaptchaConfig=i:t._tenantRecaptchaConfigs[t.tenantId]=i,i.isAnyProviderEnabled()&&new xe(t).verify()}(e)}catch(e){console.log("Failed to initialize reCAPTCHA Enterprise config. Triggering the reCAPTCHA v2 verification.")}try{let s;if(s="string"==typeof t?{phoneNumber:t}:t,"session"in s){const t=s.session;if("phoneNumber"in s){_("enroll"===t.type,e,"internal-error");const i=Ce(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"}},"mfaSmsEnrollment",(async(e,t)=>t.phoneEnrollmentInfo.captchaResponse===ke?(_((null==n?void 0:n.type)===St,e,"argument-error"),Ze(e,await It(e,t,n))):Ze(e,t)),"PHONE_PROVIDER");return(await i.catch((e=>Promise.reject(e)))).phoneSessionInfo.sessionInfo}{_("signin"===t.type,e,"internal-error");const r=(null===(i=s.multiFactorHint)||void 0===i?void 0:i.uid)||s.multiFactorUid;_(r,e,"missing-multi-factor-info");const o=Ce(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:r,phoneSignInInfo:{clientType:"CLIENT_TYPE_WEB"}},"mfaSmsSignIn",(async(e,t)=>t.phoneSignInInfo.captchaResponse===ke?(_((null==n?void 0:n.type)===St,e,"argument-error"),bt(e,await It(e,t,n))):bt(e,t)),"PHONE_PROVIDER");return(await o.catch((e=>Promise.reject(e)))).phoneResponseInfo.sessionInfo}}{const t=Ce(e,{phoneNumber:s.phoneNumber,clientType:"CLIENT_TYPE_WEB"},"sendVerificationCode",(async(e,t)=>t.captchaResponse===ke?(_((null==n?void 0:n.type)===St,e,"argument-error"),Ue(e,await It(e,t,n))):Ue(e,t)),"PHONE_PROVIDER");return(await t.catch((e=>Promise.reject(e)))).sessionInfo}}finally{null==n||n._reset()}}async function It(e,t,n){_(n.type===St,e,"argument-error");const i=await n.verify();_("string"==typeof i,e,"argument-error");const s=Object.assign({},t);if("phoneEnrollmentInfo"in s){const e=s.phoneEnrollmentInfo.phoneNumber,t=s.phoneEnrollmentInfo.captchaResponse,n=s.phoneEnrollmentInfo.clientType,r=s.phoneEnrollmentInfo.recaptchaVersion;return Object.assign(s,{phoneEnrollmentInfo:{phoneNumber:e,recaptchaToken:i,captchaResponse:t,clientType:n,recaptchaVersion:r}}),s}if("phoneSignInInfo"in s){const e=s.phoneSignInInfo.captchaResponse,t=s.phoneSignInInfo.clientType,n=s.phoneSignInInfo.recaptchaVersion;return Object.assign(s,{phoneSignInInfo:{recaptchaToken:i,captchaResponse:e,clientType:t,recaptchaVersion:n}}),s}return Object.assign(s,{recaptchaToken:i}),s}class kt{constructor(e){this.providerId=kt.PROVIDER_ID,this.auth=ye(e)}verifyPhoneNumber(e,t){return Et(this.auth,e,(0,s.m9)(t))}static credential(e,t){return qe._fromVerification(e,t)}static credentialFromResult(e){const t=e;return kt.credentialFromTaggedObject(t)}static credentialFromError(e){return kt.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?qe._fromTokenResponse(t,n):null}}kt.PROVIDER_ID="phone",kt.PHONE_SIGN_IN_METHOD="phone";class xt extends Ne{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return Me(e,this._buildIdpRequest())}_linkToIdToken(e,t){return Me(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return Me(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function Tt(e){return async function(e,t,n=!1){if((0,i.rh)(e.app))return Promise.reject(f(e));const s="signIn",r=await Ye(e,s,t),o=await He._fromIdTokenResponse(e,s,r);return n||await e._updateCurrentUser(o.user),o}(e.auth,new xt(e),e.bypassAuthState)}function Ct(e){const{auth:t,user:n}=e;return _(n,t,"internal-error"),async function(e,t,n=!1){const{auth:s}=e;if((0,i.rh)(s.app))return Promise.reject(f(s));const r="reauthenticate";try{const i=await $(e,Ye(s,r,t,e),n);_(i.idToken,s,"internal-error");const o=G(i.idToken);_(o,s,"internal-error");const{sub:a}=o;return _(e.uid===a,s,"user-mismatch"),He._forOperation(e,r,i)}catch(e){throw"auth/user-not-found"===(null==e?void 0:e.code)&&h(s,"user-mismatch"),e}}(n,new xt(e),e.bypassAuthState)}async function At(e){const{auth:t,user:n}=e;return _(n,t,"internal-error"),async function(e,t,n=!1){const i=await $(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return He._forOperation(e,"link",i)}(n,new xt(e),e.bypassAuthState)}class Ot{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return Tt;case"linkViaPopup":case"linkViaRedirect":return At;case"reauthViaPopup":case"reauthViaRedirect":return Ct;default:h(this.auth,"internal-error")}}resolve(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){w(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Nt=new S(2e3,1e4);class Lt extends Ot{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,Lt.currentPopupAction&&Lt.currentPopupAction.cancel(),Lt.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return _(e,this.auth,"internal-error"),e}async onExecution(){w(1===this.filter.length,"Popup operations only handle one event");const e=at();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(m(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(m(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Lt.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(m(this.auth,"popup-closed-by-user"))}),8e3):this.pollId=window.setTimeout(e,Nt.get())};e()}}Lt.currentPopupAction=null;const Dt=new Map;class Rt extends Ot{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=Dt.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return ne("pendingRedirect",e.config.apiKey,e.name)}(t),i=function(e){return Z(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth)?await super.execute():null;e=()=>Promise.resolve(t)}catch(t){e=()=>Promise.reject(t)}Dt.set(this.auth._key(),e)}return this.bypassAuthState||Dt.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function Mt(e,t){Dt.set(e._key(),t)}async function Pt(e,t,n=!1){if((0,i.rh)(e.app))return Promise.reject(f(e));const s=ye(e),r=function(e,t){return t?Z(t):(_(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(s,t),o=new Rt(s,r,n),a=await o.execute();return a&&!n&&(delete a.user._redirectEventId,await s._persistUserIfCurrent(a.user),await s._setRedirectUser(null,t)),a}class Ut{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return qt(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!qt(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(m(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(Ft(e))}saveEventToCache(e){this.cachedEventUids.add(Ft(e)),this.lastProcessedEventTime=Date.now()}}function Ft(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function qt({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const jt=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Vt=/^https?/;function Gt(e){const t=v(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!Vt.test(n))return!1;if(jt.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const Bt=new S(3e4,6e4);function $t(){const e=ct().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}function Kt(e){return new Promise(((t,n)=>{var i,s,r;function o(){$t(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{$t(),n(m(e,"network-request-failed"))},timeout:Bt.get()})}if(null===(s=null===(i=ct().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=ct().gapi)||void 0===r?void 0:r.load)){const t=Se("iframefcb");return ct()[t]=()=>{gapi.load?o():n(m(e,"network-request-failed"))},be(`${ve.gapiScript}?onload=${t}`).catch((e=>n(e)))}o()}})).catch((e=>{throw Wt=null,e}))}let Wt=null;const zt=new S(5e3,15e3),Ht={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Qt=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Jt(e){const t=e.config;_(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?E(t,"emulator/auth/iframe"):`https://${e.config.authDomain}/__/auth/iframe`,r={apiKey:t.apiKey,appName:e.name,v:i.Jn},o=Qt.get(e.config.apiHost);o&&(r.eid=o);const a=e._getFrameworks();return a.length&&(r.fw=a.join(",")),`${n}?${(0,s.xO)(r).slice(1)}`}const Yt={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"};class Xt{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Zt=encodeURIComponent("fac");async function en(e,t,n,r,o,a){_(e.config.authDomain,e,"auth-domain-config-required"),_(e.config.apiKey,e,"invalid-api-key");const l={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:r,v:i.Jn,eventId:o};if(t instanceof Ge){t.setDefaultLanguage(e.languageCode),l.providerId=t.providerId||"",(0,s.xb)(t.getCustomParameters())||(l.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(a||{}))l[e]=t}if(t instanceof Be){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(l.scopes=e.join(","))}e.tenantId&&(l.tid=e.tenantId);const c=l;for(const e of Object.keys(c))void 0===c[e]&&delete c[e];const u=await e._getAppCheckToken(),d=u?`#${Zt}=${encodeURIComponent(u)}`:"";return`${function({config:e}){return e.emulator?E(e,"emulator/auth/handler"):`https://${e.authDomain}/__/auth/handler`}(e)}?${(0,s.xO)(c).slice(1)}${d}`}const tn="webStorageSupport",nn=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=rt,this._completeRedirectFn=Pt,this._overrideRedirectResult=Mt}async _openPopup(e,t,n,i){var r;return w(null===(r=this.eventManagers[e._key()])||void 0===r?void 0:r.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=500,r=600){const o=Math.max((window.screen.availHeight-r)/2,0).toString(),a=Math.max((window.screen.availWidth-i)/2,0).toString();let l="";const c=Object.assign(Object.assign({},Yt),{width:i.toString(),height:r.toString(),top:o,left:a}),u=(0,s.z$)().toLowerCase();n&&(l=ae(u)?"_blank":n),re(u)&&(t=t||"http://localhost",c.scrollbars="yes");const d=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=(0,s.z$)()){var t;return he(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(u)&&"_self"!==l)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",l),new Xt(null);const h=window.open(t||"",l,d);_(h,e,"popup-blocked");try{h.focus()}catch(e){}return new Xt(h)}(e,await en(e,t,n,v(),i),at())}async _openRedirect(e,t,n,i){return await this._originValidation(e),s=await en(e,t,n,v(),i),ct().location.href=s,new Promise((()=>{}));var s}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(w(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await function(e){return Wt=Wt||Kt(e),Wt}(e),n=ct().gapi;return _(n,e,"internal-error"),t.open({where:document.body,url:Jt(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Ht,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=m(e,"network-request-failed"),r=ct().setTimeout((()=>{i(s)}),zt.get());function o(){ct().clearTimeout(r),n(t)}t.ping(o).then(o,(()=>{i(s)}))}))))}(e),n=new Ut(e);return t.register("authEvent",(t=>(_(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(tn,{type:tn},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i.webStorageSupport;void 0!==s&&t(!!s),h(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return A(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(Gt(e))return}catch(e){}h(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return me()||oe()||he()}};var sn="@firebase/auth",rn="1.10.8";class on{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{e((null==t?void 0:t.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){_(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}const an=(0,s.Pz)("authIdTokenMaxAge")||300;let ln=null;function cn(e=(0,i.Mq)()){const t=(0,i.qX)(e,"auth");if(t.isInitialized())return t.getImmediate();const n=function(e,t){const n=(0,i.qX)(e,"auth");if(n.isInitialized()){const e=n.getImmediate(),i=n.getOptions();if((0,s.vZ)(i,null!=t?t:{}))return e;h(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:nn,persistence:[vt,it,rt]}),r=(0,s.Pz)("authTokenSyncURL");if(r&&"boolean"==typeof isSecureContext&&isSecureContext){const e=new URL(r,location.origin);if(location.origin===e.origin){const t=(o=e.toString(),async e=>{const t=e&&await e.getIdTokenResult(),n=t&&((new Date).getTime()-Date.parse(t.issuedAtTime))/1e3;if(n&&n>an)return;const i=null==t?void 0:t.token;ln!==i&&(ln=i,await fetch(o,{method:i?"POST":"DELETE",headers:i?{Authorization:`Bearer ${i}`}:{}}))});!function(e,t,n){(0,s.m9)(e).beforeAuthStateChanged(t,n)}(n,t,(()=>t(n.currentUser))),function(e,n,i,r){(0,s.m9)(e).onIdTokenChanged((e=>t(e)),void 0,void 0)}(n)}}var o;const a=(0,s.q4)("auth");return a&&function(e,t,n){const i=ye(e);_(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const r=!!(null==n?void 0:n.disableWarnings),o=Ae(t),{host:a,port:l}=function(e){const t=Ae(e),n=/(\/\/)?([^?#/]+)/.exec(e.substr(t.length));if(!n)return{host:"",port:null};const i=n[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const e=s[1];return{host:e,port:Oe(i.substr(e.length+1))}}{const[e,t]=i.split(":");return{host:e,port:Oe(t)}}}(t),c=null===l?"":`:${l}`,u={url:`${o}//${a}${c}/`},d=Object.freeze({host:a,port:l,protocol:o.replace(":",""),options:Object.freeze({disableWarnings:r})});if(!i._canInitEmulator)return _(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),void _((0,s.vZ)(u,i.config.emulator)&&(0,s.vZ)(d,i.emulatorConfig),i,"emulator-config-failed");i.config.emulator=u,i.emulatorConfig=d,i.settings.appVerificationDisabledForTesting=!0,(0,s.Xx)(a)?((0,s.Uo)(`${o}//${a}${c}`),(0,s.dp)("Auth",!0)):r||function(){function e(){const e=document.createElement("p"),t=e.style;e.innerText="Running in emulator mode. Do not use with production credentials.",t.position="fixed",t.width="100%",t.backgroundColor="#ffffff",t.border=".1em solid #000000",t.color="#b50000",t.bottom="0px",t.left="0px",t.margin="0px",t.zIndex="10000",t.textAlign="center",e.classList.add("firebase-emulator-warning"),document.body.appendChild(e)}"undefined"!=typeof console&&"function"==typeof console.info&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),"undefined"!=typeof window&&"undefined"!=typeof document&&("loading"===document.readyState?window.addEventListener("DOMContentLoaded",e):e())}()}(n,`http://${a}`),n}var un;ve={loadJS:e=>new Promise(((t,n)=>{const i=document.createElement("script");var s,r;i.setAttribute("src",e),i.onload=t,i.onerror=e=>{const t=m("internal-error");t.customData=e,n(t)},i.type="text/javascript",i.charset="UTF-8",(null!==(r=null===(s=document.getElementsByTagName("head"))||void 0===s?void 0:s[0])&&void 0!==r?r:document).appendChild(i)})),gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="},un="Browser",(0,i.Xd)(new a.wA("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:r,authDomain:o}=n.options;_(r&&!r.includes(":"),"invalid-api-key",{appName:n.name});const a={apiKey:r,authDomain:o,clientPlatform:un,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:pe(un)},l=new _e(n,i,s,a);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Z);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(l,t),l}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),(0,i.Xd)(new a.wA("auth-internal",(e=>{return t=ye(e.getProvider("auth").getImmediate()),new on(t);var t}),"PRIVATE").setInstantiationMode("EXPLICIT")),(0,i.KN)(sn,rn,void 0),(0,i.KN)(sn,rn,"esm2017")},8104:(e,t,n)=>{"use strict";n.d(t,{vr:()=>Dl,hJ:()=>pa,JU:()=>fa,QT:()=>yl,PL:()=>vl,ad:()=>ba,nP:()=>Rl,cf:()=>El,IO:()=>il,i3:()=>Nl,Bt:()=>Ll,pl:()=>bl,r7:()=>Sl,ar:()=>rl,qs:()=>Ml});var i,s,r=n(389),o=n(8463),a=n(3333),l=n(5406),c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},u={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(e,t,n){n||(n=0);var i=Array(16);if("string"==typeof t)for(var s=0;16>s;++s)i[s]=t.charCodeAt(n++)|t.charCodeAt(n++)<<8|t.charCodeAt(n++)<<16|t.charCodeAt(n++)<<24;else for(s=0;16>s;++s)i[s]=t[n++]|t[n++]<<8|t[n++]<<16|t[n++]<<24;t=e.g[0],n=e.g[1],s=e.g[2];var r=e.g[3],o=t+(r^n&(s^r))+i[0]+3614090360&4294967295;o=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=(n=(s=(r=(t=n+(o<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=t+(r^n&(s^r))+i[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=r+(s^t&(n^s))+i[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^r&(t^n))+i[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(t^s&(r^t))+i[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=t+(s^r&(n^s))+i[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=t+(s^r&(n^s))+i[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=r+(n^s&(t^n))+i[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(t^n&(r^t))+i[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(r^t&(s^r))+i[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=t+(n^s^r)+i[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=t+(n^s^r)+i[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=r+(t^n^s)+i[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(r^t^n)+i[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^r^t)+i[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=t+(s^(n|~r))+i[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~r))+i[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=t+(s^(n|~r))+i[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(t^(r|~n))+i[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(r^(s|~t))+i[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((r=(t=n+((o=t+(s^(n|~r))+i[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=r+(n^(t|~s))+i[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=r+((o=s+(t^(r|~n))+i[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~t))+i[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,e.g[2]=e.g[2]+s&4294967295,e.g[3]=e.g[3]+r&4294967295}function r(e,t){this.h=t;for(var n=[],i=!0,s=e.length-1;0<=s;s--){var r=0|e[s];i&&r==t||(n[s]=r,i=!1)}this.g=n}!function(e,t){function n(){}n.prototype=t.prototype,e.D=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.C=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}(t,(function(){this.blockSize=-1})),t.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.u=function(e,t){void 0===t&&(t=e.length);for(var i=t-this.blockSize,s=this.B,r=this.h,o=0;o<t;){if(0==r)for(;o<=i;)n(this,e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[r++]=e.charCodeAt(o++),r==this.blockSize){n(this,s),r=0;break}}else for(;o<t;)if(s[r++]=e[o++],r==this.blockSize){n(this,s),r=0;break}}this.h=r,this.o+=t},t.prototype.v=function(){var e=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;var n=8*this.o;for(t=e.length-8;t<e.length;++t)e[t]=255&n,n/=256;for(this.u(e),e=Array(16),t=n=0;4>t;++t)for(var i=0;32>i;i+=8)e[n++]=this.g[t]>>>i&255;return e};var o={};function a(e){return-128<=e&&128>e?function(e,t){var n=o;return Object.prototype.hasOwnProperty.call(n,e)?n[e]:n[e]=function(e){return new r([0|e],0>e?-1:0)}(e)}(e):new r([0|e],0>e?-1:0)}function l(e){if(isNaN(e)||!isFinite(e))return c;if(0>e)return f(l(-e));for(var t=[],n=1,i=0;e>=n;i++)t[i]=e/n|0,n*=4294967296;return new r(t,0)}var c=a(0),d=a(1),h=a(16777216);function m(e){if(0!=e.h)return!1;for(var t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function p(e){return-1==e.h}function f(e){for(var t=e.g.length,n=[],i=0;i<t;i++)n[i]=~e.g[i];return new r(n,~e.h).add(d)}function g(e,t){return e.add(f(t))}function _(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function y(e,t){this.g=e,this.h=t}function w(e,t){if(m(t))throw Error("division by zero");if(m(e))return new y(c,c);if(p(e))return t=w(f(e),t),new y(f(t.g),f(t.h));if(p(t))return t=w(e,f(t)),new y(f(t.g),t.h);if(30<e.g.length){if(p(e)||p(t))throw Error("slowDivide_ only works with positive integers.");for(var n=d,i=t;0>=i.l(e);)n=v(n),i=v(i);var s=b(n,1),r=b(i,1);for(i=b(i,2),n=b(n,2);!m(i);){var o=r.add(i);0>=o.l(e)&&(s=s.add(n),r=o),i=b(i,1),n=b(n,1)}return t=g(e,s.j(t)),new y(s,t)}for(s=c;0<=e.l(t);){for(n=Math.max(1,Math.floor(e.m()/t.m())),i=48>=(i=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,i-48),o=(r=l(n)).j(t);p(o)||0<o.l(e);)o=(r=l(n-=i)).j(t);m(r)&&(r=d),s=s.add(r),e=g(e,o)}return new y(s,e)}function v(e){for(var t=e.g.length+1,n=[],i=0;i<t;i++)n[i]=e.i(i)<<1|e.i(i-1)>>>31;return new r(n,e.h)}function b(e,t){var n=t>>5;t%=32;for(var i=e.g.length-n,s=[],o=0;o<i;o++)s[o]=0<t?e.i(o+n)>>>t|e.i(o+n+1)<<32-t:e.i(o+n);return new r(s,e.h)}(e=r.prototype).m=function(){if(p(this))return-f(this).m();for(var e=0,t=1,n=0;n<this.g.length;n++){var i=this.i(n);e+=(0<=i?i:4294967296+i)*t,t*=4294967296}return e},e.toString=function(e){if(2>(e=e||10)||36<e)throw Error("radix out of range: "+e);if(m(this))return"0";if(p(this))return"-"+f(this).toString(e);for(var t=l(Math.pow(e,6)),n=this,i="";;){var s=w(n,t).g,r=((0<(n=g(n,s.j(t))).g.length?n.g[0]:n.h)>>>0).toString(e);if(m(n=s))return r+i;for(;6>r.length;)r="0"+r;i=r+i}},e.i=function(e){return 0>e?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return p(e=g(this,e))?-1:m(e)?0:1},e.abs=function(){return p(this)?f(this):this},e.add=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0,s=0;s<=t;s++){var o=i+(65535&this.i(s))+(65535&e.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(e.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},e.j=function(e){if(m(this)||m(e))return c;if(p(this))return p(e)?f(this).j(f(e)):f(f(this).j(e));if(p(e))return f(this.j(f(e)));if(0>this.l(h)&&0>e.l(h))return l(this.m()*e.m());for(var t=this.g.length+e.g.length,n=[],i=0;i<2*t;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<e.g.length;s++){var o=this.i(i)>>>16,a=65535&this.i(i),u=e.i(s)>>>16,d=65535&e.i(s);n[2*i+2*s]+=a*d,_(n,2*i+2*s),n[2*i+2*s+1]+=o*d,_(n,2*i+2*s+1),n[2*i+2*s+1]+=a*u,_(n,2*i+2*s+1),n[2*i+2*s+2]+=o*u,_(n,2*i+2*s+2)}for(i=0;i<t;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=t;i<2*t;i++)n[i]=0;return new r(n,0)},e.A=function(e){return w(this,e).h},e.and=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)&e.i(i);return new r(n,this.h&e.h)},e.or=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)|e.i(i);return new r(n,this.h|e.h)},e.xor=function(e){for(var t=Math.max(this.g.length,e.g.length),n=[],i=0;i<t;i++)n[i]=this.i(i)^e.i(i);return new r(n,this.h^e.h)},t.prototype.digest=t.prototype.v,t.prototype.reset=t.prototype.s,t.prototype.update=t.prototype.u,s=u.Md5=t,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=l,r.fromString=function e(t,n){if(0==t.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==t.charAt(0))return f(e(t.substring(1),n));if(0<=t.indexOf("-"))throw Error('number format error: interior "-" character');for(var i=l(Math.pow(n,8)),s=c,r=0;r<t.length;r+=8){var o=Math.min(8,t.length-r),a=parseInt(t.substring(r,r+o),n);8>o?(o=l(Math.pow(n,o)),s=s.j(o).add(l(a))):s=(s=s.j(i)).add(l(a))}return s},i=u.Integer=r}).apply(void 0!==c?c:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var d,h,m,p,f,g,_,y,w="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},v={};(function(){var e,t="function"==typeof Object.defineProperties?Object.defineProperty:function(e,t,n){return e==Array.prototype||e==Object.prototype||(e[t]=n.value),e},n=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof w&&w];for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(e,i){if(i)e:{var s=n;e=e.split(".");for(var r=0;r<e.length-1;r++){var o=e[r];if(!(o in s))break e;s=s[o]}(i=i(r=s[e=e[e.length-1]]))!=r&&null!=i&&t(s,e,{configurable:!0,writable:!0,value:i})}}("Array.prototype.values",(function(e){return e||function(){return function(e,t){e instanceof String&&(e+="");var n=0,i=!1,s={next:function(){if(!i&&n<e.length){var s=n++;return{value:t(0,e[s]),done:!1}}return i=!0,{done:!0,value:void 0}}};return s[Symbol.iterator]=function(){return s},s}(this,(function(e,t){return t}))}}));var i=i||{},s=this||self;function r(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,n){return e.call.apply(e.bind,arguments)}function l(e,t,n){if(!e)throw Error();if(2<arguments.length){var i=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,i),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function c(e,t,n){return(c=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:l).apply(null,arguments)}function u(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function b(e,t){function n(){}n.prototype=t.prototype,e.aa=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Qb=function(e,n,i){for(var s=Array(arguments.length-2),r=2;r<arguments.length;r++)s[r-2]=arguments[r];return t.prototype[n].apply(e,s)}}function S(e){const t=e.length;if(0<t){const n=Array(t);for(let i=0;i<t;i++)n[i]=e[i];return n}return[]}function E(e,t){for(let t=1;t<arguments.length;t++){const n=arguments[t];if(r(n)){const t=e.length||0,i=n.length||0;e.length=t+i;for(let s=0;s<i;s++)e[t+s]=n[s]}else e.push(n)}}function I(e){return/^[\s\xa0]*$/.test(e)}function k(){var e=s.navigator;return e&&(e=e.userAgent)?e:""}function x(e){return x[" "](e),e}x[" "]=function(){};var T=!(-1==k().indexOf("Gecko")||-1!=k().toLowerCase().indexOf("webkit")&&-1==k().indexOf("Edge")||-1!=k().indexOf("Trident")||-1!=k().indexOf("MSIE")||-1!=k().indexOf("Edge"));function C(e,t,n){for(const i in e)t.call(n,e[i],i,e)}function A(e){const t={};for(const n in e)t[n]=e[n];return t}const O="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function N(e,t){let n,i;for(let t=1;t<arguments.length;t++){for(n in i=arguments[t],i)e[n]=i[n];for(let t=0;t<O.length;t++)n=O[t],Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}}function L(e){var t=1;e=e.split(":");const n=[];for(;0<t&&e.length;)n.push(e.shift()),t--;return e.length&&n.push(e.join(":")),n}function D(e){s.setTimeout((()=>{throw e}),0)}function R(){var e=q;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var M=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}((()=>new P),(e=>e.reset()));class P{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let U,F=!1,q=new class{constructor(){this.h=this.g=null}add(e,t){const n=M.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}},j=()=>{const e=s.Promise.resolve(void 0);U=()=>{e.then(V)}};var V=()=>{for(var e;e=R();){try{e.h.call(e.g)}catch(e){D(e)}var t=M;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}F=!1};function G(){this.s=this.s,this.C=this.C}function B(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}G.prototype.s=!1,G.prototype.ma=function(){this.s||(this.s=!0,this.N())},G.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},B.prototype.h=function(){this.defaultPrevented=!0};var $=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(e){}return e}();function K(e,t){if(B.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,i=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(T){e:{try{x(t.nodeName);var s=!0;break e}catch(e){}s=!1}s||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,i?(this.clientX=void 0!==i.clientX?i.clientX:i.pageX,this.clientY=void 0!==i.clientY?i.clientY:i.pageY,this.screenX=i.screenX||0,this.screenY=i.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"==typeof e.pointerType?e.pointerType:W[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&K.aa.h.call(this)}}b(K,B);var W={2:"touch",3:"pen",4:"mouse"};K.prototype.h=function(){K.aa.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var z="closure_listenable_"+(1e6*Math.random()|0),H=0;function Q(e,t,n,i,s){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!i,this.ha=s,this.key=++H,this.da=this.fa=!1}function J(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function Y(e){this.src=e,this.g={},this.h=0}function X(e,t){var n=t.type;if(n in e.g){var i,s=e.g[n],r=Array.prototype.indexOf.call(s,t,void 0);(i=0<=r)&&Array.prototype.splice.call(s,r,1),i&&(J(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function Z(e,t,n,i){for(var s=0;s<e.length;++s){var r=e[s];if(!r.da&&r.listener==t&&r.capture==!!n&&r.ha==i)return s}return-1}Y.prototype.add=function(e,t,n,i,s){var r=e.toString();(e=this.g[r])||(e=this.g[r]=[],this.h++);var o=Z(e,t,i,s);return-1<o?(t=e[o],n||(t.fa=!1)):((t=new Q(t,this.src,r,!!i,s)).fa=n,e.push(t)),t};var ee="closure_lm_"+(1e6*Math.random()|0),te={};function ne(e,t,n,i,s){if(i&&i.once)return se(e,t,n,i,s);if(Array.isArray(t)){for(var r=0;r<t.length;r++)ne(e,t[r],n,i,s);return null}return n=de(n),e&&e[z]?e.K(t,n,o(i)?!!i.capture:!!i,s):ie(e,t,n,!1,i,s)}function ie(e,t,n,i,s,r){if(!t)throw Error("Invalid event type");var a=o(s)?!!s.capture:!!s,l=ce(e);if(l||(e[ee]=l=new Y(e)),(n=l.add(t,n,i,a,r)).proxy)return n;if(i=function(){const e=le;return function t(n){return e.call(t.src,t.listener,n)}}(),n.proxy=i,i.src=e,i.listener=n,e.addEventListener)$||(s=a),void 0===s&&(s=!1),e.addEventListener(t.toString(),i,s);else if(e.attachEvent)e.attachEvent(ae(t.toString()),i);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(i)}return n}function se(e,t,n,i,s){if(Array.isArray(t)){for(var r=0;r<t.length;r++)se(e,t[r],n,i,s);return null}return n=de(n),e&&e[z]?e.L(t,n,o(i)?!!i.capture:!!i,s):ie(e,t,n,!0,i,s)}function re(e,t,n,i,s){if(Array.isArray(t))for(var r=0;r<t.length;r++)re(e,t[r],n,i,s);else i=o(i)?!!i.capture:!!i,n=de(n),e&&e[z]?(e=e.i,(t=String(t).toString())in e.g&&-1<(n=Z(r=e.g[t],n,i,s))&&(J(r[n]),Array.prototype.splice.call(r,n,1),0==r.length&&(delete e.g[t],e.h--))):e&&(e=ce(e))&&(t=e.g[t.toString()],e=-1,t&&(e=Z(t,n,i,s)),(n=-1<e?t[e]:null)&&oe(n))}function oe(e){if("number"!=typeof e&&e&&!e.da){var t=e.src;if(t&&t[z])X(t.i,e);else{var n=e.type,i=e.proxy;t.removeEventListener?t.removeEventListener(n,i,e.capture):t.detachEvent?t.detachEvent(ae(n),i):t.addListener&&t.removeListener&&t.removeListener(i),(n=ce(t))?(X(n,e),0==n.h&&(n.src=null,t[ee]=null)):J(e)}}}function ae(e){return e in te?te[e]:te[e]="on"+e}function le(e,t){if(e.da)e=!0;else{t=new K(t,this);var n=e.listener,i=e.ha||e.src;e.fa&&oe(e),e=n.call(i,t)}return e}function ce(e){return(e=e[ee])instanceof Y?e:null}var ue="__closure_events_fn_"+(1e9*Math.random()>>>0);function de(e){return"function"==typeof e?e:(e[ue]||(e[ue]=function(t){return e.handleEvent(t)}),e[ue])}function he(){G.call(this),this.i=new Y(this),this.M=this,this.F=null}function me(e,t){var n,i=e.F;if(i)for(n=[];i;i=i.F)n.push(i);if(e=e.M,i=t.type||t,"string"==typeof t)t=new B(t,e);else if(t instanceof B)t.target=t.target||e;else{var s=t;N(t=new B(i,e),s)}if(s=!0,n)for(var r=n.length-1;0<=r;r--){var o=t.g=n[r];s=pe(o,i,!0,t)&&s}if(s=pe(o=t.g=e,i,!0,t)&&s,s=pe(o,i,!1,t)&&s,n)for(r=0;r<n.length;r++)s=pe(o=t.g=n[r],i,!1,t)&&s}function pe(e,t,n,i){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var s=!0,r=0;r<t.length;++r){var o=t[r];if(o&&!o.da&&o.capture==n){var a=o.listener,l=o.ha||o.src;o.fa&&X(e.i,o),s=!1!==a.call(l,i)&&s}}return s&&!i.defaultPrevented}function fe(e,t,n){if("function"==typeof e)n&&(e=c(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=c(e.handleEvent,e)}return 2147483647<Number(t)?-1:s.setTimeout(e,t||0)}function ge(e){e.g=fe((()=>{e.g=null,e.i&&(e.i=!1,ge(e))}),e.l);const t=e.h;e.h=null,e.m.apply(null,t)}b(he,G),he.prototype[z]=!0,he.prototype.removeEventListener=function(e,t,n,i){re(this,e,t,n,i)},he.prototype.N=function(){if(he.aa.N.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],i=0;i<n.length;i++)J(n[i]);delete t.g[e],t.h--}}this.F=null},he.prototype.K=function(e,t,n,i){return this.i.add(String(e),t,!1,n,i)},he.prototype.L=function(e,t,n,i){return this.i.add(String(e),t,!0,n,i)};class _e extends G{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ge(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ye(e){G.call(this),this.h=e,this.g={}}b(ye,G);var we=[];function ve(e){C(e.g,(function(e,t){this.g.hasOwnProperty(t)&&oe(e)}),e),e.g={}}ye.prototype.N=function(){ye.aa.N.call(this),ve(this)},ye.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var be=s.JSON.stringify,Se=s.JSON.parse;function Ee(){}function Ie(e){return e.h||(e.h=e.i())}function ke(){}Ee.prototype.h=null;var xe={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function Te(){B.call(this,"d")}function Ce(){B.call(this,"c")}b(Te,B),b(Ce,B);var Ae={},Oe=null;function Ne(){return Oe=Oe||new he}function Le(e){B.call(this,Ae.La,e)}function De(e){const t=Ne();me(t,new Le(t))}function Re(e,t){B.call(this,Ae.STAT_EVENT,e),this.stat=t}function Me(e){const t=Ne();me(t,new Re(t,e))}function Pe(e,t){B.call(this,Ae.Ma,e),this.size=t}function Ue(e,t){if("function"!=typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout((function(){e()}),t)}function Fe(){this.g=!0}function qe(e,t,n,i){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var i=n[e];if(!(2>i.length)){var s=i[1];if(Array.isArray(s)&&!(1>s.length)){var r=s[0];if("noop"!=r&&"stop"!=r&&"close"!=r)for(var o=1;o<s.length;o++)s[o]=""}}}return be(n)}catch(e){return t}}(e,n)+(i?" "+i:"")}))}Ae.La="serverreachability",b(Le,B),Ae.STAT_EVENT="statevent",b(Re,B),Ae.Ma="timingevent",b(Pe,B),Fe.prototype.xa=function(){this.g=!1},Fe.prototype.info=function(){};var je,Ve={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ge={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Be(){}function $e(e,t,n,i){this.j=e,this.i=t,this.l=n,this.R=i||1,this.U=new ye(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Ke}function Ke(){this.i=null,this.g="",this.h=!1}b(Be,Ee),Be.prototype.g=function(){return new XMLHttpRequest},Be.prototype.i=function(){return{}},je=new Be;var We={},ze={};function He(e,t,n){e.L=1,e.v=wt(pt(t)),e.m=n,e.P=!0,Qe(e,null)}function Qe(e,t){e.F=Date.now(),Xe(e),e.A=pt(e.v);var n=e.A,i=e.R;Array.isArray(i)||(i=[String(i)]),Dt(n.i,"t",i),e.C=0,n=e.j.J,e.h=new Ke,e.g=bn(e.j,n?t:null,!e.m),0<e.O&&(e.M=new _e(c(e.Y,e,e.g),e.O)),t=e.U,n=e.g,i=e.ca;var s="readystatechange";Array.isArray(s)||(s&&(we[0]=s.toString()),s=we);for(var r=0;r<s.length;r++){var o=ne(n,s[r],i||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}t=e.H?A(e.H):{},e.m?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.A,e.u,e.m,t)):(e.u="GET",e.g.ea(e.A,e.u,null,t)),De(),function(e,t,n,i,s,r){e.info((function(){if(e.g)if(r)for(var o="",a=r.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&"type"==d[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=r;return"XMLHTTP REQ ("+i+") [attempt "+s+"]: "+t+"\n"+n+"\n"+o}))}(e.i,e.u,e.A,e.l,e.R,e.m)}function Je(e){return!!e.g&&"GET"==e.u&&2!=e.L&&e.j.Ca}function Ye(e,t){var n=e.C,i=t.indexOf("\n",n);return-1==i?ze:(n=Number(t.substring(n,i)),isNaN(n)?We:(i+=1)+n>t.length?ze:(t=t.slice(i,i+n),e.C=i+n,t))}function Xe(e){e.S=Date.now()+e.I,Ze(e,e.I)}function Ze(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=Ue(c(e.ba,e),t)}function et(e){e.B&&(s.clearTimeout(e.B),e.B=null)}function tt(e){0==e.j.G||e.J||gn(e.j,e)}function nt(e){et(e);var t=e.M;t&&"function"==typeof t.ma&&t.ma(),e.M=null,ve(e.U),e.g&&(t=e.g,e.g=null,t.abort(),t.ma())}function it(e,t){try{var n=e.j;if(0!=n.G&&(n.g==e||at(n.h,e)))if(!e.K&&at(n.h,e)&&3==n.G){try{var i=n.Da.g.parse(t)}catch(e){i=null}if(Array.isArray(i)&&3==i.length){var s=i;if(0==s[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;fn(n),rn(n)}hn(n),Me(18)}}else n.za=s[1],0<n.za-n.T&&37500>s[2]&&n.F&&0==n.v&&!n.C&&(n.C=Ue(c(n.Za,n),6e3));if(1>=ot(n.h)&&n.ca){try{n.ca()}catch(e){}n.ca=void 0}}else yn(n,11)}else if((e.K||n.g==e)&&fn(n),!I(t))for(s=n.Da.g.parse(t),t=0;t<s.length;t++){let c=s[t];if(n.T=c[0],c=c[1],2==n.G)if("c"==c[0]){n.K=c[1],n.ia=c[2];const t=c[3];null!=t&&(n.la=t,n.j.info("VER="+n.la));const s=c[4];null!=s&&(n.Aa=s,n.j.info("SVER="+n.Aa));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(i=1.5*u,n.L=i,n.j.info("backChannelRequestTimeoutMs_="+i)),i=n;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var r=i.h;r.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(r.j=r.l,r.g=new Set,r.h&&(lt(r,r.h),r.h=null))}if(i.D){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(i.ya=e,yt(i.I,i.D,e))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-e.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=e;if((i=n).qa=vn(i,i.J?i.ia:null,i.W),o.K){ct(i.h,o);var a=o,l=i.L;l&&(a.I=l),a.B&&(et(a),Xe(a)),i.g=o}else dn(i);0<n.i.length&&an(n)}else"stop"!=c[0]&&"close"!=c[0]||yn(n,7);else 3==n.G&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?yn(n,7):sn(n):"noop"!=c[0]&&n.l&&n.l.ta(c),n.v=0)}De()}catch(e){}}function st(e){this.l=e||10,e=s.PerformanceNavigationTiming?0<(e=s.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function rt(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ot(e){return e.h?1:e.g?e.g.size:0}function at(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function lt(e,t){e.g?e.g.add(t):e.h=t}function ct(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function ut(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const n of e.g.values())t=t.concat(n.D);return t}return S(e.i)}function dt(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(r(e)||"string"==typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.na&&"function"==typeof e.na)return e.na();if(!e.V||"function"!=typeof e.V){if("undefined"!=typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!=typeof Set&&e instanceof Set)){if(r(e)||"string"==typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}t=[],n=0;for(const i in e)t[n++]=i;return t}}}(e),i=function(e){if(e.V&&"function"==typeof e.V)return e.V();if("undefined"!=typeof Map&&e instanceof Map||"undefined"!=typeof Set&&e instanceof Set)return Array.from(e.values());if("string"==typeof e)return e.split("");if(r(e)){for(var t=[],n=e.length,i=0;i<n;i++)t.push(e[i]);return t}for(i in t=[],n=0,e)t[n++]=e[i];return t}(e),s=i.length,o=0;o<s;o++)t.call(void 0,i[o],n&&n[o],e)}$e.prototype.ca=function(e){e=e.target;const t=this.M;t&&3==Zt(e)?t.j():this.Y(e)},$e.prototype.Y=function(e){try{if(e==this.g)e:{const h=Zt(this.g);var t=this.g.Ba();if(this.g.Z(),!(3>h)&&(3!=h||this.g&&(this.h.h||this.g.oa()||en(this.g)))){this.J||4!=h||7==t||De(),et(this);var n=this.g.Z();this.X=n;t:if(Je(this)){var i=en(this.g);e="";var r=i.length,o=4==Zt(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){nt(this),tt(this);var a="";break t}this.h.i=new s.TextDecoder}for(t=0;t<r;t++)this.h.h=!0,e+=this.h.i.decode(i[t],{stream:!(o&&t==r-1)});i.length=0,this.h.g+=e,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(e,t,n,i,s,r,o){e.info((function(){return"XMLHTTP RESP ("+i+") [ attempt "+s+"]: "+t+"\n"+n+"\n"+r+" "+o}))}(this.i,this.u,this.A,this.l,this.R,h,n),this.o){if(this.T&&!this.K){t:{if(this.g){var l,c=this.g;if((l=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(l)){var u=l;break t}}u=null}if(!(n=u)){this.o=!1,this.s=3,Me(12),nt(this),tt(this);break e}qe(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,it(this,n)}if(this.P){let e;for(n=!0;!this.J&&this.C<a.length;){if(e=Ye(this,a),e==ze){4==h&&(this.s=4,Me(14),n=!1),qe(this.i,this.l,null,"[Incomplete Response]");break}if(e==We){this.s=4,Me(15),qe(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}qe(this.i,this.l,e,null),it(this,e)}if(Je(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=h||0!=a.length||this.h.h||(this.s=1,Me(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var d=this.j;d.g==this&&d.ba&&!d.M&&(d.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),mn(d),d.M=!0,Me(11))}}else qe(this.i,this.l,a,"[Invalid Chunked Response]"),nt(this),tt(this)}else qe(this.i,this.l,a,null),it(this,a);4==h&&nt(this),this.o&&!this.J&&(4==h?gn(this.j,this):(this.o=!1,Xe(this)))}else(function(e){const t={};e=(e.g&&2<=Zt(e)&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let i=0;i<e.length;i++){if(I(e[i]))continue;var n=L(e[i]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const r=t[s]||[];t[s]=r,r.push(n)}!function(e,t){for(const n in e)t.call(void 0,e[n],n,e)}(t,(function(e){return e.join(", ")}))})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,Me(12)):(this.s=0,Me(13)),nt(this),tt(this)}}}catch(e){}},$e.prototype.cancel=function(){this.J=!0,nt(this)},$e.prototype.ba=function(){this.B=null;const e=Date.now();0<=e-this.S?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.i,this.A),2!=this.L&&(De(),Me(17)),nt(this),this.s=2,tt(this)):Ze(this,this.S-e)},st.prototype.cancel=function(){if(this.i=ut(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var ht=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function mt(e){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,e instanceof mt){this.h=e.h,ft(this,e.j),this.o=e.o,this.g=e.g,gt(this,e.s),this.l=e.l;var t=e.i,n=new At;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),_t(this,n),this.m=e.m}else e&&(t=String(e).match(ht))?(this.h=!1,ft(this,t[1]||"",!0),this.o=vt(t[2]||""),this.g=vt(t[3]||"",!0),gt(this,t[4]),this.l=vt(t[5]||"",!0),_t(this,t[6]||"",!0),this.m=vt(t[7]||"")):(this.h=!1,this.i=new At(null,this.h))}function pt(e){return new mt(e)}function ft(e,t,n){e.j=n?vt(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function gt(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.s=t}else e.s=null}function _t(e,t,n){t instanceof At?(e.i=t,function(e,t){t&&!e.j&&(Ot(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(Nt(this,t),Dt(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=bt(t,Tt)),e.i=new At(t,e.h))}function yt(e,t,n){e.i.set(t,n)}function wt(e){return yt(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function vt(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function bt(e,t,n){return"string"==typeof e?(e=encodeURI(e).replace(t,St),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function St(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}mt.prototype.toString=function(){var e=[],t=this.j;t&&e.push(bt(t,It,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(bt(t,It,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push(bt(n,"/"==n.charAt(0)?xt:kt,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.m)&&e.push("#",bt(n,Ct)),e.join("")};var Et,It=/[#\/\?@]/g,kt=/[#\?:]/g,xt=/[#\?]/g,Tt=/[#\?@]/g,Ct=/#/g;function At(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function Ot(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var i=e[n].indexOf("="),s=null;if(0<=i){var r=e[n].substring(0,i);s=e[n].substring(i+1)}else r=e[n];t(r,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function Nt(e,t){Ot(e),t=Rt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Lt(e,t){return Ot(e),t=Rt(e,t),e.g.has(t)}function Dt(e,t,n){Nt(e,t),0<n.length&&(e.i=null,e.g.set(Rt(e,t),S(n)),e.h+=n.length)}function Rt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Mt(e,t,n,i,s){try{s&&(s.onload=null,s.onerror=null,s.onabort=null,s.ontimeout=null),i(n)}catch(e){}}function Pt(){this.g=new class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}}}function Ut(e,t,n){const i=n||"";try{dt(e,(function(e,n){let s=e;o(e)&&(s=be(e)),t.push(i+n+"="+encodeURIComponent(s))}))}catch(e){throw t.push(i+"type="+encodeURIComponent("_badmap")),e}}function Ft(e){this.l=e.Ub||null,this.j=e.eb||!1}function qt(e,t){he.call(this),this.D=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function jt(e){e.j.read().then(e.Pa.bind(e)).catch(e.ga.bind(e))}function Vt(e){e.readyState=4,e.l=null,e.j=null,e.v=null,Gt(e)}function Gt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Bt(e){let t="";return C(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function $t(e,t,n){e:{for(i in n){var i=!1;break e}i=!0}i||(n=Bt(n),"string"==typeof e?null!=n&&encodeURIComponent(String(n)):yt(e,t,n))}function Kt(e){he.call(this),this.headers=new Map,this.o=e||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(e=At.prototype).add=function(e,t){Ot(this),this.i=null,e=Rt(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},e.forEach=function(e,t){Ot(this),this.g.forEach((function(n,i){n.forEach((function(n){e.call(t,n,i,this)}),this)}),this)},e.na=function(){Ot(this);const e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[];for(let i=0;i<t.length;i++){const s=e[i];for(let e=0;e<s.length;e++)n.push(t[i])}return n},e.V=function(e){Ot(this);let t=[];if("string"==typeof e)Lt(this,e)&&(t=t.concat(this.g.get(Rt(this,e))));else{e=Array.from(this.g.values());for(let n=0;n<e.length;n++)t=t.concat(e[n])}return t},e.set=function(e,t){return Ot(this),this.i=null,Lt(this,e=Rt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&0<(e=this.V(e)).length?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(var n=0;n<t.length;n++){var i=t[n];const r=encodeURIComponent(String(i)),o=this.V(i);for(i=0;i<o.length;i++){var s=r;""!==o[i]&&(s+="="+encodeURIComponent(String(o[i]))),e.push(s)}}return this.i=e.join("&")},b(Ft,Ee),Ft.prototype.g=function(){return new qt(this.l,this.j)},Ft.prototype.i=(Et={},function(){return Et}),b(qt,he),(e=qt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=e,this.A=t,this.readyState=1,Gt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const t={headers:this.u,method:this.B,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||s).fetch(new Request(this.A,t)).then(this.Sa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Vt(this)),this.readyState=0},e.Sa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Gt(this)),this.g&&(this.readyState=3,Gt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;jt(this)}else e.text().then(this.Ra.bind(this),this.ga.bind(this))},e.Pa=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.v.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Vt(this):Gt(this),3==this.readyState&&jt(this)}},e.Ra=function(e){this.g&&(this.response=this.responseText=e,Vt(this))},e.Qa=function(e){this.g&&(this.response=e,Vt(this))},e.ga=function(){this.g&&Vt(this)},e.setRequestHeader=function(e,t){this.u.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(qt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),b(Kt,he);var Wt=/^https?$/i,zt=["POST","PUT"];function Ht(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.m=5,Qt(e),Yt(e)}function Qt(e){e.A||(e.A=!0,me(e,"complete"),me(e,"error"))}function Jt(e){if(e.h&&void 0!==i&&(!e.v[1]||4!=Zt(e)||2!=e.Z()))if(e.u&&4==Zt(e))fe(e.Ea,0,e);else if(me(e,"readystatechange"),4==Zt(e)){e.h=!1;try{const i=e.Z();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var n;if(!(n=t)){var r;if(r=0===i){var o=String(e.D).match(ht)[1]||null;!o&&s.self&&s.self.location&&(o=s.self.location.protocol.slice(0,-1)),r=!Wt.test(o?o.toLowerCase():"")}n=r}if(n)me(e,"complete"),me(e,"success");else{e.m=6;try{var a=2<Zt(e)?e.g.statusText:""}catch(e){a=""}e.l=a+" ["+e.Z()+"]",Qt(e)}}finally{Yt(e)}}}function Yt(e,t){if(e.g){Xt(e);const n=e.g,i=e.v[0]?()=>{}:null;e.g=null,e.v=null,t||me(e,"ready");try{n.onreadystatechange=i}catch(e){}}}function Xt(e){e.I&&(s.clearTimeout(e.I),e.I=null)}function Zt(e){return e.g?e.g.readyState:0}function en(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.H){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(e){return null}}function tn(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function nn(e){this.Aa=0,this.i=[],this.j=new Fe,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=tn("failFast",!1,e),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=tn("baseRetryDelayMs",5e3,e),this.cb=tn("retryDelaySeedMs",1e4,e),this.Wa=tn("forwardChannelMaxRetries",2,e),this.wa=tn("forwardChannelRequestTimeoutMs",2e4,e),this.pa=e&&e.xmlHttpFactory||void 0,this.Xa=e&&e.Tb||void 0,this.Ca=e&&e.useFetchStreams||!1,this.L=void 0,this.J=e&&e.supportsCrossDomainXhr||!1,this.K="",this.h=new st(e&&e.concurrentRequestLimit),this.Da=new Pt,this.P=e&&e.fastHandshake||!1,this.O=e&&e.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=e&&e.Rb||!1,e&&e.xa&&this.j.xa(),e&&e.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&e&&e.detectBufferingProxy||!1,this.ja=void 0,e&&e.longPollingTimeout&&0<e.longPollingTimeout&&(this.ja=e.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function sn(e){if(on(e),3==e.G){var t=e.U++,n=pt(e.I);if(yt(n,"SID",e.K),yt(n,"RID",t),yt(n,"TYPE","terminate"),cn(e,n),(t=new $e(e,e.j,t)).L=2,t.v=wt(pt(n)),n=!1,s.navigator&&s.navigator.sendBeacon)try{n=s.navigator.sendBeacon(t.v.toString(),"")}catch(e){}!n&&s.Image&&((new Image).src=t.v,n=!0),n||(t.g=bn(t.j,null),t.g.ea(t.v)),t.F=Date.now(),Xe(t)}wn(e)}function rn(e){e.g&&(mn(e),e.g.cancel(),e.g=null)}function on(e){rn(e),e.u&&(s.clearTimeout(e.u),e.u=null),fn(e),e.h.cancel(),e.s&&("number"==typeof e.s&&s.clearTimeout(e.s),e.s=null)}function an(e){if(!rt(e.h)&&!e.s){e.s=!0;var t=e.Ga;U||j(),F||(U(),F=!0),q.add(t,e),e.B=0}}function ln(e,t){var n;n=t?t.l:e.U++;const i=pt(e.I);yt(i,"SID",e.K),yt(i,"RID",n),yt(i,"AID",e.T),cn(e,i),e.m&&e.o&&$t(i,e.m,e.o),n=new $e(e,e.j,n,e.B+1),null===e.m&&(n.H=e.o),t&&(e.i=t.D.concat(e.i)),t=un(e,n,1e3),n.I=Math.round(.5*e.wa)+Math.round(.5*e.wa*Math.random()),lt(e.h,n),He(n,i,t)}function cn(e,t){e.H&&C(e.H,(function(e,n){yt(t,n,e)})),e.l&&dt({},(function(e,n){yt(t,n,e)}))}function un(e,t,n){n=Math.min(e.i.length,n);var i=e.l?c(e.l.Na,e.l,e):null;e:{var s=e.i;let t=-1;for(;;){const e=["count="+n];-1==t?0<n?(t=s[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let r=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=t,0>n)t=Math.max(0,s[o].g-100),r=!1;else try{Ut(a,e,"req"+n+"_")}catch(e){i&&i(a)}}if(r){i=e.join("&");break e}}}return e=e.i.splice(0,n),t.D=e,i}function dn(e){if(!e.g&&!e.u){e.Y=1;var t=e.Fa;U||j(),F||(U(),F=!0),q.add(t,e),e.v=0}}function hn(e){return!(e.g||e.u||3<=e.v||(e.Y++,e.u=Ue(c(e.Fa,e),_n(e,e.v)),e.v++,0))}function mn(e){null!=e.A&&(s.clearTimeout(e.A),e.A=null)}function pn(e){e.g=new $e(e,e.j,"rpc",e.Y),null===e.m&&(e.g.H=e.o),e.g.O=0;var t=pt(e.qa);yt(t,"RID","rpc"),yt(t,"SID",e.K),yt(t,"AID",e.T),yt(t,"CI",e.F?"0":"1"),!e.F&&e.ja&&yt(t,"TO",e.ja),yt(t,"TYPE","xmlhttp"),cn(e,t),e.m&&e.o&&$t(t,e.m,e.o),e.L&&(e.g.I=e.L);var n=e.g;e=e.ia,n.L=1,n.v=wt(pt(t)),n.m=null,n.P=!0,Qe(n,e)}function fn(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function gn(e,t){var n=null;if(e.g==t){fn(e),mn(e),e.g=null;var i=2}else{if(!at(e.h,t))return;n=t.D,ct(e.h,t),i=1}if(0!=e.G)if(t.o)if(1==i){n=t.m?t.m.length:0,t=Date.now()-t.F;var s=e.B;me(i=Ne(),new Pe(i,n)),an(e)}else dn(e);else if(3==(s=t.s)||0==s&&0<t.X||!(1==i&&function(e,t){return!(ot(e.h)>=e.h.j-(e.s?1:0)||(e.s?(e.i=t.D.concat(e.i),0):1==e.G||2==e.G||e.B>=(e.Va?0:e.Wa)||(e.s=Ue(c(e.Ga,e,t),_n(e,e.B)),e.B++,0)))}(e,t)||2==i&&hn(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),s){case 1:yn(e,5);break;case 4:yn(e,10);break;case 3:yn(e,6);break;default:yn(e,2)}}function _n(e,t){let n=e.Ta+Math.floor(Math.random()*e.cb);return e.isActive()||(n*=2),n*t}function yn(e,t){if(e.j.info("Error code "+t),2==t){var n=c(e.fb,e),i=e.Xa;const t=!i;i=new mt(i||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||ft(i,"https"),wt(i),t?function(e,t){const n=new Fe;if(s.Image){const i=new Image;i.onload=u(Mt,n,"TestLoadImage: loaded",!0,t,i),i.onerror=u(Mt,n,"TestLoadImage: error",!1,t,i),i.onabort=u(Mt,n,"TestLoadImage: abort",!1,t,i),i.ontimeout=u(Mt,n,"TestLoadImage: timeout",!1,t,i),s.setTimeout((function(){i.ontimeout&&i.ontimeout()}),1e4),i.src=e}else t(!1)}(i.toString(),n):function(e,t){new Fe;const n=new AbortController,i=setTimeout((()=>{n.abort(),Mt(0,0,!1,t)}),1e4);fetch(e,{signal:n.signal}).then((e=>{clearTimeout(i),e.ok?Mt(0,0,!0,t):Mt(0,0,!1,t)})).catch((()=>{clearTimeout(i),Mt(0,0,!1,t)}))}(i.toString(),n)}else Me(2);e.G=0,e.l&&e.l.sa(t),wn(e),on(e)}function wn(e){if(e.G=0,e.ka=[],e.l){const t=ut(e.h);0==t.length&&0==e.i.length||(E(e.ka,t),E(e.ka,e.i),e.h.i.length=0,S(e.i),e.i.length=0),e.l.ra()}}function vn(e,t,n){var i=n instanceof mt?pt(n):new mt(n);if(""!=i.g)t&&(i.g=t+"."+i.g),gt(i,i.s);else{var r=s.location;i=r.protocol,t=t?t+"."+r.hostname:r.hostname,r=+r.port;var o=new mt(null);i&&ft(o,i),t&&(o.g=t),r&&gt(o,r),n&&(o.l=n),i=o}return n=e.D,t=e.ya,n&&t&&yt(i,n,t),yt(i,"VER",e.la),cn(e,i),i}function bn(e,t,n){if(t&&!e.J)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Ca&&!e.pa?new Kt(new Ft({eb:n})):new Kt(e.pa)).Ha(e.J),t}function Sn(){}function En(){}function In(e,t){he.call(this),this.g=new nn(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.va&&(e?e["X-WebChannel-Client-Profile"]=t.va:e={"X-WebChannel-Client-Profile":t.va}),this.g.S=e,(e=t&&t.Sb)&&!I(e)&&(this.g.m=e),this.v=t&&t.supportsCrossDomainXhr||!1,this.u=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!I(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&t in(e=this.h)&&delete e[t]),this.j=new Tn(this)}function kn(e){Te.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function xn(){Ce.call(this),this.status=1}function Tn(e){this.g=e}(e=Kt.prototype).Ha=function(e){this.J=e},e.ea=function(e,t,n,i){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():je.g(),this.v=this.o?Ie(this.o):Ie(je),this.g.onreadystatechange=c(this.Ea,this);try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(e){return void Ht(this,e)}if(e=n||"",n=new Map(this.headers),i)if(Object.getPrototypeOf(i)===Object.prototype)for(var r in i)n.set(r,i[r]);else{if("function"!=typeof i.keys||"function"!=typeof i.get)throw Error("Unknown input type for opt_headers: "+String(i));for(const e of i.keys())n.set(e,i.get(e))}i=Array.from(n.keys()).find((e=>"content-type"==e.toLowerCase())),r=s.FormData&&e instanceof s.FormData,!(0<=Array.prototype.indexOf.call(zt,t,void 0))||i||r||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[e,t]of n)this.g.setRequestHeader(e,t);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{Xt(this),this.u=!0,this.g.send(e),this.u=!1}catch(e){Ht(this,e)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=e||7,me(this,"complete"),me(this,"abort"),Yt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Yt(this,!0)),Kt.aa.N.call(this)},e.Ea=function(){this.s||(this.B||this.u||this.j?Jt(this):this.bb())},e.bb=function(){Jt(this)},e.isActive=function(){return!!this.g},e.Z=function(){try{return 2<Zt(this)?this.g.status:-1}catch(e){return-1}},e.oa=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.Oa=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),Se(t)}},e.Ba=function(){return this.m},e.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(e=nn.prototype).la=8,e.G=1,e.connect=function(e,t,n,i){Me(0),this.W=e,this.H=t||{},n&&void 0!==i&&(this.H.OSID=n,this.H.OAID=i),this.F=this.X,this.I=vn(this,null,this.W),an(this)},e.Ga=function(e){if(this.s)if(this.s=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;const s=new $e(this,this.j,e);let r=this.o;if(this.S&&(r?(r=A(r),N(r,this.S)):r=this.S),null!==this.m||this.O||(s.H=r,r=null),this.P)e:{for(var t=0,n=0;n<this.i.length;n++){var i=this.i[n];if(void 0===(i="__data__"in i.map&&"string"==typeof(i=i.map.__data__)?i.length:void 0))break;if(4096<(t+=i)){t=n;break e}if(4096===t||n===this.i.length-1){t=n+1;break e}}t=1e3}else t=1e3;t=un(this,s,t),yt(n=pt(this.I),"RID",e),yt(n,"CVER",22),this.D&&yt(n,"X-HTTP-Session-Id",this.D),cn(this,n),r&&(this.O?t="headers="+encodeURIComponent(String(Bt(r)))+"&"+t:this.m&&$t(n,this.m,r)),lt(this.h,s),this.Ua&&yt(n,"TYPE","init"),this.P?(yt(n,"$req",t),yt(n,"SID","null"),s.T=!0,He(s,n,null)):He(s,n,t),this.G=2}}else 3==this.G&&(e?ln(this,e):0==this.i.length||rt(this.h)||ln(this))},e.Fa=function(){if(this.u=null,pn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var e=2*this.R;this.j.info("BP detection timer enabled: "+e),this.A=Ue(c(this.ab,this),e)}},e.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,Me(10),rn(this),pn(this))},e.Za=function(){null!=this.C&&(this.C=null,rn(this),hn(this),Me(19))},e.fb=function(e){e?(this.j.info("Successfully pinged google.com"),Me(2)):(this.j.info("Failed to ping google.com"),Me(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=Sn.prototype).ua=function(){},e.ta=function(){},e.sa=function(){},e.ra=function(){},e.isActive=function(){return!0},e.Na=function(){},En.prototype.g=function(e,t){return new In(e,t)},b(In,he),In.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},In.prototype.close=function(){sn(this.g)},In.prototype.o=function(e){var t=this.g;if("string"==typeof e){var n={};n.__data__=e,e=n}else this.u&&((n={}).__data__=be(e),e=n);t.i.push(new class{constructor(e,t){this.g=e,this.map=t}}(t.Ya++,e)),3==t.G&&an(t)},In.prototype.N=function(){this.g.l=null,delete this.j,sn(this.g),delete this.g,In.aa.N.call(this)},b(kn,Te),b(xn,Ce),b(Tn,Sn),Tn.prototype.ua=function(){me(this.g,"a")},Tn.prototype.ta=function(e){me(this.g,new kn(e))},Tn.prototype.sa=function(e){me(this.g,new xn)},Tn.prototype.ra=function(){me(this.g,"b")},En.prototype.createWebChannel=En.prototype.g,In.prototype.send=In.prototype.o,In.prototype.open=In.prototype.m,In.prototype.close=In.prototype.close,y=v.createWebChannelTransport=function(){return new En},_=v.getStatEventTarget=function(){return Ne()},g=v.Event=Ae,f=v.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Ve.NO_ERROR=0,Ve.TIMEOUT=8,Ve.HTTP_ERROR=6,p=v.ErrorCode=Ve,Ge.COMPLETE="complete",m=v.EventType=Ge,ke.EventType=xe,xe.OPEN="a",xe.CLOSE="b",xe.ERROR="c",xe.MESSAGE="d",he.prototype.listen=he.prototype.K,h=v.WebChannel=ke,v.FetchXmlHttpFactory=Ft,Kt.prototype.listenOnce=Kt.prototype.L,Kt.prototype.getLastError=Kt.prototype.Ka,Kt.prototype.getLastErrorCode=Kt.prototype.Ba,Kt.prototype.getStatus=Kt.prototype.Z,Kt.prototype.getResponseJson=Kt.prototype.Oa,Kt.prototype.getResponseText=Kt.prototype.oa,Kt.prototype.send=Kt.prototype.ea,Kt.prototype.setWithCredentials=Kt.prototype.Ha,d=v.XhrIo=Kt}).apply(void 0!==w?w:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const b="@firebase/firestore",S="4.8.0";class E{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}E.UNAUTHENTICATED=new E(null),E.GOOGLE_CREDENTIALS=new E("google-credentials-uid"),E.FIRST_PARTY=new E("first-party-uid"),E.MOCK_USER=new E("mock-user");let I="11.10.0";const k=new a.Yd("@firebase/firestore");function x(){return k.logLevel}function T(e,...t){if(k.logLevel<=a.in.DEBUG){const n=t.map(O);k.debug(`Firestore (${I}): ${e}`,...n)}}function C(e,...t){if(k.logLevel<=a.in.ERROR){const n=t.map(O);k.error(`Firestore (${I}): ${e}`,...n)}}function A(e,...t){if(k.logLevel<=a.in.WARN){const n=t.map(O);k.warn(`Firestore (${I}): ${e}`,...n)}}function O(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function N(e,t,n){let i="Unexpected state";"string"==typeof t?i=t:n=t,L(e,i,n)}function L(e,t,n){let i=`FIRESTORE (${I}) INTERNAL ASSERTION FAILED: ${t} (ID: ${e.toString(16)})`;if(void 0!==n)try{i+=" CONTEXT: "+JSON.stringify(n)}catch(e){i+=" CONTEXT: "+n}throw C(i),new Error(i)}function D(e,t,n,i){let s="Unexpected state";"string"==typeof n?s=n:i=n,e||L(t,s,i)}function R(e,t){return e}const M={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class P extends l.ZR{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class U{constructor(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}}class F{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}}class q{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable((()=>t(E.UNAUTHENTICATED)))}shutdown(){}}class j{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable((()=>t(this.token.user)))}shutdown(){this.changeListener=null}}class V{constructor(e){this.t=e,this.currentUser=E.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){D(void 0===this.o,42304);let n=this.i;const i=e=>this.i!==n?(n=this.i,t(e)):Promise.resolve();let s=new U;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new U,e.enqueueRetryable((()=>i(this.currentUser)))};const r=()=>{const t=s;e.enqueueRetryable((async()=>{await t.promise,await i(this.currentUser)}))},o=e=>{T("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),r())};this.t.onInit((e=>o(e))),setTimeout((()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(T("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new U)}}),0),r()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then((t=>this.i!==e?(T("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(D("string"==typeof t.accessToken,31837,{l:t}),new F(t.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return D(null===e||"string"==typeof e,2055,{h:e}),new E(e)}}class G{constructor(e,t,n){this.P=e,this.T=t,this.I=n,this.type="FirstParty",this.user=E.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class B{constructor(e,t,n){this.P=e,this.T=t,this.I=n}getToken(){return Promise.resolve(new G(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable((()=>t(E.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ${constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class K{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,(0,r.rh)(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){D(void 0===this.o,3512);const n=e=>{null!=e.error&&T("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${e.error.message}`);const n=e.token!==this.m;return this.m=e.token,T("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable((()=>n(t)))};const i=e=>{T("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((e=>i(e))),setTimeout((()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?i(e):T("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new $(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((e=>e?(D("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new $(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function W(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(let t=0;t<e;t++)n[t]=Math.floor(256*Math.random());return n}function z(){return new TextEncoder}class H{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const n=W(40);for(let i=0;i<n.length;++i)t.length<20&&n[i]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[i]%62))}return t}}function Q(e,t){return e<t?-1:e>t?1:0}function J(e,t){let n=0;for(;n<e.length&&n<t.length;){const i=e.codePointAt(n),s=t.codePointAt(n);if(i!==s){if(i<128&&s<128)return Q(i,s);{const r=z(),o=X(r.encode(Y(e,n)),r.encode(Y(t,n)));return 0!==o?o:Q(i,s)}}n+=i>65535?2:1}return Q(e.length,t.length)}function Y(e,t){return e.codePointAt(t)>65535?e.substring(t,t+2):e.substring(t,t+1)}function X(e,t){for(let n=0;n<e.length&&n<t.length;++n)if(e[n]!==t[n])return Q(e[n],t[n]);return Q(e.length,t.length)}function Z(e,t,n){return e.length===t.length&&e.every(((e,i)=>n(e,t[i])))}const ee="__name__";class te{constructor(e,t,n){void 0===t?t=0:t>e.length&&N(637,{offset:t,range:e.length}),void 0===n?n=e.length-t:n>e.length-t&&N(1746,{length:n,range:e.length-t}),this.segments=e,this.offset=t,this.len=n}get length(){return this.len}isEqual(e){return 0===te.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof te?e.forEach((e=>{t.push(e)})):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const n=Math.min(e.length,t.length);for(let i=0;i<n;i++){const n=te.compareSegments(e.get(i),t.get(i));if(0!==n)return n}return Q(e.length,t.length)}static compareSegments(e,t){const n=te.isNumericId(e),i=te.isNumericId(t);return n&&!i?-1:!n&&i?1:n&&i?te.extractNumericId(e).compare(te.extractNumericId(t)):J(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return i.fromString(e.substring(4,e.length-2))}}class ne extends te{construct(e,t,n){return new ne(e,t,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...e){const t=[];for(const n of e){if(n.indexOf("//")>=0)throw new P(M.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);t.push(...n.split("/").filter((e=>e.length>0)))}return new ne(t)}static emptyPath(){return new ne([])}}const ie=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class se extends te{construct(e,t,n){return new se(e,t,n)}static isValidIdentifier(e){return ie.test(e)}canonicalString(){return this.toArray().map((e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),se.isValidIdentifier(e)||(e="`"+e+"`"),e))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===ee}static keyField(){return new se([ee])}static fromServerFormat(e){const t=[];let n="",i=0;const s=()=>{if(0===n.length)throw new P(M.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(n),n=""};let r=!1;for(;i<e.length;){const t=e[i];if("\\"===t){if(i+1===e.length)throw new P(M.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[i+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new P(M.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);n+=t,i+=2}else"`"===t?(r=!r,i++):"."!==t||r?(n+=t,i++):(s(),i++)}if(s(),r)throw new P(M.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new se(t)}static emptyPath(){return new se([])}}class re{constructor(e){this.path=e}static fromPath(e){return new re(ne.fromString(e))}static fromName(e){return new re(ne.fromString(e).popFirst(5))}static empty(){return new re(ne.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===ne.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return ne.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new re(new ne(e.slice()))}}function oe(e,t,n){if(!n)throw new P(M.INVALID_ARGUMENT,`Function ${e}() cannot be called with an empty ${t}.`)}function ae(e){if(!re.isDocumentKey(e))throw new P(M.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${e} has ${e.length}.`)}function le(e){if(re.isDocumentKey(e))throw new P(M.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${e} has ${e.length}.`)}function ce(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function ue(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e=`${e.substring(0,20)}...`),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?`a custom ${t} object`:"an object"}}return"function"==typeof e?"a function":N(12329,{type:typeof e})}function de(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new P(M.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=ue(e);throw new P(M.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${n}`)}}return e}function he(e,t){const n={typeString:e};return t&&(n.value=t),n}function me(e,t){if(!ce(e))throw new P(M.INVALID_ARGUMENT,"JSON must be an object");let n;for(const i in t)if(t[i]){const s=t[i].typeString,r="value"in t[i]?{value:t[i].value}:void 0;if(!(i in e)){n=`JSON missing required field: '${i}'`;break}const o=e[i];if(s&&typeof o!==s){n=`JSON field '${i}' must be a ${s}.`;break}if(void 0!==r&&o!==r.value){n=`Expected '${i}' field to equal '${r.value}'`;break}}if(n)throw new P(M.INVALID_ARGUMENT,n);return!0}const pe=-62135596800,fe=1e6;class ge{static now(){return ge.fromMillis(Date.now())}static fromDate(e){return ge.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),n=Math.floor((e-1e3*t)*fe);return new ge(t,n)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new P(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new P(M.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<pe)throw new P(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new P(M.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/fe}_compareTo(e){return this.seconds===e.seconds?Q(this.nanoseconds,e.nanoseconds):Q(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:ge._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(me(e,ge._jsonSchema))return new ge(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-pe;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}ge._jsonSchemaVersion="firestore/timestamp/1.0",ge._jsonSchema={type:he("string",ge._jsonSchemaVersion),seconds:he("number"),nanoseconds:he("number")};class _e{static fromTimestamp(e){return new _e(e)}static min(){return new _e(new ge(0,0))}static max(){return new _e(new ge(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}function ye(e){return new we(e.readTime,e.key,-1)}class we{constructor(e,t,n){this.readTime=e,this.documentKey=t,this.largestBatchId=n}static min(){return new we(_e.min(),re.empty(),-1)}static max(){return new we(_e.max(),re.empty(),-1)}}function ve(e,t){let n=e.readTime.compareTo(t.readTime);return 0!==n?n:(n=re.comparator(e.documentKey,t.documentKey),0!==n?n:Q(e.largestBatchId,t.largestBatchId))}class be{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((e=>e()))}}async function Se(e){if(e.code!==M.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==e.message)throw e;T("LocalStore","Unexpectedly lost primary lease")}class Ee{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&N(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new Ee(((n,i)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(n,i)},this.catchCallback=e=>{this.wrapFailure(t,e).next(n,i)}}))}toPromise(){return new Promise(((e,t)=>{this.next(e,t)}))}wrapUserFunction(e){try{const t=e();return t instanceof Ee?t:Ee.resolve(t)}catch(e){return Ee.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction((()=>e(t))):Ee.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction((()=>e(t))):Ee.reject(t)}static resolve(e){return new Ee(((t,n)=>{t(e)}))}static reject(e){return new Ee(((t,n)=>{n(e)}))}static waitFor(e){return new Ee(((t,n)=>{let i=0,s=0,r=!1;e.forEach((e=>{++i,e.next((()=>{++s,r&&s===i&&t()}),(e=>n(e)))})),r=!0,s===i&&t()}))}static or(e){let t=Ee.resolve(!1);for(const n of e)t=t.next((e=>e?Ee.resolve(e):n()));return t}static forEach(e,t){const n=[];return e.forEach(((e,i)=>{n.push(t.call(this,e,i))})),this.waitFor(n)}static mapArray(e,t){return new Ee(((n,i)=>{const s=e.length,r=new Array(s);let o=0;for(let a=0;a<s;a++){const l=a;t(e[l]).next((e=>{r[l]=e,++o,o===s&&n(r)}),(e=>i(e)))}}))}static doWhile(e,t){return new Ee(((n,i)=>{const s=()=>{!0===e()?t().next((()=>{s()}),i):n()};s()}))}}function Ie(e){return"IndexedDbTransactionError"===e.name}class ke{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this._e(e),this.ae=e=>t.writeSequenceNumber(e))}_e(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ae&&this.ae(e),e}}ke.ue=-1;function xe(e){return null==e}function Te(e){return 0===e&&1/e==-1/0}function Ce(e,t){let n=t;const i=e.length;for(let t=0;t<i;t++){const i=e.charAt(t);switch(i){case"\0":n+="";break;case"":n+="";break;default:n+=i}}return n}function Ae(e){return e+""}const Oe="owner",Ne="mutationQueues",Le="mutations",De="documentMutations",Re="remoteDocumentGlobal",Me="targets",Pe="targetDocuments",Ue="targetGlobal",Fe="collectionParents",qe="clientMetadata",je="bundles",Ve="namedQueries";function Ge(e){let t=0;for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Be(e,t){for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function $e(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class Ke{constructor(e,t){this.comparator=e,this.root=t||ze.EMPTY}insert(e,t){return new Ke(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,ze.BLACK,null,null))}remove(e){return new Ke(this.comparator,this.root.remove(e,this.comparator).copy(null,null,ze.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}indexOf(e){let t=0,n=this.root;for(;!n.isEmpty();){const i=this.comparator(e,n.key);if(0===i)return t+n.left.size;i<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal(((t,n)=>(e(t,n),!1)))}toString(){const e=[];return this.inorderTraversal(((t,n)=>(e.push(`${t}:${n}`),!1))),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new We(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new We(this.root,e,this.comparator,!1)}getReverseIterator(){return new We(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new We(this.root,e,this.comparator,!0)}}class We{constructor(e,t,n,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?n(e.key,t):1,t&&i&&(s*=-1),s<0)e=this.isReverse?e.left:e.right;else{if(0===s){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class ze{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:ze.RED,this.left=null!=i?i:ze.EMPTY,this.right=null!=s?s:ze.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,n,i,s){return new ze(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp()}removeMin(){if(this.left.isEmpty())return ze.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let n,i=this;if(t(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,t),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===t(e,i.key)){if(i.right.isEmpty())return ze.EMPTY;n=i.right.min(),i=i.copy(n.key,n.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,t))}return i.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,ze.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,ze.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw N(43730,{key:this.key,value:this.value});if(this.right.isRed())throw N(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw N(27949);return e+(this.isRed()?0:1)}}ze.EMPTY=null,ze.RED=!0,ze.BLACK=!1,ze.EMPTY=new class{constructor(){this.size=0}get key(){throw N(57766)}get value(){throw N(16141)}get color(){throw N(16727)}get left(){throw N(29726)}get right(){throw N(36894)}copy(e,t,n,i,s){return this}insert(e,t,n){return new ze(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class He{constructor(e){this.comparator=e,this.data=new Ke(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal(((t,n)=>(e(t),!1)))}forEachInRange(e,t){const n=this.data.getIteratorFrom(e[0]);for(;n.hasNext();){const i=n.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new Qe(this.data.getIterator())}getIteratorFrom(e){return new Qe(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach((e=>{t=t.add(e)})),t}isEqual(e){if(!(e instanceof He))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),n=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(0!==this.comparator(e,i))return!1}return!0}toArray(){const e=[];return this.forEach((t=>{e.push(t)})),e}toString(){const e=[];return this.forEach((t=>e.push(t))),"SortedSet("+e.toString()+")"}copy(e){const t=new He(this.comparator);return t.data=e,t}}class Qe{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Je{constructor(e){this.fields=e,e.sort(se.comparator)}static empty(){return new Je([])}unionWith(e){let t=new He(se.comparator);for(const e of this.fields)t=t.add(e);for(const n of e)t=t.add(n);return new Je(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Z(this.fields,e.fields,((e,t)=>e.isEqual(t)))}}class Ye extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Xe{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new Ye("Invalid base64 string: "+e):e}}(e);return new Xe(t)}static fromUint8Array(e){const t=function(e){let t="";for(let n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new Xe(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Q(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}Xe.EMPTY_BYTE_STRING=new Xe("");const Ze=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function et(e){if(D(!!e,39018),"string"==typeof e){let t=0;const n=Ze.exec(e);if(D(!!n,46558,{timestamp:e}),n[1]){let e=n[1];e=(e+"000000000").substr(0,9),t=Number(e)}const i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:tt(e.seconds),nanos:tt(e.nanos)}}function tt(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function nt(e){return"string"==typeof e?Xe.fromBase64String(e):Xe.fromUint8Array(e)}const it="server_timestamp",st="__type__",rt="__previous_value__",ot="__local_write_time__";function at(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[st])||void 0===n?void 0:n.stringValue)===it}function lt(e){const t=e.mapValue.fields[rt];return at(t)?lt(t):t}function ct(e){const t=et(e.mapValue.fields[ot].timestampValue);return new ge(t.seconds,t.nanos)}class ut{constructor(e,t,n,i,s,r,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=n,this.host=i,this.ssl=s,this.forceLongPolling=r,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=c}}const dt="(default)";class ht{constructor(e,t){this.projectId=e,this.database=t||dt}static empty(){return new ht("","")}get isDefaultDatabase(){return this.database===dt}isEqual(e){return e instanceof ht&&e.projectId===this.projectId&&e.database===this.database}}const mt="__type__",pt="__max__",ft={fields:{__type__:{stringValue:pt}}},gt="__vector__",_t="value";function yt(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?at(e)?4:Mt(e)?9007199254740991:Dt(e)?10:11:N(28295,{value:e})}function wt(e,t){if(e===t)return!0;const n=yt(e);if(n!==yt(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return ct(e).isEqual(ct(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const n=et(e.timestampValue),i=et(t.timestampValue);return n.seconds===i.seconds&&n.nanos===i.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return nt(e.bytesValue).isEqual(nt(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return tt(e.geoPointValue.latitude)===tt(t.geoPointValue.latitude)&&tt(e.geoPointValue.longitude)===tt(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return tt(e.integerValue)===tt(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const n=tt(e.doubleValue),i=tt(t.doubleValue);return n===i?Te(n)===Te(i):isNaN(n)&&isNaN(i)}return!1}(e,t);case 9:return Z(e.arrayValue.values||[],t.arrayValue.values||[],wt);case 10:case 11:return function(e,t){const n=e.mapValue.fields||{},i=t.mapValue.fields||{};if(Ge(n)!==Ge(i))return!1;for(const e in n)if(n.hasOwnProperty(e)&&(void 0===i[e]||!wt(n[e],i[e])))return!1;return!0}(e,t);default:return N(52216,{left:e})}}function vt(e,t){return void 0!==(e.values||[]).find((e=>wt(e,t)))}function bt(e,t){if(e===t)return 0;const n=yt(e),i=yt(t);if(n!==i)return Q(n,i);switch(n){case 0:case 9007199254740991:return 0;case 1:return Q(e.booleanValue,t.booleanValue);case 2:return function(e,t){const n=tt(e.integerValue||e.doubleValue),i=tt(t.integerValue||t.doubleValue);return n<i?-1:n>i?1:n===i?0:isNaN(n)?isNaN(i)?0:-1:1}(e,t);case 3:return St(e.timestampValue,t.timestampValue);case 4:return St(ct(e),ct(t));case 5:return J(e.stringValue,t.stringValue);case 6:return function(e,t){const n=nt(e),i=nt(t);return n.compareTo(i)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const n=e.split("/"),i=t.split("/");for(let e=0;e<n.length&&e<i.length;e++){const t=Q(n[e],i[e]);if(0!==t)return t}return Q(n.length,i.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const n=Q(tt(e.latitude),tt(t.latitude));return 0!==n?n:Q(tt(e.longitude),tt(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return Et(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n,i,s,r;const o=e.fields||{},a=t.fields||{},l=null===(n=o[_t])||void 0===n?void 0:n.arrayValue,c=null===(i=a[_t])||void 0===i?void 0:i.arrayValue,u=Q((null===(s=null==l?void 0:l.values)||void 0===s?void 0:s.length)||0,(null===(r=null==c?void 0:c.values)||void 0===r?void 0:r.length)||0);return 0!==u?u:Et(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===ft&&t===ft)return 0;if(e===ft)return 1;if(t===ft)return-1;const n=e.fields||{},i=Object.keys(n),s=t.fields||{},r=Object.keys(s);i.sort(),r.sort();for(let e=0;e<i.length&&e<r.length;++e){const t=J(i[e],r[e]);if(0!==t)return t;const o=bt(n[i[e]],s[r[e]]);if(0!==o)return o}return Q(i.length,r.length)}(e.mapValue,t.mapValue);default:throw N(23264,{le:n})}}function St(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Q(e,t);const n=et(e),i=et(t),s=Q(n.seconds,i.seconds);return 0!==s?s:Q(n.nanos,i.nanos)}function Et(e,t){const n=e.values||[],i=t.values||[];for(let e=0;e<n.length&&e<i.length;++e){const t=bt(n[e],i[e]);if(t)return t}return Q(n.length,i.length)}function It(e){return kt(e)}function kt(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=et(e);return`time(${t.seconds},${t.nanos})`}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return nt(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return re.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return`geo(${e.latitude},${e.longitude})`}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",n=!0;for(const i of e.values||[])n?n=!1:t+=",",t+=kt(i);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let n="{",i=!0;for(const s of t)i?i=!1:n+=",",n+=`${s}:${kt(e.fields[s])}`;return n+"}"}(e.mapValue):N(61005,{value:e})}function xt(e){switch(yt(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=lt(e);return t?16+xt(t):16;case 5:return 2*e.stringValue.length;case 6:return nt(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce(((e,t)=>e+xt(t)),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return Be(e.fields,((e,n)=>{t+=e.length+xt(n)})),t}(e.mapValue);default:throw N(13486,{value:e})}}function Tt(e,t){return{referenceValue:`projects/${e.projectId}/databases/${e.database}/documents/${t.path.canonicalString()}`}}function Ct(e){return!!e&&"integerValue"in e}function At(e){return!!e&&"arrayValue"in e}function Ot(e){return!!e&&"nullValue"in e}function Nt(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Lt(e){return!!e&&"mapValue"in e}function Dt(e){var t,n;return(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{})[mt])||void 0===n?void 0:n.stringValue)===gt}function Rt(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return Be(e.mapValue.fields,((e,n)=>t.mapValue.fields[e]=Rt(n))),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let n=0;n<(e.arrayValue.values||[]).length;++n)t.arrayValue.values[n]=Rt(e.arrayValue.values[n]);return t}return Object.assign({},e)}function Mt(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===pt}class Pt{constructor(e){this.value=e}static empty(){return new Pt({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let n=0;n<e.length-1;++n)if(t=(t.mapValue.fields||{})[e.get(n)],!Lt(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Rt(t)}setAll(e){let t=se.emptyPath(),n={},i=[];e.forEach(((e,s)=>{if(!t.isImmediateParentOf(s)){const e=this.getFieldsMap(t);this.applyChanges(e,n,i),n={},i=[],t=s.popLast()}e?n[s.lastSegment()]=Rt(e):i.push(s.lastSegment())}));const s=this.getFieldsMap(t);this.applyChanges(s,n,i)}delete(e){const t=this.field(e.popLast());Lt(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return wt(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let n=0;n<e.length;++n){let i=t.mapValue.fields[e.get(n)];Lt(i)&&i.mapValue.fields||(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,n){Be(t,((t,n)=>e[t]=n));for(const t of n)delete e[t]}clone(){return new Pt(Rt(this.value))}}function Ut(e){const t=[];return Be(e.fields,((e,n)=>{const i=new se([e]);if(Lt(n)){const e=Ut(n.mapValue).fields;if(0===e.length)t.push(i);else for(const n of e)t.push(i.child(n))}else t.push(i)})),new Je(t)}class Ft{constructor(e,t,n,i,s,r,o){this.key=e,this.documentType=t,this.version=n,this.readTime=i,this.createTime=s,this.data=r,this.documentState=o}static newInvalidDocument(e){return new Ft(e,0,_e.min(),_e.min(),_e.min(),Pt.empty(),0)}static newFoundDocument(e,t,n,i){return new Ft(e,1,t,_e.min(),n,i,0)}static newNoDocument(e,t){return new Ft(e,2,t,_e.min(),_e.min(),Pt.empty(),0)}static newUnknownDocument(e,t){return new Ft(e,3,t,_e.min(),_e.min(),Pt.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(_e.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Pt.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Pt.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=_e.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof Ft&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new Ft(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class qt{constructor(e,t){this.position=e,this.inclusive=t}}function jt(e,t,n){let i=0;for(let s=0;s<e.position.length;s++){const r=t[s],o=e.position[s];if(i=r.field.isKeyField()?re.comparator(re.fromName(o.referenceValue),n.key):bt(o,n.data.field(r.field)),"desc"===r.dir&&(i*=-1),0!==i)break}return i}function Vt(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let n=0;n<e.position.length;n++)if(!wt(e.position[n],t.position[n]))return!1;return!0}class Gt{constructor(e,t="asc"){this.field=e,this.dir=t}}function Bt(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class $t{}class Kt extends $t{constructor(e,t,n){super(),this.field=e,this.op=t,this.value=n}static create(e,t,n){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,n):new Xt(e,t,n):"array-contains"===t?new nn(e,n):"in"===t?new sn(e,n):"not-in"===t?new rn(e,n):"array-contains-any"===t?new on(e,n):new Kt(e,t,n)}static createKeyFieldInFilter(e,t,n){return"in"===t?new Zt(e,n):new en(e,n)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(bt(t,this.value)):null!==t&&yt(this.value)===yt(t)&&this.matchesComparison(bt(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return N(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Wt extends $t{constructor(e,t){super(),this.filters=e,this.op=t,this.he=null}static create(e,t){return new Wt(e,t)}matches(e){return zt(this)?void 0===this.filters.find((t=>!t.matches(e))):void 0!==this.filters.find((t=>t.matches(e)))}getFlattenedFilters(){return null!==this.he||(this.he=this.filters.reduce(((e,t)=>e.concat(t.getFlattenedFilters())),[])),this.he}getFilters(){return Object.assign([],this.filters)}}function zt(e){return"and"===e.op}function Ht(e){return function(e){for(const t of e.filters)if(t instanceof Wt)return!1;return!0}(e)&&zt(e)}function Qt(e){if(e instanceof Kt)return e.field.canonicalString()+e.op.toString()+It(e.value);if(Ht(e))return e.filters.map((e=>Qt(e))).join(",");{const t=e.filters.map((e=>Qt(e))).join(",");return`${e.op}(${t})`}}function Jt(e,t){return e instanceof Kt?function(e,t){return t instanceof Kt&&e.op===t.op&&e.field.isEqual(t.field)&&wt(e.value,t.value)}(e,t):e instanceof Wt?function(e,t){return t instanceof Wt&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce(((e,n,i)=>e&&Jt(n,t.filters[i])),!0)}(e,t):void N(19439)}function Yt(e){return e instanceof Kt?function(e){return`${e.field.canonicalString()} ${e.op} ${It(e.value)}`}(e):e instanceof Wt?function(e){return e.op.toString()+" {"+e.getFilters().map(Yt).join(" ,")+"}"}(e):"Filter"}class Xt extends Kt{constructor(e,t,n){super(e,t,n),this.key=re.fromName(n.referenceValue)}matches(e){const t=re.comparator(e.key,this.key);return this.matchesComparison(t)}}class Zt extends Kt{constructor(e,t){super(e,"in",t),this.keys=tn(0,t)}matches(e){return this.keys.some((t=>t.isEqual(e.key)))}}class en extends Kt{constructor(e,t){super(e,"not-in",t),this.keys=tn(0,t)}matches(e){return!this.keys.some((t=>t.isEqual(e.key)))}}function tn(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((e=>re.fromName(e.referenceValue)))}class nn extends Kt{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return At(t)&&vt(t.arrayValue,this.value)}}class sn extends Kt{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&vt(this.value.arrayValue,t)}}class rn extends Kt{constructor(e,t){super(e,"not-in",t)}matches(e){if(vt(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!vt(this.value.arrayValue,t)}}class on extends Kt{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!At(t)||!t.arrayValue.values)&&t.arrayValue.values.some((e=>vt(this.value.arrayValue,e)))}}class an{constructor(e,t=null,n=[],i=[],s=null,r=null,o=null){this.path=e,this.collectionGroup=t,this.orderBy=n,this.filters=i,this.limit=s,this.startAt=r,this.endAt=o,this.Pe=null}}function ln(e,t=null,n=[],i=[],s=null,r=null,o=null){return new an(e,t,n,i,s,r,o)}function cn(e){const t=R(e);if(null===t.Pe){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((e=>Qt(e))).join(","),e+="|ob:",e+=t.orderBy.map((e=>function(e){return e.field.canonicalString()+e.dir}(e))).join(","),xe(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((e=>It(e))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((e=>It(e))).join(",")),t.Pe=e}return t.Pe}function un(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let n=0;n<e.orderBy.length;n++)if(!Bt(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let n=0;n<e.filters.length;n++)if(!Jt(e.filters[n],t.filters[n]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Vt(e.startAt,t.startAt)&&Vt(e.endAt,t.endAt)}function dn(e){return re.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class hn{constructor(e,t=null,n=[],i=[],s=null,r="F",o=null,a=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=n,this.filters=i,this.limit=s,this.limitType=r,this.startAt=o,this.endAt=a,this.Te=null,this.Ie=null,this.de=null,this.startAt,this.endAt}}function mn(e){return new hn(e)}function pn(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function fn(e){return null!==e.collectionGroup}function gn(e){const t=R(e);if(null===t.Te){t.Te=[];const e=new Set;for(const n of t.explicitOrderBy)t.Te.push(n),e.add(n.field.canonicalString());const n=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",i=function(e){let t=new He(se.comparator);return e.filters.forEach((e=>{e.getFlattenedFilters().forEach((e=>{e.isInequality()&&(t=t.add(e.field))}))})),t}(t);i.forEach((i=>{e.has(i.canonicalString())||i.isKeyField()||t.Te.push(new Gt(i,n))})),e.has(se.keyField().canonicalString())||t.Te.push(new Gt(se.keyField(),n))}return t.Te}function _n(e){const t=R(e);return t.Ie||(t.Ie=function(e,t){if("F"===e.limitType)return ln(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map((e=>{const t="desc"===e.dir?"asc":"desc";return new Gt(e.field,t)}));const n=e.endAt?new qt(e.endAt.position,e.endAt.inclusive):null,i=e.startAt?new qt(e.startAt.position,e.startAt.inclusive):null;return ln(e.path,e.collectionGroup,t,e.filters,e.limit,n,i)}}(t,gn(e))),t.Ie}function yn(e,t){const n=e.filters.concat([t]);return new hn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}function wn(e,t,n){return new hn(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function vn(e,t){return un(_n(e),_n(t))&&e.limitType===t.limitType}function bn(e){return`${cn(_n(e))}|lt:${e.limitType}`}function Sn(e){return`Query(target=${function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=`, filters: [${e.filters.map((e=>Yt(e))).join(", ")}]`),xe(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=`, orderBy: [${e.orderBy.map((e=>function(e){return`${e.field.canonicalString()} (${e.dir})`}(e))).join(", ")}]`),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((e=>It(e))).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((e=>It(e))).join(",")),`Target(${t})`}(_n(e))}; limitType=${e.limitType})`}function En(e,t){return t.isFoundDocument()&&function(e,t){const n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):re.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){for(const n of gn(e))if(!n.field.isKeyField()&&null===t.data.field(n.field))return!1;return!0}(e,t)&&function(e,t){for(const n of e.filters)if(!n.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){const i=jt(e,t,n);return e.inclusive?i<=0:i<0}(e.startAt,gn(e),t)||e.endAt&&!function(e,t,n){const i=jt(e,t,n);return e.inclusive?i>=0:i>0}(e.endAt,gn(e),t))}(e,t)}function In(e){return(t,n)=>{let i=!1;for(const s of gn(e)){const e=kn(s,t,n);if(0!==e)return e;i=i||s.field.isKeyField()}return 0}}function kn(e,t,n){const i=e.field.isKeyField()?re.comparator(t.key,n.key):function(e,t,n){const i=t.data.field(e),s=n.data.field(e);return null!==i&&null!==s?bt(i,s):N(42886)}(e.field,t,n);switch(e.dir){case"asc":return i;case"desc":return-1*i;default:return N(19790,{direction:e.dir})}}class xn{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n)for(const[t,i]of n)if(this.equalsFn(t,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const n=this.mapKeyFn(e),i=this.inner[n];if(void 0===i)return this.inner[n]=[[e,t]],void this.innerSize++;for(let n=0;n<i.length;n++)if(this.equalsFn(i[n][0],e))return void(i[n]=[e,t]);i.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return 1===n.length?delete this.inner[t]:n.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Be(this.inner,((t,n)=>{for(const[t,i]of n)e(t,i)}))}isEmpty(){return $e(this.inner)}size(){return this.innerSize}}const Tn=new Ke(re.comparator);function Cn(){return Tn}const An=new Ke(re.comparator);function On(...e){let t=An;for(const n of e)t=t.insert(n.key,n);return t}function Nn(e){let t=An;return e.forEach(((e,n)=>t=t.insert(e,n.overlayedDocument))),t}function Ln(){return Rn()}function Dn(){return Rn()}function Rn(){return new xn((e=>e.toString()),((e,t)=>e.isEqual(t)))}const Mn=new Ke(re.comparator),Pn=new He(re.comparator);function Un(...e){let t=Pn;for(const n of e)t=t.add(n);return t}const Fn=new He(Q);function qn(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Te(t)?"-0":t}}function jn(e){return{integerValue:""+e}}function Vn(e,t){return function(e){return"number"==typeof e&&Number.isInteger(e)&&!Te(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}(t)?jn(t):qn(e,t)}class Gn{constructor(){this._=void 0}}function Bn(e,t,n){return e instanceof Wn?function(e,t){const n={fields:{[st]:{stringValue:it},[ot]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&at(t)&&(t=lt(t)),t&&(n.fields[rt]=t),{mapValue:n}}(n,t):e instanceof zn?Hn(e,t):e instanceof Qn?Jn(e,t):function(e,t){const n=Kn(e,t),i=Xn(n)+Xn(e.Ee);return Ct(n)&&Ct(e.Ee)?jn(i):qn(e.serializer,i)}(e,t)}function $n(e,t,n){return e instanceof zn?Hn(e,t):e instanceof Qn?Jn(e,t):n}function Kn(e,t){return e instanceof Yn?function(e){return Ct(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class Wn extends Gn{}class zn extends Gn{constructor(e){super(),this.elements=e}}function Hn(e,t){const n=Zn(t);for(const t of e.elements)n.some((e=>wt(e,t)))||n.push(t);return{arrayValue:{values:n}}}class Qn extends Gn{constructor(e){super(),this.elements=e}}function Jn(e,t){let n=Zn(t);for(const t of e.elements)n=n.filter((e=>!wt(e,t)));return{arrayValue:{values:n}}}class Yn extends Gn{constructor(e,t){super(),this.serializer=e,this.Ee=t}}function Xn(e){return tt(e.integerValue||e.doubleValue)}function Zn(e){return At(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class ei{constructor(e,t){this.field=e,this.transform=t}}class ti{constructor(e,t){this.version=e,this.transformResults=t}}class ni{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ni}static exists(e){return new ni(void 0,e)}static updateTime(e){return new ni(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function ii(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class si{}function ri(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new fi(e.key,ni.none()):new ui(e.key,e.data,ni.none());{const n=e.data,i=Pt.empty();let s=new He(se.comparator);for(let e of t.fields)if(!s.has(e)){let t=n.field(e);null===t&&e.length>1&&(e=e.popLast(),t=n.field(e)),null===t?i.delete(e):i.set(e,t),s=s.add(e)}return new di(e.key,i,new Je(s.toArray()),ni.none())}}function oi(e,t,n){e instanceof ui?function(e,t,n){const i=e.value.clone(),s=mi(e.fieldTransforms,t,n.transformResults);i.setAll(s),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(e,t,n):e instanceof di?function(e,t,n){if(!ii(e.precondition,t))return void t.convertToUnknownDocument(n.version);const i=mi(e.fieldTransforms,t,n.transformResults),s=t.data;s.setAll(hi(e)),s.setAll(i),t.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function ai(e,t,n,i){return e instanceof ui?function(e,t,n,i){if(!ii(e.precondition,t))return n;const s=e.value.clone(),r=pi(e.fieldTransforms,i,t);return s.setAll(r),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null}(e,t,n,i):e instanceof di?function(e,t,n,i){if(!ii(e.precondition,t))return n;const s=pi(e.fieldTransforms,i,t),r=t.data;return r.setAll(hi(e)),r.setAll(s),t.convertToFoundDocument(t.version,r).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((e=>e.field)))}(e,t,n,i):function(e,t,n){return ii(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function li(e,t){let n=null;for(const i of e.fieldTransforms){const e=t.data.field(i.field),s=Kn(i.transform,e||null);null!=s&&(null===n&&(n=Pt.empty()),n.set(i.field,s))}return n||null}function ci(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Z(e,t,((e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof zn&&t instanceof zn||e instanceof Qn&&t instanceof Qn?Z(e.elements,t.elements,wt):e instanceof Yn&&t instanceof Yn?wt(e.Ee,t.Ee):e instanceof Wn&&t instanceof Wn}(e.transform,t.transform)}(e,t)))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class ui extends si{constructor(e,t,n,i=[]){super(),this.key=e,this.value=t,this.precondition=n,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}}class di extends si{constructor(e,t,n,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=n,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function hi(e){const t=new Map;return e.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const i=e.data.field(n);t.set(n,i)}})),t}function mi(e,t,n){const i=new Map;D(e.length===n.length,32656,{Ae:n.length,Re:e.length});for(let s=0;s<n.length;s++){const r=e[s],o=r.transform,a=t.data.field(r.field);i.set(r.field,$n(o,a,n[s]))}return i}function pi(e,t,n){const i=new Map;for(const s of e){const e=s.transform,r=n.data.field(s.field);i.set(s.field,Bn(e,r,t))}return i}class fi extends si{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class gi extends si{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class _i{constructor(e,t,n,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=n,this.mutations=i}applyToRemoteDocument(e,t){const n=t.mutationResults;for(let t=0;t<this.mutations.length;t++){const i=this.mutations[t];i.key.isEqual(e.key)&&oi(i,e,n[t])}}applyToLocalView(e,t){for(const n of this.baseMutations)n.key.isEqual(e.key)&&(t=ai(n,e,t,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(e.key)&&(t=ai(n,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const n=Dn();return this.mutations.forEach((i=>{const s=e.get(i.key),r=s.overlayedDocument;let o=this.applyToLocalView(r,s.mutatedFields);o=t.has(i.key)?null:o;const a=ri(r,o);null!==a&&n.set(i.key,a),r.isValidDocument()||r.convertToNoDocument(_e.min())})),n}keys(){return this.mutations.reduce(((e,t)=>e.add(t.key)),Un())}isEqual(e){return this.batchId===e.batchId&&Z(this.mutations,e.mutations,((e,t)=>ci(e,t)))&&Z(this.baseMutations,e.baseMutations,((e,t)=>ci(e,t)))}}class yi{constructor(e,t,n,i){this.batch=e,this.commitVersion=t,this.mutationResults=n,this.docVersions=i}static from(e,t,n){D(e.mutations.length===n.length,58842,{Ve:e.mutations.length,me:n.length});let i=Mn;const s=e.mutations;for(let e=0;e<s.length;e++)i=i.insert(s[e].key,n[e].version);return new yi(e,t,n,i)}}class wi{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class vi{constructor(e,t){this.count=e,this.unchangedNames=t}}var bi,Si;function Ei(e){switch(e){case M.OK:return N(64938);case M.CANCELLED:case M.UNKNOWN:case M.DEADLINE_EXCEEDED:case M.RESOURCE_EXHAUSTED:case M.INTERNAL:case M.UNAVAILABLE:case M.UNAUTHENTICATED:return!1;case M.INVALID_ARGUMENT:case M.NOT_FOUND:case M.ALREADY_EXISTS:case M.PERMISSION_DENIED:case M.FAILED_PRECONDITION:case M.ABORTED:case M.OUT_OF_RANGE:case M.UNIMPLEMENTED:case M.DATA_LOSS:return!0;default:return N(15467,{code:e})}}function Ii(e){if(void 0===e)return C("GRPC error has no .code"),M.UNKNOWN;switch(e){case bi.OK:return M.OK;case bi.CANCELLED:return M.CANCELLED;case bi.UNKNOWN:return M.UNKNOWN;case bi.DEADLINE_EXCEEDED:return M.DEADLINE_EXCEEDED;case bi.RESOURCE_EXHAUSTED:return M.RESOURCE_EXHAUSTED;case bi.INTERNAL:return M.INTERNAL;case bi.UNAVAILABLE:return M.UNAVAILABLE;case bi.UNAUTHENTICATED:return M.UNAUTHENTICATED;case bi.INVALID_ARGUMENT:return M.INVALID_ARGUMENT;case bi.NOT_FOUND:return M.NOT_FOUND;case bi.ALREADY_EXISTS:return M.ALREADY_EXISTS;case bi.PERMISSION_DENIED:return M.PERMISSION_DENIED;case bi.FAILED_PRECONDITION:return M.FAILED_PRECONDITION;case bi.ABORTED:return M.ABORTED;case bi.OUT_OF_RANGE:return M.OUT_OF_RANGE;case bi.UNIMPLEMENTED:return M.UNIMPLEMENTED;case bi.DATA_LOSS:return M.DATA_LOSS;default:return N(39323,{code:e})}}(Si=bi||(bi={}))[Si.OK=0]="OK",Si[Si.CANCELLED=1]="CANCELLED",Si[Si.UNKNOWN=2]="UNKNOWN",Si[Si.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Si[Si.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Si[Si.NOT_FOUND=5]="NOT_FOUND",Si[Si.ALREADY_EXISTS=6]="ALREADY_EXISTS",Si[Si.PERMISSION_DENIED=7]="PERMISSION_DENIED",Si[Si.UNAUTHENTICATED=16]="UNAUTHENTICATED",Si[Si.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Si[Si.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Si[Si.ABORTED=10]="ABORTED",Si[Si.OUT_OF_RANGE=11]="OUT_OF_RANGE",Si[Si.UNIMPLEMENTED=12]="UNIMPLEMENTED",Si[Si.INTERNAL=13]="INTERNAL",Si[Si.UNAVAILABLE=14]="UNAVAILABLE",Si[Si.DATA_LOSS=15]="DATA_LOSS";const ki=new i([4294967295,4294967295],0);function xi(e){const t=z().encode(e),n=new s;return n.update(t),new Uint8Array(n.digest())}function Ti(e){const t=new DataView(e.buffer),n=t.getUint32(0,!0),s=t.getUint32(4,!0),r=t.getUint32(8,!0),o=t.getUint32(12,!0);return[new i([n,s],0),new i([r,o],0)]}class Ci{constructor(e,t,n){if(this.bitmap=e,this.padding=t,this.hashCount=n,t<0||t>=8)throw new Ai(`Invalid padding: ${t}`);if(n<0)throw new Ai(`Invalid hash count: ${n}`);if(e.length>0&&0===this.hashCount)throw new Ai(`Invalid hash count: ${n}`);if(0===e.length&&0!==t)throw new Ai(`Invalid padding when bitmap length is 0: ${t}`);this.fe=8*e.length-t,this.ge=i.fromNumber(this.fe)}pe(e,t,n){let s=e.add(t.multiply(i.fromNumber(n)));return 1===s.compare(ki)&&(s=new i([s.getBits(0),s.getBits(1)],0)),s.modulo(this.ge).toNumber()}ye(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.fe)return!1;const t=xi(e),[n,i]=Ti(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(n,i,e);if(!this.ye(t))return!1}return!0}static create(e,t,n){const i=e%8==0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),r=new Ci(s,i,t);return n.forEach((e=>r.insert(e))),r}insert(e){if(0===this.fe)return;const t=xi(e),[n,i]=Ti(t);for(let e=0;e<this.hashCount;e++){const t=this.pe(n,i,e);this.we(t)}}we(e){const t=Math.floor(e/8),n=e%8;this.bitmap[t]|=1<<n}}class Ai extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Oi{constructor(e,t,n,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=n,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,n){const i=new Map;return i.set(e,Ni.createSynthesizedTargetChangeForCurrentChange(e,t,n)),new Oi(_e.min(),i,new Ke(Q),Cn(),Un())}}class Ni{constructor(e,t,n,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=n,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,n){return new Ni(n,t,Un(),Un(),Un())}}class Li{constructor(e,t,n,i){this.Se=e,this.removedTargetIds=t,this.key=n,this.be=i}}class Di{constructor(e,t){this.targetId=e,this.De=t}}class Ri{constructor(e,t,n=Xe.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=n,this.cause=i}}class Mi{constructor(){this.ve=0,this.Ce=Fi(),this.Fe=Xe.EMPTY_BYTE_STRING,this.Me=!1,this.xe=!0}get current(){return this.Me}get resumeToken(){return this.Fe}get Oe(){return 0!==this.ve}get Ne(){return this.xe}Be(e){e.approximateByteSize()>0&&(this.xe=!0,this.Fe=e)}Le(){let e=Un(),t=Un(),n=Un();return this.Ce.forEach(((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:n=n.add(i);break;default:N(38017,{changeType:s})}})),new Ni(this.Fe,this.Me,e,t,n)}ke(){this.xe=!1,this.Ce=Fi()}qe(e,t){this.xe=!0,this.Ce=this.Ce.insert(e,t)}Qe(e){this.xe=!0,this.Ce=this.Ce.remove(e)}$e(){this.ve+=1}Ue(){this.ve-=1,D(this.ve>=0,3241,{ve:this.ve})}Ke(){this.xe=!0,this.Me=!0}}class Pi{constructor(e){this.We=e,this.Ge=new Map,this.ze=Cn(),this.je=Ui(),this.Je=Ui(),this.He=new Ke(Q)}Ye(e){for(const t of e.Se)e.be&&e.be.isFoundDocument()?this.Ze(t,e.be):this.Xe(t,e.key,e.be);for(const t of e.removedTargetIds)this.Xe(t,e.key,e.be)}et(e){this.forEachTarget(e,(t=>{const n=this.tt(t);switch(e.state){case 0:this.nt(t)&&n.Be(e.resumeToken);break;case 1:n.Ue(),n.Oe||n.ke(),n.Be(e.resumeToken);break;case 2:n.Ue(),n.Oe||this.removeTarget(t);break;case 3:this.nt(t)&&(n.Ke(),n.Be(e.resumeToken));break;case 4:this.nt(t)&&(this.rt(t),n.Be(e.resumeToken));break;default:N(56790,{state:e.state})}}))}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.Ge.forEach(((e,n)=>{this.nt(n)&&t(n)}))}it(e){const t=e.targetId,n=e.De.count,i=this.st(t);if(i){const s=i.target;if(dn(s))if(0===n){const e=new re(s.path);this.Xe(t,e,Ft.newNoDocument(e,_e.min()))}else D(1===n,20013,{expectedCount:n});else{const i=this.ot(t);if(i!==n){const n=this._t(e),s=n?this.ut(n,e,i):1;if(0!==s){this.rt(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.He=this.He.insert(t,e)}}}}}_t(e){const t=e.De.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:n="",padding:i=0},hashCount:s=0}=t;let r,o;try{r=nt(n).toUint8Array()}catch(e){if(e instanceof Ye)return A("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Ci(r,i,s)}catch(e){return A(e instanceof Ai?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.fe?null:o}ut(e,t,n){return t.De.count===n-this.ht(e,t.targetId)?0:2}ht(e,t){const n=this.We.getRemoteKeysForTarget(t);let i=0;return n.forEach((n=>{const s=this.We.lt(),r=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;e.mightContain(r)||(this.Xe(t,n,null),i++)})),i}Pt(e){const t=new Map;this.Ge.forEach(((n,i)=>{const s=this.st(i);if(s){if(n.current&&dn(s.target)){const t=new re(s.target.path);this.Tt(t).has(i)||this.It(i,t)||this.Xe(i,t,Ft.newNoDocument(t,e))}n.Ne&&(t.set(i,n.Le()),n.ke())}}));let n=Un();this.Je.forEach(((e,t)=>{let i=!0;t.forEachWhile((e=>{const t=this.st(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(i=!1,!1)})),i&&(n=n.add(e))})),this.ze.forEach(((t,n)=>n.setReadTime(e)));const i=new Oi(e,t,this.He,this.ze,n);return this.ze=Cn(),this.je=Ui(),this.Je=Ui(),this.He=new Ke(Q),i}Ze(e,t){if(!this.nt(e))return;const n=this.It(e,t.key)?2:0;this.tt(e).qe(t.key,n),this.ze=this.ze.insert(t.key,t),this.je=this.je.insert(t.key,this.Tt(t.key).add(e)),this.Je=this.Je.insert(t.key,this.dt(t.key).add(e))}Xe(e,t,n){if(!this.nt(e))return;const i=this.tt(e);this.It(e,t)?i.qe(t,1):i.Qe(t),this.Je=this.Je.insert(t,this.dt(t).delete(e)),this.Je=this.Je.insert(t,this.dt(t).add(e)),n&&(this.ze=this.ze.insert(t,n))}removeTarget(e){this.Ge.delete(e)}ot(e){const t=this.tt(e).Le();return this.We.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}$e(e){this.tt(e).$e()}tt(e){let t=this.Ge.get(e);return t||(t=new Mi,this.Ge.set(e,t)),t}dt(e){let t=this.Je.get(e);return t||(t=new He(Q),this.Je=this.Je.insert(e,t)),t}Tt(e){let t=this.je.get(e);return t||(t=new He(Q),this.je=this.je.insert(e,t)),t}nt(e){const t=null!==this.st(e);return t||T("WatchChangeAggregator","Detected inactive target",e),t}st(e){const t=this.Ge.get(e);return t&&t.Oe?null:this.We.Et(e)}rt(e){this.Ge.set(e,new Mi),this.We.getRemoteKeysForTarget(e).forEach((t=>{this.Xe(e,t,null)}))}It(e,t){return this.We.getRemoteKeysForTarget(e).has(t)}}function Ui(){return new Ke(re.comparator)}function Fi(){return new Ke(re.comparator)}const qi={asc:"ASCENDING",desc:"DESCENDING"},ji={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vi={and:"AND",or:"OR"};class Gi{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function Bi(e,t){return e.useProto3Json||xe(t)?t:{value:t}}function $i(e,t){return e.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ki(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function Wi(e,t){return $i(e,t.toTimestamp())}function zi(e){return D(!!e,49232),_e.fromTimestamp(function(e){const t=et(e);return new ge(t.seconds,t.nanos)}(e))}function Hi(e,t){return Qi(e,t).canonicalString()}function Qi(e,t){const n=function(e){return new ne(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?n:n.child(t)}function Ji(e){const t=ne.fromString(e);return D(fs(t),10190,{key:t.toString()}),t}function Yi(e,t){return Hi(e.databaseId,t.path)}function Xi(e,t){const n=Ji(t);if(n.get(1)!==e.databaseId.projectId)throw new P(M.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new P(M.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new re(ts(n))}function Zi(e,t){return Hi(e.databaseId,t)}function es(e){return new ne(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function ts(e){return D(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ns(e,t,n){return{name:Yi(e,t),fields:n.value.mapValue.fields}}function is(e,t){let n;if(t instanceof ui)n={update:ns(e,t.key,t.value)};else if(t instanceof fi)n={delete:Yi(e,t.key)};else if(t instanceof di)n={update:ns(e,t.key,t.data),updateMask:ps(t.fieldMask)};else{if(!(t instanceof gi))return N(16599,{Rt:t.type});n={verify:Yi(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((e=>function(e,t){const n=t.transform;if(n instanceof Wn)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof zn)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Qn)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Yn)return{fieldPath:t.field.canonicalString(),increment:n.Ee};throw N(20930,{transform:t.transform})}(0,e)))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Wi(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:N(27497)}(e,t.precondition)),n}function ss(e,t){return{documents:[Zi(e,t.path)]}}function rs(e,t){const n={structuredQuery:{}},i=t.path;let s;null!==t.collectionGroup?(s=i,n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=i.popLast(),n.structuredQuery.from=[{collectionId:i.lastSegment()}]),n.parent=Zi(e,s);const r=function(e){if(0!==e.length)return ms(Wt.create(e,"and"))}(t.filters);r&&(n.structuredQuery.where=r);const o=function(e){if(0!==e.length)return e.map((e=>function(e){return{field:ds(e.field),direction:ls(e.dir)}}(e)))}(t.orderBy);o&&(n.structuredQuery.orderBy=o);const a=Bi(e,t.limit);return null!==a&&(n.structuredQuery.limit=a),t.startAt&&(n.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{Vt:n,parent:s}}function os(e){let t=function(e){const t=Ji(e);return 4===t.length?ne.emptyPath():ts(t)}(e.parent);const n=e.structuredQuery,i=n.from?n.from.length:0;let s=null;if(i>0){D(1===i,65062);const e=n.from[0];e.allDescendants?s=e.collectionId:t=t.child(e.collectionId)}let r=[];n.where&&(r=function(e){const t=as(e);return t instanceof Wt&&Ht(t)?t.getFilters():[t]}(n.where));let o=[];n.orderBy&&(o=function(e){return e.map((e=>function(e){return new Gt(hs(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)))}(n.orderBy));let a=null;n.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,xe(t)?null:t}(n.limit));let l=null;n.startAt&&(l=function(e){const t=!!e.before,n=e.values||[];return new qt(n,t)}(n.startAt));let c=null;return n.endAt&&(c=function(e){const t=!e.before,n=e.values||[];return new qt(n,t)}(n.endAt)),function(e,t,n,i,s,r,o,a){return new hn(e,t,n,i,s,r,o,a)}(t,s,o,r,a,"F",l,c)}function as(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=hs(e.unaryFilter.field);return Kt.create(t,"==",{doubleValue:NaN});case"IS_NULL":const n=hs(e.unaryFilter.field);return Kt.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const i=hs(e.unaryFilter.field);return Kt.create(i,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=hs(e.unaryFilter.field);return Kt.create(s,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return N(61313);default:return N(60726)}}(e):void 0!==e.fieldFilter?function(e){return Kt.create(hs(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return N(58110);default:return N(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return Wt.create(e.compositeFilter.filters.map((e=>as(e))),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return N(1026)}}(e.compositeFilter.op))}(e):N(30097,{filter:e})}function ls(e){return qi[e]}function cs(e){return ji[e]}function us(e){return Vi[e]}function ds(e){return{fieldPath:e.canonicalString()}}function hs(e){return se.fromServerFormat(e.fieldPath)}function ms(e){return e instanceof Kt?function(e){if("=="===e.op){if(Nt(e.value))return{unaryFilter:{field:ds(e.field),op:"IS_NAN"}};if(Ot(e.value))return{unaryFilter:{field:ds(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Nt(e.value))return{unaryFilter:{field:ds(e.field),op:"IS_NOT_NAN"}};if(Ot(e.value))return{unaryFilter:{field:ds(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ds(e.field),op:cs(e.op),value:e.value}}}(e):e instanceof Wt?function(e){const t=e.getFilters().map((e=>ms(e)));return 1===t.length?t[0]:{compositeFilter:{op:us(e.op),filters:t}}}(e):N(54877,{filter:e})}function ps(e){const t=[];return e.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function fs(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class gs{constructor(e,t,n,i,s=_e.min(),r=_e.min(),o=Xe.EMPTY_BYTE_STRING,a=null){this.target=e,this.targetId=t,this.purpose=n,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=r,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new gs(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new gs(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new gs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class _s{constructor(e){this.gt=e}}function ys(e){const t=os({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?wn(t,t.limit,"L"):t}class ws{constructor(){}bt(e,t){this.Dt(e,t),t.vt()}Dt(e,t){if("nullValue"in e)this.Ct(t,5);else if("booleanValue"in e)this.Ct(t,10),t.Ft(e.booleanValue?1:0);else if("integerValue"in e)this.Ct(t,15),t.Ft(tt(e.integerValue));else if("doubleValue"in e){const n=tt(e.doubleValue);isNaN(n)?this.Ct(t,13):(this.Ct(t,15),Te(n)?t.Ft(0):t.Ft(n))}else if("timestampValue"in e){let n=e.timestampValue;this.Ct(t,20),"string"==typeof n&&(n=et(n)),t.Mt(`${n.seconds||""}`),t.Ft(n.nanos||0)}else if("stringValue"in e)this.xt(e.stringValue,t),this.Ot(t);else if("bytesValue"in e)this.Ct(t,30),t.Nt(nt(e.bytesValue)),this.Ot(t);else if("referenceValue"in e)this.Bt(e.referenceValue,t);else if("geoPointValue"in e){const n=e.geoPointValue;this.Ct(t,45),t.Ft(n.latitude||0),t.Ft(n.longitude||0)}else"mapValue"in e?Mt(e)?this.Ct(t,Number.MAX_SAFE_INTEGER):Dt(e)?this.Lt(e.mapValue,t):(this.kt(e.mapValue,t),this.Ot(t)):"arrayValue"in e?(this.qt(e.arrayValue,t),this.Ot(t)):N(19022,{Qt:e})}xt(e,t){this.Ct(t,25),this.$t(e,t)}$t(e,t){t.Mt(e)}kt(e,t){const n=e.fields||{};this.Ct(t,55);for(const e of Object.keys(n))this.xt(e,t),this.Dt(n[e],t)}Lt(e,t){var n,i;const s=e.fields||{};this.Ct(t,53);const r=_t,o=(null===(i=null===(n=s[r].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.length)||0;this.Ct(t,15),t.Ft(tt(o)),this.xt(r,t),this.Dt(s[r],t)}qt(e,t){const n=e.values||[];this.Ct(t,50);for(const e of n)this.Dt(e,t)}Bt(e,t){this.Ct(t,37),re.fromName(e).path.forEach((e=>{this.Ct(t,60),this.$t(e,t)}))}Ct(e,t){e.Ft(t)}Ot(e){e.Ft(2)}}ws.Ut=new ws;class vs{constructor(){this.Dn=new bs}addToCollectionParentIndex(e,t){return this.Dn.add(t),Ee.resolve()}getCollectionParents(e,t){return Ee.resolve(this.Dn.getEntries(t))}addFieldIndex(e,t){return Ee.resolve()}deleteFieldIndex(e,t){return Ee.resolve()}deleteAllFieldIndexes(e){return Ee.resolve()}createTargetIndexes(e,t){return Ee.resolve()}getDocumentsMatchingTarget(e,t){return Ee.resolve(null)}getIndexType(e,t){return Ee.resolve(0)}getFieldIndexes(e,t){return Ee.resolve([])}getNextCollectionGroupToUpdate(e){return Ee.resolve(null)}getMinOffset(e,t){return Ee.resolve(we.min())}getMinOffsetFromCollectionGroup(e,t){return Ee.resolve(we.min())}updateCollectionGroup(e,t,n){return Ee.resolve()}updateIndexEntries(e,t){return Ee.resolve()}}class bs{constructor(){this.index={}}add(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t]||new He(ne.comparator),s=!i.has(n);return this.index[t]=i.add(n),s}has(e){const t=e.lastSegment(),n=e.popLast(),i=this.index[t];return i&&i.has(n)}getEntries(e){return(this.index[e]||new He(ne.comparator)).toArray()}}new Uint8Array(0);const Ss={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Es=41943040;class Is{static withCacheSize(e){return new Is(e,Is.DEFAULT_COLLECTION_PERCENTILE,Is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,n){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=n}}Is.DEFAULT_COLLECTION_PERCENTILE=10,Is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Is.DEFAULT=new Is(Es,Is.DEFAULT_COLLECTION_PERCENTILE,Is.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Is.DISABLED=new Is(-1,0,0);class ks{constructor(e){this._r=e}next(){return this._r+=2,this._r}static ar(){return new ks(0)}static ur(){return new ks(-1)}}const xs="LruGarbageCollector";function Ts([e,t],[n,i]){const s=Q(e,n);return 0===s?Q(t,i):s}class Cs{constructor(e){this.Tr=e,this.buffer=new He(Ts),this.Ir=0}dr(){return++this.Ir}Er(e){const t=[e,this.dr()];if(this.buffer.size<this.Tr)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Ts(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class As{constructor(e,t,n){this.garbageCollector=e,this.asyncQueue=t,this.localStore=n,this.Ar=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Rr(6e4)}stop(){this.Ar&&(this.Ar.cancel(),this.Ar=null)}get started(){return null!==this.Ar}Rr(e){T(xs,`Garbage collection scheduled in ${e}ms`),this.Ar=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,(async()=>{this.Ar=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Ie(e)?T(xs,"Ignoring IndexedDB error during garbage collection: ",e):await Se(e)}await this.Rr(3e5)}))}}class Os{constructor(e,t){this.Vr=e,this.params=t}calculateTargetCount(e,t){return this.Vr.mr(e).next((e=>Math.floor(t/100*e)))}nthSequenceNumber(e,t){if(0===t)return Ee.resolve(ke.ue);const n=new Cs(t);return this.Vr.forEachTarget(e,(e=>n.Er(e.sequenceNumber))).next((()=>this.Vr.gr(e,(e=>n.Er(e))))).next((()=>n.maxValue))}removeTargets(e,t,n){return this.Vr.removeTargets(e,t,n)}removeOrphanedDocuments(e,t){return this.Vr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector","Garbage collection skipped; disabled"),Ee.resolve(Ss)):this.getCacheSize(e).next((n=>n<this.params.cacheSizeCollectionThreshold?(T("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Ss):this.pr(e,t)))}getCacheSize(e){return this.Vr.getCacheSize(e)}pr(e,t){let n,i,s,r,o,l,c;const u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((t=>(t>this.params.maximumSequenceNumbersToCollect?(T("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${t}`),i=this.params.maximumSequenceNumbersToCollect):i=t,r=Date.now(),this.nthSequenceNumber(e,i)))).next((i=>(n=i,o=Date.now(),this.removeTargets(e,n,t)))).next((t=>(s=t,l=Date.now(),this.removeOrphanedDocuments(e,n)))).next((e=>(c=Date.now(),x()<=a.in.DEBUG&&T("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${r-u}ms\n\tDetermined least recently used ${i} in `+(o-r)+"ms\n"+`\tRemoved ${s} targets in `+(l-o)+"ms\n"+`\tRemoved ${e} documents in `+(c-l)+"ms\n"+`Total Duration: ${c-u}ms`),Ee.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:e}))))}}class Ns{constructor(){this.changes=new xn((e=>e.toString()),((e,t)=>e.isEqual(t))),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ft.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const n=this.changes.get(t);return void 0!==n?Ee.resolve(n):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class Ls{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class Ds{constructor(e,t,n,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=n,this.indexManager=i}getDocument(e,t){let n=null;return this.documentOverlayCache.getOverlay(e,t).next((i=>(n=i,this.remoteDocumentCache.getEntry(e,t)))).next((e=>(null!==n&&ai(n.mutation,e,Je.empty(),ge.now()),e)))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.getLocalViewOfDocuments(e,t,Un()).next((()=>t))))}getLocalViewOfDocuments(e,t,n=Un()){const i=Ln();return this.populateOverlays(e,i,t).next((()=>this.computeViews(e,t,i,n).next((e=>{let t=On();return e.forEach(((e,n)=>{t=t.insert(e,n.overlayedDocument)})),t}))))}getOverlayedDocuments(e,t){const n=Ln();return this.populateOverlays(e,n,t).next((()=>this.computeViews(e,t,n,Un())))}populateOverlays(e,t,n){const i=[];return n.forEach((e=>{t.has(e)||i.push(e)})),this.documentOverlayCache.getOverlays(e,i).next((e=>{e.forEach(((e,n)=>{t.set(e,n)}))}))}computeViews(e,t,n,i){let s=Cn();const r=Rn(),o=Rn();return t.forEach(((e,t)=>{const o=n.get(t.key);i.has(t.key)&&(void 0===o||o.mutation instanceof di)?s=s.insert(t.key,t):void 0!==o?(r.set(t.key,o.mutation.getFieldMask()),ai(o.mutation,t,o.mutation.getFieldMask(),ge.now())):r.set(t.key,Je.empty())})),this.recalculateAndSaveOverlays(e,s).next((e=>(e.forEach(((e,t)=>r.set(e,t))),t.forEach(((e,t)=>{var n;return o.set(e,new Ls(t,null!==(n=r.get(e))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(e,t){const n=Rn();let i=new Ke(((e,t)=>e-t)),s=Un();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((e=>{for(const s of e)s.keys().forEach((e=>{const r=t.get(e);if(null===r)return;let o=n.get(e)||Je.empty();o=s.applyToLocalView(r,o),n.set(e,o);const a=(i.get(s.batchId)||Un()).add(e);i=i.insert(s.batchId,a)}))})).next((()=>{const r=[],o=i.getReverseIterator();for(;o.hasNext();){const i=o.getNext(),a=i.key,l=i.value,c=Dn();l.forEach((e=>{if(!s.has(e)){const i=ri(t.get(e),n.get(e));null!==i&&c.set(e,i),s=s.add(e)}})),r.push(this.documentOverlayCache.saveOverlays(e,a,c))}return Ee.waitFor(r)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next((t=>this.recalculateAndSaveOverlays(e,t)))}getDocumentsMatchingQuery(e,t,n,i){return function(e){return re.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):fn(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n,i):this.getDocumentsMatchingCollectionQuery(e,t,n,i)}getNextDocuments(e,t,n,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,i).next((s=>{const r=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,i-s.size):Ee.resolve(Ln());let o=-1,a=s;return r.next((t=>Ee.forEach(t,((t,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(t)?Ee.resolve():this.remoteDocumentCache.getEntry(e,t).next((e=>{a=a.insert(t,e)}))))).next((()=>this.populateOverlays(e,t,s))).next((()=>this.computeViews(e,a,t,Un()))).next((e=>({batchId:o,changes:Nn(e)})))))}))}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new re(t)).next((e=>{let t=On();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}getDocumentsMatchingCollectionGroupQuery(e,t,n,i){const s=t.collectionGroup;let r=On();return this.indexManager.getCollectionParents(e,s).next((o=>Ee.forEach(o,(o=>{const a=function(e,t){return new hn(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(s));return this.getDocumentsMatchingCollectionQuery(e,a,n,i).next((e=>{e.forEach(((e,t)=>{r=r.insert(e,t)}))}))})).next((()=>r))))}getDocumentsMatchingCollectionQuery(e,t,n,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId).next((r=>(s=r,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,n,s,i)))).next((e=>{s.forEach(((t,n)=>{const i=n.getKey();null===e.get(i)&&(e=e.insert(i,Ft.newInvalidDocument(i)))}));let n=On();return e.forEach(((e,i)=>{const r=s.get(e);void 0!==r&&ai(r.mutation,i,Je.empty(),ge.now()),En(t,i)&&(n=n.insert(e,i))})),n}))}}class Rs{constructor(e){this.serializer=e,this.Br=new Map,this.Lr=new Map}getBundleMetadata(e,t){return Ee.resolve(this.Br.get(t))}saveBundleMetadata(e,t){return this.Br.set(t.id,function(e){return{id:e.id,version:e.version,createTime:zi(e.createTime)}}(t)),Ee.resolve()}getNamedQuery(e,t){return Ee.resolve(this.Lr.get(t))}saveNamedQuery(e,t){return this.Lr.set(t.name,function(e){return{name:e.name,query:ys(e.bundledQuery),readTime:zi(e.readTime)}}(t)),Ee.resolve()}}class Ms{constructor(){this.overlays=new Ke(re.comparator),this.kr=new Map}getOverlay(e,t){return Ee.resolve(this.overlays.get(t))}getOverlays(e,t){const n=Ln();return Ee.forEach(t,(t=>this.getOverlay(e,t).next((e=>{null!==e&&n.set(t,e)})))).next((()=>n))}saveOverlays(e,t,n){return n.forEach(((n,i)=>{this.wt(e,t,i)})),Ee.resolve()}removeOverlaysForBatchId(e,t,n){const i=this.kr.get(n);return void 0!==i&&(i.forEach((e=>this.overlays=this.overlays.remove(e))),this.kr.delete(n)),Ee.resolve()}getOverlaysForCollection(e,t,n){const i=Ln(),s=t.length+1,r=new re(t.child("")),o=this.overlays.getIteratorFrom(r);for(;o.hasNext();){const e=o.getNext().value,r=e.getKey();if(!t.isPrefixOf(r.path))break;r.path.length===s&&e.largestBatchId>n&&i.set(e.getKey(),e)}return Ee.resolve(i)}getOverlaysForCollectionGroup(e,t,n,i){let s=new Ke(((e,t)=>e-t));const r=this.overlays.getIterator();for(;r.hasNext();){const e=r.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>n){let t=s.get(e.largestBatchId);null===t&&(t=Ln(),s=s.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ln(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((e,t)=>o.set(e,t))),!(o.size()>=i)););return Ee.resolve(o)}wt(e,t,n){const i=this.overlays.get(n.key);if(null!==i){const e=this.kr.get(i.largestBatchId).delete(n.key);this.kr.set(i.largestBatchId,e)}this.overlays=this.overlays.insert(n.key,new wi(t,n));let s=this.kr.get(t);void 0===s&&(s=Un(),this.kr.set(t,s)),this.kr.set(t,s.add(n.key))}}class Ps{constructor(){this.sessionToken=Xe.EMPTY_BYTE_STRING}getSessionToken(e){return Ee.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,Ee.resolve()}}class Us{constructor(){this.qr=new He(Fs.Qr),this.$r=new He(Fs.Ur)}isEmpty(){return this.qr.isEmpty()}addReference(e,t){const n=new Fs(e,t);this.qr=this.qr.add(n),this.$r=this.$r.add(n)}Kr(e,t){e.forEach((e=>this.addReference(e,t)))}removeReference(e,t){this.Wr(new Fs(e,t))}Gr(e,t){e.forEach((e=>this.removeReference(e,t)))}zr(e){const t=new re(new ne([])),n=new Fs(t,e),i=new Fs(t,e+1),s=[];return this.$r.forEachInRange([n,i],(e=>{this.Wr(e),s.push(e.key)})),s}jr(){this.qr.forEach((e=>this.Wr(e)))}Wr(e){this.qr=this.qr.delete(e),this.$r=this.$r.delete(e)}Jr(e){const t=new re(new ne([])),n=new Fs(t,e),i=new Fs(t,e+1);let s=Un();return this.$r.forEachInRange([n,i],(e=>{s=s.add(e.key)})),s}containsKey(e){const t=new Fs(e,0),n=this.qr.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}class Fs{constructor(e,t){this.key=e,this.Hr=t}static Qr(e,t){return re.comparator(e.key,t.key)||Q(e.Hr,t.Hr)}static Ur(e,t){return Q(e.Hr,t.Hr)||re.comparator(e.key,t.key)}}class qs{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.er=1,this.Yr=new He(Fs.Qr)}checkEmpty(e){return Ee.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,n,i){const s=this.er;this.er++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const r=new _i(s,t,n,i);this.mutationQueue.push(r);for(const t of i)this.Yr=this.Yr.add(new Fs(t.key,s)),this.indexManager.addToCollectionParentIndex(e,t.key.path.popLast());return Ee.resolve(r)}lookupMutationBatch(e,t){return Ee.resolve(this.Zr(t))}getNextMutationBatchAfterBatchId(e,t){const n=t+1,i=this.Xr(n),s=i<0?0:i;return Ee.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return Ee.resolve(0===this.mutationQueue.length?-1:this.er-1)}getAllMutationBatches(e){return Ee.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const n=new Fs(t,0),i=new Fs(t,Number.POSITIVE_INFINITY),s=[];return this.Yr.forEachInRange([n,i],(e=>{const t=this.Zr(e.Hr);s.push(t)})),Ee.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let n=new He(Q);return t.forEach((e=>{const t=new Fs(e,0),i=new Fs(e,Number.POSITIVE_INFINITY);this.Yr.forEachInRange([t,i],(e=>{n=n.add(e.Hr)}))})),Ee.resolve(this.ei(n))}getAllMutationBatchesAffectingQuery(e,t){const n=t.path,i=n.length+1;let s=n;re.isDocumentKey(s)||(s=s.child(""));const r=new Fs(new re(s),0);let o=new He(Q);return this.Yr.forEachWhile((e=>{const t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===i&&(o=o.add(e.Hr)),!0)}),r),Ee.resolve(this.ei(o))}ei(e){const t=[];return e.forEach((e=>{const n=this.Zr(e);null!==n&&t.push(n)})),t}removeMutationBatch(e,t){D(0===this.ti(t.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Yr;return Ee.forEach(t.mutations,(i=>{const s=new Fs(i.key,t.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((()=>{this.Yr=n}))}rr(e){}containsKey(e,t){const n=new Fs(t,0),i=this.Yr.firstAfterOrEqual(n);return Ee.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,Ee.resolve()}ti(e,t){return this.Xr(e)}Xr(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Zr(e){const t=this.Xr(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class js{constructor(e){this.ni=e,this.docs=new Ke(re.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const n=t.key,i=this.docs.get(n),s=i?i.size:0,r=this.ni(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:r}),this.size+=r-s,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const n=this.docs.get(t);return Ee.resolve(n?n.document.mutableCopy():Ft.newInvalidDocument(t))}getEntries(e,t){let n=Cn();return t.forEach((e=>{const t=this.docs.get(e);n=n.insert(e,t?t.document.mutableCopy():Ft.newInvalidDocument(e))})),Ee.resolve(n)}getDocumentsMatchingQuery(e,t,n,i){let s=Cn();const r=t.path,o=new re(r.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!r.isPrefixOf(e.path))break;e.path.length>r.length+1||ve(ye(o),n)<=0||(i.has(o.key)||En(t,o))&&(s=s.insert(o.key,o.mutableCopy()))}return Ee.resolve(s)}getAllFromCollectionGroup(e,t,n,i){N(9500)}ri(e,t){return Ee.forEach(this.docs,(e=>t(e)))}newChangeBuffer(e){return new Vs(this)}getSize(e){return Ee.resolve(this.size)}}class Vs extends Ns{constructor(e){super(),this.Or=e}applyChanges(e){const t=[];return this.changes.forEach(((n,i)=>{i.isValidDocument()?t.push(this.Or.addEntry(e,i)):this.Or.removeEntry(n)})),Ee.waitFor(t)}getFromCache(e,t){return this.Or.getEntry(e,t)}getAllFromCache(e,t){return this.Or.getEntries(e,t)}}class Gs{constructor(e){this.persistence=e,this.ii=new xn((e=>cn(e)),un),this.lastRemoteSnapshotVersion=_e.min(),this.highestTargetId=0,this.si=0,this.oi=new Us,this.targetCount=0,this._i=ks.ar()}forEachTarget(e,t){return this.ii.forEach(((e,n)=>t(n))),Ee.resolve()}getLastRemoteSnapshotVersion(e){return Ee.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return Ee.resolve(this.si)}allocateTargetId(e){return this.highestTargetId=this._i.next(),Ee.resolve(this.highestTargetId)}setTargetsMetadata(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.si&&(this.si=t),Ee.resolve()}hr(e){this.ii.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this._i=new ks(t),this.highestTargetId=t),e.sequenceNumber>this.si&&(this.si=e.sequenceNumber)}addTargetData(e,t){return this.hr(t),this.targetCount+=1,Ee.resolve()}updateTargetData(e,t){return this.hr(t),Ee.resolve()}removeTargetData(e,t){return this.ii.delete(t.target),this.oi.zr(t.targetId),this.targetCount-=1,Ee.resolve()}removeTargets(e,t,n){let i=0;const s=[];return this.ii.forEach(((r,o)=>{o.sequenceNumber<=t&&null===n.get(o.targetId)&&(this.ii.delete(r),s.push(this.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Ee.waitFor(s).next((()=>i))}getTargetCount(e){return Ee.resolve(this.targetCount)}getTargetData(e,t){const n=this.ii.get(t)||null;return Ee.resolve(n)}addMatchingKeys(e,t,n){return this.oi.Kr(t,n),Ee.resolve()}removeMatchingKeys(e,t,n){this.oi.Gr(t,n);const i=this.persistence.referenceDelegate,s=[];return i&&t.forEach((t=>{s.push(i.markPotentiallyOrphaned(e,t))})),Ee.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.oi.zr(t),Ee.resolve()}getMatchingKeysForTargetId(e,t){const n=this.oi.Jr(t);return Ee.resolve(n)}containsKey(e,t){return Ee.resolve(this.oi.containsKey(t))}}class Bs{constructor(e,t){this.ai={},this.overlays={},this.ui=new ke(0),this.ci=!1,this.ci=!0,this.li=new Ps,this.referenceDelegate=e(this),this.hi=new Gs(this),this.indexManager=new vs,this.remoteDocumentCache=function(e){return new js(e)}((e=>this.referenceDelegate.Pi(e))),this.serializer=new _s(t),this.Ti=new Rs(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.ci=!1,Promise.resolve()}get started(){return this.ci}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new Ms,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let n=this.ai[e.toKey()];return n||(n=new qs(t,this.referenceDelegate),this.ai[e.toKey()]=n),n}getGlobalsCache(){return this.li}getTargetCache(){return this.hi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ti}runTransaction(e,t,n){T("MemoryPersistence","Starting transaction:",e);const i=new $s(this.ui.next());return this.referenceDelegate.Ii(),n(i).next((e=>this.referenceDelegate.di(i).next((()=>e)))).toPromise().then((e=>(i.raiseOnCommittedEvent(),e)))}Ei(e,t){return Ee.or(Object.values(this.ai).map((n=>()=>n.containsKey(e,t))))}}class $s extends be{constructor(e){super(),this.currentSequenceNumber=e}}class Ks{constructor(e){this.persistence=e,this.Ai=new Us,this.Ri=null}static Vi(e){return new Ks(e)}get mi(){if(this.Ri)return this.Ri;throw N(60996)}addReference(e,t,n){return this.Ai.addReference(n,t),this.mi.delete(n.toString()),Ee.resolve()}removeReference(e,t,n){return this.Ai.removeReference(n,t),this.mi.add(n.toString()),Ee.resolve()}markPotentiallyOrphaned(e,t){return this.mi.add(t.toString()),Ee.resolve()}removeTarget(e,t){this.Ai.zr(t.targetId).forEach((e=>this.mi.add(e.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(e,t.targetId).next((e=>{e.forEach((e=>this.mi.add(e.toString())))})).next((()=>n.removeTargetData(e,t)))}Ii(){this.Ri=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Ee.forEach(this.mi,(n=>{const i=re.fromPath(n);return this.fi(e,i).next((e=>{e||t.removeEntry(i,_e.min())}))})).next((()=>(this.Ri=null,t.apply(e))))}updateLimboDocument(e,t){return this.fi(e,t).next((e=>{e?this.mi.delete(t.toString()):this.mi.add(t.toString())}))}Pi(e){return 0}fi(e,t){return Ee.or([()=>Ee.resolve(this.Ai.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ei(e,t)])}}class Ws{constructor(e,t){this.persistence=e,this.gi=new xn((e=>function(e){let t="";for(let n=0;n<e.length;n++)t.length>0&&(t=Ae(t)),t=Ce(e.get(n),t);return Ae(t)}(e.path)),((e,t)=>e.isEqual(t))),this.garbageCollector=function(e,t){return new Os(e,t)}(this,t)}static Vi(e,t){return new Ws(e,t)}Ii(){}di(e){return Ee.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}mr(e){const t=this.yr(e);return this.persistence.getTargetCache().getTargetCount(e).next((e=>t.next((t=>e+t))))}yr(e){let t=0;return this.gr(e,(e=>{t++})).next((()=>t))}gr(e,t){return Ee.forEach(this.gi,((n,i)=>this.Sr(e,n,i).next((e=>e?Ee.resolve():t(i)))))}removeTargets(e,t,n){return this.persistence.getTargetCache().removeTargets(e,t,n)}removeOrphanedDocuments(e,t){let n=0;const i=this.persistence.getRemoteDocumentCache(),s=i.newChangeBuffer();return i.ri(e,(i=>this.Sr(e,i,t).next((e=>{e||(n++,s.removeEntry(i,_e.min()))})))).next((()=>s.apply(e))).next((()=>n))}markPotentiallyOrphaned(e,t){return this.gi.set(t,e.currentSequenceNumber),Ee.resolve()}removeTarget(e,t){const n=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,n)}addReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),Ee.resolve()}removeReference(e,t,n){return this.gi.set(n,e.currentSequenceNumber),Ee.resolve()}updateLimboDocument(e,t){return this.gi.set(t,e.currentSequenceNumber),Ee.resolve()}Pi(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=xt(e.data.value)),t}Sr(e,t,n){return Ee.or([()=>this.persistence.Ei(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.gi.get(t);return Ee.resolve(void 0!==e&&e>n)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class zs{constructor(e,t,n,i){this.targetId=e,this.fromCache=t,this.Is=n,this.ds=i}static Es(e,t){let n=Un(),i=Un();for(const e of t.docChanges)switch(e.type){case 0:n=n.add(e.doc.key);break;case 1:i=i.add(e.doc.key)}return new zs(e,t.fromCache,n,i)}}class Hs{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class Qs{constructor(){this.As=!1,this.Rs=!1,this.Vs=100,this.fs=(0,l.G6)()?8:function(e){const t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}((0,l.z$)())>0?6:4}initialize(e,t){this.gs=e,this.indexManager=t,this.As=!0}getDocumentsMatchingQuery(e,t,n,i){const s={result:null};return this.ps(e,t).next((e=>{s.result=e})).next((()=>{if(!s.result)return this.ys(e,t,i,n).next((e=>{s.result=e}))})).next((()=>{if(s.result)return;const n=new Hs;return this.ws(e,t,n).next((i=>{if(s.result=i,this.Rs)return this.Ss(e,t,n,i.size)}))})).next((()=>s.result))}Ss(e,t,n,i){return n.documentReadCount<this.Vs?(x()<=a.in.DEBUG&&T("QueryEngine","SDK will not create cache indexes for query:",Sn(t),"since it only creates cache indexes for collection contains","more than or equal to",this.Vs,"documents"),Ee.resolve()):(x()<=a.in.DEBUG&&T("QueryEngine","Query:",Sn(t),"scans",n.documentReadCount,"local documents and returns",i,"documents as results."),n.documentReadCount>this.fs*i?(x()<=a.in.DEBUG&&T("QueryEngine","The SDK decides to create cache indexes for query:",Sn(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,_n(t))):Ee.resolve())}ps(e,t){if(pn(t))return Ee.resolve(null);let n=_n(t);return this.indexManager.getIndexType(e,n).next((i=>0===i?null:(null!==t.limit&&1===i&&(t=wn(t,null,"F"),n=_n(t)),this.indexManager.getDocumentsMatchingTarget(e,n).next((i=>{const s=Un(...i);return this.gs.getDocuments(e,s).next((i=>this.indexManager.getMinOffset(e,n).next((n=>{const r=this.bs(t,i);return this.Ds(t,r,s,n.readTime)?this.ps(e,wn(t,null,"F")):this.vs(e,r,t,n)}))))})))))}ys(e,t,n,i){return pn(t)||i.isEqual(_e.min())?Ee.resolve(null):this.gs.getDocuments(e,n).next((s=>{const r=this.bs(t,s);return this.Ds(t,r,n,i)?Ee.resolve(null):(x()<=a.in.DEBUG&&T("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Sn(t)),this.vs(e,r,t,function(e,t){const n=e.toTimestamp().seconds,i=e.toTimestamp().nanoseconds+1,s=_e.fromTimestamp(1e9===i?new ge(n+1,0):new ge(n,i));return new we(s,re.empty(),t)}(i,-1)).next((e=>e)))}))}bs(e,t){let n=new He(In(e));return t.forEach(((t,i)=>{En(e,i)&&(n=n.add(i))})),n}Ds(e,t,n,i){if(null===e.limit)return!1;if(n.size!==t.size)return!0;const s="F"===e.limitType?t.last():t.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(i)>0)}ws(e,t,n){return x()<=a.in.DEBUG&&T("QueryEngine","Using full collection scan to execute query:",Sn(t)),this.gs.getDocumentsMatchingQuery(e,t,we.min(),n)}vs(e,t,n,i){return this.gs.getDocumentsMatchingQuery(e,n,i).next((e=>(t.forEach((t=>{e=e.insert(t.key,t)})),e)))}}const Js="LocalStore";class Ys{constructor(e,t,n,i){this.persistence=e,this.Cs=t,this.serializer=i,this.Fs=new Ke(Q),this.Ms=new xn((e=>cn(e)),un),this.xs=new Map,this.Os=e.getRemoteDocumentCache(),this.hi=e.getTargetCache(),this.Ti=e.getBundleCache(),this.Ns(n)}Ns(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Ds(this.Os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Os.setIndexManager(this.indexManager),this.Cs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(t=>e.collect(t,this.Fs)))}}async function Xs(e,t){const n=R(e);return await n.persistence.runTransaction("Handle user change","readonly",(e=>{let i;return n.mutationQueue.getAllMutationBatches(e).next((s=>(i=s,n.Ns(t),n.mutationQueue.getAllMutationBatches(e)))).next((t=>{const s=[],r=[];let o=Un();for(const e of i){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){r.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return n.localDocuments.getDocuments(e,o).next((e=>({Bs:e,removedBatchIds:s,addedBatchIds:r})))}))}))}function Zs(e){const t=R(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.hi.getLastRemoteSnapshotVersion(e)))}function er(e,t){const n=R(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(e=>(void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t))))}async function tr(e,t,n){const i=R(e),s=i.Fs.get(t),r=n?"readwrite":"readwrite-primary";try{n||await i.persistence.runTransaction("Release target",r,(e=>i.persistence.referenceDelegate.removeTarget(e,s)))}catch(e){if(!Ie(e))throw e;T(Js,`Failed to update sequence numbers for target ${t}: ${e}`)}i.Fs=i.Fs.remove(t),i.Ms.delete(s.target)}function nr(e,t,n){const i=R(e);let s=_e.min(),r=Un();return i.persistence.runTransaction("Execute query","readwrite",(e=>function(e,t,n){const i=R(e),s=i.Ms.get(n);return void 0!==s?Ee.resolve(i.Fs.get(s)):i.hi.getTargetData(t,n)}(i,e,_n(t)).next((t=>{if(t)return s=t.lastLimboFreeSnapshotVersion,i.hi.getMatchingKeysForTargetId(e,t.targetId).next((e=>{r=e}))})).next((()=>i.Cs.getDocumentsMatchingQuery(e,t,n?s:_e.min(),n?r:Un()))).next((e=>(function(e,t,n){let i=e.xs.get(t)||_e.min();n.forEach(((e,t)=>{t.readTime.compareTo(i)>0&&(i=t.readTime)})),e.xs.set(t,i)}(i,function(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}(t),e),{documents:e,qs:r})))))}class ir{constructor(){this.activeTargetIds=Fn}Gs(e){this.activeTargetIds=this.activeTargetIds.add(e)}zs(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Ws(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class sr{constructor(){this.Fo=new ir,this.Mo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,n){}addLocalQueryTarget(e,t=!0){return t&&this.Fo.Gs(e),this.Mo[e]||"not-current"}updateQueryState(e,t,n){this.Mo[e]=t}removeLocalQueryTarget(e){this.Fo.zs(e)}isLocalQueryTarget(e){return this.Fo.activeTargetIds.has(e)}clearQueryState(e){delete this.Mo[e]}getAllActiveQueryTargets(){return this.Fo.activeTargetIds}isActiveQueryTarget(e){return this.Fo.activeTargetIds.has(e)}start(){return this.Fo=new ir,Promise.resolve()}handleUserChange(e,t,n){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class rr{xo(e){}shutdown(){}}const or="ConnectivityMonitor";class ar{constructor(){this.Oo=()=>this.No(),this.Bo=()=>this.Lo(),this.ko=[],this.qo()}xo(e){this.ko.push(e)}shutdown(){window.removeEventListener("online",this.Oo),window.removeEventListener("offline",this.Bo)}qo(){window.addEventListener("online",this.Oo),window.addEventListener("offline",this.Bo)}No(){T(or,"Network connectivity changed: AVAILABLE");for(const e of this.ko)e(0)}Lo(){T(or,"Network connectivity changed: UNAVAILABLE");for(const e of this.ko)e(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let lr=null;function cr(){return null===lr?lr=268435456+Math.round(2147483648*Math.random()):lr++,"0x"+lr.toString(16)}const ur="RestConnection",dr={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class hr{get Qo(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),i=encodeURIComponent(this.databaseId.database);this.$o=t+"://"+e.host,this.Uo=`projects/${n}/databases/${i}`,this.Ko=this.databaseId.database===dt?`project_id=${n}`:`project_id=${n}&database_id=${i}`}Wo(e,t,n,i,s){const r=cr(),o=this.Go(e,t.toUriEncodedString());T(ur,`Sending RPC '${e}' ${r}:`,o,n);const a={"google-cloud-resource-prefix":this.Uo,"x-goog-request-params":this.Ko};this.zo(a,i,s);const{host:c}=new URL(o),u=(0,l.Xx)(c);return this.jo(e,o,a,n,u).then((t=>(T(ur,`Received RPC '${e}' ${r}: `,t),t)),(t=>{throw A(ur,`RPC '${e}' ${r} failed with error: `,t,"url: ",o,"request:",n),t}))}Jo(e,t,n,i,s,r){return this.Wo(e,t,n,i,s)}zo(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+I,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach(((t,n)=>e[n]=t)),n&&n.headers.forEach(((t,n)=>e[n]=t))}Go(e,t){const n=dr[e];return`${this.$o}/v1/${t}:${n}`}terminate(){}}class mr{constructor(e){this.Ho=e.Ho,this.Yo=e.Yo}Zo(e){this.Xo=e}e_(e){this.t_=e}n_(e){this.r_=e}onMessage(e){this.i_=e}close(){this.Yo()}send(e){this.Ho(e)}s_(){this.Xo()}o_(){this.t_()}__(e){this.r_(e)}a_(e){this.i_(e)}}const pr="WebChannelConnection";class fr extends hr{constructor(e){super(e),this.u_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}jo(e,t,n,i,s){const r=cr();return new Promise(((s,o)=>{const a=new d;a.setWithCredentials(!0),a.listenOnce(m.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case p.NO_ERROR:const t=a.getResponseJson();T(pr,`XHR for RPC '${e}' ${r} received:`,JSON.stringify(t)),s(t);break;case p.TIMEOUT:T(pr,`RPC '${e}' ${r} timed out`),o(new P(M.DEADLINE_EXCEEDED,"Request time out"));break;case p.HTTP_ERROR:const n=a.getStatus();if(T(pr,`RPC '${e}' ${r} failed with status:`,n,"response text:",a.getResponseText()),n>0){let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const t=null==e?void 0:e.error;if(t&&t.status&&t.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(M).indexOf(t)>=0?t:M.UNKNOWN}(t.status);o(new P(e,t.message))}else o(new P(M.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new P(M.UNAVAILABLE,"Connection failed."));break;default:N(9055,{c_:e,streamId:r,l_:a.getLastErrorCode(),h_:a.getLastError()})}}finally{T(pr,`RPC '${e}' ${r} completed.`)}}));const l=JSON.stringify(i);T(pr,`RPC '${e}' ${r} sending request:`,i),a.send(t,"POST",l,n,15)}))}P_(e,t,n){const i=cr(),s=[this.$o,"/","google.firestore.v1.Firestore","/",e,"/channel"],r=y(),o=_(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.zo(a.initMessageHeaders,t,n),a.encodeInitMessageHeaders=!0;const c=s.join("");T(pr,`Creating RPC '${e}' stream ${i}: ${c}`,a);const u=r.createWebChannel(c,a);this.T_(u);let d=!1,m=!1;const p=new mr({Ho:t=>{m?T(pr,`Not sending because RPC '${e}' stream ${i} is closed:`,t):(d||(T(pr,`Opening RPC '${e}' stream ${i} transport.`),u.open(),d=!0),T(pr,`RPC '${e}' stream ${i} sending:`,t),u.send(t))},Yo:()=>u.close()}),w=(e,t,n)=>{e.listen(t,(e=>{try{n(e)}catch(e){setTimeout((()=>{throw e}),0)}}))};return w(u,h.EventType.OPEN,(()=>{m||(T(pr,`RPC '${e}' stream ${i} transport opened.`),p.s_())})),w(u,h.EventType.CLOSE,(()=>{m||(m=!0,T(pr,`RPC '${e}' stream ${i} transport closed`),p.__(),this.I_(u))})),w(u,h.EventType.ERROR,(t=>{m||(m=!0,A(pr,`RPC '${e}' stream ${i} transport errored. Name:`,t.name,"Message:",t.message),p.__(new P(M.UNAVAILABLE,"The operation could not be completed")))})),w(u,h.EventType.MESSAGE,(t=>{var n;if(!m){const s=t.data[0];D(!!s,16349);const r=s,o=(null==r?void 0:r.error)||(null===(n=r[0])||void 0===n?void 0:n.error);if(o){T(pr,`RPC '${e}' stream ${i} received error:`,o);const t=o.status;let n=function(e){const t=bi[e];if(void 0!==t)return Ii(t)}(t),s=o.message;void 0===n&&(n=M.INTERNAL,s="Unknown error status: "+t+" with message "+o.message),m=!0,p.__(new P(n,s)),u.close()}else T(pr,`RPC '${e}' stream ${i} received:`,s),p.a_(s)}})),w(o,g.STAT_EVENT,(t=>{t.stat===f.PROXY?T(pr,`RPC '${e}' stream ${i} detected buffering proxy`):t.stat===f.NOPROXY&&T(pr,`RPC '${e}' stream ${i} detected no buffering proxy`)})),setTimeout((()=>{p.o_()}),0),p}terminate(){this.u_.forEach((e=>e.close())),this.u_=[]}T_(e){this.u_.push(e)}I_(e){this.u_=this.u_.filter((t=>t===e))}}function gr(){return"undefined"!=typeof document?document:null}function _r(e){return new Gi(e,!0)}class yr{constructor(e,t,n=1e3,i=1.5,s=6e4){this.Fi=e,this.timerId=t,this.d_=n,this.E_=i,this.A_=s,this.R_=0,this.V_=null,this.m_=Date.now(),this.reset()}reset(){this.R_=0}f_(){this.R_=this.A_}g_(e){this.cancel();const t=Math.floor(this.R_+this.p_()),n=Math.max(0,Date.now()-this.m_),i=Math.max(0,t-n);i>0&&T("ExponentialBackoff",`Backing off for ${i} ms (base delay: ${this.R_} ms, delay with jitter: ${t} ms, last attempt: ${n} ms ago)`),this.V_=this.Fi.enqueueAfterDelay(this.timerId,i,(()=>(this.m_=Date.now(),e()))),this.R_*=this.E_,this.R_<this.d_&&(this.R_=this.d_),this.R_>this.A_&&(this.R_=this.A_)}y_(){null!==this.V_&&(this.V_.skipDelay(),this.V_=null)}cancel(){null!==this.V_&&(this.V_.cancel(),this.V_=null)}p_(){return(Math.random()-.5)*this.R_}}const wr="PersistentStream";class vr{constructor(e,t,n,i,s,r,o,a){this.Fi=e,this.w_=n,this.S_=i,this.connection=s,this.authCredentialsProvider=r,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.b_=0,this.D_=null,this.v_=null,this.stream=null,this.C_=0,this.F_=new yr(e,t)}M_(){return 1===this.state||5===this.state||this.x_()}x_(){return 2===this.state||3===this.state}start(){this.C_=0,4!==this.state?this.auth():this.O_()}async stop(){this.M_()&&await this.close(0)}N_(){this.state=0,this.F_.reset()}B_(){this.x_()&&null===this.D_&&(this.D_=this.Fi.enqueueAfterDelay(this.w_,6e4,(()=>this.L_())))}k_(e){this.q_(),this.stream.send(e)}async L_(){if(this.x_())return this.close(0)}q_(){this.D_&&(this.D_.cancel(),this.D_=null)}Q_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.q_(),this.Q_(),this.F_.cancel(),this.b_++,4!==e?this.F_.reset():t&&t.code===M.RESOURCE_EXHAUSTED?(C(t.toString()),C("Using maximum backoff delay to prevent overloading the backend."),this.F_.f_()):t&&t.code===M.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.U_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.n_(t)}U_(){}auth(){this.state=1;const e=this.K_(this.b_),t=this.b_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([e,n])=>{this.b_===t&&this.W_(e,n)}),(t=>{e((()=>{const e=new P(M.UNKNOWN,"Fetching auth token failed: "+t.message);return this.G_(e)}))}))}W_(e,t){const n=this.K_(this.b_);this.stream=this.z_(e,t),this.stream.Zo((()=>{n((()=>this.listener.Zo()))})),this.stream.e_((()=>{n((()=>(this.state=2,this.v_=this.Fi.enqueueAfterDelay(this.S_,1e4,(()=>(this.x_()&&(this.state=3),Promise.resolve()))),this.listener.e_())))})),this.stream.n_((e=>{n((()=>this.G_(e)))})),this.stream.onMessage((e=>{n((()=>1==++this.C_?this.j_(e):this.onNext(e)))}))}O_(){this.state=5,this.F_.g_((async()=>{this.state=0,this.start()}))}G_(e){return T(wr,`close with error: ${e}`),this.stream=null,this.close(4,e)}K_(e){return t=>{this.Fi.enqueueAndForget((()=>this.b_===e?t():(T(wr,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class br extends vr{constructor(e,t,n,i,s,r){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}z_(e,t){return this.connection.P_("Listen",e,t)}j_(e){return this.onNext(e)}onNext(e){this.F_.reset();const t=function(e,t){let n;if("targetChange"in t){t.targetChange;const i=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:N(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=function(e,t){return e.useProto3Json?(D(void 0===t||"string"==typeof t,58123),Xe.fromBase64String(t||"")):(D(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),Xe.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?M.UNKNOWN:Ii(e.code);return new P(t,e.message||"")}(o);n=new Ri(i,s,r,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=Xi(e,i.document.name),r=zi(i.document.updateTime),o=i.document.createTime?zi(i.document.createTime):_e.min(),a=new Pt({mapValue:{fields:i.document.fields}}),l=Ft.newFoundDocument(s,r,o,a),c=i.targetIds||[],u=i.removedTargetIds||[];n=new Li(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=Xi(e,i.document),r=i.readTime?zi(i.readTime):_e.min(),o=Ft.newNoDocument(s,r),a=i.removedTargetIds||[];n=new Li([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=Xi(e,i.document),r=i.removedTargetIds||[];n=new Li([],r,s,null)}else{if(!("filter"in t))return N(11601,{At:t});{t.filter;const e=t.filter;e.targetId;const{count:i=0,unchangedNames:s}=e,r=new vi(i,s),o=e.targetId;n=new Di(o,r)}}return n}(this.serializer,e),n=function(e){if(!("targetChange"in e))return _e.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?_e.min():t.readTime?zi(t.readTime):_e.min()}(e);return this.listener.J_(t,n)}H_(e){const t={};t.database=es(this.serializer),t.addTarget=function(e,t){let n;const i=t.target;if(n=dn(i)?{documents:ss(e,i)}:{query:rs(e,i).Vt},n.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){n.resumeToken=Ki(e,t.resumeToken);const i=Bi(e,t.expectedCount);null!==i&&(n.expectedCount=i)}else if(t.snapshotVersion.compareTo(_e.min())>0){n.readTime=$i(e,t.snapshotVersion.toTimestamp());const i=Bi(e,t.expectedCount);null!==i&&(n.expectedCount=i)}return n}(this.serializer,e);const n=function(e,t){const n=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return N(28987,{purpose:e})}}(t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,e);n&&(t.labels=n),this.k_(t)}Y_(e){const t={};t.database=es(this.serializer),t.removeTarget=e,this.k_(t)}}class Sr extends vr{constructor(e,t,n,i,s,r){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,n,i,r),this.serializer=s}get Z_(){return this.C_>0}start(){this.lastStreamToken=void 0,super.start()}U_(){this.Z_&&this.X_([])}z_(e,t){return this.connection.P_("Write",e,t)}j_(e){return D(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,D(!e.writeResults||0===e.writeResults.length,55816),this.listener.ea()}onNext(e){D(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.F_.reset();const t=function(e,t){return e&&e.length>0?(D(void 0!==t,14353),e.map((e=>function(e,t){let n=e.updateTime?zi(e.updateTime):zi(t);return n.isEqual(_e.min())&&(n=zi(t)),new ti(n,e.transformResults||[])}(e,t)))):[]}(e.writeResults,e.commitTime),n=zi(e.commitTime);return this.listener.ta(n,t)}na(){const e={};e.database=es(this.serializer),this.k_(e)}X_(e){const t={streamToken:this.lastStreamToken,writes:e.map((e=>is(this.serializer,e)))};this.k_(t)}}class Er{}class Ir extends Er{constructor(e,t,n,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=n,this.serializer=i,this.ra=!1}ia(){if(this.ra)throw new P(M.FAILED_PRECONDITION,"The client has already been terminated.")}Wo(e,t,n,i){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,r])=>this.connection.Wo(e,Qi(t,n),i,s,r))).catch((e=>{throw"FirebaseError"===e.name?(e.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new P(M.UNKNOWN,e.toString())}))}Jo(e,t,n,i,s){return this.ia(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Jo(e,Qi(t,n),i,r,o,s))).catch((e=>{throw"FirebaseError"===e.name?(e.code===M.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new P(M.UNKNOWN,e.toString())}))}terminate(){this.ra=!0,this.connection.terminate()}}class kr{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.sa=0,this.oa=null,this._a=!0}aa(){0===this.sa&&(this.ua("Unknown"),this.oa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.oa=null,this.ca("Backend didn't respond within 10 seconds."),this.ua("Offline"),Promise.resolve()))))}la(e){"Online"===this.state?this.ua("Unknown"):(this.sa++,this.sa>=1&&(this.ha(),this.ca(`Connection failed 1 times. Most recent error: ${e.toString()}`),this.ua("Offline")))}set(e){this.ha(),this.sa=0,"Online"===e&&(this._a=!1),this.ua(e)}ua(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}ca(e){const t=`Could not reach Cloud Firestore backend. ${e}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this._a?(C(t),this._a=!1):T("OnlineStateTracker",t)}ha(){null!==this.oa&&(this.oa.cancel(),this.oa=null)}}const xr="RemoteStore";class Tr{constructor(e,t,n,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=n,this.remoteSyncer={},this.Pa=[],this.Ta=new Map,this.Ia=new Set,this.da=[],this.Ea=s,this.Ea.xo((e=>{n.enqueueAndForget((async()=>{Pr(this)&&(T(xr,"Restarting streams for network reachability change."),await async function(e){const t=R(e);t.Ia.add(4),await Ar(t),t.Aa.set("Unknown"),t.Ia.delete(4),await Cr(t)}(this))}))})),this.Aa=new kr(n,i)}}async function Cr(e){if(Pr(e))for(const t of e.da)await t(!0)}async function Ar(e){for(const t of e.da)await t(!1)}function Or(e,t){const n=R(e);n.Ta.has(t.targetId)||(n.Ta.set(t.targetId,t),Mr(n)?Rr(n):eo(n).x_()&&Lr(n,t))}function Nr(e,t){const n=R(e),i=eo(n);n.Ta.delete(t),i.x_()&&Dr(n,t),0===n.Ta.size&&(i.x_()?i.B_():Pr(n)&&n.Aa.set("Unknown"))}function Lr(e,t){if(e.Ra.$e(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(_e.min())>0){const n=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(n)}eo(e).H_(t)}function Dr(e,t){e.Ra.$e(t),eo(e).Y_(t)}function Rr(e){e.Ra=new Pi({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),Et:t=>e.Ta.get(t)||null,lt:()=>e.datastore.serializer.databaseId}),eo(e).start(),e.Aa.aa()}function Mr(e){return Pr(e)&&!eo(e).M_()&&e.Ta.size>0}function Pr(e){return 0===R(e).Ia.size}function Ur(e){e.Ra=void 0}async function Fr(e){e.Aa.set("Online")}async function qr(e){e.Ta.forEach(((t,n)=>{Lr(e,t)}))}async function jr(e,t){Ur(e),Mr(e)?(e.Aa.la(t),Rr(e)):e.Aa.set("Unknown")}async function Vr(e,t,n){if(e.Aa.set("Online"),t instanceof Ri&&2===t.state&&t.cause)try{await async function(e,t){const n=t.cause;for(const i of t.targetIds)e.Ta.has(i)&&(await e.remoteSyncer.rejectListen(i,n),e.Ta.delete(i),e.Ra.removeTarget(i))}(e,t)}catch(n){T(xr,"Failed to remove targets %s: %s ",t.targetIds.join(","),n),await Gr(e,n)}else if(t instanceof Li?e.Ra.Ye(t):t instanceof Di?e.Ra.it(t):e.Ra.et(t),!n.isEqual(_e.min()))try{const t=await Zs(e.localStore);n.compareTo(t)>=0&&await function(e,t){const n=e.Ra.Pt(t);return n.targetChanges.forEach(((n,i)=>{if(n.resumeToken.approximateByteSize()>0){const s=e.Ta.get(i);s&&e.Ta.set(i,s.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach(((t,n)=>{const i=e.Ta.get(t);if(!i)return;e.Ta.set(t,i.withResumeToken(Xe.EMPTY_BYTE_STRING,i.snapshotVersion)),Dr(e,t);const s=new gs(i.target,t,n,i.sequenceNumber);Lr(e,s)})),e.remoteSyncer.applyRemoteEvent(n)}(e,n)}catch(t){T(xr,"Failed to raise snapshot:",t),await Gr(e,t)}}async function Gr(e,t,n){if(!Ie(t))throw t;e.Ia.add(1),await Ar(e),e.Aa.set("Offline"),n||(n=()=>Zs(e.localStore)),e.asyncQueue.enqueueRetryable((async()=>{T(xr,"Retrying IndexedDB access"),await n(),e.Ia.delete(1),await Cr(e)}))}function Br(e,t){return t().catch((n=>Gr(e,n,t)))}async function $r(e){const t=R(e),n=to(t);let i=t.Pa.length>0?t.Pa[t.Pa.length-1].batchId:-1;for(;Kr(t);)try{const e=await er(t.localStore,i);if(null===e){0===t.Pa.length&&n.B_();break}i=e.batchId,Wr(t,e)}catch(e){await Gr(t,e)}zr(t)&&Hr(t)}function Kr(e){return Pr(e)&&e.Pa.length<10}function Wr(e,t){e.Pa.push(t);const n=to(e);n.x_()&&n.Z_&&n.X_(t.mutations)}function zr(e){return Pr(e)&&!to(e).M_()&&e.Pa.length>0}function Hr(e){to(e).start()}async function Qr(e){to(e).na()}async function Jr(e){const t=to(e);for(const n of e.Pa)t.X_(n.mutations)}async function Yr(e,t,n){const i=e.Pa.shift(),s=yi.from(i,t,n);await Br(e,(()=>e.remoteSyncer.applySuccessfulWrite(s))),await $r(e)}async function Xr(e,t){t&&to(e).Z_&&await async function(e,t){if(function(e){return Ei(e)&&e!==M.ABORTED}(t.code)){const n=e.Pa.shift();to(e).N_(),await Br(e,(()=>e.remoteSyncer.rejectFailedWrite(n.batchId,t))),await $r(e)}}(e,t),zr(e)&&Hr(e)}async function Zr(e,t){const n=R(e);n.asyncQueue.verifyOperationInProgress(),T(xr,"RemoteStore received new credentials");const i=Pr(n);n.Ia.add(3),await Ar(n),i&&n.Aa.set("Unknown"),await n.remoteSyncer.handleCredentialChange(t),n.Ia.delete(3),await Cr(n)}function eo(e){return e.Va||(e.Va=function(e,t,n){const i=R(e);return i.ia(),new br(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Zo:Fr.bind(null,e),e_:qr.bind(null,e),n_:jr.bind(null,e),J_:Vr.bind(null,e)}),e.da.push((async t=>{t?(e.Va.N_(),Mr(e)?Rr(e):e.Aa.set("Unknown")):(await e.Va.stop(),Ur(e))}))),e.Va}function to(e){return e.ma||(e.ma=function(e,t,n){const i=R(e);return i.ia(),new Sr(t,i.connection,i.authCredentials,i.appCheckCredentials,i.serializer,n)}(e.datastore,e.asyncQueue,{Zo:()=>Promise.resolve(),e_:Qr.bind(null,e),n_:Xr.bind(null,e),ea:Jr.bind(null,e),ta:Yr.bind(null,e)}),e.da.push((async t=>{t?(e.ma.N_(),await $r(e)):(await e.ma.stop(),e.Pa.length>0&&(T(xr,`Stopping write stream with ${e.Pa.length} pending writes`),e.Pa=[]))}))),e.ma}class no{constructor(e,t,n,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=n,this.op=i,this.removalCallback=s,this.deferred=new U,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((e=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(e,t,n,i,s){const r=Date.now()+n,o=new no(e,t,r,i,s);return o.start(n),o}start(e){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new P(M.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((e=>this.deferred.resolve(e)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function io(e,t){if(C("AsyncQueue",`${t}: ${e}`),Ie(e))return new P(M.UNAVAILABLE,`${t}: ${e}`);throw e}class so{static emptySet(e){return new so(e.comparator)}constructor(e){this.comparator=e?(t,n)=>e(t,n)||re.comparator(t.key,n.key):(e,t)=>re.comparator(e.key,t.key),this.keyedMap=On(),this.sortedSet=new Ke(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal(((t,n)=>(e(t),!1)))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof so))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),n=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,i=n.getNext().key;if(!e.isEqual(i))return!1}return!0}toString(){const e=[];return this.forEach((t=>{e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const n=new so;return n.comparator=this.comparator,n.keyedMap=e,n.sortedSet=t,n}}class ro{constructor(){this.fa=new Ke(re.comparator)}track(e){const t=e.doc.key,n=this.fa.get(t);n?0!==e.type&&3===n.type?this.fa=this.fa.insert(t,e):3===e.type&&1!==n.type?this.fa=this.fa.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.fa=this.fa.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.fa=this.fa.remove(t):1===e.type&&2===n.type?this.fa=this.fa.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.fa=this.fa.insert(t,{type:2,doc:e.doc}):N(63341,{At:e,ga:n}):this.fa=this.fa.insert(t,e)}pa(){const e=[];return this.fa.inorderTraversal(((t,n)=>{e.push(n)})),e}}class oo{constructor(e,t,n,i,s,r,o,a,l){this.query=e,this.docs=t,this.oldDocs=n,this.docChanges=i,this.mutatedKeys=s,this.fromCache=r,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,n,i,s){const r=[];return t.forEach((e=>{r.push({type:0,doc:e})})),new oo(e,t,so.emptySet(t),r,n,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&vn(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(let e=0;e<t.length;e++)if(t[e].type!==n[e].type||!t[e].doc.isEqual(n[e].doc))return!1;return!0}}class ao{constructor(){this.ya=void 0,this.wa=[]}Sa(){return this.wa.some((e=>e.ba()))}}class lo{constructor(){this.queries=co(),this.onlineState="Unknown",this.Da=new Set}terminate(){!function(e,t){const n=R(e),i=n.queries;n.queries=co(),i.forEach(((e,n)=>{for(const e of n.wa)e.onError(t)}))}(this,new P(M.ABORTED,"Firestore shutting down"))}}function co(){return new xn((e=>bn(e)),vn)}async function uo(e,t){const n=R(e);let i=3;const s=t.query;let r=n.queries.get(s);r?!r.Sa()&&t.ba()&&(i=2):(r=new ao,i=t.ba()?0:1);try{switch(i){case 0:r.ya=await n.onListen(s,!0);break;case 1:r.ya=await n.onListen(s,!1);break;case 2:await n.onFirstRemoteStoreListen(s)}}catch(e){const n=io(e,`Initialization of query '${Sn(t.query)}' failed`);return void t.onError(n)}n.queries.set(s,r),r.wa.push(t),t.va(n.onlineState),r.ya&&t.Ca(r.ya)&&fo(n)}async function ho(e,t){const n=R(e),i=t.query;let s=3;const r=n.queries.get(i);if(r){const e=r.wa.indexOf(t);e>=0&&(r.wa.splice(e,1),0===r.wa.length?s=t.ba()?0:1:!r.Sa()&&t.ba()&&(s=2))}switch(s){case 0:return n.queries.delete(i),n.onUnlisten(i,!0);case 1:return n.queries.delete(i),n.onUnlisten(i,!1);case 2:return n.onLastRemoteStoreUnlisten(i);default:return}}function mo(e,t){const n=R(e);let i=!1;for(const e of t){const t=e.query,s=n.queries.get(t);if(s){for(const t of s.wa)t.Ca(e)&&(i=!0);s.ya=e}}i&&fo(n)}function po(e,t,n){const i=R(e),s=i.queries.get(t);if(s)for(const e of s.wa)e.onError(n);i.queries.delete(t)}function fo(e){e.Da.forEach((e=>{e.next()}))}var go,_o;(_o=go||(go={})).Fa="default",_o.Cache="cache";class yo{constructor(e,t,n){this.query=e,this.Ma=t,this.xa=!1,this.Oa=null,this.onlineState="Unknown",this.options=n||{}}Ca(e){if(!this.options.includeMetadataChanges){const t=[];for(const n of e.docChanges)3!==n.type&&t.push(n);e=new oo(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.xa?this.Na(e)&&(this.Ma.next(e),t=!0):this.Ba(e,this.onlineState)&&(this.La(e),t=!0),this.Oa=e,t}onError(e){this.Ma.error(e)}va(e){this.onlineState=e;let t=!1;return this.Oa&&!this.xa&&this.Ba(this.Oa,e)&&(this.La(this.Oa),t=!0),t}Ba(e,t){if(!e.fromCache)return!0;if(!this.ba())return!0;const n="Offline"!==t;return(!this.options.ka||!n)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Na(e){if(e.docChanges.length>0)return!0;const t=this.Oa&&this.Oa.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}La(e){e=oo.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.xa=!0,this.Ma.next(e)}ba(){return this.options.source!==go.Cache}}class wo{constructor(e){this.key=e}}class vo{constructor(e){this.key=e}}class bo{constructor(e,t){this.query=e,this.Ha=t,this.Ya=null,this.hasCachedResults=!1,this.current=!1,this.Za=Un(),this.mutatedKeys=Un(),this.Xa=In(e),this.eu=new so(this.Xa)}get tu(){return this.Ha}nu(e,t){const n=t?t.ru:new ro,i=t?t.eu:this.eu;let s=t?t.mutatedKeys:this.mutatedKeys,r=i,o=!1;const a="F"===this.query.limitType&&i.size===this.query.limit?i.last():null,l="L"===this.query.limitType&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal(((e,t)=>{const c=i.get(e),u=En(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let m=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(n.track({type:3,doc:u}),m=!0):this.iu(c,u)||(n.track({type:2,doc:u}),m=!0,(a&&this.Xa(u,a)>0||l&&this.Xa(u,l)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),m=!0):c&&!u&&(n.track({type:1,doc:c}),m=!0,(a||l)&&(o=!0)),m&&(u?(r=r.add(u),s=h?s.add(e):s.delete(e)):(r=r.delete(e),s=s.delete(e)))})),null!==this.query.limit)for(;r.size>this.query.limit;){const e="F"===this.query.limitType?r.last():r.first();r=r.delete(e.key),s=s.delete(e.key),n.track({type:1,doc:e})}return{eu:r,ru:n,Ds:o,mutatedKeys:s}}iu(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,n,i){const s=this.eu;this.eu=e.eu,this.mutatedKeys=e.mutatedKeys;const r=e.ru.pa();r.sort(((e,t)=>function(e,t){const n=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return N(20277,{At:e})}};return n(e)-n(t)}(e.type,t.type)||this.Xa(e.doc,t.doc))),this.su(n),i=null!=i&&i;const o=t&&!i?this.ou():[],a=0===this.Za.size&&this.current&&!i?1:0,l=a!==this.Ya;return this.Ya=a,0!==r.length||l?{snapshot:new oo(this.query,e.eu,s,r,e.mutatedKeys,0===a,l,!1,!!n&&n.resumeToken.approximateByteSize()>0),_u:o}:{_u:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({eu:this.eu,ru:new ro,mutatedKeys:this.mutatedKeys,Ds:!1},!1)):{_u:[]}}au(e){return!this.Ha.has(e)&&!!this.eu.has(e)&&!this.eu.get(e).hasLocalMutations}su(e){e&&(e.addedDocuments.forEach((e=>this.Ha=this.Ha.add(e))),e.modifiedDocuments.forEach((e=>{})),e.removedDocuments.forEach((e=>this.Ha=this.Ha.delete(e))),this.current=e.current)}ou(){if(!this.current)return[];const e=this.Za;this.Za=Un(),this.eu.forEach((e=>{this.au(e.key)&&(this.Za=this.Za.add(e.key))}));const t=[];return e.forEach((e=>{this.Za.has(e)||t.push(new vo(e))})),this.Za.forEach((n=>{e.has(n)||t.push(new wo(n))})),t}uu(e){this.Ha=e.qs,this.Za=Un();const t=this.nu(e.documents);return this.applyChanges(t,!0)}cu(){return oo.fromInitialDocuments(this.query,this.eu,this.mutatedKeys,0===this.Ya,this.hasCachedResults)}}const So="SyncEngine";class Eo{constructor(e,t,n){this.query=e,this.targetId=t,this.view=n}}class Io{constructor(e){this.key=e,this.lu=!1}}class ko{constructor(e,t,n,i,s,r){this.localStore=e,this.remoteStore=t,this.eventManager=n,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=r,this.hu={},this.Pu=new xn((e=>bn(e)),vn),this.Tu=new Map,this.Iu=new Set,this.du=new Ke(re.comparator),this.Eu=new Map,this.Au=new Us,this.Ru={},this.Vu=new Map,this.mu=ks.ur(),this.onlineState="Unknown",this.fu=void 0}get isPrimaryClient(){return!0===this.fu}}async function xo(e,t,n=!0){const i=Wo(e);let s;const r=i.Pu.get(t);return r?(i.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.cu()):s=await Co(i,t,n,!0),s}async function To(e,t){const n=Wo(e);await Co(n,t,!0,!1)}async function Co(e,t,n,i){const s=await function(e,t){const n=R(e);return n.persistence.runTransaction("Allocate target","readwrite",(e=>{let i;return n.hi.getTargetData(e,t).next((s=>s?(i=s,Ee.resolve(i)):n.hi.allocateTargetId(e).next((s=>(i=new gs(t,s,"TargetPurposeListen",e.currentSequenceNumber),n.hi.addTargetData(e,i).next((()=>i)))))))})).then((e=>{const i=n.Fs.get(e.targetId);return(null===i||e.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(n.Fs=n.Fs.insert(e.targetId,e),n.Ms.set(t,e.targetId)),e}))}(e.localStore,_n(t)),r=s.targetId,o=e.sharedClientState.addLocalQueryTarget(r,n);let a;return i&&(a=await async function(e,t,n,i,s){e.gu=(t,n,i)=>async function(e,t,n,i){let s=t.view.nu(n);s.Ds&&(s=await nr(e.localStore,t.query,!1).then((({documents:e})=>t.view.nu(e,s))));const r=i&&i.targetChanges.get(t.targetId),o=i&&null!=i.targetMismatches.get(t.targetId),a=t.view.applyChanges(s,e.isPrimaryClient,r,o);return jo(e,t.targetId,a._u),a.snapshot}(e,t,n,i);const r=await nr(e.localStore,t,!0),o=new bo(t,r.qs),a=o.nu(r.documents),l=Ni.createSynthesizedTargetChangeForCurrentChange(n,i&&"Offline"!==e.onlineState,s),c=o.applyChanges(a,e.isPrimaryClient,l);jo(e,n,c._u);const u=new Eo(t,n,o);return e.Pu.set(t,u),e.Tu.has(n)?e.Tu.get(n).push(t):e.Tu.set(n,[t]),c.snapshot}(e,t,r,"current"===o,s.resumeToken)),e.isPrimaryClient&&n&&Or(e.remoteStore,s),a}async function Ao(e,t,n){const i=R(e),s=i.Pu.get(t),r=i.Tu.get(s.targetId);if(r.length>1)return i.Tu.set(s.targetId,r.filter((e=>!vn(e,t)))),void i.Pu.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await tr(i.localStore,s.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(s.targetId),n&&Nr(i.remoteStore,s.targetId),Fo(i,s.targetId)})).catch(Se)):(Fo(i,s.targetId),await tr(i.localStore,s.targetId,!0))}async function Oo(e,t){const n=R(e),i=n.Pu.get(t),s=n.Tu.get(i.targetId);n.isPrimaryClient&&1===s.length&&(n.sharedClientState.removeLocalQueryTarget(i.targetId),Nr(n.remoteStore,i.targetId))}async function No(e,t){const n=R(e);try{const e=await function(e,t){const n=R(e),i=t.snapshotVersion;let s=n.Fs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(e=>{const r=n.Os.newChangeBuffer({trackRemovals:!0});s=n.Fs;const o=[];t.targetChanges.forEach(((r,a)=>{const l=s.get(a);if(!l)return;o.push(n.hi.removeMatchingKeys(e,r.removedDocuments,a).next((()=>n.hi.addMatchingKeys(e,r.addedDocuments,a))));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(Xe.EMPTY_BYTE_STRING,_e.min()).withLastLimboFreeSnapshotVersion(_e.min()):r.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(r.resumeToken,i)),s=s.insert(a,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(l,c,r)&&o.push(n.hi.updateTargetData(e,c))}));let a=Cn(),l=Un();if(t.documentUpdates.forEach((i=>{t.resolvedLimboDocuments.has(i)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,i))})),o.push(function(e,t,n){let i=Un(),s=Un();return n.forEach((e=>i=i.add(e))),t.getEntries(e,i).next((e=>{let i=Cn();return n.forEach(((n,r)=>{const o=e.get(n);r.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),r.isNoDocument()&&r.version.isEqual(_e.min())?(t.removeEntry(n,r.readTime),i=i.insert(n,r)):!o.isValidDocument()||r.version.compareTo(o.version)>0||0===r.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(r),i=i.insert(n,r)):T(Js,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",r.version)})),{Ls:i,ks:s}}))}(e,r,t.documentUpdates).next((e=>{a=e.Ls,l=e.ks}))),!i.isEqual(_e.min())){const t=n.hi.getLastRemoteSnapshotVersion(e).next((t=>n.hi.setTargetsMetadata(e,e.currentSequenceNumber,i)));o.push(t)}return Ee.waitFor(o).next((()=>r.apply(e))).next((()=>n.localDocuments.getLocalViewOfDocuments(e,a,l))).next((()=>a))})).then((e=>(n.Fs=s,e)))}(n.localStore,t);t.targetChanges.forEach(((e,t)=>{const i=n.Eu.get(t);i&&(D(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?i.lu=!0:e.modifiedDocuments.size>0?D(i.lu,14607):e.removedDocuments.size>0&&(D(i.lu,42227),i.lu=!1))})),await Bo(n,e,t)}catch(e){await Se(e)}}function Lo(e,t,n){const i=R(e);if(i.isPrimaryClient&&0===n||!i.isPrimaryClient&&1===n){const e=[];i.Pu.forEach(((n,i)=>{const s=i.view.va(t);s.snapshot&&e.push(s.snapshot)})),function(e,t){const n=R(e);n.onlineState=t;let i=!1;n.queries.forEach(((e,n)=>{for(const e of n.wa)e.va(t)&&(i=!0)})),i&&fo(n)}(i.eventManager,t),e.length&&i.hu.J_(e),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function Do(e,t,n){const i=R(e);i.sharedClientState.updateQueryState(t,"rejected",n);const s=i.Eu.get(t),r=s&&s.key;if(r){let e=new Ke(re.comparator);e=e.insert(r,Ft.newNoDocument(r,_e.min()));const n=Un().add(r),s=new Oi(_e.min(),new Map,new Ke(Q),e,n);await No(i,s),i.du=i.du.remove(r),i.Eu.delete(t),Go(i)}else await tr(i.localStore,t,!1).then((()=>Fo(i,t,n))).catch(Se)}async function Ro(e,t){const n=R(e),i=t.batch.batchId;try{const e=await function(e,t){const n=R(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(e=>{const i=t.batch.keys(),s=n.Os.newChangeBuffer({trackRemovals:!0});return function(e,t,n,i){const s=n.batch,r=s.keys();let o=Ee.resolve();return r.forEach((e=>{o=o.next((()=>i.getEntry(t,e))).next((t=>{const r=n.docVersions.get(e);D(null!==r,48541),t.version.compareTo(r)<0&&(s.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),i.addEntry(t)))}))})),o.next((()=>e.mutationQueue.removeMutationBatch(t,s)))}(n,e,t,s).next((()=>s.apply(e))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=Un();for(let n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t)))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(n.localStore,t);Uo(n,i,null),Po(n,i),n.sharedClientState.updateMutationState(i,"acknowledged"),await Bo(n,e)}catch(e){await Se(e)}}async function Mo(e,t,n){const i=R(e);try{const e=await function(e,t){const n=R(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(e=>{let i;return n.mutationQueue.lookupMutationBatch(e,t).next((t=>(D(null!==t,37113),i=t.keys(),n.mutationQueue.removeMutationBatch(e,t)))).next((()=>n.mutationQueue.performConsistencyCheck(e))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(e,i,t))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,i))).next((()=>n.localDocuments.getDocuments(e,i)))}))}(i.localStore,t);Uo(i,t,n),Po(i,t),i.sharedClientState.updateMutationState(t,"rejected",n),await Bo(i,e)}catch(n){await Se(n)}}function Po(e,t){(e.Vu.get(t)||[]).forEach((e=>{e.resolve()})),e.Vu.delete(t)}function Uo(e,t,n){const i=R(e);let s=i.Ru[i.currentUser.toKey()];if(s){const e=s.get(t);e&&(n?e.reject(n):e.resolve(),s=s.remove(t)),i.Ru[i.currentUser.toKey()]=s}}function Fo(e,t,n=null){e.sharedClientState.removeLocalQueryTarget(t);for(const i of e.Tu.get(t))e.Pu.delete(i),n&&e.hu.pu(i,n);e.Tu.delete(t),e.isPrimaryClient&&e.Au.zr(t).forEach((t=>{e.Au.containsKey(t)||qo(e,t)}))}function qo(e,t){e.Iu.delete(t.path.canonicalString());const n=e.du.get(t);null!==n&&(Nr(e.remoteStore,n),e.du=e.du.remove(t),e.Eu.delete(n),Go(e))}function jo(e,t,n){for(const i of n)i instanceof wo?(e.Au.addReference(i.key,t),Vo(e,i)):i instanceof vo?(T(So,"Document no longer in limbo: "+i.key),e.Au.removeReference(i.key,t),e.Au.containsKey(i.key)||qo(e,i.key)):N(19791,{yu:i})}function Vo(e,t){const n=t.key,i=n.path.canonicalString();e.du.get(n)||e.Iu.has(i)||(T(So,"New document in limbo: "+n),e.Iu.add(i),Go(e))}function Go(e){for(;e.Iu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Iu.values().next().value;e.Iu.delete(t);const n=new re(ne.fromString(t)),i=e.mu.next();e.Eu.set(i,new Io(n)),e.du=e.du.insert(n,i),Or(e.remoteStore,new gs(_n(mn(n.path)),i,"TargetPurposeLimboResolution",ke.ue))}}async function Bo(e,t,n){const i=R(e),s=[],r=[],o=[];i.Pu.isEmpty()||(i.Pu.forEach(((e,a)=>{o.push(i.gu(a,t,n).then((e=>{var t;if((e||n)&&i.isPrimaryClient){const s=e?!e.fromCache:null===(t=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;i.sharedClientState.updateQueryState(a.targetId,s?"current":"not-current")}if(e){s.push(e);const t=zs.Es(a.targetId,e);r.push(t)}})))})),await Promise.all(o),i.hu.J_(s),await async function(e,t){const n=R(e);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(e=>Ee.forEach(t,(t=>Ee.forEach(t.Is,(i=>n.persistence.referenceDelegate.addReference(e,t.targetId,i))).next((()=>Ee.forEach(t.ds,(i=>n.persistence.referenceDelegate.removeReference(e,t.targetId,i)))))))))}catch(e){if(!Ie(e))throw e;T(Js,"Failed to update sequence numbers: "+e)}for(const e of t){const t=e.targetId;if(!e.fromCache){const e=n.Fs.get(t),i=e.snapshotVersion,s=e.withLastLimboFreeSnapshotVersion(i);n.Fs=n.Fs.insert(t,s)}}}(i.localStore,r))}async function $o(e,t){const n=R(e);if(!n.currentUser.isEqual(t)){T(So,"User change. New user:",t.toKey());const e=await Xs(n.localStore,t);n.currentUser=t,function(e,t){e.Vu.forEach((e=>{e.forEach((e=>{e.reject(new P(M.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.Vu.clear()}(n),n.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await Bo(n,e.Bs)}}function Ko(e,t){const n=R(e),i=n.Eu.get(t);if(i&&i.lu)return Un().add(i.key);{let e=Un();const i=n.Tu.get(t);if(!i)return e;for(const t of i){const i=n.Pu.get(t);e=e.unionWith(i.view.tu)}return e}}function Wo(e){const t=R(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=No.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Ko.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Do.bind(null,t),t.hu.J_=mo.bind(null,t.eventManager),t.hu.pu=po.bind(null,t.eventManager),t}function zo(e){const t=R(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ro.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Mo.bind(null,t),t}class Ho{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=_r(e.databaseInfo.databaseId),this.sharedClientState=this.bu(e),this.persistence=this.Du(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Cu(e,this.localStore),this.indexBackfillerScheduler=this.Fu(e,this.localStore)}Cu(e,t){return null}Fu(e,t){return null}vu(e){return function(e,t,n,i){return new Ys(e,t,n,i)}(this.persistence,new Qs,e.initialUser,this.serializer)}Du(e){return new Bs(Ks.Vi,this.serializer)}bu(e){return new sr}async terminate(){var e,t;null===(e=this.gcScheduler)||void 0===e||e.stop(),null===(t=this.indexBackfillerScheduler)||void 0===t||t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Ho.provider={build:()=>new Ho};class Qo extends Ho{constructor(e){super(),this.cacheSizeBytes=e}Cu(e,t){D(this.persistence.referenceDelegate instanceof Ws,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new As(n,e.asyncQueue,t)}Du(e){const t=void 0!==this.cacheSizeBytes?Is.withCacheSize(this.cacheSizeBytes):Is.DEFAULT;return new Bs((e=>Ws.Vi(e,t)),this.serializer)}}class Jo{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>Lo(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=$o.bind(null,this.syncEngine),await async function(e,t){const n=R(e);t?(n.Ia.delete(2),await Cr(n)):t||(n.Ia.add(2),await Ar(n),n.Aa.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new lo}createDatastore(e){const t=_r(e.databaseInfo.databaseId),n=function(e){return new fr(e)}(e.databaseInfo);return function(e,t,n,i){return new Ir(e,t,n,i)}(e.authCredentials,e.appCheckCredentials,n,t)}createRemoteStore(e){return function(e,t,n,i,s){return new Tr(e,t,n,i,s)}(this.localStore,this.datastore,e.asyncQueue,(e=>Lo(this.syncEngine,e,0)),ar.C()?new ar:new rr)}createSyncEngine(e,t){return function(e,t,n,i,s,r,o){const a=new ko(e,t,n,i,s,r);return o&&(a.fu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=R(e);T(xr,"RemoteStore shutting down."),t.Ia.add(5),await Ar(t),t.Ea.shutdown(),t.Aa.set("Unknown")}(this.remoteStore),null===(e=this.datastore)||void 0===e||e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Jo.provider={build:()=>new Jo};class Yo{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.xu(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.xu(this.observer.error,e):C("Uncaught Error in snapshot listener:",e.toString()))}Ou(){this.muted=!0}xu(e,t){setTimeout((()=>{this.muted||e(t)}),0)}}class Xo{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastTransactionError=null,this.writtenDocs=new Set}async lookup(e){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw this.lastTransactionError=new P(M.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes."),this.lastTransactionError;const t=await async function(e,t){const n=R(e),i={documents:t.map((e=>Yi(n.serializer,e)))},s=await n.Jo("BatchGetDocuments",n.serializer.databaseId,ne.emptyPath(),i,t.length),r=new Map;s.forEach((e=>{const t=function(e,t){return"found"in t?function(e,t){D(!!t.found,43571),t.found.name,t.found.updateTime;const n=Xi(e,t.found.name),i=zi(t.found.updateTime),s=t.found.createTime?zi(t.found.createTime):_e.min(),r=new Pt({mapValue:{fields:t.found.fields}});return Ft.newFoundDocument(n,i,s,r)}(e,t):"missing"in t?function(e,t){D(!!t.missing,3894),D(!!t.readTime,22933);const n=Xi(e,t.missing),i=zi(t.readTime);return Ft.newNoDocument(n,i)}(e,t):N(7234,{result:t})}(n.serializer,e);r.set(t.key.toString(),t)}));const o=[];return t.forEach((e=>{const t=r.get(e.toString());D(!!t,55234,{key:e}),o.push(t)})),o}(this.datastore,e);return t.forEach((e=>this.recordVersion(e))),t}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastTransactionError=e}this.writtenDocs.add(e.toString())}delete(e){this.write(new fi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}async commit(){if(this.ensureCommitNotCalled(),this.lastTransactionError)throw this.lastTransactionError;const e=this.readVersions;this.mutations.forEach((t=>{e.delete(t.key.toString())})),e.forEach(((e,t)=>{const n=re.fromPath(t);this.mutations.push(new gi(n,this.precondition(n)))})),await async function(e,t){const n=R(e),i={writes:t.map((e=>is(n.serializer,e)))};await n.Wo("Commit",n.serializer.databaseId,ne.emptyPath(),i)}(this.datastore,this.mutations),this.committed=!0}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw N(50498,{Wu:e.constructor.name});t=_e.min()}const n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new P(M.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){const t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(_e.min())?ni.exists(!1):ni.updateTime(t):ni.none()}preconditionForUpdate(e){const t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(_e.min()))throw new P(M.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ni.updateTime(t)}return ni.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}}class Zo{constructor(e,t,n,i,s){this.asyncQueue=e,this.datastore=t,this.options=n,this.updateFunction=i,this.deferred=s,this.Gu=n.maxAttempts,this.F_=new yr(this.asyncQueue,"transaction_retry")}zu(){this.Gu-=1,this.ju()}ju(){this.F_.g_((async()=>{const e=new Xo(this.datastore),t=this.Ju(e);t&&t.then((t=>{this.asyncQueue.enqueueAndForget((()=>e.commit().then((()=>{this.deferred.resolve(t)})).catch((e=>{this.Hu(e)}))))})).catch((e=>{this.Hu(e)}))}))}Ju(e){try{const t=this.updateFunction(e);return!xe(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}Hu(e){this.Gu>0&&this.Yu(e)?(this.Gu-=1,this.asyncQueue.enqueueAndForget((()=>(this.ju(),Promise.resolve())))):this.deferred.reject(e)}Yu(e){if("FirebaseError"===e.name){const t=e.code;return"aborted"===t||"failed-precondition"===t||"already-exists"===t||!Ei(t)}return!1}}const ea="FirestoreClient";class ta{constructor(e,t,n,i,s){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=n,this.databaseInfo=i,this.user=E.UNAUTHENTICATED,this.clientId=H.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=s,this.authCredentials.start(n,(async e=>{T(ea,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e})),this.appCheckCredentials.start(n,(e=>(T(ea,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new U;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const n=io(t,"Failed to shutdown persistence");e.reject(n)}})),e.promise}}async function na(e,t){e.asyncQueue.verifyOperationInProgress(),T(ea,"Initializing OfflineComponentProvider");const n=e.configuration;await t.initialize(n);let i=n.initialUser;e.setCredentialChangeListener((async e=>{i.isEqual(e)||(await Xs(t.localStore,e),i=e)})),t.persistence.setDatabaseDeletedListener((()=>{A("Terminating Firestore due to IndexedDb database deletion"),e.terminate().then((()=>{T("Terminating Firestore due to IndexedDb database deletion completed successfully")})).catch((e=>{A("Terminating Firestore due to IndexedDb database deletion failed",e)}))})),e._offlineComponents=t}async function ia(e,t){e.asyncQueue.verifyOperationInProgress();const n=await async function(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){T(ea,"Using user provided OfflineComponentProvider");try{await na(e,e._uninitializedComponentsProvider._offline)}catch(t){const n=t;if(!function(e){return"FirebaseError"===e.name?e.code===M.FAILED_PRECONDITION||e.code===M.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(n))throw n;A("Error using user provided cache. Falling back to memory cache: "+n),await na(e,new Ho)}}else T(ea,"Using default OfflineComponentProvider"),await na(e,new Qo(void 0));return e._offlineComponents}(e);T(ea,"Initializing OnlineComponentProvider"),await t.initialize(n,e.configuration),e.setCredentialChangeListener((e=>Zr(t.remoteStore,e))),e.setAppCheckTokenChangeListener(((e,n)=>Zr(t.remoteStore,n))),e._onlineComponents=t}async function sa(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(T(ea,"Using user provided OnlineComponentProvider"),await ia(e,e._uninitializedComponentsProvider._online)):(T(ea,"Using default OnlineComponentProvider"),await ia(e,new Jo))),e._onlineComponents}async function ra(e){const t=await sa(e),n=t.eventManager;return n.onListen=xo.bind(null,t.syncEngine),n.onUnlisten=Ao.bind(null,t.syncEngine),n.onFirstRemoteStoreListen=To.bind(null,t.syncEngine),n.onLastRemoteStoreUnlisten=Oo.bind(null,t.syncEngine),n}function oa(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const aa=new Map,la="firestore.googleapis.com";class ca{constructor(e){var t,n;if(void 0===e.host){if(void 0!==e.ssl)throw new P(M.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=la,this.ssl=!0}else this.host=e.host,this.ssl=null===(t=e.ssl)||void 0===t||t;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Es;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<1048576)throw new P(M.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,n,i){if(!0===t&&!0===i)throw new P(M.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,e.experimentalForceLongPolling,0,e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=oa(null!==(n=e.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new P(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (must not be NaN)`);if(e.timeoutSeconds<5)throw new P(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (minimum allowed value is 5)`);if(e.timeoutSeconds>30)throw new P(M.INVALID_ARGUMENT,`invalid long polling timeout: ${e.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class ua{constructor(e,t,n,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=n,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ca({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new P(M.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new P(M.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ca(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new q;switch(e.type){case"firstParty":return new B(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new P(M.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=aa.get(e);t&&(T("ComponentProvider","Removing Datastore"),aa.delete(e),t.terminate())}(this),Promise.resolve()}}class da{constructor(e,t,n){this.converter=t,this._query=n,this.type="query",this.firestore=e}withConverter(e){return new da(this.firestore,e,this._query)}}class ha{constructor(e,t,n){this.converter=t,this._key=n,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new ma(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new ha(this.firestore,e,this._key)}toJSON(){return{type:ha._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,n){if(me(t,ha._jsonSchema))return new ha(e,n||null,new re(ne.fromString(t.referencePath)))}}ha._jsonSchemaVersion="firestore/documentReference/1.0",ha._jsonSchema={type:he("string",ha._jsonSchemaVersion),referencePath:he("string")};class ma extends da{constructor(e,t,n){super(e,t,mn(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new ha(this.firestore,null,new re(e))}withConverter(e){return new ma(this.firestore,e,this._path)}}function pa(e,t,...n){if(e=(0,l.m9)(e),oe("collection","path",t),e instanceof ua){const i=ne.fromString(t,...n);return le(i),new ma(e,null,i)}{if(!(e instanceof ha||e instanceof ma))throw new P(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(ne.fromString(t,...n));return le(i),new ma(e.firestore,null,i)}}function fa(e,t,...n){if(e=(0,l.m9)(e),1===arguments.length&&(t=H.newId()),oe("doc","path",t),e instanceof ua){const i=ne.fromString(t,...n);return ae(i),new ha(e,null,new re(i))}{if(!(e instanceof ha||e instanceof ma))throw new P(M.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=e._path.child(ne.fromString(t,...n));return ae(i),new ha(e.firestore,e instanceof ma?e.converter:null,new re(i))}}const ga="AsyncQueue";class _a{constructor(e=Promise.resolve()){this.Zu=[],this.Xu=!1,this.ec=[],this.tc=null,this.nc=!1,this.rc=!1,this.sc=[],this.F_=new yr(this,"async_queue_retry"),this.oc=()=>{const e=gr();e&&T(ga,"Visibility state changed to "+e.visibilityState),this.F_.y_()},this._c=e;const t=gr();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this.oc)}get isShuttingDown(){return this.Xu}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.ac(),this.uc(e)}enterRestrictedMode(e){if(!this.Xu){this.Xu=!0,this.rc=e||!1;const t=gr();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.oc)}}enqueue(e){if(this.ac(),this.Xu)return new Promise((()=>{}));const t=new U;return this.uc((()=>this.Xu&&this.rc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise))).then((()=>t.promise))}enqueueRetryable(e){this.enqueueAndForget((()=>(this.Zu.push(e),this.cc())))}async cc(){if(0!==this.Zu.length){try{await this.Zu[0](),this.Zu.shift(),this.F_.reset()}catch(e){if(!Ie(e))throw e;T(ga,"Operation failed with retryable error: "+e)}this.Zu.length>0&&this.F_.g_((()=>this.cc()))}}uc(e){const t=this._c.then((()=>(this.nc=!0,e().catch((e=>{throw this.tc=e,this.nc=!1,C("INTERNAL UNHANDLED ERROR: ",ya(e)),e})).then((e=>(this.nc=!1,e))))));return this._c=t,t}enqueueAfterDelay(e,t,n){this.ac(),this.sc.indexOf(e)>-1&&(t=0);const i=no.createAndSchedule(this,e,t,n,(e=>this.lc(e)));return this.ec.push(i),i}ac(){this.tc&&N(47125,{hc:ya(this.tc)})}verifyOperationInProgress(){}async Pc(){let e;do{e=this._c,await e}while(e!==this._c)}Tc(e){for(const t of this.ec)if(t.timerId===e)return!0;return!1}Ic(e){return this.Pc().then((()=>{this.ec.sort(((e,t)=>e.targetTimeMs-t.targetTimeMs));for(const t of this.ec)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Pc()}))}dc(e){this.sc.push(e)}lc(e){const t=this.ec.indexOf(e);this.ec.splice(t,1)}}function ya(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function wa(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const n=e;for(const e of["next","error","complete"])if(e in n&&"function"==typeof n[e])return!0;return!1}(e)}class va extends ua{constructor(e,t,n,i){super(e,t,n,i),this.type="firestore",this._queue=new _a,this._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new _a(e),this._firestoreClient=void 0,await e}}}function ba(e,t){const n="object"==typeof e?e:(0,r.Mq)(),i="string"==typeof e?e:t||dt,s=(0,r.qX)(n,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=(0,l.P0)("firestore");e&&function(e,t,n,i={}){var s;e=de(e,ua);const r=(0,l.Xx)(t),o=e._getSettings(),a=Object.assign(Object.assign({},o),{emulatorOptions:e._getEmulatorOptions()}),c=`${t}:${n}`;r&&((0,l.Uo)(`https://${c}`),(0,l.dp)("Firestore",!0)),o.host!==la&&o.host!==c&&A("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const u=Object.assign(Object.assign({},o),{host:c,ssl:r,emulatorOptions:i});if(!(0,l.vZ)(u,a)&&(e._setSettings(u),i.mockUserToken)){let t,n;if("string"==typeof i.mockUserToken)t=i.mockUserToken,n=E.MOCK_USER;else{t=(0,l.Sg)(i.mockUserToken,null===(s=e._app)||void 0===s?void 0:s.options.projectId);const r=i.mockUserToken.sub||i.mockUserToken.user_id;if(!r)throw new P(M.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new E(r)}e._authCredentials=new j(new F(t,n))}}(s,...e)}return s}function Sa(e){if(e._terminated)throw new P(M.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||function(e){var t,n,i;const s=e._freezeSettings(),r=function(e,t,n,i){return new ut(e,t,n,i.host,i.ssl,i.experimentalForceLongPolling,i.experimentalAutoDetectLongPolling,oa(i.experimentalLongPollingOptions),i.useFetchStreams,i.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,s);e._componentsProvider||(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(i=s.localCache)||void 0===i?void 0:i._onlineComponentProvider)&&(e._componentsProvider={_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider}),e._firestoreClient=new ta(e._authCredentials,e._appCheckCredentials,e._queue,r,e._componentsProvider&&function(e){const t=null==e?void 0:e._online.build();return{_offline:null==e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}(e),e._firestoreClient}class Ea{constructor(e){this._byteString=e}static fromBase64String(e){try{return new Ea(Xe.fromBase64String(e))}catch(e){throw new P(M.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new Ea(Xe.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:Ea._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(me(e,Ea._jsonSchema))return Ea.fromBase64String(e.bytes)}}Ea._jsonSchemaVersion="firestore/bytes/1.0",Ea._jsonSchema={type:he("string",Ea._jsonSchemaVersion),bytes:he("string")};class Ia{constructor(...e){for(let t=0;t<e.length;++t)if(0===e[t].length)throw new P(M.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new se(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ka{constructor(e){this._methodName=e}}class xa{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new P(M.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new P(M.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Q(this._lat,e._lat)||Q(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:xa._jsonSchemaVersion}}static fromJSON(e){if(me(e,xa._jsonSchema))return new xa(e.latitude,e.longitude)}}xa._jsonSchemaVersion="firestore/geoPoint/1.0",xa._jsonSchema={type:he("string",xa._jsonSchemaVersion),latitude:he("number"),longitude:he("number")};class Ta{constructor(e){this._values=(e||[]).map((e=>e))}toArray(){return this._values.map((e=>e))}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(this._values,e._values)}toJSON(){return{type:Ta._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(me(e,Ta._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every((e=>"number"==typeof e)))return new Ta(e.vectorValues);throw new P(M.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ta._jsonSchemaVersion="firestore/vectorValue/1.0",Ta._jsonSchema={type:he("string",Ta._jsonSchemaVersion),vectorValues:he("object")};const Ca=/^__.*__$/;class Aa{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return null!==this.fieldMask?new di(e,this.data,this.fieldMask,t,this.fieldTransforms):new ui(e,this.data,t,this.fieldTransforms)}}class Oa{constructor(e,t,n){this.data=e,this.fieldMask=t,this.fieldTransforms=n}toMutation(e,t){return new di(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function Na(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw N(40011,{Ec:e})}}class La{constructor(e,t,n,i,s,r){this.settings=e,this.databaseId=t,this.serializer=n,this.ignoreUndefinedProperties=i,void 0===s&&this.Ac(),this.fieldTransforms=s||[],this.fieldMask=r||[]}get path(){return this.settings.path}get Ec(){return this.settings.Ec}Rc(e){return new La(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Vc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Rc({path:n,mc:!1});return i.fc(e),i}gc(e){var t;const n=null===(t=this.path)||void 0===t?void 0:t.child(e),i=this.Rc({path:n,mc:!1});return i.Ac(),i}yc(e){return this.Rc({path:void 0,mc:!0})}wc(e){return Qa(e,this.settings.methodName,this.settings.Sc||!1,this.path,this.settings.bc)}contains(e){return void 0!==this.fieldMask.find((t=>e.isPrefixOf(t)))||void 0!==this.fieldTransforms.find((t=>e.isPrefixOf(t.field)))}Ac(){if(this.path)for(let e=0;e<this.path.length;e++)this.fc(this.path.get(e))}fc(e){if(0===e.length)throw this.wc("Document fields must not be empty");if(Na(this.Ec)&&Ca.test(e))throw this.wc('Document fields cannot begin and end with "__"')}}class Da{constructor(e,t,n){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=n||_r(e)}Dc(e,t,n,i=!1){return new La({Ec:e,methodName:t,bc:n,path:se.emptyPath(),mc:!1,Sc:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Ra(e){const t=e._freezeSettings(),n=_r(e._databaseId);return new Da(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Ma(e,t,n,i,s,r={}){const o=e.Dc(r.merge||r.mergeFields?2:0,t,n,s);Ka("Data must be an object, but it was:",o,i);const a=Ba(i,o);let l,c;if(r.merge)l=new Je(o.fieldMask),c=o.fieldTransforms;else if(r.mergeFields){const e=[];for(const i of r.mergeFields){const s=Wa(t,i,n);if(!o.contains(s))throw new P(M.INVALID_ARGUMENT,`Field '${s}' is specified in your field mask but missing from your input data.`);Ja(e,s)||e.push(s)}l=new Je(e),c=o.fieldTransforms.filter((e=>l.covers(e.field)))}else l=null,c=o.fieldTransforms;return new Aa(new Pt(a),l,c)}class Pa extends ka{_toFieldTransform(e){if(2!==e.Ec)throw 1===e.Ec?e.wc(`${this._methodName}() can only appear at the top level of your update data`):e.wc(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof Pa}}class Ua extends ka{_toFieldTransform(e){return new ei(e.path,new Wn)}isEqual(e){return e instanceof Ua}}class Fa extends ka{constructor(e,t){super(e),this.vc=t}_toFieldTransform(e){const t=function(e,t,n){return new La({Ec:3,bc:t.settings.bc,methodName:e._methodName,mc:n},t.databaseId,t.serializer,t.ignoreUndefinedProperties)}(this,e,!0),n=this.vc.map((e=>Ga(e,t))),i=new zn(n);return new ei(e.path,i)}isEqual(e){return e instanceof Fa&&(0,l.vZ)(this.vc,e.vc)}}class qa extends ka{constructor(e,t){super(e),this.Cc=t}_toFieldTransform(e){const t=new Yn(e.serializer,Vn(e.serializer,this.Cc));return new ei(e.path,t)}isEqual(e){return e instanceof qa&&this.Cc===e.Cc}}function ja(e,t,n,i){const s=e.Dc(1,t,n);Ka("Data must be an object, but it was:",s,i);const r=[],o=Pt.empty();Be(i,((e,i)=>{const a=Ha(t,e,n);i=(0,l.m9)(i);const c=s.gc(a);if(i instanceof Pa)r.push(a);else{const e=Ga(i,c);null!=e&&(r.push(a),o.set(a,e))}}));const a=new Je(r);return new Oa(o,a,s.fieldTransforms)}function Va(e,t,n,i,s,r){const o=e.Dc(1,t,n),a=[Wa(t,i,n)],c=[s];if(r.length%2!=0)throw new P(M.INVALID_ARGUMENT,`Function ${t}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let e=0;e<r.length;e+=2)a.push(Wa(t,r[e])),c.push(r[e+1]);const u=[],d=Pt.empty();for(let e=a.length-1;e>=0;--e)if(!Ja(u,a[e])){const t=a[e];let n=c[e];n=(0,l.m9)(n);const i=o.gc(t);if(n instanceof Pa)u.push(t);else{const e=Ga(n,i);null!=e&&(u.push(t),d.set(t,e))}}const h=new Je(u);return new Oa(d,h,o.fieldTransforms)}function Ga(e,t){if($a(e=(0,l.m9)(e)))return Ka("Unsupported field value:",t,e),Ba(e,t);if(e instanceof ka)return function(e,t){if(!Na(t.Ec))throw t.wc(`${e._methodName}() can only be used with update() and set()`);if(!t.path)throw t.wc(`${e._methodName}() is not currently supported inside arrays`);const n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.mc&&4!==t.Ec)throw t.wc("Nested arrays are not supported");return function(e,t){const n=[];let i=0;for(const s of e){let e=Ga(s,t.yc(i));null==e&&(e={nullValue:"NULL_VALUE"}),n.push(e),i++}return{arrayValue:{values:n}}}(e,t)}return function(e,t){if(null===(e=(0,l.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return Vn(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const n=ge.fromDate(e);return{timestampValue:$i(t.serializer,n)}}if(e instanceof ge){const n=new ge(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:$i(t.serializer,n)}}if(e instanceof xa)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ea)return{bytesValue:Ki(t.serializer,e._byteString)};if(e instanceof ha){const n=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(n))throw t.wc(`Document reference is for database ${i.projectId}/${i.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Hi(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof Ta)return function(e,t){return{mapValue:{fields:{[mt]:{stringValue:gt},[_t]:{arrayValue:{values:e.toArray().map((e=>{if("number"!=typeof e)throw t.wc("VectorValues must only contain numeric values.");return qn(t.serializer,e)}))}}}}}}(e,t);throw t.wc(`Unsupported field value: ${ue(e)}`)}(e,t)}function Ba(e,t){const n={};return $e(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Be(e,((e,i)=>{const s=Ga(i,t.Vc(e));null!=s&&(n[e]=s)})),{mapValue:{fields:n}}}function $a(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ge||e instanceof xa||e instanceof Ea||e instanceof ha||e instanceof ka||e instanceof Ta)}function Ka(e,t,n){if(!$a(n)||!ce(n)){const i=ue(n);throw"an object"===i?t.wc(e+" a custom object"):t.wc(e+" "+i)}}function Wa(e,t,n){if((t=(0,l.m9)(t))instanceof Ia)return t._internalPath;if("string"==typeof t)return Ha(e,t);throw Qa("Field path arguments must be of type string or ",e,!1,void 0,n)}const za=new RegExp("[~\\*/\\[\\]]");function Ha(e,t,n){if(t.search(za)>=0)throw Qa(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,e,!1,void 0,n);try{return new Ia(...t.split("."))._internalPath}catch(i){throw Qa(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,e,!1,void 0,n)}}function Qa(e,t,n,i,s){const r=i&&!i.isEmpty(),o=void 0!==s;let a=`Function ${t}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(r||o)&&(l+=" (found",r&&(l+=` in field ${i}`),o&&(l+=` in document ${s}`),l+=")"),new P(M.INVALID_ARGUMENT,a+e+l)}function Ja(e,t){return e.some((e=>e.isEqual(t)))}class Ya{constructor(e,t,n,i,s){this._firestore=e,this._userDataWriter=t,this._key=n,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new ha(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Xa(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Za("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Xa extends Ya{data(){return super.data()}}function Za(e,t){return"string"==typeof t?Ha(e,t):t instanceof Ia?t._internalPath:t._delegate._internalPath}function el(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new P(M.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class tl{}class nl extends tl{}function il(e,t,...n){let i=[];t instanceof tl&&i.push(t),i=i.concat(n),function(e){const t=e.filter((e=>e instanceof ol)).length,n=e.filter((e=>e instanceof sl)).length;if(t>1||t>0&&n>0)throw new P(M.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(i);for(const t of i)e=t._apply(e);return e}class sl extends nl{constructor(e,t,n){super(),this._field=e,this._op=t,this._value=n,this.type="where"}static _create(e,t,n){return new sl(e,t,n)}_apply(e){const t=this._parse(e);return cl(e._query,t),new da(e.firestore,e.converter,yn(e._query,t))}_parse(e){const t=Ra(e.firestore),n=function(e,t,n,i,s,r,o){let a;if(s.isKeyField()){if("array-contains"===r||"array-contains-any"===r)throw new P(M.INVALID_ARGUMENT,`Invalid Query. You can't perform '${r}' queries on documentId().`);if("in"===r||"not-in"===r){ll(o,r);const t=[];for(const n of o)t.push(al(i,e,n));a={arrayValue:{values:t}}}else a=al(i,e,o)}else"in"!==r&&"not-in"!==r&&"array-contains-any"!==r||ll(o,r),a=function(e,t,n,i=!1){return Ga(n,e.Dc(i?4:3,t))}(n,"where",o,"in"===r||"not-in"===r);return Kt.create(s,r,a)}(e._query,0,t,e.firestore._databaseId,this._field,this._op,this._value);return n}}function rl(e,t,n){const i=t,s=Za("where",e);return sl._create(s,i,n)}class ol extends tl{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new ol(e,t)}_parse(e){const t=this._queryConstraints.map((t=>t._parse(e))).filter((e=>e.getFilters().length>0));return 1===t.length?t[0]:Wt.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let n=e;const i=t.getFlattenedFilters();for(const e of i)cl(n,e),n=yn(n,e)}(e._query,t),new da(e.firestore,e.converter,yn(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}function al(e,t,n){if("string"==typeof(n=(0,l.m9)(n))){if(""===n)throw new P(M.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!fn(t)&&-1!==n.indexOf("/"))throw new P(M.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${n}' contains a '/' character.`);const i=t.path.child(ne.fromString(n));if(!re.isDocumentKey(i))throw new P(M.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Tt(e,new re(i))}if(n instanceof ha)return Tt(e,n._key);throw new P(M.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${ue(n)}.`)}function ll(e,t){if(!Array.isArray(e)||0===e.length)throw new P(M.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function cl(e,t){const n=function(e,t){for(const n of e)for(const e of n.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==n)throw n===t.op?new P(M.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new P(M.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${n.toString()}' filters.`)}class ul{convertValue(e,t="none"){switch(yt(e)){case 0:return null;case 1:return e.booleanValue;case 2:return tt(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(nt(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw N(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){const n={};return Be(e,((e,i)=>{n[e]=this.convertValue(i,t)})),n}convertVectorValue(e){var t,n,i;const s=null===(i=null===(n=null===(t=e.fields)||void 0===t?void 0:t[_t].arrayValue)||void 0===n?void 0:n.values)||void 0===i?void 0:i.map((e=>tt(e.doubleValue)));return new Ta(s)}convertGeoPoint(e){return new xa(tt(e.latitude),tt(e.longitude))}convertArray(e,t){return(e.values||[]).map((e=>this.convertValue(e,t)))}convertServerTimestamp(e,t){switch(t){case"previous":const n=lt(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(ct(e));default:return null}}convertTimestamp(e){const t=et(e);return new ge(t.seconds,t.nanos)}convertDocumentKey(e,t){const n=ne.fromString(e);D(fs(n),9688,{name:e});const i=new ht(n.get(1),n.get(3)),s=new re(n.popFirst(5));return i.isEqual(t)||C(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}}function dl(e,t,n){let i;return i=e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t,i}class hl extends ul{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ea(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ha(this.firestore,null,t)}}class ml{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class pl extends Ya{constructor(e,t,n,i,s,r){super(e,t,n,i,r),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document){if(this._converter){const t=new fl(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e,t={}){if(this._document){const n=this._document.data.field(Za("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new P(M.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=pl._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}pl._jsonSchemaVersion="firestore/documentSnapshot/1.0",pl._jsonSchema={type:he("string",pl._jsonSchemaVersion),bundleSource:he("string","DocumentSnapshot"),bundleName:he("string"),bundle:he("string")};class fl extends pl{data(e={}){return super.data(e)}}class gl{constructor(e,t,n,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new ml(i.hasPendingWrites,i.fromCache),this.query=n}get docs(){const e=[];return this.forEach((t=>e.push(t))),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach((n=>{e.call(t,new fl(this._firestore,this._userDataWriter,n.key,n,new ml(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(e={}){const t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new P(M.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map((n=>{const i=new fl(e._firestore,e._userDataWriter,n.doc.key,n.doc,new ml(e._snapshot.mutatedKeys.has(n.doc.key),e._snapshot.fromCache),e.query.converter);return n.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}}))}{let n=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((e=>t||3!==e.type)).map((t=>{const i=new fl(e._firestore,e._userDataWriter,t.doc.key,t.doc,new ml(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let s=-1,r=-1;return 0!==t.type&&(s=n.indexOf(t.doc.key),n=n.delete(t.doc.key)),1!==t.type&&(n=n.add(t.doc),r=n.indexOf(t.doc.key)),{type:_l(t.type),doc:i,oldIndex:s,newIndex:r}}))}}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new P(M.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=gl._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=H.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],n=[],i=[];return this.docs.forEach((e=>{null!==e._document&&(t.push(e._document),n.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),i.push(e.ref.path))})),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function _l(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return N(61501,{type:e})}}function yl(e){e=de(e,ha);const t=de(e.firestore,va);return function(e,t,n={}){const i=new U;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,s){const r=new Yo({next:a=>{r.Ou(),t.enqueueAndForget((()=>ho(e,o)));const l=a.docs.has(n);!l&&a.fromCache?s.reject(new P(M.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&i&&"server"===i.source?s.reject(new P(M.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(a)},error:e=>s.reject(e)}),o=new yo(mn(n.path),r,{includeMetadataChanges:!0,ka:!0});return uo(e,o)}(await ra(e),e.asyncQueue,t,n,i))),i.promise}(Sa(t),e._key).then((n=>kl(t,e,n)))}gl._jsonSchemaVersion="firestore/querySnapshot/1.0",gl._jsonSchema={type:he("string",gl._jsonSchemaVersion),bundleSource:he("string","QuerySnapshot"),bundleName:he("string"),bundle:he("string")};class wl extends ul{constructor(e){super(),this.firestore=e}convertBytes(e){return new Ea(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new ha(this.firestore,null,t)}}function vl(e){e=de(e,da);const t=de(e.firestore,va),n=Sa(t),i=new wl(t);return el(e._query),function(e,t,n={}){const i=new U;return e.asyncQueue.enqueueAndForget((async()=>function(e,t,n,i,s){const r=new Yo({next:n=>{r.Ou(),t.enqueueAndForget((()=>ho(e,o))),n.fromCache&&"server"===i.source?s.reject(new P(M.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):s.resolve(n)},error:e=>s.reject(e)}),o=new yo(n,r,{includeMetadataChanges:!0,ka:!0});return uo(e,o)}(await ra(e),e.asyncQueue,t,n,i))),i.promise}(n,e._query).then((n=>new gl(t,i,e,n)))}function bl(e,t,n){e=de(e,ha);const i=de(e.firestore,va),s=dl(e.converter,t,n);return Il(i,[Ma(Ra(i),"setDoc",e._key,s,null!==e.converter,n).toMutation(e._key,ni.none())])}function Sl(e,t,n,...i){e=de(e,ha);const s=de(e.firestore,va),r=Ra(s);let o;return o="string"==typeof(t=(0,l.m9)(t))||t instanceof Ia?Va(r,"updateDoc",e._key,t,n,i):ja(r,"updateDoc",e._key,t),Il(s,[o.toMutation(e._key,ni.exists(!0))])}function El(e,...t){var n,i,s;e=(0,l.m9)(e);let r={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof t[o]||wa(t[o])||(r=t[o++]);const a={includeMetadataChanges:r.includeMetadataChanges,source:r.source};if(wa(t[o])){const e=t[o];t[o]=null===(n=e.next)||void 0===n?void 0:n.bind(e),t[o+1]=null===(i=e.error)||void 0===i?void 0:i.bind(e),t[o+2]=null===(s=e.complete)||void 0===s?void 0:s.bind(e)}let c,u,d;if(e instanceof ha)u=de(e.firestore,va),d=mn(e._key.path),c={next:n=>{t[o]&&t[o](kl(u,e,n))},error:t[o+1],complete:t[o+2]};else{const n=de(e,da);u=de(n.firestore,va),d=n._query;const i=new wl(u);c={next:e=>{t[o]&&t[o](new gl(u,i,n,e))},error:t[o+1],complete:t[o+2]},el(e._query)}return function(e,t,n,i){const s=new Yo(i),r=new yo(t,s,n);return e.asyncQueue.enqueueAndForget((async()=>uo(await ra(e),r))),()=>{s.Ou(),e.asyncQueue.enqueueAndForget((async()=>ho(await ra(e),r)))}}(Sa(u),d,a,c)}function Il(e,t){return function(e,t){const n=new U;return e.asyncQueue.enqueueAndForget((async()=>async function(e,t,n){const i=zo(e);try{const e=await function(e,t){const n=R(e),i=ge.now(),s=t.reduce(((e,t)=>e.add(t.key)),Un());let r,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(e=>{let a=Cn(),l=Un();return n.Os.getEntries(e,s).next((e=>{a=e,a.forEach(((e,t)=>{t.isValidDocument()||(l=l.add(e))}))})).next((()=>n.localDocuments.getOverlayedDocuments(e,a))).next((s=>{r=s;const o=[];for(const e of t){const t=li(e,r.get(e.key).overlayedDocument);null!=t&&o.push(new di(e.key,t,Ut(t.value.mapValue),ni.exists(!0)))}return n.mutationQueue.addMutationBatch(e,i,o,t)})).next((t=>{o=t;const i=t.applyToLocalDocumentSet(r,l);return n.documentOverlayCache.saveOverlays(e,t.batchId,i)}))})).then((()=>({batchId:o.batchId,changes:Nn(r)})))}(i.localStore,t);i.sharedClientState.addPendingMutation(e.batchId),function(e,t,n){let i=e.Ru[e.currentUser.toKey()];i||(i=new Ke(Q)),i=i.insert(t,n),e.Ru[e.currentUser.toKey()]=i}(i,e.batchId,n),await Bo(i,e.changes),await $r(i.remoteStore)}catch(e){const t=io(e,"Failed to persist write");n.reject(t)}}(await function(e){return sa(e).then((e=>e.syncEngine))}(e),t,n))),n.promise}(Sa(e),t)}function kl(e,t,n){const i=n.docs.get(t._key),s=new wl(e);return new pl(e,s,t._key,i,new ml(n.hasPendingWrites,n.fromCache),t.converter)}const xl={maxAttempts:5};class Tl{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Ra(e)}set(e,t,n){this._verifyNotCommitted();const i=Cl(e,this._firestore),s=dl(i.converter,t,n),r=Ma(this._dataReader,"WriteBatch.set",i._key,s,null!==i.converter,n);return this._mutations.push(r.toMutation(i._key,ni.none())),this}update(e,t,n,...i){this._verifyNotCommitted();const s=Cl(e,this._firestore);let r;return r="string"==typeof(t=(0,l.m9)(t))||t instanceof Ia?Va(this._dataReader,"WriteBatch.update",s._key,t,n,i):ja(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(r.toMutation(s._key,ni.exists(!0))),this}delete(e){this._verifyNotCommitted();const t=Cl(e,this._firestore);return this._mutations=this._mutations.concat(new fi(t._key,ni.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new P(M.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}function Cl(e,t){if((e=(0,l.m9)(e)).firestore!==t)throw new P(M.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}class Al{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Ra(e)}get(e){const t=Cl(e,this._firestore),n=new hl(this._firestore);return this._transaction.lookup([t._key]).then((e=>{if(!e||1!==e.length)return N(24041);const i=e[0];if(i.isFoundDocument())return new Ya(this._firestore,n,i.key,i,t.converter);if(i.isNoDocument())return new Ya(this._firestore,n,t._key,null,t.converter);throw N(18433,{doc:i})}))}set(e,t,n){const i=Cl(e,this._firestore),s=dl(i.converter,t,n),r=Ma(this._dataReader,"Transaction.set",i._key,s,null!==i.converter,n);return this._transaction.set(i._key,r),this}update(e,t,n,...i){const s=Cl(e,this._firestore);let r;return r="string"==typeof(t=(0,l.m9)(t))||t instanceof Ia?Va(this._dataReader,"Transaction.update",s._key,t,n,i):ja(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,r),this}delete(e){const t=Cl(e,this._firestore);return this._transaction.delete(t._key),this}}class Ol extends Al{constructor(e,t){super(e,t),this._firestore=e}get(e){const t=Cl(e,this._firestore),n=new wl(this._firestore);return super.get(e).then((e=>new pl(this._firestore,n,t._key,e._document,new ml(!1,!1),t.converter)))}}function Nl(e,t,n){e=de(e,va);const i=Object.assign(Object.assign({},xl),n);return function(e){if(e.maxAttempts<1)throw new P(M.INVALID_ARGUMENT,"Max attempts must be at least 1")}(i),function(e,t,n){const i=new U;return e.asyncQueue.enqueueAndForget((async()=>{const s=await function(e){return sa(e).then((e=>e.datastore))}(e);new Zo(e.asyncQueue,s,n,t,i).zu()})),i.promise}(Sa(e),(n=>t(new Ol(e,n))),i)}function Ll(){return new Ua("serverTimestamp")}function Dl(...e){return new Fa("arrayUnion",e)}function Rl(e){return new qa("increment",e)}function Ml(e){return Sa(e=de(e,va)),new Tl(e,(t=>Il(e,t)))}new WeakMap,function(e,t=!0){!function(e){I=e}(r.Jn),(0,r.Xd)(new o.wA("firestore",((e,{instanceIdentifier:n,options:i})=>{const s=e.getProvider("app").getImmediate(),r=new va(new V(e.getProvider("auth-internal")),new K(s,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new P(M.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ht(e.options.projectId,t)}(s,n),s);return i=Object.assign({useFetchStreams:t},i),r._setSettings(i),r}),"PUBLIC").setMultipleInstances(!0)),(0,r.KN)(b,S,e),(0,r.KN)(b,S,"esm2017")}()},4147:e=>{"use strict";e.exports=JSON.parse('{"name":"facebook-marketplace-bot","version":"25.0716.444","description":"","main":"contentscript.js","dependencies":{"acorn":"^8.8.1","firebase":"^11.2.0","graceful-fs":"^4.2.10","javascript-obfuscator":"^4.0.0","mel-spintax":"^1.0.4","path":"^0.12.7","webpack-cli":"^4.9.2"},"scripts":{"build":"npm run version_update && webpack && node ./generateScript.js && npm run show_version","debug":"node debugger.js","lint":"eslint .","test":"echo \\"Error: no test specified\\" && exit 1","version_update_old":"npm version patch --no-git-tag-version","version_update":"node ./version_updater.js","deploy-traderonly":"surge dist/","show_version":"npm -s run env echo \'$npm_package_version\'"},"repository":{"type":"git","url":"git+ssh://git@bitbucket.org/hopla-tools/offerupbot.git"},"author":"Silver Serate","license":"ISC","homepage":"https://bitbucket.org/hopla-tools/offerupbot#readme","devDependencies":{"eslint":"^8.55.0","source-map":"^0.7.4","webpack":"^5.74.0","webpack-obfuscator":"^3.5.1"}}')}},t={};function n(i){var s=t[i];if(void 0!==s)return s.exports;var r=t[i]={exports:{}};return e[i](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var i in t)n.o(t,i)&&!n.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{if(window.isAlreadyInjected)throw new Error("Marketplace Bot is already injected to this page.");window.isAlreadyInjected=!0;const{showAlerts:e}=n(1203),{getConsoleMessages:t}=n(3539),{injectMdl:i}=n(4559),{injectStyle:s}=n(5729),{insertUI:r}=n(642),{isInjectedToOtherTab:o}=n(5779),{loadInputs:a}=n(5489),{onSessionReady:l}=n(1585),{_apiSendBug:c}=n(4484),{version:u}=n(4147),{chromeStorageListKeys:d}=n(1334),{loadOpenAIApiKey:h}=n(9309),{waitForLogin:m}=n(3253),{setupGlobalErrorHandlers:p}=n(2497),{insertDraggableIcon:f}=n(584),{initFirebase:g}=n(6081),{getInstanceId:_}=n(1311),{getCurrentListingInfo:y}=n(4388),{listenNetworkEvents:w}=n(6077),{initMdl:v}=n(4118),{skips:b}=n(8521);(async()=>{if(window.extension_version=u,window.messagesSent=0,window.iStreaks=0,unsafeWindow.isRun=0,window.isViewMode=!0,window.tabId=Math.round(1e4*Math.random()),window.textMatchIndex={},window.isEnterprise=!1,window.isKO=!1,window.debug=!1,unsafeWindow.skips=b,await o())console.error("Facebook Marketplace Bot is already inject in another tab.");else{window.instanceId=await _(),console.log(`Marketplace Bot Version ${window.extension_version}`),unsafeWindow.getCurrentListingInfo=y;try{!function(){"use strict";e&&alert("Facebook Marketplace Bot has been injected!"),f(),g();try{w(),async function(){p(),s(),await t(),r(),h(),i(),v(),await a(),m(l)}()}catch(e){console.error("Bot crashed. offline",e),c({error:"Found error in the bot.",info:e.toString()})}unsafeWindow.chromeStorageListKeys=d,console.log("Facebook Marketplace Bot is ready!")}()}catch(e){console.trace(),console.error("caught error",e),console.log("Caught error. Will restart bot."),c({error:"Found error in the bot.",info:e.toString()})}}})()})()})();
//# sourceMappingURL=bundle.js.map




})();